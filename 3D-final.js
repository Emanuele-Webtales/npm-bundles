import*as e from"react";import t,{useReducer as n,useRef as r,useDebugValue as i,useEffect as s,useLayoutEffect as a,useState as o,useMemo as l}from"react";import{jsx as u}from"react/jsx-runtime";function c(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const d="174",h=0,p=1,f=2,m=2,g=100,v=101,y=102,_=200,x=201,b=202,S=203,T=204,w=205,M=206,E=207,A=208,C=209,R=210,N=211,P=212,I=213,L=214,U=0,D=1,F=2,B=3,O=4,k=5,z=6,V=7,G="attached",H="detached",W=300,j=301,q=302,X=303,$=304,Y=306,K=1e3,Q=1001,Z=1002,J=1003,ee=1004,te=1005,ne=1006,re=1007,ie=1008,se=1009,ae=1010,oe=1011,le=1012,ue=1013,ce=1014,de=1015,he=1016,pe=1017,fe=1018,me=1020,ge=35902,ve=1021,ye=1022,_e=1023,xe=1024,be=1025,Se=1026,Te=1027,we=1028,Me=1029,Ee=1030,Ae=1031,Ce=1033,Re=33776,Ne=33777,Pe=33778,Ie=33779,Le=35840,Ue=35841,De=35842,Fe=35843,Be=36196,Oe=37492,ke=37496,ze=37808,Ve=37809,Ge=37810,He=37811,We=37812,je=37813,qe=37814,Xe=37815,$e=37816,Ye=37817,Ke=37818,Qe=37819,Ze=37820,Je=37821,et=36492,tt=36494,nt=36495,rt=36283,it=36284,st=36285,at=36286,ot=2300,lt=2301,ut=2302,ct=2400,dt=2401,ht=2402,pt=2500,ft=2501,mt="",gt="srgb",vt="srgb-linear",yt="linear",_t="srgb",xt=7680,bt=519,St=512,Tt=513,wt=514,Mt=515,Et=516,At=517,Ct=518,Rt=519,Nt=35044,Pt=35048,It="300 es",Lt=2e3,Ut=2001;class Dt{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return void 0!==n&&(void 0!==n[e]&&-1!==n[e].indexOf(t))}removeEventListener(e,t){const n=this._listeners;if(void 0===n)return;const r=n[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){const t=this._listeners;if(void 0===t)return;const n=t[e.type];if(void 0!==n){e.target=this;const t=n.slice(0);for(let n=0,r=t.length;n<r;n++)t[n].call(this,e);e.target=null}}}const Ft=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Bt=1234567;const Ot=Math.PI/180,kt=180/Math.PI;function zt(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Ft[255&e]+Ft[e>>8&255]+Ft[e>>16&255]+Ft[e>>24&255]+"-"+Ft[255&t]+Ft[t>>8&255]+"-"+Ft[t>>16&15|64]+Ft[t>>24&255]+"-"+Ft[63&n|128]+Ft[n>>8&255]+"-"+Ft[n>>16&255]+Ft[n>>24&255]+Ft[255&r]+Ft[r>>8&255]+Ft[r>>16&255]+Ft[r>>24&255]).toLowerCase()}function Vt(e,t,n){return Math.max(t,Math.min(n,e))}function Gt(e,t){return(e%t+t)%t}function Ht(e,t,n){return(1-n)*e+n*t}function Wt(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return e/4294967295;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int32Array:return Math.max(e/2147483647,-1);case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function jt(e,t){switch(t.constructor){case Float32Array:return e;case Uint32Array:return Math.round(4294967295*e);case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int32Array:return Math.round(2147483647*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}const qt={DEG2RAD:Ot,RAD2DEG:kt,generateUUID:zt,clamp:Vt,euclideanModulo:Gt,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:Ht,damp:function(e,t,n,r){return Ht(e,t,1-Math.exp(-n*r))},pingpong:function(e,t=1){return t-Math.abs(Gt(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(Bt=e);let t=Bt+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*Ot},radToDeg:function(e){return e*kt},isPowerOfTwo:function(e){return!(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){const s=Math.cos,a=Math.sin,o=s(n/2),l=a(n/2),u=s((t+r)/2),c=a((t+r)/2),d=s((t-r)/2),h=a((t-r)/2),p=s((r-t)/2),f=a((r-t)/2);switch(i){case"XYX":e.set(o*c,l*d,l*h,o*u);break;case"YZY":e.set(l*h,o*c,l*d,o*u);break;case"ZXZ":e.set(l*d,l*h,o*c,o*u);break;case"XZX":e.set(o*c,l*f,l*p,o*u);break;case"YXY":e.set(l*p,o*c,l*f,o*u);break;case"ZYZ":e.set(l*f,l*p,o*c,o*u)}},normalize:jt,denormalize:Wt};class Xt{constructor(e=0,t=0){Xt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Vt(this.x,e.x,t.x),this.y=Vt(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Vt(this.x,e,t),this.y=Vt(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Vt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Vt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,s=this.y-e.y;return this.x=i*n-s*r+e.x,this.y=i*r+s*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class $t{constructor(e,t,n,r,i,s,a,o,l){$t.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,s,a,o,l)}set(e,t,n,r,i,s,a,o,l){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=i,u[5]=o,u[6]=n,u[7]=s,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,s=n[0],a=n[3],o=n[6],l=n[1],u=n[4],c=n[7],d=n[2],h=n[5],p=n[8],f=r[0],m=r[3],g=r[6],v=r[1],y=r[4],_=r[7],x=r[2],b=r[5],S=r[8];return i[0]=s*f+a*v+o*x,i[3]=s*m+a*y+o*b,i[6]=s*g+a*_+o*S,i[1]=l*f+u*v+c*x,i[4]=l*m+u*y+c*b,i[7]=l*g+u*_+c*S,i[2]=d*f+h*v+p*x,i[5]=d*m+h*y+p*b,i[8]=d*g+h*_+p*S,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8];return t*s*u-t*a*l-n*i*u+n*a*o+r*i*l-r*s*o}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8],c=u*s-a*l,d=a*o-u*i,h=l*i-s*o,p=t*c+n*d+r*h;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=c*f,e[1]=(r*l-u*n)*f,e[2]=(a*n-r*s)*f,e[3]=d*f,e[4]=(u*t-r*o)*f,e[5]=(r*i-a*t)*f,e[6]=h*f,e[7]=(n*o-l*t)*f,e[8]=(s*t-n*i)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,s,a){const o=Math.cos(i),l=Math.sin(i);return this.set(n*o,n*l,-n*(o*s+l*a)+s+e,-r*l,r*o,-r*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Yt.makeScale(e,t)),this}rotate(e){return this.premultiply(Yt.makeRotation(-e)),this}translate(e,t){return this.premultiply(Yt.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const Yt=new $t;function Kt(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}const Qt={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Zt(e,t){return new Qt[e](t)}function Jt(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function en(){const e=Jt("canvas");return e.style.display="block",e}const tn={};function nn(e){e in tn||(tn[e]=!0)}const rn=(new $t).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),sn=(new $t).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function an(){const e={enabled:!0,workingColorSpace:vt,spaces:{},convert:function(e,t,n){return!1!==this.enabled&&t!==n&&t&&n?(this.spaces[t].transfer===_t&&(e.r=ln(e.r),e.g=ln(e.g),e.b=ln(e.b)),this.spaces[t].primaries!==this.spaces[n].primaries&&(e.applyMatrix3(this.spaces[t].toXYZ),e.applyMatrix3(this.spaces[n].fromXYZ)),this.spaces[n].transfer===_t&&(e.r=un(e.r),e.g=un(e.g),e.b=un(e.b)),e):e},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)},getPrimaries:function(e){return this.spaces[e].primaries},getTransfer:function(e){return e===mt?yt:this.spaces[e].transfer},getLuminanceCoefficients:function(e,t=this.workingColorSpace){return e.fromArray(this.spaces[t].luminanceCoefficients)},define:function(e){Object.assign(this.spaces,e)},_getMatrix:function(e,t,n){return e.copy(this.spaces[t].toXYZ).multiply(this.spaces[n].fromXYZ)},_getDrawingBufferColorSpace:function(e){return this.spaces[e].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(e=this.workingColorSpace){return this.spaces[e].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],n=[.2126,.7152,.0722],r=[.3127,.329];return e.define({[vt]:{primaries:t,whitePoint:r,transfer:yt,toXYZ:rn,fromXYZ:sn,luminanceCoefficients:n,workingColorSpaceConfig:{unpackColorSpace:gt},outputColorSpaceConfig:{drawingBufferColorSpace:gt}},[gt]:{primaries:t,whitePoint:r,transfer:_t,toXYZ:rn,fromXYZ:sn,luminanceCoefficients:n,outputColorSpaceConfig:{drawingBufferColorSpace:gt}}}),e}const on=an();function ln(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function un(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let cn;class dn{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===cn&&(cn=Jt("canvas")),cn.width=e.width,cn.height=e.height;const n=cn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=cn}return t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Jt("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*ln(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*ln(t[e]/255)):t[e]=ln(t[e]);return{data:t,width:e.width,height:e.height}}return e}}let hn=0;class pn{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:hn++}),this.uuid=zt(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(fn(r[t].image)):e.push(fn(r[t]))}else e=fn(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function fn(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?dn.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:{}}let mn=0;class gn extends Dt{constructor(e=gn.DEFAULT_IMAGE,t=gn.DEFAULT_MAPPING,n=1001,r=1001,i=1006,s=1008,a=1023,o=1009,l=gn.DEFAULT_ANISOTROPY,u=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:mn++}),this.uuid=zt(),this.name="",this.source=new pn(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Xt(0,0),this.repeat=new Xt(1,1),this.center=new Xt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new $t,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==W)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case K:e.x=e.x-Math.floor(e.x);break;case Q:e.x=e.x<0?0:1;break;case Z:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case K:e.y=e.y-Math.floor(e.y);break;case Q:e.y=e.y<0?0:1;break;case Z:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){!0===e&&this.pmremVersion++}}gn.DEFAULT_IMAGE=null,gn.DEFAULT_MAPPING=W,gn.DEFAULT_ANISOTROPY=1;class vn{constructor(e=0,t=0,n=0,r=1){vn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*r+s[12]*i,this.y=s[1]*t+s[5]*n+s[9]*r+s[13]*i,this.z=s[2]*t+s[6]*n+s[10]*r+s[14]*i,this.w=s[3]*t+s[7]*n+s[11]*r+s[15]*i,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const s=.01,a=.1,o=e.elements,l=o[0],u=o[4],c=o[8],d=o[1],h=o[5],p=o[9],f=o[2],m=o[6],g=o[10];if(Math.abs(u-d)<s&&Math.abs(c-f)<s&&Math.abs(p-m)<s){if(Math.abs(u+d)<a&&Math.abs(c+f)<a&&Math.abs(p+m)<a&&Math.abs(l+h+g-3)<a)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,o=(h+1)/2,v=(g+1)/2,y=(u+d)/4,_=(c+f)/4,x=(p+m)/4;return e>o&&e>v?e<s?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=y/n,i=_/n):o>v?o<s?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(o),n=y/r,i=x/r):v<s?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(v),n=_/i,r=x/i),this.set(n,r,i,t),this}let v=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(d-u)*(d-u));return Math.abs(v)<.001&&(v=1),this.x=(m-p)/v,this.y=(c-f)/v,this.z=(d-u)/v,this.w=Math.acos((l+h+g-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Vt(this.x,e.x,t.x),this.y=Vt(this.y,e.y,t.y),this.z=Vt(this.z,e.z,t.z),this.w=Vt(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Vt(this.x,e,t),this.y=Vt(this.y,e,t),this.z=Vt(this.z,e,t),this.w=Vt(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Vt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class yn extends Dt{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new vn(0,0,e,t),this.scissorTest=!1,this.viewport=new vn(0,0,e,t);const r={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ne,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const i=new gn(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);i.flipY=!1,i.generateMipmaps=n.generateMipmaps,i.internalFormat=n.internalFormat,this.textures=[];const s=n.count;for(let e=0;e<s;e++)this.textures[e]=i.clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){null!==this._depthTexture&&(this._depthTexture.renderTarget=null),null!==e&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.textures.length;r<i;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const n=Object.assign({},e.textures[t].image);this.textures[t].source=new pn(n)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class _n extends yn{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class xn extends gn{constructor(e=null,t=1,n=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=J,this.minFilter=J,this.wrapR=Q,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class bn extends gn{constructor(e=null,t=1,n=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:r},this.magFilter=J,this.minFilter=J,this.wrapR=Q,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Sn{constructor(e=0,t=0,n=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=r}static slerpFlat(e,t,n,r,i,s,a){let o=n[r+0],l=n[r+1],u=n[r+2],c=n[r+3];const d=i[s+0],h=i[s+1],p=i[s+2],f=i[s+3];if(0===a)return e[t+0]=o,e[t+1]=l,e[t+2]=u,void(e[t+3]=c);if(1===a)return e[t+0]=d,e[t+1]=h,e[t+2]=p,void(e[t+3]=f);if(c!==f||o!==d||l!==h||u!==p){let e=1-a;const t=o*d+l*h+u*p+c*f,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),s=Math.atan2(i,t*n);e=Math.sin(e*s)/i,a=Math.sin(a*s)/i}const i=a*n;if(o=o*e+d*i,l=l*e+h*i,u=u*e+p*i,c=c*e+f*i,e===1-a){const e=1/Math.sqrt(o*o+l*l+u*u+c*c);o*=e,l*=e,u*=e,c*=e}}e[t]=o,e[t+1]=l,e[t+2]=u,e[t+3]=c}static multiplyQuaternionsFlat(e,t,n,r,i,s){const a=n[r],o=n[r+1],l=n[r+2],u=n[r+3],c=i[s],d=i[s+1],h=i[s+2],p=i[s+3];return e[t]=a*p+u*c+o*h-l*d,e[t+1]=o*p+u*d+l*c-a*h,e[t+2]=l*p+u*h+a*d-o*c,e[t+3]=u*p-a*c-o*d-l*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,r=e._y,i=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(n/2),u=a(r/2),c=a(i/2),d=o(n/2),h=o(r/2),p=o(i/2);switch(s){case"XYZ":this._x=d*u*c+l*h*p,this._y=l*h*c-d*u*p,this._z=l*u*p+d*h*c,this._w=l*u*c-d*h*p;break;case"YXZ":this._x=d*u*c+l*h*p,this._y=l*h*c-d*u*p,this._z=l*u*p-d*h*c,this._w=l*u*c+d*h*p;break;case"ZXY":this._x=d*u*c-l*h*p,this._y=l*h*c+d*u*p,this._z=l*u*p+d*h*c,this._w=l*u*c-d*h*p;break;case"ZYX":this._x=d*u*c-l*h*p,this._y=l*h*c+d*u*p,this._z=l*u*p-d*h*c,this._w=l*u*c+d*h*p;break;case"YZX":this._x=d*u*c+l*h*p,this._y=l*h*c+d*u*p,this._z=l*u*p-d*h*c,this._w=l*u*c-d*h*p;break;case"XZY":this._x=d*u*c-l*h*p,this._y=l*h*c-d*u*p,this._z=l*u*p+d*h*c,this._w=l*u*c+d*h*p}return!0===t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],s=t[1],a=t[5],o=t[9],l=t[2],u=t[6],c=t[10],d=n+a+c;if(d>0){const e=.5/Math.sqrt(d+1);this._w=.25/e,this._x=(u-o)*e,this._y=(i-l)*e,this._z=(s-r)*e}else if(n>a&&n>c){const e=2*Math.sqrt(1+n-a-c);this._w=(u-o)/e,this._x=.25*e,this._y=(r+s)/e,this._z=(i+l)/e}else if(a>c){const e=2*Math.sqrt(1+a-n-c);this._w=(i-l)/e,this._x=(r+s)/e,this._y=.25*e,this._z=(o+u)/e}else{const e=2*Math.sqrt(1+c-n-a);this._w=(s-r)/e,this._x=(i+l)/e,this._y=(o+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Vt(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,s=e._w,a=t._x,o=t._y,l=t._z,u=t._w;return this._x=n*u+s*a+r*l-i*o,this._y=r*u+s*o+i*a-n*l,this._z=i*u+s*l+n*o-r*a,this._w=s*u-n*a-r*o-i*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,s=this._w;let a=s*e._w+n*e._x+r*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=n,this._y=r,this._z=i,this;const o=1-a*a;if(o<=Number.EPSILON){const e=1-t;return this._w=e*s+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this}const l=Math.sqrt(o),u=Math.atan2(l,a),c=Math.sin((1-t)*u)/l,d=Math.sin(t*u)/l;return this._w=s*c+this._w*d,this._x=n*c+this._x*d,this._y=r*c+this._y*d,this._z=i*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),r=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(r*Math.sin(e),r*Math.cos(e),i*Math.sin(t),i*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Tn{constructor(e=0,t=0,n=0){Tn.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Mn.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Mn.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,s=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*s,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*s,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*s,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,a=e.z,o=e.w,l=2*(s*r-a*n),u=2*(a*t-i*r),c=2*(i*n-s*t);return this.x=t+o*l+s*c-a*u,this.y=n+o*u+a*l-i*c,this.z=r+o*c+i*u-s*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Vt(this.x,e.x,t.x),this.y=Vt(this.y,e.y,t.y),this.z=Vt(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Vt(this.x,e,t),this.y=Vt(this.y,e,t),this.z=Vt(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Vt(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,s=t.x,a=t.y,o=t.z;return this.x=r*o-i*a,this.y=i*s-n*o,this.z=n*a-r*s,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return wn.copy(this).projectOnVector(e),this.sub(wn)}reflect(e){return this.sub(wn.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Vt(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=2*Math.random()-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const wn=new Tn,Mn=new Sn;class En{constructor(e=new Tn(1/0,1/0,1/0),t=new Tn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Cn.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Cn.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Cn.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n){const r=n.getAttribute("position");if(!0===t&&void 0!==r&&!0!==e.isInstancedMesh)for(let t=0,n=r.count;t<n;t++)!0===e.isMesh?e.getVertexPosition(t,Cn):Cn.fromBufferAttribute(r,t),Cn.applyMatrix4(e.matrixWorld),this.expandByPoint(Cn);else void 0!==e.boundingBox?(null===e.boundingBox&&e.computeBoundingBox(),Rn.copy(e.boundingBox)):(null===n.boundingBox&&n.computeBoundingBox(),Rn.copy(n.boundingBox)),Rn.applyMatrix4(e.matrixWorld),this.union(Rn)}const r=e.children;for(let e=0,n=r.length;e<n;e++)this.expandByObject(r[e],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Cn),Cn.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Fn),Bn.subVectors(this.max,Fn),Nn.subVectors(e.a,Fn),Pn.subVectors(e.b,Fn),In.subVectors(e.c,Fn),Ln.subVectors(Pn,Nn),Un.subVectors(In,Pn),Dn.subVectors(Nn,In);let t=[0,-Ln.z,Ln.y,0,-Un.z,Un.y,0,-Dn.z,Dn.y,Ln.z,0,-Ln.x,Un.z,0,-Un.x,Dn.z,0,-Dn.x,-Ln.y,Ln.x,0,-Un.y,Un.x,0,-Dn.y,Dn.x,0];return!!zn(t,Nn,Pn,In,Bn)&&(t=[1,0,0,0,1,0,0,0,1],!!zn(t,Nn,Pn,In,Bn)&&(On.crossVectors(Ln,Un),t=[On.x,On.y,On.z],zn(t,Nn,Pn,In,Bn)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Cn).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=.5*this.getSize(Cn).length()),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(An[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),An[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),An[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),An[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),An[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),An[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),An[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),An[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(An)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const An=[new Tn,new Tn,new Tn,new Tn,new Tn,new Tn,new Tn,new Tn],Cn=new Tn,Rn=new En,Nn=new Tn,Pn=new Tn,In=new Tn,Ln=new Tn,Un=new Tn,Dn=new Tn,Fn=new Tn,Bn=new Tn,On=new Tn,kn=new Tn;function zn(e,t,n,r,i){for(let s=0,a=e.length-3;s<=a;s+=3){kn.fromArray(e,s);const a=i.x*Math.abs(kn.x)+i.y*Math.abs(kn.y)+i.z*Math.abs(kn.z),o=t.dot(kn),l=n.dot(kn),u=r.dot(kn);if(Math.max(-Math.max(o,l,u),Math.min(o,l,u))>a)return!1}return!0}const Vn=new En,Gn=new Tn,Hn=new Tn;class Wn{constructor(e=new Tn,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):Vn.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Gn.subVectors(e,this.center);const t=Gn.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.addScaledVector(Gn,n/e),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Hn.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Gn.copy(e.center).add(Hn)),this.expandByPoint(Gn.copy(e.center).sub(Hn))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const jn=new Tn,qn=new Tn,Xn=new Tn,$n=new Tn,Yn=new Tn,Kn=new Tn,Qn=new Tn;class Zn{constructor(e=new Tn,t=new Tn(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,jn)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=jn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(jn.copy(this.origin).addScaledVector(this.direction,t),jn.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){qn.copy(e).add(t).multiplyScalar(.5),Xn.copy(t).sub(e).normalize(),$n.copy(this.origin).sub(qn);const i=.5*e.distanceTo(t),s=-this.direction.dot(Xn),a=$n.dot(this.direction),o=-$n.dot(Xn),l=$n.lengthSq(),u=Math.abs(1-s*s);let c,d,h,p;if(u>0)if(c=s*o-a,d=s*a-o,p=i*u,c>=0)if(d>=-p)if(d<=p){const e=1/u;c*=e,d*=e,h=c*(c+s*d+2*a)+d*(s*c+d+2*o)+l}else d=i,c=Math.max(0,-(s*d+a)),h=-c*c+d*(d+2*o)+l;else d=-i,c=Math.max(0,-(s*d+a)),h=-c*c+d*(d+2*o)+l;else d<=-p?(c=Math.max(0,-(-s*i+a)),d=c>0?-i:Math.min(Math.max(-i,-o),i),h=-c*c+d*(d+2*o)+l):d<=p?(c=0,d=Math.min(Math.max(-i,-o),i),h=d*(d+2*o)+l):(c=Math.max(0,-(s*i+a)),d=c>0?i:Math.min(Math.max(-i,-o),i),h=-c*c+d*(d+2*o)+l);else d=s>0?-i:i,c=Math.max(0,-(s*d+a)),h=-c*c+d*(d+2*o)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,c),r&&r.copy(qn).addScaledVector(Xn,d),h}intersectSphere(e,t){jn.subVectors(e.center,this.origin);const n=jn.dot(this.direction),r=jn.dot(jn)-n*n,i=e.radius*e.radius;if(r>i)return null;const s=Math.sqrt(i-r),a=n-s,o=n+s;return o<0?null:a<0?this.at(o,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,s,a,o;const l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,r=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,r=(e.min.x-d.x)*l),u>=0?(i=(e.min.y-d.y)*u,s=(e.max.y-d.y)*u):(i=(e.max.y-d.y)*u,s=(e.min.y-d.y)*u),n>s||i>r?null:((i>n||isNaN(n))&&(n=i),(s<r||isNaN(r))&&(r=s),c>=0?(a=(e.min.z-d.z)*c,o=(e.max.z-d.z)*c):(a=(e.max.z-d.z)*c,o=(e.min.z-d.z)*c),n>o||a>r?null:((a>n||n!=n)&&(n=a),(o<r||r!=r)&&(r=o),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,jn)}intersectTriangle(e,t,n,r,i){Yn.subVectors(t,e),Kn.subVectors(n,e),Qn.crossVectors(Yn,Kn);let s,a=this.direction.dot(Qn);if(a>0){if(r)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}$n.subVectors(this.origin,e);const o=s*this.direction.dot(Kn.crossVectors($n,Kn));if(o<0)return null;const l=s*this.direction.dot(Yn.cross($n));if(l<0)return null;if(o+l>a)return null;const u=-s*$n.dot(Qn);return u<0?null:this.at(u/a,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Jn{constructor(e,t,n,r,i,s,a,o,l,u,c,d,h,p,f,m){Jn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,n,r,i,s,a,o,l,u,c,d,h,p,f,m)}set(e,t,n,r,i,s,a,o,l,u,c,d,h,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=u,g[10]=c,g[14]=d,g[3]=h,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Jn).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/er.setFromMatrixColumn(e,0).length(),i=1/er.setFromMatrixColumn(e,1).length(),s=1/er.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*s,t[9]=n[9]*s,t[10]=n[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,r=e.y,i=e.z,s=Math.cos(n),a=Math.sin(n),o=Math.cos(r),l=Math.sin(r),u=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){const e=s*u,n=s*c,r=a*u,i=a*c;t[0]=o*u,t[4]=-o*c,t[8]=l,t[1]=n+r*l,t[5]=e-i*l,t[9]=-a*o,t[2]=i-e*l,t[6]=r+n*l,t[10]=s*o}else if("YXZ"===e.order){const e=o*u,n=o*c,r=l*u,i=l*c;t[0]=e+i*a,t[4]=r*a-n,t[8]=s*l,t[1]=s*c,t[5]=s*u,t[9]=-a,t[2]=n*a-r,t[6]=i+e*a,t[10]=s*o}else if("ZXY"===e.order){const e=o*u,n=o*c,r=l*u,i=l*c;t[0]=e-i*a,t[4]=-s*c,t[8]=r+n*a,t[1]=n+r*a,t[5]=s*u,t[9]=i-e*a,t[2]=-s*l,t[6]=a,t[10]=s*o}else if("ZYX"===e.order){const e=s*u,n=s*c,r=a*u,i=a*c;t[0]=o*u,t[4]=r*l-n,t[8]=e*l+i,t[1]=o*c,t[5]=i*l+e,t[9]=n*l-r,t[2]=-l,t[6]=a*o,t[10]=s*o}else if("YZX"===e.order){const e=s*o,n=s*l,r=a*o,i=a*l;t[0]=o*u,t[4]=i-e*c,t[8]=r*c+n,t[1]=c,t[5]=s*u,t[9]=-a*u,t[2]=-l*u,t[6]=n*c+r,t[10]=e-i*c}else if("XZY"===e.order){const e=s*o,n=s*l,r=a*o,i=a*l;t[0]=o*u,t[4]=-c,t[8]=l*u,t[1]=e*c+i,t[5]=s*u,t[9]=n*c-r,t[2]=r*c-n,t[6]=a*u,t[10]=i*c+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(nr,e,rr)}lookAt(e,t,n){const r=this.elements;return ar.subVectors(e,t),0===ar.lengthSq()&&(ar.z=1),ar.normalize(),ir.crossVectors(n,ar),0===ir.lengthSq()&&(1===Math.abs(n.z)?ar.x+=1e-4:ar.z+=1e-4,ar.normalize(),ir.crossVectors(n,ar)),ir.normalize(),sr.crossVectors(ar,ir),r[0]=ir.x,r[4]=sr.x,r[8]=ar.x,r[1]=ir.y,r[5]=sr.y,r[9]=ar.y,r[2]=ir.z,r[6]=sr.z,r[10]=ar.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,s=n[0],a=n[4],o=n[8],l=n[12],u=n[1],c=n[5],d=n[9],h=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],x=n[15],b=r[0],S=r[4],T=r[8],w=r[12],M=r[1],E=r[5],A=r[9],C=r[13],R=r[2],N=r[6],P=r[10],I=r[14],L=r[3],U=r[7],D=r[11],F=r[15];return i[0]=s*b+a*M+o*R+l*L,i[4]=s*S+a*E+o*N+l*U,i[8]=s*T+a*A+o*P+l*D,i[12]=s*w+a*C+o*I+l*F,i[1]=u*b+c*M+d*R+h*L,i[5]=u*S+c*E+d*N+h*U,i[9]=u*T+c*A+d*P+h*D,i[13]=u*w+c*C+d*I+h*F,i[2]=p*b+f*M+m*R+g*L,i[6]=p*S+f*E+m*N+g*U,i[10]=p*T+f*A+m*P+g*D,i[14]=p*w+f*C+m*I+g*F,i[3]=v*b+y*M+_*R+x*L,i[7]=v*S+y*E+_*N+x*U,i[11]=v*T+y*A+_*P+x*D,i[15]=v*w+y*C+_*I+x*F,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],a=e[5],o=e[9],l=e[13],u=e[2],c=e[6],d=e[10],h=e[14];return e[3]*(+i*o*c-r*l*c-i*a*d+n*l*d+r*a*h-n*o*h)+e[7]*(+t*o*h-t*l*d+i*s*d-r*s*h+r*l*u-i*o*u)+e[11]*(+t*l*c-t*a*h-i*s*c+n*s*h+i*a*u-n*l*u)+e[15]*(-r*a*u-t*o*c+t*a*d+r*s*c-n*s*d+n*o*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],l=e[7],u=e[8],c=e[9],d=e[10],h=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=c*m*l-f*d*l+f*o*h-a*m*h-c*o*g+a*d*g,y=p*d*l-u*m*l-p*o*h+s*m*h+u*o*g-s*d*g,_=u*f*l-p*c*l+p*a*h-s*f*h-u*a*g+s*c*g,x=p*c*o-u*f*o-p*a*d+s*f*d+u*a*m-s*c*m,b=t*v+n*y+r*_+i*x;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const S=1/b;return e[0]=v*S,e[1]=(f*d*i-c*m*i-f*r*h+n*m*h+c*r*g-n*d*g)*S,e[2]=(a*m*i-f*o*i+f*r*l-n*m*l-a*r*g+n*o*g)*S,e[3]=(c*o*i-a*d*i-c*r*l+n*d*l+a*r*h-n*o*h)*S,e[4]=y*S,e[5]=(u*m*i-p*d*i+p*r*h-t*m*h-u*r*g+t*d*g)*S,e[6]=(p*o*i-s*m*i-p*r*l+t*m*l+s*r*g-t*o*g)*S,e[7]=(s*d*i-u*o*i+u*r*l-t*d*l-s*r*h+t*o*h)*S,e[8]=_*S,e[9]=(p*c*i-u*f*i-p*n*h+t*f*h+u*n*g-t*c*g)*S,e[10]=(s*f*i-p*a*i+p*n*l-t*f*l-s*n*g+t*a*g)*S,e[11]=(u*a*i-s*c*i-u*n*l+t*c*l+s*n*h-t*a*h)*S,e[12]=x*S,e[13]=(u*f*r-p*c*r+p*n*d-t*f*d-u*n*m+t*c*m)*S,e[14]=(p*a*r-s*f*r-p*n*o+t*f*o+s*n*m-t*a*m)*S,e[15]=(s*c*r-u*a*r+u*n*o-t*c*o-s*n*d+t*a*d)*S,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,a=e.y,o=e.z,l=i*s,u=i*a;return this.set(l*s+n,l*a-r*o,l*o+r*a,0,l*a+r*o,u*a+n,u*o-r*s,0,l*o-r*a,u*o+r*s,i*o*o+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,s){return this.set(1,n,i,0,e,1,s,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,s=t._y,a=t._z,o=t._w,l=i+i,u=s+s,c=a+a,d=i*l,h=i*u,p=i*c,f=s*u,m=s*c,g=a*c,v=o*l,y=o*u,_=o*c,x=n.x,b=n.y,S=n.z;return r[0]=(1-(f+g))*x,r[1]=(h+_)*x,r[2]=(p-y)*x,r[3]=0,r[4]=(h-_)*b,r[5]=(1-(d+g))*b,r[6]=(m+v)*b,r[7]=0,r[8]=(p+y)*S,r[9]=(m-v)*S,r[10]=(1-(d+f))*S,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=er.set(r[0],r[1],r[2]).length();const s=er.set(r[4],r[5],r[6]).length(),a=er.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],tr.copy(this);const o=1/i,l=1/s,u=1/a;return tr.elements[0]*=o,tr.elements[1]*=o,tr.elements[2]*=o,tr.elements[4]*=l,tr.elements[5]*=l,tr.elements[6]*=l,tr.elements[8]*=u,tr.elements[9]*=u,tr.elements[10]*=u,t.setFromRotationMatrix(tr),n.x=i,n.y=s,n.z=a,this}makePerspective(e,t,n,r,i,s,a=2e3){const o=this.elements,l=2*i/(t-e),u=2*i/(n-r),c=(t+e)/(t-e),d=(n+r)/(n-r);let h,p;if(a===Lt)h=-(s+i)/(s-i),p=-2*s*i/(s-i);else{if(a!==Ut)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);h=-s/(s-i),p=-s*i/(s-i)}return o[0]=l,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=u,o[9]=d,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,r,i,s,a=2e3){const o=this.elements,l=1/(t-e),u=1/(n-r),c=1/(s-i),d=(t+e)*l,h=(n+r)*u;let p,f;if(a===Lt)p=(s+i)*c,f=-2*c;else{if(a!==Ut)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=i*c,f=-1*c}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-d,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=f,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const er=new Tn,tr=new Jn,nr=new Tn(0,0,0),rr=new Tn(1,1,1),ir=new Tn,sr=new Tn,ar=new Tn,or=new Jn,lr=new Sn;class ur{constructor(e=0,t=0,n=0,r=ur.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],s=r[4],a=r[8],o=r[1],l=r[5],u=r[9],c=r[2],d=r[6],h=r[10];switch(t){case"XYZ":this._y=Math.asin(Vt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,h),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Vt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-c,i),this._z=0);break;case"ZXY":this._x=Math.asin(Vt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-c,h),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,i));break;case"ZYX":this._y=Math.asin(-Vt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(o,i)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Vt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-Vt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-u,h),this._y=0)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return or.makeRotationFromQuaternion(e),this.setFromRotationMatrix(or,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return lr.setFromEuler(this),this.setFromQuaternion(lr,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ur.DEFAULT_ORDER="XYZ";class cr{constructor(){this.mask=1}set(e){this.mask=1<<e>>>0}enable(e){this.mask|=1<<e}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e}disable(e){this.mask&=~(1<<e)}disableAll(){this.mask=0}test(e){return 0!==(this.mask&e.mask)}isEnabled(e){return!!(this.mask&1<<e)}}let dr=0;const hr=new Tn,pr=new Sn,fr=new Jn,mr=new Tn,gr=new Tn,vr=new Tn,yr=new Sn,_r=new Tn(1,0,0),xr=new Tn(0,1,0),br=new Tn(0,0,1),Sr={type:"added"},Tr={type:"removed"},wr={type:"childadded",child:null},Mr={type:"childremoved",child:null};class Er extends Dt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:dr++}),this.uuid=zt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Er.DEFAULT_UP.clone();const e=new Tn,t=new ur,n=new Sn,r=new Tn(1,1,1);t._onChange(function(){n.setFromEuler(t,!1)}),n._onChange(function(){t.setFromQuaternion(n,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Jn},normalMatrix:{value:new $t}}),this.matrix=new Jn,this.matrixWorld=new Jn,this.matrixAutoUpdate=Er.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Er.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new cr,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return pr.setFromAxisAngle(e,t),this.quaternion.multiply(pr),this}rotateOnWorldAxis(e,t){return pr.setFromAxisAngle(e,t),this.quaternion.premultiply(pr),this}rotateX(e){return this.rotateOnAxis(_r,e)}rotateY(e){return this.rotateOnAxis(xr,e)}rotateZ(e){return this.rotateOnAxis(br,e)}translateOnAxis(e,t){return hr.copy(e).applyQuaternion(this.quaternion),this.position.add(hr.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(_r,e)}translateY(e){return this.translateOnAxis(xr,e)}translateZ(e){return this.translateOnAxis(br,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(fr.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?mr.copy(e):mr.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),gr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?fr.lookAt(gr,mr,this.up):fr.lookAt(mr,gr,this.up),this.quaternion.setFromRotationMatrix(fr),r&&(fr.extractRotation(r.matrixWorld),pr.setFromRotationMatrix(fr),this.quaternion.premultiply(pr.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this||e&&e.isObject3D&&(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Sr),wr.child=e,this.dispatchEvent(wr),wr.child=null),this}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Tr),Mr.child=e,this.dispatchEvent(Mr),Mr.child=null),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),fr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),fr.multiply(e.parent.matrixWorld)),e.applyMatrix4(fr),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Sr),wr.child=e,this.dispatchEvent(wr),wr.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const r=this.children;for(let i=0,s=r.length;i<s;i++)r[i].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gr,e,vr),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(gr,yr,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++){t[n].updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++){e[t].updateWorldMatrix(!1,!0)}}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(e=>({boxInitialized:e.boxInitialized,boxMin:e.box.min.toArray(),boxMax:e.box.max.toArray(),sphereInitialized:e.sphereInitialized,sphereRadius:e.sphere.radius,sphereCenter:e.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),null!==this._colorsTexture&&(r.colorsTexture=this._colorsTexture.toJSON(e)),null!==this.boundingSphere&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),null!==this.boundingBox&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=s(e.geometries),r=s(e.materials),i=s(e.textures),a=s(e.images),o=s(e.shapes),l=s(e.skeletons),u=s(e.animations),c=s(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),a.length>0&&(n.images=a),o.length>0&&(n.shapes=o),l.length>0&&(n.skeletons=l),u.length>0&&(n.animations=u),c.length>0&&(n.nodes=c)}return n.object=r,n;function s(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}Er.DEFAULT_UP=new Tn(0,1,0),Er.DEFAULT_MATRIX_AUTO_UPDATE=!0,Er.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ar=new Tn,Cr=new Tn,Rr=new Tn,Nr=new Tn,Pr=new Tn,Ir=new Tn,Lr=new Tn,Ur=new Tn,Dr=new Tn,Fr=new Tn,Br=new vn,Or=new vn,kr=new vn;class zr{constructor(e=new Tn,t=new Tn,n=new Tn){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),Ar.subVectors(e,t),r.cross(Ar);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){Ar.subVectors(r,t),Cr.subVectors(n,t),Rr.subVectors(e,t);const s=Ar.dot(Ar),a=Ar.dot(Cr),o=Ar.dot(Rr),l=Cr.dot(Cr),u=Cr.dot(Rr),c=s*l-a*a;if(0===c)return i.set(0,0,0),null;const d=1/c,h=(l*o-a*u)*d,p=(s*u-a*o)*d;return i.set(1-h-p,p,h)}static containsPoint(e,t,n,r){return null!==this.getBarycoord(e,t,n,r,Nr)&&(Nr.x>=0&&Nr.y>=0&&Nr.x+Nr.y<=1)}static getInterpolation(e,t,n,r,i,s,a,o){return null===this.getBarycoord(e,t,n,r,Nr)?(o.x=0,o.y=0,"z"in o&&(o.z=0),"w"in o&&(o.w=0),null):(o.setScalar(0),o.addScaledVector(i,Nr.x),o.addScaledVector(s,Nr.y),o.addScaledVector(a,Nr.z),o)}static getInterpolatedAttribute(e,t,n,r,i,s){return Br.setScalar(0),Or.setScalar(0),kr.setScalar(0),Br.fromBufferAttribute(e,t),Or.fromBufferAttribute(e,n),kr.fromBufferAttribute(e,r),s.setScalar(0),s.addScaledVector(Br,i.x),s.addScaledVector(Or,i.y),s.addScaledVector(kr,i.z),s}static isFrontFacing(e,t,n,r){return Ar.subVectors(n,t),Cr.subVectors(e,t),Ar.cross(Cr).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ar.subVectors(this.c,this.b),Cr.subVectors(this.a,this.b),.5*Ar.cross(Cr).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return zr.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return zr.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,r,i){return zr.getInterpolation(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return zr.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return zr.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let s,a;Pr.subVectors(r,n),Ir.subVectors(i,n),Ur.subVectors(e,n);const o=Pr.dot(Ur),l=Ir.dot(Ur);if(o<=0&&l<=0)return t.copy(n);Dr.subVectors(e,r);const u=Pr.dot(Dr),c=Ir.dot(Dr);if(u>=0&&c<=u)return t.copy(r);const d=o*c-u*l;if(d<=0&&o>=0&&u<=0)return s=o/(o-u),t.copy(n).addScaledVector(Pr,s);Fr.subVectors(e,i);const h=Pr.dot(Fr),p=Ir.dot(Fr);if(p>=0&&h<=p)return t.copy(i);const f=h*l-o*p;if(f<=0&&l>=0&&p<=0)return a=l/(l-p),t.copy(n).addScaledVector(Ir,a);const m=u*p-h*c;if(m<=0&&c-u>=0&&h-p>=0)return Lr.subVectors(i,r),a=(c-u)/(c-u+(h-p)),t.copy(r).addScaledVector(Lr,a);const g=1/(m+f+d);return s=f*g,a=d*g,t.copy(n).addScaledVector(Pr,s).addScaledVector(Ir,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Vr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gr={h:0,s:0,l:0},Hr={h:0,s:0,l:0};function Wr(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}class jr{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(void 0===t&&void 0===n){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=gt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,on.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r=on.workingColorSpace){return this.r=e,this.g=t,this.b=n,on.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r=on.workingColorSpace){if(e=Gt(e,1),t=Vt(t,0,1),n=Vt(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Wr(i,r,e+1/3),this.g=Wr(i,r,e),this.b=Wr(i,r,e-1/3)}return on.toWorkingColorSpace(this,r),this}setStyle(e,t=gt){function n(e){void 0!==e&&parseFloat(e)}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let e;const i=r[1],s=r[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(e[4]),this.setRGB(Math.min(255,parseInt(e[1],10))/255,Math.min(255,parseInt(e[2],10))/255,Math.min(255,parseInt(e[3],10))/255,t);if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(e[4]),this.setRGB(Math.min(100,parseInt(e[1],10))/100,Math.min(100,parseInt(e[2],10))/100,Math.min(100,parseInt(e[3],10))/100,t);break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(e[4]),this.setHSL(parseFloat(e[1])/360,parseFloat(e[2])/100,parseFloat(e[3])/100,t)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=r[1],n=e.length;if(3===n)return this.setRGB(parseInt(e.charAt(0),16)/15,parseInt(e.charAt(1),16)/15,parseInt(e.charAt(2),16)/15,t);if(6===n)return this.setHex(parseInt(e,16),t)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=gt){const n=Vr[e.toLowerCase()];return void 0!==n&&this.setHex(n,t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ln(e.r),this.g=ln(e.g),this.b=ln(e.b),this}copyLinearToSRGB(e){return this.r=un(e.r),this.g=un(e.g),this.b=un(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=gt){return on.fromWorkingColorSpace(qr.copy(this),e),65536*Math.round(Vt(255*qr.r,0,255))+256*Math.round(Vt(255*qr.g,0,255))+Math.round(Vt(255*qr.b,0,255))}getHexString(e=gt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=on.workingColorSpace){on.fromWorkingColorSpace(qr.copy(this),t);const n=qr.r,r=qr.g,i=qr.b,s=Math.max(n,r,i),a=Math.min(n,r,i);let o,l;const u=(a+s)/2;if(a===s)o=0,l=0;else{const e=s-a;switch(l=u<=.5?e/(s+a):e/(2-s-a),s){case n:o=(r-i)/e+(r<i?6:0);break;case r:o=(i-n)/e+2;break;case i:o=(n-r)/e+4}o/=6}return e.h=o,e.s=l,e.l=u,e}getRGB(e,t=on.workingColorSpace){return on.fromWorkingColorSpace(qr.copy(this),t),e.r=qr.r,e.g=qr.g,e.b=qr.b,e}getStyle(e=gt){on.fromWorkingColorSpace(qr.copy(this),e);const t=qr.r,n=qr.g,r=qr.b;return e!==gt?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*n)},${Math.round(255*r)})`}offsetHSL(e,t,n){return this.getHSL(Gr),this.setHSL(Gr.h+e,Gr.s+t,Gr.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Gr),e.getHSL(Hr);const n=Ht(Gr.h,Hr.h,t),r=Ht(Gr.s,Hr.s,t),i=Ht(Gr.l,Hr.l,t);return this.setHSL(n,r,i),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,r=this.b,i=e.elements;return this.r=i[0]*t+i[3]*n+i[6]*r,this.g=i[1]*t+i[4]*n+i[7]*r,this.b=i[2]*t+i[5]*n+i[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const qr=new jr;jr.NAMES=Vr;let Xr=0;class $r extends Dt{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Xr++}),this.uuid=zt(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=T,this.blendDst=w,this.blendEquation=g,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new jr(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=bt,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=xt,this.stencilZFail=xt,this.stencilZPass=xt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n)continue;const r=this[t];void 0!==r&&(r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n)}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(n.dispersion=this.dispersion),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),void 0!==this.anisotropy&&(n.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapRotation&&(n.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),!0===this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=!0),this.blendSrc!==T&&(n.blendSrc=this.blendSrc),this.blendDst!==w&&(n.blendDst=this.blendDst),this.blendEquation!==g&&(n.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(n.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(n.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(n.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(n.depthFunc=this.depthFunc),!1===this.depthTest&&(n.depthTest=this.depthTest),!1===this.depthWrite&&(n.depthWrite=this.depthWrite),!1===this.colorWrite&&(n.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==bt&&(n.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(n.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==xt&&(n.stencilFail=this.stencilFail),this.stencilZFail!==xt&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==xt&&(n.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(n.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaHash&&(n.alphaHash=!0),!0===this.alphaToCoverage&&(n.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=!0),!0===this.forceSinglePass&&(n.forceSinglePass=!0),!0===this.wireframe&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}onBuild(){}}class Yr extends $r{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new jr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ur,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Kr=Qr();function Qr(){const e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),i=new Uint32Array(512);for(let e=0;e<256;++e){const t=e-127;t<-27?(r[e]=0,r[256|e]=32768,i[e]=24,i[256|e]=24):t<-14?(r[e]=1024>>-t-14,r[256|e]=1024>>-t-14|32768,i[e]=-t-1,i[256|e]=-t-1):t<=15?(r[e]=t+15<<10,r[256|e]=t+15<<10|32768,i[e]=13,i[256|e]=13):t<128?(r[e]=31744,r[256|e]=64512,i[e]=24,i[256|e]=24):(r[e]=31744,r[256|e]=64512,i[e]=13,i[256|e]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let e=1;e<1024;++e){let t=e<<13,n=0;for(;!(8388608&t);)t<<=1,n-=8388608;t&=-8388609,n+=947912704,s[e]=t|n}for(let e=1024;e<2048;++e)s[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)a[e]=e<<23;a[31]=1199570944,a[32]=2147483648;for(let e=33;e<63;++e)a[e]=2147483648+(e-32<<23);a[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(o[e]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:i,mantissaTable:s,exponentTable:a,offsetTable:o}}function Zr(e){Math.abs(e),e=Vt(e,-65504,65504),Kr.floatView[0]=e;const t=Kr.uint32View[0],n=t>>23&511;return Kr.baseTable[n]+((8388607&t)>>Kr.shiftTable[n])}function Jr(e){const t=e>>10;return Kr.uint32View[0]=Kr.mantissaTable[Kr.offsetTable[t]+(1023&e)]+Kr.exponentTable[t],Kr.floatView[0]}const ei=new Tn,ti=new Xt;let ni=0;class ri{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:ni++}),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n,this.usage=Nt,this.updateRanges=[],this.gpuType=de,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)ti.fromBufferAttribute(this,t),ti.applyMatrix3(e),this.setXY(t,ti.x,ti.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)ei.fromBufferAttribute(this,t),ei.applyMatrix3(e),this.setXYZ(t,ei.x,ei.y,ei.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)ei.fromBufferAttribute(this,t),ei.applyMatrix4(e),this.setXYZ(t,ei.x,ei.y,ei.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ei.fromBufferAttribute(this,t),ei.applyNormalMatrix(e),this.setXYZ(t,ei.x,ei.y,ei.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ei.fromBufferAttribute(this,t),ei.transformDirection(e),this.setXYZ(t,ei.x,ei.y,ei.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=Wt(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=jt(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Wt(t,this.array)),t}setX(e,t){return this.normalized&&(t=jt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Wt(t,this.array)),t}setY(e,t){return this.normalized&&(t=jt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Wt(t,this.array)),t}setZ(e,t){return this.normalized&&(t=jt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Wt(t,this.array)),t}setW(e,t){return this.normalized&&(t=jt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=jt(t,this.array),n=jt(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=jt(t,this.array),n=jt(n,this.array),r=jt(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=jt(t,this.array),n=jt(n,this.array),r=jt(r,this.array),i=jt(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Nt&&(e.usage=this.usage),e}}class ii extends ri{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class si extends ri{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class ai extends ri{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Jr(this.array[e*this.itemSize]);return this.normalized&&(t=Wt(t,this.array)),t}setX(e,t){return this.normalized&&(t=jt(t,this.array)),this.array[e*this.itemSize]=Zr(t),this}getY(e){let t=Jr(this.array[e*this.itemSize+1]);return this.normalized&&(t=Wt(t,this.array)),t}setY(e,t){return this.normalized&&(t=jt(t,this.array)),this.array[e*this.itemSize+1]=Zr(t),this}getZ(e){let t=Jr(this.array[e*this.itemSize+2]);return this.normalized&&(t=Wt(t,this.array)),t}setZ(e,t){return this.normalized&&(t=jt(t,this.array)),this.array[e*this.itemSize+2]=Zr(t),this}getW(e){let t=Jr(this.array[e*this.itemSize+3]);return this.normalized&&(t=Wt(t,this.array)),t}setW(e,t){return this.normalized&&(t=jt(t,this.array)),this.array[e*this.itemSize+3]=Zr(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=jt(t,this.array),n=jt(n,this.array)),this.array[e+0]=Zr(t),this.array[e+1]=Zr(n),this}setXYZ(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=jt(t,this.array),n=jt(n,this.array),r=jt(r,this.array)),this.array[e+0]=Zr(t),this.array[e+1]=Zr(n),this.array[e+2]=Zr(r),this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=jt(t,this.array),n=jt(n,this.array),r=jt(r,this.array),i=jt(i,this.array)),this.array[e+0]=Zr(t),this.array[e+1]=Zr(n),this.array[e+2]=Zr(r),this.array[e+3]=Zr(i),this}}class oi extends ri{constructor(e,t,n){super(new Float32Array(e),t,n)}}let li=0;const ui=new Jn,ci=new Er,di=new Tn,hi=new En,pi=new En,fi=new Tn;class mi extends Dt{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:li++}),this.uuid=zt(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Kt(e)?si:ii)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new $t).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return ui.makeRotationFromQuaternion(e),this.applyMatrix4(ui),this}rotateX(e){return ui.makeRotationX(e),this.applyMatrix4(ui),this}rotateY(e){return ui.makeRotationY(e),this.applyMatrix4(ui),this}rotateZ(e){return ui.makeRotationZ(e),this.applyMatrix4(ui),this}translate(e,t,n){return ui.makeTranslation(e,t,n),this.applyMatrix4(ui),this}scale(e,t,n){return ui.makeScale(e,t,n),this.applyMatrix4(ui),this}lookAt(e){return ci.lookAt(e),ci.updateMatrix(),this.applyMatrix4(ci.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(di).negate(),this.translate(di.x,di.y,di.z),this}setFromPoints(e){const t=this.getAttribute("position");if(void 0===t){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}this.setAttribute("position",new oi(t,3))}else{const n=Math.min(e.length,t.count);for(let r=0;r<n;r++){const n=e[r];t.setXYZ(r,n.x,n.y,n.z||0)}e.length,t.count,t.needsUpdate=!0}return this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new En);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingBox.set(new Tn(-1/0,-1/0,-1/0),new Tn(1/0,1/0,1/0));else{if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];hi.setFromBufferAttribute(n),this.morphTargetsRelative?(fi.addVectors(this.boundingBox.min,hi.min),this.boundingBox.expandByPoint(fi),fi.addVectors(this.boundingBox.max,hi.max),this.boundingBox.expandByPoint(fi)):(this.boundingBox.expandByPoint(hi.min),this.boundingBox.expandByPoint(hi.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Wn);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)this.boundingSphere.set(new Tn,1/0);else if(e){const n=this.boundingSphere.center;if(hi.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];pi.setFromBufferAttribute(n),this.morphTargetsRelative?(fi.addVectors(hi.min,pi.min),hi.expandByPoint(fi),fi.addVectors(hi.max,pi.max),hi.expandByPoint(fi)):(hi.expandByPoint(pi.min),hi.expandByPoint(pi.max))}hi.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)fi.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(fi));if(t)for(let i=0,s=t.length;i<s;i++){const s=t[i],a=this.morphTargetsRelative;for(let t=0,i=s.count;t<i;t++)fi.fromBufferAttribute(s,t),a&&(di.fromBufferAttribute(e,t),fi.add(di)),r=Math.max(r,n.distanceToSquared(fi))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return;const n=t.position,r=t.normal,i=t.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new ri(new Float32Array(4*n.count),4));const s=this.getAttribute("tangent"),a=[],o=[];for(let e=0;e<n.count;e++)a[e]=new Tn,o[e]=new Tn;const l=new Tn,u=new Tn,c=new Tn,d=new Xt,h=new Xt,p=new Xt,f=new Tn,m=new Tn;function g(e,t,r){l.fromBufferAttribute(n,e),u.fromBufferAttribute(n,t),c.fromBufferAttribute(n,r),d.fromBufferAttribute(i,e),h.fromBufferAttribute(i,t),p.fromBufferAttribute(i,r),u.sub(l),c.sub(l),h.sub(d),p.sub(d);const s=1/(h.x*p.y-p.x*h.y);isFinite(s)&&(f.copy(u).multiplyScalar(p.y).addScaledVector(c,-h.y).multiplyScalar(s),m.copy(c).multiplyScalar(h.x).addScaledVector(u,-p.x).multiplyScalar(s),a[e].add(f),a[t].add(f),a[r].add(f),o[e].add(m),o[t].add(m),o[r].add(m))}let v=this.groups;0===v.length&&(v=[{start:0,count:e.count}]);for(let t=0,n=v.length;t<n;++t){const n=v[t],r=n.start;for(let t=r,i=r+n.count;t<i;t+=3)g(e.getX(t+0),e.getX(t+1),e.getX(t+2))}const y=new Tn,_=new Tn,x=new Tn,b=new Tn;function S(e){x.fromBufferAttribute(r,e),b.copy(x);const t=a[e];y.copy(t),y.sub(x.multiplyScalar(x.dot(t))).normalize(),_.crossVectors(b,t);const n=_.dot(o[e])<0?-1:1;s.setXYZW(e,y.x,y.y,y.z,n)}for(let t=0,n=v.length;t<n;++t){const n=v[t],r=n.start;for(let t=r,i=r+n.count;t<i;t+=3)S(e.getX(t+0)),S(e.getX(t+1)),S(e.getX(t+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new ri(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new Tn,i=new Tn,s=new Tn,a=new Tn,o=new Tn,l=new Tn,u=new Tn,c=new Tn;if(e)for(let d=0,h=e.count;d<h;d+=3){const h=e.getX(d+0),p=e.getX(d+1),f=e.getX(d+2);r.fromBufferAttribute(t,h),i.fromBufferAttribute(t,p),s.fromBufferAttribute(t,f),u.subVectors(s,i),c.subVectors(r,i),u.cross(c),a.fromBufferAttribute(n,h),o.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),a.add(u),o.add(u),l.add(u),n.setXYZ(h,a.x,a.y,a.z),n.setXYZ(p,o.x,o.y,o.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,a=t.count;e<a;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),s.fromBufferAttribute(t,e+2),u.subVectors(s,i),c.subVectors(r,i),u.cross(c),n.setXYZ(e+0,u.x,u.y,u.z),n.setXYZ(e+1,u.x,u.y,u.z),n.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)fi.fromBufferAttribute(e,t),fi.normalize(),e.setXYZ(t,fi.x,fi.y,fi.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,s=new n.constructor(t.length*r);let a=0,o=0;for(let i=0,l=t.length;i<l;i++){a=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*r;for(let e=0;e<r;e++)s[o++]=n[a++]}return new ri(s,r,i)}if(null===this.index)return this;const t=new mi,n=this.index.array,r=this.attributes;for(const i in r){const s=e(r[i],n);t.setAttribute(i,s)}const i=this.morphAttributes;for(const r in i){const s=[],a=i[r];for(let t=0,r=a.length;t<r;t++){const r=e(a[t],n);s.push(r)}t.morphAttributes[r]=s}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let e=0,n=s.length;e<n;e++){const n=s[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],s=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];s.push(r.toJSON(e.data))}s.length>0&&(r[t]=s,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const gi=new Jn,vi=new Zn,yi=new Wn,_i=new Tn,xi=new Tn,bi=new Tn,Si=new Tn,Ti=new Tn,wi=new Tn,Mi=new Tn,Ei=new Tn;class Ai extends Er{constructor(e=new mi,t=new Yr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}getVertexPosition(e,t){const n=this.geometry,r=n.attributes.position,i=n.morphAttributes.position,s=n.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(i&&a){wi.set(0,0,0);for(let n=0,r=i.length;n<r;n++){const r=a[n],o=i[n];0!==r&&(Ti.fromBufferAttribute(o,e),s?wi.addScaledVector(Ti,r):wi.addScaledVector(Ti.sub(t),r))}t.add(wi)}return t}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r){if(null===n.boundingSphere&&n.computeBoundingSphere(),yi.copy(n.boundingSphere),yi.applyMatrix4(i),vi.copy(e.ray).recast(e.near),!1===yi.containsPoint(vi.origin)){if(null===vi.intersectSphere(yi,_i))return;if(vi.origin.distanceToSquared(_i)>(e.far-e.near)**2)return}gi.copy(i).invert(),vi.copy(e.ray).applyMatrix4(gi),null!==n.boundingBox&&!1===vi.intersectsBox(n.boundingBox)||this._computeIntersections(e,t,vi)}}_computeIntersections(e,t,n){let r;const i=this.geometry,s=this.material,a=i.index,o=i.attributes.position,l=i.attributes.uv,u=i.attributes.uv1,c=i.attributes.normal,d=i.groups,h=i.drawRange;if(null!==a)if(Array.isArray(s))for(let i=0,o=d.length;i<o;i++){const o=d[i],p=s[o.materialIndex];for(let i=Math.max(o.start,h.start),s=Math.min(a.count,Math.min(o.start+o.count,h.start+h.count));i<s;i+=3){r=Ci(this,p,e,n,l,u,c,a.getX(i),a.getX(i+1),a.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=o.materialIndex,t.push(r))}}else{for(let i=Math.max(0,h.start),o=Math.min(a.count,h.start+h.count);i<o;i+=3){r=Ci(this,s,e,n,l,u,c,a.getX(i),a.getX(i+1),a.getX(i+2)),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}else if(void 0!==o)if(Array.isArray(s))for(let i=0,a=d.length;i<a;i++){const a=d[i],p=s[a.materialIndex];for(let i=Math.max(a.start,h.start),s=Math.min(o.count,Math.min(a.start+a.count,h.start+h.count));i<s;i+=3){r=Ci(this,p,e,n,l,u,c,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=a.materialIndex,t.push(r))}}else{for(let i=Math.max(0,h.start),a=Math.min(o.count,h.start+h.count);i<a;i+=3){r=Ci(this,s,e,n,l,u,c,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}}}function Ci(e,t,n,r,i,s,a,o,l,u){e.getVertexPosition(o,xi),e.getVertexPosition(l,bi),e.getVertexPosition(u,Si);const c=function(e,t,n,r,i,s,a,o){let l;if(l=1===t.side?r.intersectTriangle(a,s,i,!0,o):r.intersectTriangle(i,s,a,0===t.side,o),null===l)return null;Ei.copy(o),Ei.applyMatrix4(e.matrixWorld);const u=n.ray.origin.distanceTo(Ei);return u<n.near||u>n.far?null:{distance:u,point:Ei.clone(),object:e}}(e,t,n,r,xi,bi,Si,Mi);if(c){const e=new Tn;zr.getBarycoord(Mi,xi,bi,Si,e),i&&(c.uv=zr.getInterpolatedAttribute(i,o,l,u,e,new Xt)),s&&(c.uv1=zr.getInterpolatedAttribute(s,o,l,u,e,new Xt)),a&&(c.normal=zr.getInterpolatedAttribute(a,o,l,u,e,new Tn),c.normal.dot(r.direction)>0&&c.normal.multiplyScalar(-1));const t={a:o,b:l,c:u,normal:new Tn,materialIndex:0};zr.getNormal(xi,bi,Si,t.normal),c.face=t,c.barycoord=e}return c}class Ri extends mi{constructor(e=1,t=1,n=1,r=1,i=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:s};const a=this;r=Math.floor(r),i=Math.floor(i),s=Math.floor(s);const o=[],l=[],u=[],c=[];let d=0,h=0;function p(e,t,n,r,i,s,p,f,m,g,v){const y=s/m,_=p/g,x=s/2,b=p/2,S=f/2,T=m+1,w=g+1;let M=0,E=0;const A=new Tn;for(let s=0;s<w;s++){const a=s*_-b;for(let o=0;o<T;o++){const d=o*y-x;A[e]=d*r,A[t]=a*i,A[n]=S,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[n]=f>0?1:-1,u.push(A.x,A.y,A.z),c.push(o/m),c.push(1-s/g),M+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=d+t+T*e,r=d+t+T*(e+1),i=d+(t+1)+T*(e+1),s=d+(t+1)+T*e;o.push(n,r,s),o.push(r,i,s),E+=6}a.addGroup(h,E,v),h+=E,d+=M}p("z","y","x",-1,-1,n,t,e,s,i,0),p("z","y","x",1,-1,n,t,-e,s,i,1),p("x","z","y",1,1,e,n,t,r,s,2),p("x","z","y",1,-1,e,n,-t,r,s,3),p("x","y","z",1,-1,e,t,n,r,i,4),p("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(o),this.setAttribute("position",new oi(l,3)),this.setAttribute("normal",new oi(u,3)),this.setAttribute("uv",new oi(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ri(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Ni(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?t[n][r]=null:t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function Pi(e){const t={};for(let n=0;n<e.length;n++){const r=Ni(e[n]);for(const e in r)t[e]=r[e]}return t}function Ii(e){const t=e.getRenderTarget();return null===t?e.outputColorSpace:!0===t.isXRRenderTarget?t.texture.colorSpace:on.workingColorSpace}const Li={clone:Ni,merge:Pi};class Ui extends $r{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ni(e.uniforms),this.uniformsGroups=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Di extends Er{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Jn,this.projectionMatrix=new Jn,this.projectionMatrixInverse=new Jn,this.coordinateSystem=Lt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Fi=new Tn,Bi=new Xt,Oi=new Xt;class ki extends Di{constructor(e=50,t=1,n=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*kt*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Ot*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*kt*Math.atan(Math.tan(.5*Ot*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Fi.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Fi.x,Fi.y).multiplyScalar(-e/Fi.z),Fi.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Fi.x,Fi.y).multiplyScalar(-e/Fi.z)}getViewSize(e,t){return this.getViewBounds(e,Bi,Oi),t.subVectors(Oi,Bi)}setViewOffset(e,t,n,r,i,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Ot*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,a=s.fullHeight;i+=s.offsetX*r/e,t-=s.offsetY*n/a,r*=s.width/e,n*=s.height/a}const a=this.filmOffset;0!==a&&(i+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const zi=-90;class Vi extends Er{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new ki(zi,1,e,t);r.layers=this.layers,this.add(r);const i=new ki(zi,1,e,t);i.layers=this.layers,this.add(i);const s=new ki(zi,1,e,t);s.layers=this.layers,this.add(s);const a=new ki(zi,1,e,t);a.layers=this.layers,this.add(a);const o=new ki(zi,1,e,t);o.layers=this.layers,this.add(o);const l=new ki(zi,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,r,i,s,a,o]=t;for(const e of t)this.remove(e);if(e===Lt)n.up.set(0,1,0),n.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==Ut)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);n.up.set(0,-1,0),n.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[i,s,a,o,l,u]=this.children,c=e.getRenderTarget(),d=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const f=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,r),e.render(t,i),e.setRenderTarget(n,1,r),e.render(t,s),e.setRenderTarget(n,2,r),e.render(t,a),e.setRenderTarget(n,3,r),e.render(t,o),e.setRenderTarget(n,4,r),e.render(t,l),n.texture.generateMipmaps=f,e.setRenderTarget(n,5,r),e.render(t,u),e.setRenderTarget(c,d,h),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class Gi extends gn{constructor(e,t,n,r,i,s,a,o,l,u){super(e=void 0!==e?e:[],t=void 0!==t?t:j,n,r,i,s,a,o,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Hi extends _n{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new Gi(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:ne}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new Ri(5,5,5),i=new Ui({name:"CubemapFromEquirect",uniforms:Ni(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=t;const s=new Ai(r,i),a=t.minFilter;t.minFilter===ie&&(t.minFilter=ne);return new Vi(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}class Wi extends Er{constructor(){super(),this.isGroup=!0,this.type="Group"}}const ji={type:"move"};class qi{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Wi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Wi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Tn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Tn),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Wi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Tn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Tn),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(l&&e.hand){s=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n),i=this._getHandJoint(l,r);null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.matrixWorldNeedsUpdate=!0,i.jointRadius=e.radius),i.visible=null!==e}const r=l.joints["index-finger-tip"],i=l.joints["thumb-tip"],a=r.position.distanceTo(i.position),o=.02,u=.005;l.inputState.pinching&&a>o+u?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&a<=o-u&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(r=t.getPose(e.targetRaySpace,n),null===r&&null!==i&&(r=i),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(ji)))}return null!==a&&(a.visible=null!==r),null!==o&&(o.visible=null!==i),null!==l&&(l.visible=null!==s),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const n=new Wi;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Xi{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new jr(e),this.density=t}clone(){return new Xi(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class $i{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new jr(e),this.near=t,this.far=n}clone(){return new $i(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Yi extends Er{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new ur,this.environmentIntensity=1,this.environmentRotation=new ur,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Ki{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Nt,this.updateRanges=[],this.version=0,this.uuid=zt()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=zt()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=zt()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Qi=new Tn;class Zi{constructor(e,t,n,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)Qi.fromBufferAttribute(this,t),Qi.applyMatrix4(e),this.setXYZ(t,Qi.x,Qi.y,Qi.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Qi.fromBufferAttribute(this,t),Qi.applyNormalMatrix(e),this.setXYZ(t,Qi.x,Qi.y,Qi.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Qi.fromBufferAttribute(this,t),Qi.transformDirection(e),this.setXYZ(t,Qi.x,Qi.y,Qi.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=Wt(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=jt(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=jt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=jt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=jt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=jt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Wt(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Wt(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Wt(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Wt(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=jt(t,this.array),n=jt(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=jt(t,this.array),n=jt(n,this.array),r=jt(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=jt(t,this.array),n=jt(n,this.array),r=jt(r,this.array),i=jt(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new ri(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Zi(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Ji extends $r{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new jr(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let es;const ts=new Tn,ns=new Tn,rs=new Tn,is=new Xt,ss=new Xt,as=new Jn,os=new Tn,ls=new Tn,us=new Tn,cs=new Xt,ds=new Xt,hs=new Xt;class ps extends Er{constructor(e=new Ji){if(super(),this.isSprite=!0,this.type="Sprite",void 0===es){es=new mi;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new Ki(e,5);es.setIndex([0,1,2,0,2,3]),es.setAttribute("position",new Zi(t,3,0,!1)),es.setAttribute("uv",new Zi(t,2,3,!1))}this.geometry=es,this.material=e,this.center=new Xt(.5,.5)}raycast(e,t){e.camera,ns.setFromMatrixScale(this.matrixWorld),as.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),rs.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&ns.multiplyScalar(-rs.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const s=this.center;fs(os.set(-.5,-.5,0),rs,s,ns,r,i),fs(ls.set(.5,-.5,0),rs,s,ns,r,i),fs(us.set(.5,.5,0),rs,s,ns,r,i),cs.set(0,0),ds.set(1,0),hs.set(1,1);let a=e.ray.intersectTriangle(os,ls,us,!1,ts);if(null===a&&(fs(ls.set(-.5,.5,0),rs,s,ns,r,i),ds.set(0,1),a=e.ray.intersectTriangle(os,us,ls,!1,ts),null===a))return;const o=e.ray.origin.distanceTo(ts);o<e.near||o>e.far||t.push({distance:o,point:ts.clone(),uv:zr.getInterpolation(ts,os,ls,us,cs,ds,hs,new Xt),face:null,object:this})}copy(e,t){return super.copy(e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function fs(e,t,n,r,i,s){is.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(ss.x=s*is.x-i*is.y,ss.y=i*is.x+s*is.y):ss.copy(is),e.copy(t),e.x+=ss.x,e.y+=ss.y,e.applyMatrix4(as)}const ms=new Tn,gs=new Tn;class vs extends Er{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance,n.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const r=this.levels;let i;for(i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const e=t.splice(n,1);return this.remove(e[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r;n++){let r=t[n].distance;if(t[n].object.visible&&(r-=r*t[n].hysteresis),e<r)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){ms.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(ms);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){ms.setFromMatrixPosition(e.matrixWorld),gs.setFromMatrixPosition(this.matrixWorld);const n=ms.distanceTo(gs)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i;r++){let e=t[r].distance;if(t[r].object.visible&&(e-=e*t[r].hysteresis),!(n>=e))break;t[r-1].object.visible=!1,t[r].object.visible=!0}for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,r=n.length;e<r;e++){const r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance,hysteresis:r.hysteresis})}return t}}const ys=new Tn,_s=new vn,xs=new vn,bs=new Tn,Ss=new Jn,Ts=new Tn,ws=new Wn,Ms=new Jn,Es=new Zn;class As extends Ai{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=G,this.bindMatrix=new Jn,this.bindMatrixInverse=new Jn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;null===this.boundingBox&&(this.boundingBox=new En),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,Ts),this.boundingBox.expandByPoint(Ts)}computeBoundingSphere(){const e=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Wn),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let e=0;e<t.count;e++)this.getVertexPosition(e,Ts),this.boundingSphere.expandByPoint(Ts)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,r=this.matrixWorld;void 0!==n&&(null===this.boundingSphere&&this.computeBoundingSphere(),ws.copy(this.boundingSphere),ws.applyMatrix4(r),!1!==e.ray.intersectsSphere(ws)&&(Ms.copy(r).invert(),Es.copy(e.ray).applyMatrix4(Ms),null!==this.boundingBox&&!1===Es.intersectsBox(this.boundingBox)||this._computeIntersections(e,t,Es)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new vn,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===G?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===H&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}applyBoneTransform(e,t){const n=this.skeleton,r=this.geometry;_s.fromBufferAttribute(r.attributes.skinIndex,e),xs.fromBufferAttribute(r.attributes.skinWeight,e),ys.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=xs.getComponent(e);if(0!==r){const i=_s.getComponent(e);Ss.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(bs.copy(ys).applyMatrix4(Ss),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}class Cs extends Er{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Rs extends gn{constructor(e=null,t=1,n=1,r,i,s,a,o,l=1003,u=1003,c,d){super(null,s,a,o,l,u,r,i,c,d),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Ns=new Jn,Ps=new Jn;class Is{constructor(e=[],t=[]){this.uuid=zt(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Jn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Jn;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){const i=e[r]?e[r].matrixWorld:Ps;Ns.multiplyMatrices(i,t[r]),Ns.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new Is(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Rs(t,e,e,_e,de);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){let r=t[e.bones[n]];void 0===r&&(r=new Cs),this.bones.push(r),this.boneInverses.push((new Jn).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const s=n[r];e.boneInverses.push(s.toArray())}return e}}class Ls extends ri{constructor(e,t,n,r=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Us=new Jn,Ds=new Jn,Fs=[],Bs=new En,Os=new Jn,ks=new Ai,zs=new Wn;class Vs extends Ai{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Ls(new Float32Array(16*n),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let e=0;e<n;e++)this.setMatrixAt(e,Os)}computeBoundingBox(){const e=this.geometry,t=this.count;null===this.boundingBox&&(this.boundingBox=new En),null===e.boundingBox&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Us),Bs.copy(e.boundingBox).applyMatrix4(Us),this.boundingBox.union(Bs)}computeBoundingSphere(){const e=this.geometry,t=this.count;null===this.boundingSphere&&(this.boundingSphere=new Wn),null===e.boundingSphere&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,Us),zs.copy(e.boundingSphere).applyMatrix4(Us),this.boundingSphere.union(zs)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.morphTexture&&(this.morphTexture=e.morphTexture.clone()),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}getMorphAt(e,t){const n=t.morphTargetInfluences,r=this.morphTexture.source.data.data,i=e*(n.length+1)+1;for(let e=0;e<n.length;e++)n[e]=r[i+e]}raycast(e,t){const n=this.matrixWorld,r=this.count;if(ks.geometry=this.geometry,ks.material=this.material,void 0!==ks.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),zs.copy(this.boundingSphere),zs.applyMatrix4(n),!1!==e.ray.intersectsSphere(zs)))for(let i=0;i<r;i++){this.getMatrixAt(i,Us),Ds.multiplyMatrices(n,Us),ks.matrixWorld=Ds,ks.raycast(e,Fs);for(let e=0,n=Fs.length;e<n;e++){const n=Fs[e];n.instanceId=i,n.object=this,t.push(n)}Fs.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Ls(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}setMorphAt(e,t){const n=t.morphTargetInfluences,r=n.length+1;null===this.morphTexture&&(this.morphTexture=new Rs(new Float32Array(r*this.count),r,this.count,we,de));const i=this.morphTexture.source.data.data;let s=0;for(let e=0;e<n.length;e++)s+=n[e];const a=this.geometry.morphTargetsRelative?1:1-s,o=r*e;i[o]=a,i.set(n,o+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null)}}const Gs=new Tn,Hs=new Tn,Ws=new $t;class js{constructor(e=new Tn(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=Gs.subVectors(n,t).cross(Hs.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Gs),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(e.start).addScaledVector(n,i)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Ws.getNormalMatrix(e),r=this.coplanarPoint(Gs).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const qs=new Wn,Xs=new Tn;class $s{constructor(e=new js,t=new js,n=new js,r=new js,i=new js,s=new js){this.planes=[e,t,n,r,i,s]}set(e,t,n,r,i,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(r),a[4].copy(i),a[5].copy(s),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=2e3){const n=this.planes,r=e.elements,i=r[0],s=r[1],a=r[2],o=r[3],l=r[4],u=r[5],c=r[6],d=r[7],h=r[8],p=r[9],f=r[10],m=r[11],g=r[12],v=r[13],y=r[14],_=r[15];if(n[0].setComponents(o-i,d-l,m-h,_-g).normalize(),n[1].setComponents(o+i,d+l,m+h,_+g).normalize(),n[2].setComponents(o+s,d+u,m+p,_+v).normalize(),n[3].setComponents(o-s,d-u,m-p,_-v).normalize(),n[4].setComponents(o-a,d-c,m-f,_-y).normalize(),t===Lt)n[5].setComponents(o+a,d+c,m+f,_+y).normalize();else{if(t!==Ut)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);n[5].setComponents(a,c,f,y).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),qs.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),qs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(qs)}intersectsSprite(e){return qs.center.set(0,0,0),qs.radius=.7071067811865476,qs.applyMatrix4(e.matrixWorld),this.intersectsSphere(qs)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(Xs.x=r.normal.x>0?e.max.x:e.min.x,Xs.y=r.normal.y>0?e.max.y:e.min.y,Xs.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(Xs)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Ys(e,t){return e-t}function Ks(e,t){return e.z-t.z}function Qs(e,t){return t.z-e.z}class Zs{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,r){const i=this.pool,s=this.list;this.index>=i.length&&i.push({start:-1,count:-1,z:-1,index:-1});const a=i[this.index];s.push(a),this.index++,a.start=e,a.count=t,a.z=n,a.index=r}reset(){this.list.length=0,this.index=0}}const Js=new Jn,ea=new jr(1,1,1),ta=new $s,na=new En,ra=new Wn,ia=new Tn,sa=new Tn,aa=new Tn,oa=new Zs,la=new Ai,ua=[];function ca(e,t,n=0){const r=t.itemSize;if(e.isInterleavedBufferAttribute||e.array.constructor!==t.array.constructor){const i=e.count;for(let s=0;s<i;s++)for(let i=0;i<r;i++)t.setComponent(s+n,i,e.getComponent(s,i))}else t.array.set(e.array,n*r);t.needsUpdate=!0}function da(e,t){if(e.constructor!==t.constructor){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++)t[r]=e[r]}else{const n=Math.min(e.length,t.length);t.set(new e.constructor(e.buffer,0,n))}}class ha extends Ai{constructor(e,t,n=2*t,r){super(new mi,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(4*this._maxInstanceCount);e=4*Math.ceil(e/4),e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new Rs(t,e,e,_e,de);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new Rs(t,e,e,Me,ce);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new Rs(t,e,e,_e,de);n.colorSpace=on.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,r=this._maxIndexCount;if(!1===this._geometryInitialized){for(const r in e.attributes){const i=e.getAttribute(r),{array:s,itemSize:a,normalized:o}=i,l=new s.constructor(n*a),u=new ri(l,a,o);t.setAttribute(r,u)}if(null!==e.getIndex()){const e=n>65535?new Uint32Array(r):new Uint16Array(r);t.setIndex(new ri(e,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(Boolean(e.getIndex())!==Boolean(t.getIndex()))throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const r=e.getAttribute(n),i=t.getAttribute(n);if(r.itemSize!==i.itemSize||r.normalized!==i.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||!1===t[e].active)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new En);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){if(!1===t[n].active)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,Js),this.getBoundingBoxAt(r,na).applyMatrix4(Js),e.union(na)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Wn);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,r=t.length;n<r;n++){if(!1===t[n].active)continue;const r=t[n].geometryIndex;this.getMatrixAt(n,Js),this.getBoundingSphereAt(r,ra).applyMatrix4(Js),e.union(ra)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&0===this._availableInstanceIds.length)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const t={visible:!0,active:!0,geometryIndex:e};let n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(Ys),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=t):(n=this._instanceInfo.length,this._instanceInfo.push(t));const r=this._matricesTexture;Js.identity().toArray(r.image.data,16*n),r.needsUpdate=!0;const i=this._colorsTexture;return i&&(ea.toArray(i.image.data,4*n),i.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},i=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=-1===t?e.getAttribute("position").count:t;const s=e.getIndex();if(null!==s&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=-1===n?s.count:n),-1!==r.indexStart&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let a;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(Ys),a=this._availableGeometryIds.shift(),i[a]=r):(a=this._geometryCount,this._geometryCount++,i.push(r)),this.setGeometryAt(a,e),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,a}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,r=null!==n.getIndex(),i=n.getIndex(),s=t.getIndex(),a=this._geometryInfo[e];if(r&&s.count>a.reservedIndexCount||t.attributes.position.count>a.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const o=a.vertexStart,l=a.reservedVertexCount;a.vertexCount=t.getAttribute("position").count;for(const e in n.attributes){const r=t.getAttribute(e),i=n.getAttribute(e);ca(r,i,o);const s=r.itemSize;for(let e=r.count,t=l;e<t;e++){const t=o+e;for(let e=0;e<s;e++)i.setComponent(t,e,0)}i.needsUpdate=!0,i.addUpdateRange(o*s,l*s)}if(r){const e=a.indexStart,n=a.reservedIndexCount;a.indexCount=t.getIndex().count;for(let t=0;t<s.count;t++)i.setX(e+t,o+s.getX(t));for(let t=s.count,r=n;t<r;t++)i.setX(e+t,o);i.needsUpdate=!0,i.addUpdateRange(e,a.reservedIndexCount)}return a.start=r?a.indexStart:a.vertexStart,a.count=r?a.indexCount:a.vertexCount,a.boundingBox=null,null!==t.boundingBox&&(a.boundingBox=t.boundingBox.clone()),a.boundingSphere=null,null!==t.boundingSphere&&(a.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||!1===t[e].active)return this;const n=this._instanceInfo;for(let t=0,r=n.length;t<r;t++)n[t].active&&n[t].geometryIndex===e&&this.deleteInstance(t);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,r=n.map((e,t)=>t).sort((e,t)=>n[e].vertexStart-n[t].vertexStart),i=this.geometry;for(let s=0,a=n.length;s<a;s++){const a=r[s],o=n[a];if(!1!==o.active){if(null!==i.index){if(o.indexStart!==t){const{indexStart:n,vertexStart:r,reservedIndexCount:s}=o,a=i.index,l=a.array,u=e-r;for(let e=n;e<n+s;e++)l[e]=l[e]+u;a.array.copyWithin(t,n,n+s),a.addUpdateRange(t,s),o.indexStart=t}t+=o.reservedIndexCount}if(o.vertexStart!==e){const{vertexStart:t,reservedVertexCount:n}=o,r=i.attributes;for(const i in r){const s=r[i],{array:a,itemSize:o}=s;a.copyWithin(e*o,t*o,(t+n)*o),s.addUpdateRange(e*o,n*o)}o.vertexStart=e}e+=o.reservedVertexCount,o.start=i.index?o.indexStart:o.vertexStart,this._nextIndexStart=i.index?o.indexStart+o.reservedIndexCount:0,this._nextVertexStart=o.vertexStart+o.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(null===r.boundingBox){const e=new En,t=n.index,i=n.attributes.position;for(let n=r.start,s=r.start+r.count;n<s;n++){let r=n;t&&(r=t.getX(r)),e.expandByPoint(ia.fromBufferAttribute(i,r))}r.boundingBox=e}return t.copy(r.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,r=this._geometryInfo[e];if(null===r.boundingSphere){const t=new Wn;this.getBoundingBoxAt(e,na),na.getCenter(t.center);const i=n.index,s=n.attributes.position;let a=0;for(let e=r.start,n=r.start+r.count;e<n;e++){let n=e;i&&(n=i.getX(n)),ia.fromBufferAttribute(s,n),a=Math.max(a,t.center.distanceToSquared(ia))}t.radius=Math.sqrt(a),r.boundingSphere=t}return t.copy(r.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,r=this._matricesTexture.image.data;return t.toArray(r,16*e),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,16*e)}setColorAt(e,t){return this.validateInstanceId(e),null===this._colorsTexture&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,4*e),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,4*e)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t||(this._instanceInfo[e].visible=t,this._visibilityChanged=!0),this}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(Ys);t[t.length-1]===n.length;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const r=new Int32Array(e),i=new Int32Array(e);da(this._multiDrawCounts,r),da(this._multiDrawStarts,i),this._multiDrawCounts=r,this._multiDrawStarts=i,this._maxInstanceCount=e;const s=this._indirectTexture,a=this._matricesTexture,o=this._colorsTexture;s.dispose(),this._initIndirectTexture(),da(s.image.data,this._indirectTexture.image.data),a.dispose(),this._initMatricesTexture(),da(a.image.data,this._matricesTexture.image.data),o&&(o.dispose(),this._initColorsTexture(),da(o.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(e=>e.active),r=Math.max(...n.map(e=>e.vertexStart+e.reservedVertexCount));if(r>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index){const e=Math.max(...n.map(e=>e.indexStart+e.reservedIndexCount));if(e>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`)}const i=this.geometry;i.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new mi,this._initializeGeometry(i));const s=this.geometry;i.index&&da(i.index.array,s.index.array);for(const e in i.attributes)da(i.attributes[e].array,s.attributes[e].array)}raycast(e,t){const n=this._instanceInfo,r=this._geometryInfo,i=this.matrixWorld,s=this.geometry;la.material=this.material,la.geometry.index=s.index,la.geometry.attributes=s.attributes,null===la.geometry.boundingBox&&(la.geometry.boundingBox=new En),null===la.geometry.boundingSphere&&(la.geometry.boundingSphere=new Wn);for(let s=0,a=n.length;s<a;s++){if(!n[s].visible||!n[s].active)continue;const a=n[s].geometryIndex,o=r[a];la.geometry.setDrawRange(o.start,o.count),this.getMatrixAt(s,la.matrixWorld).premultiply(i),this.getBoundingBoxAt(a,la.geometry.boundingBox),this.getBoundingSphereAt(a,la.geometry.boundingSphere),la.raycast(e,ua);for(let e=0,n=ua.length;e<n;e++){const n=ua[e];n.object=this,n.batchId=s,t.push(n)}ua.length=0}la.material=null,la.geometry.index=null,la.geometry.attributes={},la.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=null!==e.boundingBox?e.boundingBox.clone():null,this.boundingSphere=null!==e.boundingSphere?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(e=>({...e,boundingBox:null!==e.boundingBox?e.boundingBox.clone():null,boundingSphere:null!==e.boundingSphere?e.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(e=>({...e})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),null!==this._colorsTexture&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,null!==this._colorsTexture&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,r,i){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const s=r.getIndex(),a=null===s?1:s.array.BYTES_PER_ELEMENT,o=this._instanceInfo,l=this._multiDrawStarts,u=this._multiDrawCounts,c=this._geometryInfo,d=this.perObjectFrustumCulled,h=this._indirectTexture,p=h.image.data;d&&(Js.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),ta.setFromProjectionMatrix(Js,e.coordinateSystem));let f=0;if(this.sortObjects){Js.copy(this.matrixWorld).invert(),ia.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Js),sa.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(Js);for(let e=0,t=o.length;e<t;e++)if(o[e].visible&&o[e].active){const t=o[e].geometryIndex;this.getMatrixAt(e,Js),this.getBoundingSphereAt(t,ra).applyMatrix4(Js);let n=!1;if(d&&(n=!ta.intersectsSphere(ra)),!n){const n=c[t],r=aa.subVectors(ra.center,ia).dot(sa);oa.push(n.start,n.count,r,e)}}const e=oa.list,t=this.customSort;null===t?e.sort(i.transparent?Qs:Ks):t.call(this,e,n);for(let t=0,n=e.length;t<n;t++){const n=e[t];l[f]=n.start*a,u[f]=n.count,p[f]=n.index,f++}oa.reset()}else for(let e=0,t=o.length;e<t;e++)if(o[e].visible&&o[e].active){const t=o[e].geometryIndex;let n=!1;if(d&&(this.getMatrixAt(e,Js),this.getBoundingSphereAt(t,ra).applyMatrix4(Js),n=!ta.intersectsSphere(ra)),!n){const n=c[t];l[f]=n.start*a,u[f]=n.count,p[f]=e,f++}}h.needsUpdate=!0,this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,t,n,r,i,s){this.onBeforeRender(e,null,r,i,s)}}class pa extends $r{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new jr(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const fa=new Tn,ma=new Tn,ga=new Jn,va=new Zn,ya=new Wn,_a=new Tn,xa=new Tn;class ba extends Er{constructor(e=new mi,t=new pa){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)fa.fromBufferAttribute(t,e-1),ma.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=fa.distanceTo(ma);e.setAttribute("lineDistance",new oi(n,1))}return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),ya.copy(n.boundingSphere),ya.applyMatrix4(r),ya.radius+=i,!1===e.ray.intersectsSphere(ya))return;ga.copy(r).invert(),va.copy(e.ray).applyMatrix4(ga);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=this.isLineSegments?2:1,u=n.index,c=n.attributes.position;if(null!==u){const n=Math.max(0,s.start),r=Math.min(u.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){const n=u.getX(i),r=u.getX(i+1),s=Sa(this,e,va,o,n,r,i);s&&t.push(s)}if(this.isLineLoop){const i=u.getX(r-1),s=u.getX(n),a=Sa(this,e,va,o,i,s,r-1);a&&t.push(a)}}else{const n=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);for(let i=n,s=r-1;i<s;i+=l){const n=Sa(this,e,va,o,i,i+1,i);n&&t.push(n)}if(this.isLineLoop){const i=Sa(this,e,va,o,r-1,n,r-1);i&&t.push(i)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function Sa(e,t,n,r,i,s,a){const o=e.geometry.attributes.position;fa.fromBufferAttribute(o,i),ma.fromBufferAttribute(o,s);if(n.distanceSqToSegment(fa,ma,_a,xa)>r)return;_a.applyMatrix4(e.matrixWorld);const l=t.ray.origin.distanceTo(_a);return l<t.near||l>t.far?void 0:{distance:l,point:xa.clone().applyMatrix4(e.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:e}}const Ta=new Tn,wa=new Tn;class Ma extends ba{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)Ta.fromBufferAttribute(t,e),wa.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+Ta.distanceTo(wa);e.setAttribute("lineDistance",new oi(n,1))}return this}}class Ea extends ba{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class Aa extends $r{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new jr(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Ca=new Jn,Ra=new Zn,Na=new Wn,Pa=new Tn;class Ia extends Er{constructor(e=new mi,t=new Aa){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Na.copy(n.boundingSphere),Na.applyMatrix4(r),Na.radius+=i,!1===e.ray.intersectsSphere(Na))return;Ca.copy(r).invert(),Ra.copy(e.ray).applyMatrix4(Ca);const a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=n.index,u=n.attributes.position;if(null!==l){for(let n=Math.max(0,s.start),i=Math.min(l.count,s.start+s.count);n<i;n++){const i=l.getX(n);Pa.fromBufferAttribute(u,i),La(Pa,i,o,r,e,t,this)}}else{for(let n=Math.max(0,s.start),i=Math.min(u.count,s.start+s.count);n<i;n++)Pa.fromBufferAttribute(u,n),La(Pa,n,o,r,e,t,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=n.length;e<t;e++){const t=n[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}function La(e,t,n,r,i,s,a){const o=Ra.distanceSqToPoint(e);if(o<n){const n=new Tn;Ra.closestPointToPoint(e,n),n.applyMatrix4(r);const l=i.ray.origin.distanceTo(n);if(l<i.near||l>i.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:n,index:t,face:null,faceIndex:null,barycoord:null,object:a})}}class Ua extends gn{constructor(e,t,n,r,i,s,a,o,l){super(e,t,n,r,i,s,a,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:ne,this.magFilter=void 0!==i?i:ne,this.generateMipmaps=!1;const u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function t(){u.needsUpdate=!0,e.requestVideoFrameCallback(t)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class Da extends gn{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=J,this.minFilter=J,this.generateMipmaps=!1,this.needsUpdate=!0}}class Fa extends gn{constructor(e,t,n,r,i,s,a,o,l,u,c,d){super(null,s,a,o,l,u,r,i,c,d),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Ba extends gn{constructor(e,t,n,r,i,s,a,o,l){super(e,t,n,r,i,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Oa extends gn{constructor(e,t,n,r,i,s,a,o,l,u=1026){if(u!==Se&&u!==Te)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===Se&&(n=ce),void 0===n&&u===Te&&(n=me),super(null,r,i,s,a,o,u,n,l),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:J,this.minFilter=void 0!==o?o:J,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new pn(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return null!==this.compareFunction&&(t.compareFunction=this.compareFunction),t}}class ka{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let s=1;s<=e;s++)n=this.getPoint(s/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let r=0;const i=n.length;let s;s=t||e*n[i-1];let a,o=0,l=i-1;for(;o<=l;)if(r=Math.floor(o+(l-o)/2),a=n[r]-s,a<0)o=r+1;else{if(!(a>0)){l=r;break}l=r-1}if(r=l,n[r]===s)return r/(i-1);const u=n[r];return(r+(s-u)/(n[r+1]-u))/(i-1)}getTangent(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const s=this.getPoint(r),a=this.getPoint(i),o=t||(s.isVector2?new Xt:new Tn);return o.copy(a).sub(s).normalize(),o}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new Tn,r=[],i=[],s=[],a=new Tn,o=new Jn;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new Tn)}i[0]=new Tn,s[0]=new Tn;let l=Number.MAX_VALUE;const u=Math.abs(r[0].x),c=Math.abs(r[0].y),d=Math.abs(r[0].z);u<=l&&(l=u,n.set(1,0,0)),c<=l&&(l=c,n.set(0,1,0)),d<=l&&n.set(0,0,1),a.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],a),s[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),s[t]=s[t-1].clone(),a.crossVectors(r[t-1],r[t]),a.length()>Number.EPSILON){a.normalize();const e=Math.acos(Vt(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(o.makeRotationAxis(a,e))}s[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(Vt(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(a.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(o.makeRotationAxis(r[n],t*n)),s[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class za extends ka{constructor(e=0,t=0,n=1,r=1,i=0,s=2*Math.PI,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(e,t=new Xt){const n=t,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const s=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=s?0:r),!0!==this.aClockwise||s||(i===r?i=-r:i-=r);const a=this.aStartAngle+e*i;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=o-this.aX,r=l-this.aY;o=n*e-r*t+this.aX,l=n*t+r*e+this.aY}return n.set(o,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Va extends za{constructor(e,t,n,r,i,s){super(e,t,n,n,r,i,s),this.isArcCurve=!0,this.type="ArcCurve"}}function Ga(){let e=0,t=0,n=0,r=0;function i(i,s,a,o){e=i,t=a,n=-3*i+3*s-2*a-o,r=2*i-2*s+a+o}return{initCatmullRom:function(e,t,n,r,s){i(t,n,s*(n-e),s*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,s,a,o){let l=(t-e)/s-(n-e)/(s+a)+(n-t)/a,u=(n-t)/a-(r-t)/(a+o)+(r-n)/o;l*=a,u*=a,i(t,n,l,u)},calc:function(i){const s=i*i;return e+t*i+n*s+r*(s*i)}}}const Ha=new Tn,Wa=new Ga,ja=new Ga,qa=new Ga;class Xa extends ka{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new Tn){const n=t,r=this.points,i=r.length,s=(i-(this.closed?0:1))*e;let a,o,l=Math.floor(s),u=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/i)+1)*i:0===u&&l===i-1&&(l=i-2,u=1),this.closed||l>0?a=r[(l-1)%i]:(Ha.subVectors(r[0],r[1]).add(r[0]),a=Ha);const c=r[l%i],d=r[(l+1)%i];if(this.closed||l+2<i?o=r[(l+2)%i]:(Ha.subVectors(r[i-1],r[i-2]).add(r[i-1]),o=Ha),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(a.distanceToSquared(c),e),n=Math.pow(c.distanceToSquared(d),e),r=Math.pow(d.distanceToSquared(o),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),Wa.initNonuniformCatmullRom(a.x,c.x,d.x,o.x,t,n,r),ja.initNonuniformCatmullRom(a.y,c.y,d.y,o.y,t,n,r),qa.initNonuniformCatmullRom(a.z,c.z,d.z,o.z,t,n,r)}else"catmullrom"===this.curveType&&(Wa.initCatmullRom(a.x,c.x,d.x,o.x,this.tension),ja.initCatmullRom(a.y,c.y,d.y,o.y,this.tension),qa.initCatmullRom(a.z,c.z,d.z,o.z,this.tension));return n.set(Wa.calc(u),ja.calc(u),qa.calc(u)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Tn).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function $a(e,t,n,r,i){const s=.5*(r-t),a=.5*(i-n),o=e*e;return(2*n-2*r+s+a)*(e*o)+(-3*n+3*r-2*s-a)*o+s*e+n}function Ya(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Ka(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}class Qa extends ka{constructor(e=new Xt,t=new Xt,n=new Xt,r=new Xt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Xt){const n=t,r=this.v0,i=this.v1,s=this.v2,a=this.v3;return n.set(Ka(e,r.x,i.x,s.x,a.x),Ka(e,r.y,i.y,s.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Za extends ka{constructor(e=new Tn,t=new Tn,n=new Tn,r=new Tn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Tn){const n=t,r=this.v0,i=this.v1,s=this.v2,a=this.v3;return n.set(Ka(e,r.x,i.x,s.x,a.x),Ka(e,r.y,i.y,s.y,a.y),Ka(e,r.z,i.z,s.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Ja extends ka{constructor(e=new Xt,t=new Xt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Xt){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Xt){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class eo extends ka{constructor(e=new Tn,t=new Tn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Tn){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Tn){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class to extends ka{constructor(e=new Xt,t=new Xt,n=new Xt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Xt){const n=t,r=this.v0,i=this.v1,s=this.v2;return n.set(Ya(e,r.x,i.x,s.x),Ya(e,r.y,i.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class no extends ka{constructor(e=new Tn,t=new Tn,n=new Tn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Tn){const n=t,r=this.v0,i=this.v1,s=this.v2;return n.set(Ya(e,r.x,i.x,s.x),Ya(e,r.y,i.y,s.y),Ya(e,r.z,i.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class ro extends ka{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Xt){const n=t,r=this.points,i=(r.length-1)*e,s=Math.floor(i),a=i-s,o=r[0===s?s:s-1],l=r[s],u=r[s>r.length-2?r.length-1:s+1],c=r[s>r.length-3?r.length-1:s+2];return n.set($a(a,o.x,l.x,u.x,c.x),$a(a,o.y,l.y,u.y,c.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Xt).fromArray(n))}return this}}var io=Object.freeze({__proto__:null,ArcCurve:Va,CatmullRomCurve3:Xa,CubicBezierCurve:Qa,CubicBezierCurve3:Za,EllipseCurve:za,LineCurve:Ja,LineCurve3:eo,QuadraticBezierCurve:to,QuadraticBezierCurve3:no,SplineCurve:ro});class so extends ka{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=!0===e.isVector2?"LineCurve":"LineCurve3";this.curves.push(new io[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let i=0;for(;i<r.length;){if(r[i]>=n){const e=r[i]-n,s=this.curves[i],a=s.getLength(),o=0===a?0:1-e/a;return s.getPointAt(o,t)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const s=i[r],a=s.isEllipseCurve?2*e:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?e*s.points.length:e,o=s.getPoints(a);for(let e=0;e<o.length;e++){const r=o[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new io[n.type]).fromJSON(n))}return this}}class ao extends so{constructor(e){super(),this.type="Path",this.currentPoint=new Xt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Ja(this.currentPoint.clone(),new Xt(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new to(this.currentPoint.clone(),new Xt(e,t),new Xt(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,s){const a=new Qa(this.currentPoint.clone(),new Xt(e,t),new Xt(n,r),new Xt(i,s));return this.curves.push(a),this.currentPoint.set(i,s),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new ro(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(e+a,t+o,n,r,i,s),this}absarc(e,t,n,r,i,s){return this.absellipse(e,t,n,n,r,i,s),this}ellipse(e,t,n,r,i,s,a,o){const l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,n,r,i,s,a,o),this}absellipse(e,t,n,r,i,s,a,o){const l=new za(e,t,n,r,i,s,a,o);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class oo extends mi{constructor(e=[new Xt(0,-.5),new Xt(.5,0),new Xt(0,.5)],t=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=Vt(r,0,2*Math.PI);const i=[],s=[],a=[],o=[],l=[],u=1/t,c=new Tn,d=new Xt,h=new Tn,p=new Tn,f=new Tn;let m=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,h.x=1*g,h.y=-m,h.z=0*g,f.copy(h),h.normalize(),o.push(h.x,h.y,h.z);break;case e.length-1:o.push(f.x,f.y,f.z);break;default:m=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,h.x=1*g,h.y=-m,h.z=0*g,p.copy(h),h.x+=f.x,h.y+=f.y,h.z+=f.z,h.normalize(),o.push(h.x,h.y,h.z),f.copy(p)}for(let i=0;i<=t;i++){const h=n+i*u*r,p=Math.sin(h),f=Math.cos(h);for(let n=0;n<=e.length-1;n++){c.x=e[n].x*p,c.y=e[n].y,c.z=e[n].x*f,s.push(c.x,c.y,c.z),d.x=i/t,d.y=n/(e.length-1),a.push(d.x,d.y);const r=o[3*n+0]*p,u=o[3*n+1],h=o[3*n+0]*f;l.push(r,u,h)}}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const r=t+n*e.length,s=r,a=r+e.length,o=r+e.length+1,l=r+1;i.push(s,a,l),i.push(o,l,a)}this.setIndex(i),this.setAttribute("position",new oi(s,3)),this.setAttribute("uv",new oi(a,2)),this.setAttribute("normal",new oi(l,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new oo(e.points,e.segments,e.phiStart,e.phiLength)}}class lo extends oo{constructor(e=1,t=1,n=4,r=8){const i=new ao;i.absarc(0,-t/2,e,1.5*Math.PI,0),i.absarc(0,t/2,e,0,.5*Math.PI),super(i.getPoints(n),r),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:r}}static fromJSON(e){return new lo(e.radius,e.length,e.capSegments,e.radialSegments)}}class uo extends mi{constructor(e=1,t=32,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],s=[],a=[],o=[],l=new Tn,u=new Xt;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let i=0,c=3;i<=t;i++,c+=3){const d=n+i/t*r;l.x=e*Math.cos(d),l.y=e*Math.sin(d),s.push(l.x,l.y,l.z),a.push(0,0,1),u.x=(s[c]/e+1)/2,u.y=(s[c+1]/e+1)/2,o.push(u.x,u.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute("position",new oi(s,3)),this.setAttribute("normal",new oi(a,3)),this.setAttribute("uv",new oi(o,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uo(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class co extends mi{constructor(e=1,t=1,n=1,r=32,i=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:o};const l=this;r=Math.floor(r),i=Math.floor(i);const u=[],c=[],d=[],h=[];let p=0;const f=[],m=n/2;let g=0;function v(n){const i=p,s=new Xt,f=new Tn;let v=0;const y=!0===n?e:t,_=!0===n?1:-1;for(let e=1;e<=r;e++)c.push(0,m*_,0),d.push(0,_,0),h.push(.5,.5),p++;const x=p;for(let e=0;e<=r;e++){const t=e/r*o+a,n=Math.cos(t),i=Math.sin(t);f.x=y*i,f.y=m*_,f.z=y*n,c.push(f.x,f.y,f.z),d.push(0,_,0),s.x=.5*n+.5,s.y=.5*i*_+.5,h.push(s.x,s.y),p++}for(let e=0;e<r;e++){const t=i+e,r=x+e;!0===n?u.push(r,r+1,t):u.push(r+1,r,t),v+=3}l.addGroup(g,v,!0===n?1:2),g+=v}!function(){const s=new Tn,v=new Tn;let y=0;const _=(t-e)/n;for(let l=0;l<=i;l++){const u=[],g=l/i,y=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*o+a,l=Math.sin(i),f=Math.cos(i);v.x=y*l,v.y=-g*n+m,v.z=y*f,c.push(v.x,v.y,v.z),s.set(l,_,f).normalize(),d.push(s.x,s.y,s.z),h.push(t,1-g),u.push(p++)}f.push(u)}for(let n=0;n<r;n++)for(let r=0;r<i;r++){const s=f[r][n],a=f[r+1][n],o=f[r+1][n+1],l=f[r][n+1];(e>0||0!==r)&&(u.push(s,a,l),y+=3),(t>0||r!==i-1)&&(u.push(a,o,l),y+=3)}l.addGroup(g,y,0),g+=y}(),!1===s&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(u),this.setAttribute("position",new oi(c,3)),this.setAttribute("normal",new oi(d,3)),this.setAttribute("uv",new oi(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new co(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ho extends co{constructor(e=1,t=1,n=32,r=1,i=!1,s=0,a=2*Math.PI){super(0,e,t,n,r,i,s,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:s,thetaLength:a}}static fromJSON(e){return new ho(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class po extends mi{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],s=[];function a(e,t,n,r){const i=r+1,s=[];for(let r=0;r<=i;r++){s[r]=[];const a=e.clone().lerp(n,r/i),o=t.clone().lerp(n,r/i),l=i-r;for(let e=0;e<=l;e++)s[r][e]=0===e&&r===i?a:a.clone().lerp(o,e/l)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const n=Math.floor(t/2);t%2==0?(o(s[e][n+1]),o(s[e+1][n]),o(s[e][n])):(o(s[e][n+1]),o(s[e+1][n+1]),o(s[e+1][n]))}}function o(e){i.push(e.x,e.y,e.z)}function l(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function u(e,t,n,r){r<0&&1===e.x&&(s[t]=e.x-1),0===n.x&&0===n.z&&(s[t]=r/2/Math.PI+.5)}function c(e){return Math.atan2(e.z,-e.x)}function d(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){const n=new Tn,r=new Tn,i=new Tn;for(let s=0;s<t.length;s+=3)l(t[s+0],n),l(t[s+1],r),l(t[s+2],i),a(n,r,i,e)}(r),function(e){const t=new Tn;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new Tn;for(let t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];const n=c(e)/2/Math.PI+.5,r=d(e)/Math.PI+.5;s.push(n,1-r)}(function(){const e=new Tn,t=new Tn,n=new Tn,r=new Tn,a=new Xt,o=new Xt,l=new Xt;for(let d=0,h=0;d<i.length;d+=9,h+=6){e.set(i[d+0],i[d+1],i[d+2]),t.set(i[d+3],i[d+4],i[d+5]),n.set(i[d+6],i[d+7],i[d+8]),a.set(s[h+0],s[h+1]),o.set(s[h+2],s[h+3]),l.set(s[h+4],s[h+5]),r.copy(e).add(t).add(n).divideScalar(3);const p=c(r);u(a,h+0,e,p),u(o,h+2,t,p),u(l,h+4,n,p)}})(),function(){for(let e=0;e<s.length;e+=6){const t=s[e+0],n=s[e+2],r=s[e+4],i=Math.max(t,n,r),a=Math.min(t,n,r);i>.9&&a<.1&&(t<.2&&(s[e+0]+=1),n<.2&&(s[e+2]+=1),r<.2&&(s[e+4]+=1))}}()}(),this.setAttribute("position",new oi(i,3)),this.setAttribute("normal",new oi(i.slice(),3)),this.setAttribute("uv",new oi(s,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new po(e.vertices,e.indices,e.radius,e.details)}}class fo extends po{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new fo(e.radius,e.detail)}}const mo=new Tn,go=new Tn,vo=new Tn,yo=new zr;class _o extends mi{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,r=Math.pow(10,n),i=Math.cos(Ot*t),s=e.getIndex(),a=e.getAttribute("position"),o=s?s.count:a.count,l=[0,0,0],u=["a","b","c"],c=new Array(3),d={},h=[];for(let e=0;e<o;e+=3){s?(l[0]=s.getX(e),l[1]=s.getX(e+1),l[2]=s.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:n,c:o}=yo;if(t.fromBufferAttribute(a,l[0]),n.fromBufferAttribute(a,l[1]),o.fromBufferAttribute(a,l[2]),yo.getNormal(vo),c[0]=`${Math.round(t.x*r)},${Math.round(t.y*r)},${Math.round(t.z*r)}`,c[1]=`${Math.round(n.x*r)},${Math.round(n.y*r)},${Math.round(n.z*r)}`,c[2]=`${Math.round(o.x*r)},${Math.round(o.y*r)},${Math.round(o.z*r)}`,c[0]!==c[1]&&c[1]!==c[2]&&c[2]!==c[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=c[e],r=c[t],s=yo[u[e]],a=yo[u[t]],o=`${n}_${r}`,p=`${r}_${n}`;p in d&&d[p]?(vo.dot(d[p].normal)<=i&&(h.push(s.x,s.y,s.z),h.push(a.x,a.y,a.z)),d[p]=null):o in d||(d[o]={index0:l[e],index1:l[t],normal:vo.clone()})}}for(const e in d)if(d[e]){const{index0:t,index1:n}=d[e];mo.fromBufferAttribute(a,t),go.fromBufferAttribute(a,n),h.push(mo.x,mo.y,mo.z),h.push(go.x,go.y,go.z)}this.setAttribute("position",new oi(h,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class xo extends ao{constructor(e){super(e),this.uuid=zt(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new ao).fromJSON(n))}return this}}class bo{static triangulate(e,t,n=2){const r=t&&t.length,i=r?t[0]*n:e.length;let s=So(e,0,i,n,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,u,c,d,h,p;if(r&&(s=function(e,t,n,r){const i=[];let s,a,o,l,u;for(s=0,a=t.length;s<a;s++)o=t[s]*r,l=s<a-1?t[s+1]*r:e.length,u=So(e,o,l,r,!1),u===u.next&&(u.steiner=!0),i.push(Lo(u));for(i.sort(Ro),s=0;s<i.length;s++)n=No(i[s],n);return n}(e,t,s,n)),e.length>80*n){o=u=e[0],l=c=e[1];for(let t=n;t<i;t+=n)d=e[t],h=e[t+1],d<o&&(o=d),h<l&&(l=h),d>u&&(u=d),h>c&&(c=h);p=Math.max(u-o,c-l),p=0!==p?32767/p:0}return wo(s,a,n,o,l,p,0),a}}function So(e,t,n,r,i){let s,a;if(i===function(e,t,n,r){let i=0;for(let s=t,a=n-r;s<n;s+=r)i+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return i}(e,t,n,r)>0)for(s=t;s<n;s+=r)a=Ho(s,e[s],e[s+1],a);else for(s=n-r;s>=t;s-=r)a=Ho(s,e[s],e[s+1],a);return a&&Bo(a,a.next)&&(Wo(a),a=a.next),a}function To(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!Bo(r,r.next)&&0!==Fo(r.prev,r,r.next))r=r.next;else{if(Wo(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function wo(e,t,n,r,i,s,a){if(!e)return;!a&&s&&function(e,t,n,r){let i=e;do{0===i.z&&(i.z=Io(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,s,a,o,l,u=1;do{for(n=e,e=null,s=null,a=0;n;){for(a++,r=n,o=0,t=0;t<u&&(o++,r=r.nextZ,r);t++);for(l=u;o>0||l>0&&r;)0!==o&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,o--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;n=r}s.nextZ=null,u*=2}while(a>1)}(i)}(e,r,i,s);let o,l,u=e;for(;e.prev!==e.next;)if(o=e.prev,l=e.next,s?Eo(e,r,i,s):Mo(e))t.push(o.i/n|0),t.push(e.i/n|0),t.push(l.i/n|0),Wo(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?wo(e=Ao(To(e),t,n),t,n,r,i,s,2):2===a&&Co(e,t,n,r,i,s):wo(To(e),t,n,r,i,s,1);break}}function Mo(e){const t=e.prev,n=e,r=e.next;if(Fo(t,n,r)>=0)return!1;const i=t.x,s=n.x,a=r.x,o=t.y,l=n.y,u=r.y,c=i<s?i<a?i:a:s<a?s:a,d=o<l?o<u?o:u:l<u?l:u,h=i>s?i>a?i:a:s>a?s:a,p=o>l?o>u?o:u:l>u?l:u;let f=r.next;for(;f!==t;){if(f.x>=c&&f.x<=h&&f.y>=d&&f.y<=p&&Uo(i,o,s,l,a,u,f.x,f.y)&&Fo(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Eo(e,t,n,r){const i=e.prev,s=e,a=e.next;if(Fo(i,s,a)>=0)return!1;const o=i.x,l=s.x,u=a.x,c=i.y,d=s.y,h=a.y,p=o<l?o<u?o:u:l<u?l:u,f=c<d?c<h?c:h:d<h?d:h,m=o>l?o>u?o:u:l>u?l:u,g=c>d?c>h?c:h:d>h?d:h,v=Io(p,f,t,n,r),y=Io(m,g,t,n,r);let _=e.prevZ,x=e.nextZ;for(;_&&_.z>=v&&x&&x.z<=y;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==i&&_!==a&&Uo(o,c,l,d,u,h,_.x,_.y)&&Fo(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==a&&Uo(o,c,l,d,u,h,x.x,x.y)&&Fo(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;_&&_.z>=v;){if(_.x>=p&&_.x<=m&&_.y>=f&&_.y<=g&&_!==i&&_!==a&&Uo(o,c,l,d,u,h,_.x,_.y)&&Fo(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==i&&x!==a&&Uo(o,c,l,d,u,h,x.x,x.y)&&Fo(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Ao(e,t,n){let r=e;do{const i=r.prev,s=r.next.next;!Bo(i,s)&&Oo(i,r,r.next,s)&&Vo(i,s)&&Vo(s,i)&&(t.push(i.i/n|0),t.push(r.i/n|0),t.push(s.i/n|0),Wo(r),Wo(r.next),r=e=s),r=r.next}while(r!==e);return To(r)}function Co(e,t,n,r,i,s){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&Do(a,e)){let o=Go(a,e);return a=To(a,a.next),o=To(o,o.next),wo(a,t,n,r,i,s,0),void wo(o,t,n,r,i,s,0)}e=e.next}a=a.next}while(a!==e)}function Ro(e,t){return e.x-t.x}function No(e,t){const n=function(e,t){let n,r=t,i=-1/0;const s=e.x,a=e.y;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){const e=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=s&&e>i&&(i=e,n=r.x<r.next.x?r:r.next,e===s))return n}r=r.next}while(r!==t);if(!n)return null;const o=n,l=n.x,u=n.y;let c,d=1/0;r=n;do{s>=r.x&&r.x>=l&&s!==r.x&&Uo(a<u?s:i,a,l,u,a<u?i:s,a,r.x,r.y)&&(c=Math.abs(a-r.y)/(s-r.x),Vo(r,e)&&(c<d||c===d&&(r.x>n.x||r.x===n.x&&Po(n,r)))&&(n=r,d=c)),r=r.next}while(r!==o);return n}(e,t);if(!n)return t;const r=Go(n,e);return To(r,r.next),To(n,n.next)}function Po(e,t){return Fo(e.prev,e,t.prev)<0&&Fo(t.next,e,e.next)<0}function Io(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Lo(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Uo(e,t,n,r,i,s,a,o){return(i-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(n-a)*(t-o)&&(n-a)*(s-o)>=(i-a)*(r-o)}function Do(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Oo(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Vo(e,t)&&Vo(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Fo(e.prev,e,t.prev)||Fo(e,t.prev,t))||Bo(e,t)&&Fo(e.prev,e,e.next)>0&&Fo(t.prev,t,t.next)>0)}function Fo(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Bo(e,t){return e.x===t.x&&e.y===t.y}function Oo(e,t,n,r){const i=zo(Fo(e,t,n)),s=zo(Fo(e,t,r)),a=zo(Fo(n,r,e)),o=zo(Fo(n,r,t));return i!==s&&a!==o||(!(0!==i||!ko(e,n,t))||(!(0!==s||!ko(e,r,t))||(!(0!==a||!ko(n,e,r))||!(0!==o||!ko(n,t,r)))))}function ko(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function zo(e){return e>0?1:e<0?-1:0}function Vo(e,t){return Fo(e.prev,e,e.next)<0?Fo(e,t,e.next)>=0&&Fo(e,e.prev,t)>=0:Fo(e,t,e.prev)<0||Fo(e,e.next,t)<0}function Go(e,t){const n=new jo(e.i,e.x,e.y),r=new jo(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function Ho(e,t,n,r){const i=new jo(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Wo(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function jo(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class qo{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return qo.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];Xo(e),$o(n,e);let s=e.length;t.forEach(Xo);for(let e=0;e<t.length;e++)r.push(s),s+=t[e].length,$o(n,t[e]);const a=bo.triangulate(n,r);for(let e=0;e<a.length;e+=3)i.push(a.slice(e,e+3));return i}}function Xo(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function $o(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Yo extends mi{constructor(e=new xo([new Xt(.5,.5),new Xt(-.5,.5),new Xt(-.5,-.5),new Xt(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++){s(e[t])}function s(e){const s=[],a=void 0!==t.curveSegments?t.curveSegments:12,o=void 0!==t.steps?t.steps:1,l=void 0!==t.depth?t.depth:1;let u=void 0===t.bevelEnabled||t.bevelEnabled,c=void 0!==t.bevelThickness?t.bevelThickness:.2,d=void 0!==t.bevelSize?t.bevelSize:c-.1,h=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const f=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:Ko;let g,v,y,_,x,b=!1;f&&(g=f.getSpacedPoints(o),b=!0,u=!1,v=f.computeFrenetFrames(o,!1),y=new Tn,_=new Tn,x=new Tn),u||(p=0,c=0,d=0,h=0);const S=e.extractPoints(a);let T=S.shape;const w=S.holes;if(!qo.isClockWise(T)){T=T.reverse();for(let e=0,t=w.length;e<t;e++){const t=w[e];qo.isClockWise(t)&&(w[e]=t.reverse())}}const M=qo.triangulateShape(T,w),E=T;for(let e=0,t=w.length;e<t;e++){const t=w[e];T=T.concat(t)}function A(e,t,n){return e.clone().addScaledVector(t,n)}const C=T.length,R=M.length;function N(e,t,n){let r,i,s;const a=e.x-t.x,o=e.y-t.y,l=n.x-e.x,u=n.y-e.y,c=a*a+o*o,d=a*u-o*l;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(c),h=Math.sqrt(l*l+u*u),p=t.x-o/d,f=t.y+a/d,m=((n.x-u/h-p)*u-(n.y+l/h-f)*l)/(a*u-o*l);r=p+a*m-e.x,i=f+o*m-e.y;const g=r*r+i*i;if(g<=2)return new Xt(r,i);s=Math.sqrt(g/2)}else{let e=!1;a>Number.EPSILON?l>Number.EPSILON&&(e=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(o)===Math.sign(u)&&(e=!0),e?(r=-o,i=a,s=Math.sqrt(c)):(r=a,i=o,s=Math.sqrt(c/2))}return new Xt(r/s,i/s)}const P=[];for(let e=0,t=E.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),P[e]=N(E[e],E[n],E[r]);const I=[];let L,U=P.concat();for(let e=0,t=w.length;e<t;e++){const t=w[e];L=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),L[e]=N(t[e],t[r],t[i]);I.push(L),U=U.concat(L)}for(let e=0;e<p;e++){const t=e/p,n=c*Math.cos(t*Math.PI/2),r=d*Math.sin(t*Math.PI/2)+h;for(let e=0,t=E.length;e<t;e++){const t=A(E[e],P[e],r);B(t.x,t.y,-n)}for(let e=0,t=w.length;e<t;e++){const t=w[e];L=I[e];for(let e=0,i=t.length;e<i;e++){const i=A(t[e],L[e],r);B(i.x,i.y,-n)}}}const D=d+h;for(let e=0;e<C;e++){const t=u?A(T[e],U[e],D):T[e];b?(_.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),x.copy(g[0]).add(_).add(y),B(x.x,x.y,x.z)):B(t.x,t.y,0)}for(let e=1;e<=o;e++)for(let t=0;t<C;t++){const n=u?A(T[t],U[t],D):T[t];b?(_.copy(v.normals[e]).multiplyScalar(n.x),y.copy(v.binormals[e]).multiplyScalar(n.y),x.copy(g[e]).add(_).add(y),B(x.x,x.y,x.z)):B(n.x,n.y,l/o*e)}for(let e=p-1;e>=0;e--){const t=e/p,n=c*Math.cos(t*Math.PI/2),r=d*Math.sin(t*Math.PI/2)+h;for(let e=0,t=E.length;e<t;e++){const t=A(E[e],P[e],r);B(t.x,t.y,l+n)}for(let e=0,t=w.length;e<t;e++){const t=w[e];L=I[e];for(let e=0,i=t.length;e<i;e++){const i=A(t[e],L[e],r);b?B(i.x,i.y+g[o-1].y,g[o-1].x+n):B(i.x,i.y,l+n)}}}function F(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=o+2*p;e<n;e++){const n=C*e,s=C*(e+1);k(t+r+n,t+i+n,t+i+s,t+r+s)}}}function B(e,t,n){s.push(e),s.push(t),s.push(n)}function O(e,t,i){z(e),z(t),z(i);const s=r.length/3,a=m.generateTopUV(n,r,s-3,s-2,s-1);V(a[0]),V(a[1]),V(a[2])}function k(e,t,i,s){z(e),z(t),z(s),z(t),z(i),z(s);const a=r.length/3,o=m.generateSideWallUV(n,r,a-6,a-3,a-2,a-1);V(o[0]),V(o[1]),V(o[3]),V(o[1]),V(o[2]),V(o[3])}function z(e){r.push(s[3*e+0]),r.push(s[3*e+1]),r.push(s[3*e+2])}function V(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(u){let e=0,t=C*e;for(let e=0;e<R;e++){const n=M[e];O(n[2]+t,n[1]+t,n[0]+t)}e=o+2*p,t=C*e;for(let e=0;e<R;e++){const n=M[e];O(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<R;e++){const t=M[e];O(t[2],t[1],t[0])}for(let e=0;e<R;e++){const t=M[e];O(t[0]+C*o,t[1]+C*o,t[2]+C*o)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;F(E,t),t+=E.length;for(let e=0,n=w.length;e<n;e++){const n=w[e];F(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new oi(r,3)),this.setAttribute("uv",new oi(i,2)),this.computeVertexNormals()}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new io[r.type]).fromJSON(r)),new Yo(n,e.options)}}const Ko={generateTopUV:function(e,t,n,r,i){const s=t[3*n],a=t[3*n+1],o=t[3*r],l=t[3*r+1],u=t[3*i],c=t[3*i+1];return[new Xt(s,a),new Xt(o,l),new Xt(u,c)]},generateSideWallUV:function(e,t,n,r,i,s){const a=t[3*n],o=t[3*n+1],l=t[3*n+2],u=t[3*r],c=t[3*r+1],d=t[3*r+2],h=t[3*i],p=t[3*i+1],f=t[3*i+2],m=t[3*s],g=t[3*s+1],v=t[3*s+2];return Math.abs(o-c)<Math.abs(a-u)?[new Xt(a,1-l),new Xt(u,1-d),new Xt(h,1-f),new Xt(m,1-v)]:[new Xt(o,1-l),new Xt(c,1-d),new Xt(p,1-f),new Xt(g,1-v)]}};class Qo extends po{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Qo(e.radius,e.detail)}}class Zo extends po{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Zo(e.radius,e.detail)}}class Jo extends mi{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,s=t/2,a=Math.floor(n),o=Math.floor(r),l=a+1,u=o+1,c=e/a,d=t/o,h=[],p=[],f=[],m=[];for(let e=0;e<u;e++){const t=e*d-s;for(let n=0;n<l;n++){const r=n*c-i;p.push(r,-t,0),f.push(0,0,1),m.push(n/a),m.push(1-e/o)}}for(let e=0;e<o;e++)for(let t=0;t<a;t++){const n=t+l*e,r=t+l*(e+1),i=t+1+l*(e+1),s=t+1+l*e;h.push(n,r,s),h.push(r,i,s)}this.setIndex(h),this.setAttribute("position",new oi(p,3)),this.setAttribute("normal",new oi(f,3)),this.setAttribute("uv",new oi(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Jo(e.width,e.height,e.widthSegments,e.heightSegments)}}class el extends mi{constructor(e=.5,t=1,n=32,r=1,i=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:s},n=Math.max(3,n);const a=[],o=[],l=[],u=[];let c=e;const d=(t-e)/(r=Math.max(1,r)),h=new Tn,p=new Xt;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){const r=i+e/n*s;h.x=c*Math.cos(r),h.y=c*Math.sin(r),o.push(h.x,h.y,h.z),l.push(0,0,1),p.x=(h.x/t+1)/2,p.y=(h.y/t+1)/2,u.push(p.x,p.y)}c+=d}for(let e=0;e<r;e++){const t=e*(n+1);for(let e=0;e<n;e++){const r=e+t,i=r,s=r+n+1,o=r+n+2,l=r+1;a.push(i,s,l),a.push(s,o,l)}}this.setIndex(a),this.setAttribute("position",new oi(o,3)),this.setAttribute("normal",new oi(l,3)),this.setAttribute("uv",new oi(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new el(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class tl extends mi{constructor(e=new xo([new Xt(0,.5),new Xt(-.5,-.5),new Xt(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],s=[];let a=0,o=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(a,o,t),a+=o,o=0;function l(e){const a=r.length/3,l=e.extractPoints(t);let u=l.shape;const c=l.holes;!1===qo.isClockWise(u)&&(u=u.reverse());for(let e=0,t=c.length;e<t;e++){const t=c[e];!0===qo.isClockWise(t)&&(c[e]=t.reverse())}const d=qo.triangulateShape(u,c);for(let e=0,t=c.length;e<t;e++){const t=c[e];u=u.concat(t)}for(let e=0,t=u.length;e<t;e++){const t=u[e];r.push(t.x,t.y,0),i.push(0,0,1),s.push(t.x,t.y)}for(let e=0,t=d.length;e<t;e++){const t=d[e],r=t[0]+a,i=t[1]+a,s=t[2]+a;n.push(r,i,s),o+=3}}this.setIndex(n),this.setAttribute("position",new oi(r,3)),this.setAttribute("normal",new oi(i,3)),this.setAttribute("uv",new oi(s,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}return new tl(n,e.curveSegments)}}class nl extends mi{constructor(e=1,t=32,n=16,r=0,i=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const o=Math.min(s+a,Math.PI);let l=0;const u=[],c=new Tn,d=new Tn,h=[],p=[],f=[],m=[];for(let h=0;h<=n;h++){const g=[],v=h/n;let y=0;0===h&&0===s?y=.5/t:h===n&&o===Math.PI&&(y=-.5/t);for(let n=0;n<=t;n++){const o=n/t;c.x=-e*Math.cos(r+o*i)*Math.sin(s+v*a),c.y=e*Math.cos(s+v*a),c.z=e*Math.sin(r+o*i)*Math.sin(s+v*a),p.push(c.x,c.y,c.z),d.copy(c).normalize(),f.push(d.x,d.y,d.z),m.push(o+y,1-v),g.push(l++)}u.push(g)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){const t=u[e][r+1],i=u[e][r],a=u[e+1][r],l=u[e+1][r+1];(0!==e||s>0)&&h.push(t,i,l),(e!==n-1||o<Math.PI)&&h.push(i,a,l)}this.setIndex(h),this.setAttribute("position",new oi(p,3)),this.setAttribute("normal",new oi(f,3)),this.setAttribute("uv",new oi(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nl(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class rl extends po{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new rl(e.radius,e.detail)}}class il extends mi{constructor(e=1,t=.4,n=12,r=48,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const s=[],a=[],o=[],l=[],u=new Tn,c=new Tn,d=new Tn;for(let s=0;s<=n;s++)for(let h=0;h<=r;h++){const p=h/r*i,f=s/n*Math.PI*2;c.x=(e+t*Math.cos(f))*Math.cos(p),c.y=(e+t*Math.cos(f))*Math.sin(p),c.z=t*Math.sin(f),a.push(c.x,c.y,c.z),u.x=e*Math.cos(p),u.y=e*Math.sin(p),d.subVectors(c,u).normalize(),o.push(d.x,d.y,d.z),l.push(h/r),l.push(s/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,a=(r+1)*(e-1)+t,o=(r+1)*e+t;s.push(n,i,o),s.push(i,a,o)}this.setIndex(s),this.setAttribute("position",new oi(a,3)),this.setAttribute("normal",new oi(o,3)),this.setAttribute("uv",new oi(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new il(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class sl extends mi{constructor(e=1,t=.4,n=64,r=8,i=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:s},n=Math.floor(n),r=Math.floor(r);const a=[],o=[],l=[],u=[],c=new Tn,d=new Tn,h=new Tn,p=new Tn,f=new Tn,m=new Tn,g=new Tn;for(let a=0;a<=n;++a){const y=a/n*i*Math.PI*2;v(y,i,s,e,h),v(y+.01,i,s,e,p),m.subVectors(p,h),g.addVectors(p,h),f.crossVectors(m,g),g.crossVectors(f,m),f.normalize(),g.normalize();for(let e=0;e<=r;++e){const i=e/r*Math.PI*2,s=-t*Math.cos(i),p=t*Math.sin(i);c.x=h.x+(s*g.x+p*f.x),c.y=h.y+(s*g.y+p*f.y),c.z=h.z+(s*g.z+p*f.z),o.push(c.x,c.y,c.z),d.subVectors(c,h).normalize(),l.push(d.x,d.y,d.z),u.push(a/n),u.push(e/r)}}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),s=(r+1)*e+t,o=(r+1)*(e-1)+t;a.push(n,i,o),a.push(i,s,o)}function v(e,t,n,r,i){const s=Math.cos(e),a=Math.sin(e),o=n/t*e,l=Math.cos(o);i.x=r*(2+l)*.5*s,i.y=r*(2+l)*a*.5,i.z=r*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new oi(o,3)),this.setAttribute("normal",new oi(l,3)),this.setAttribute("uv",new oi(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sl(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class al extends mi{constructor(e=new no(new Tn(-1,-1,0),new Tn(-1,1,0),new Tn(1,1,0)),t=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const s=e.computeFrenetFrames(t,i);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new Tn,o=new Tn,l=new Xt;let u=new Tn;const c=[],d=[],h=[],p=[];function f(i){u=e.getPointAt(i/t,u);const l=s.normals[i],h=s.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),s=-Math.cos(t);o.x=s*l.x+i*h.x,o.y=s*l.y+i*h.y,o.z=s*l.z+i*h.z,o.normalize(),d.push(o.x,o.y,o.z),a.x=u.x+n*o.x,a.y=u.y+n*o.y,a.z=u.z+n*o.z,c.push(a.x,a.y,a.z)}}!function(){for(let e=0;e<t;e++)f(e);f(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)l.x=e/t,l.y=n/r,h.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),s=(r+1)*e+t,a=(r+1)*(e-1)+t;p.push(n,i,a),p.push(i,s,a)}}()}(),this.setIndex(p),this.setAttribute("position",new oi(c,3)),this.setAttribute("normal",new oi(d,3)),this.setAttribute("uv",new oi(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new al((new io[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class ol extends mi{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,r=new Tn,i=new Tn;if(null!==e.index){const s=e.attributes.position,a=e.index;let o=e.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let e=0,l=o.length;e<l;++e){const l=o[e],u=l.start;for(let e=u,o=u+l.count;e<o;e+=3)for(let o=0;o<3;o++){const l=a.getX(e+o),u=a.getX(e+(o+1)%3);r.fromBufferAttribute(s,l),i.fromBufferAttribute(s,u),!0===ll(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}}else{const s=e.attributes.position;for(let e=0,a=s.count/3;e<a;e++)for(let a=0;a<3;a++){const o=3*e+a,l=3*e+(a+1)%3;r.fromBufferAttribute(s,o),i.fromBufferAttribute(s,l),!0===ll(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}this.setAttribute("position",new oi(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function ll(e,t,n){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r),n.add(i),!0)}var ul=Object.freeze({__proto__:null,BoxGeometry:Ri,CapsuleGeometry:lo,CircleGeometry:uo,ConeGeometry:ho,CylinderGeometry:co,DodecahedronGeometry:fo,EdgesGeometry:_o,ExtrudeGeometry:Yo,IcosahedronGeometry:Qo,LatheGeometry:oo,OctahedronGeometry:Zo,PlaneGeometry:Jo,PolyhedronGeometry:po,RingGeometry:el,ShapeGeometry:tl,SphereGeometry:nl,TetrahedronGeometry:rl,TorusGeometry:il,TorusKnotGeometry:sl,TubeGeometry:al,WireframeGeometry:ol});class cl extends $r{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new jr(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class dl extends Ui{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class hl extends $r{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new jr(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ur,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class pl extends hl{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Xt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Vt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new jr(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new jr(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new jr(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class fl extends $r{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new jr(16777215),this.specular=new jr(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ur,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ml extends $r{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new jr(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class gl extends $r{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class vl extends $r{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new jr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jr(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ur,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class yl extends $r{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class _l extends $r{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class xl extends $r{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new jr(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class bl extends pa{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Sl(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Tl(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function wl(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort(function(t,n){return e[t]-e[n]}),n}function Ml(e,t,n){const r=e.length,i=new e.constructor(r);for(let s=0,a=0;a!==r;++s){const r=n[s]*t;for(let n=0;n!==t;++n)i[a++]=e[r+n]}return i}function El(e,t,n,r){let i=1,s=e[0];for(;void 0!==s&&void 0===s[r];)s=e[i++];if(void 0===s)return;let a=s[r];if(void 0!==a)if(Array.isArray(a))do{a=s[r],void 0!==a&&(t.push(s.time),n.push(...a)),s=e[i++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[r],void 0!==a&&(t.push(s.time),a.toArray(n,n.length)),s=e[i++]}while(void 0!==s);else do{a=s[r],void 0!==a&&(t.push(s.time),n.push(a)),s=e[i++]}while(void 0!==s)}const Al={convertArray:Sl,isTypedArray:Tl,getKeyframeOrder:wl,sortedArray:Ml,flattenJSON:El,subclip:function(e,t,n,r,i=30){const s=e.clone();s.name=t;const a=[];for(let e=0;e<s.tracks.length;++e){const t=s.tracks[e],o=t.getValueSize(),l=[],u=[];for(let e=0;e<t.times.length;++e){const s=t.times[e]*i;if(!(s<n||s>=r)){l.push(t.times[e]);for(let n=0;n<o;++n)u.push(t.values[e*o+n])}}0!==l.length&&(t.times=Sl(l,t.times.constructor),t.values=Sl(u,t.values.constructor),a.push(t))}s.tracks=a;let o=1/0;for(let e=0;e<s.tracks.length;++e)o>s.tracks[e].times[0]&&(o=s.tracks[e].times[0]);for(let e=0;e<s.tracks.length;++e)s.tracks[e].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(e,t=0,n=e,r=30){r<=0&&(r=30);const i=n.tracks.length,s=t/r;for(let t=0;t<i;++t){const r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const a=e.tracks.find(function(e){return e.name===r.name&&e.ValueTypeName===i});if(void 0===a)continue;let o=0;const l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let u=0;const c=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=c/3);const d=r.times.length-1;let h;if(s<=r.times[0]){const e=o,t=l-o;h=r.values.slice(e,t)}else if(s>=r.times[d]){const e=d*l+o,t=e+l-o;h=r.values.slice(e,t)}else{const e=r.createInterpolant(),t=o,n=l-o;e.evaluate(s),h=e.resultBuffer.slice(t,n)}if("quaternion"===i){(new Sn).fromArray(h).normalize().conjugate().toArray(h)}const p=a.times.length;for(let e=0;e<p;++e){const t=e*c+u;if("quaternion"===i)Sn.multiplyQuaternionsFlat(a.values,t,h,0,a.values,t);else{const e=c-2*u;for(let n=0;n<e;++n)a.values[t+n]-=h[n]}}}return e.blendMode=ft,e}};class Cl{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let s;n:{r:if(!(e<r)){for(let s=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===s)break;if(i=r,r=t[++n],e<r)break t}s=t.length;break n}if(!(e>=i)){const a=t[1];e<a&&(n=2,i=a);for(let s=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===s)break;if(r=i,i=t[--n-1],e>=i)break t}s=n,n=0;break n}break e}for(;n<s;){const r=n+s>>>1;e<t[r]?s=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Rl extends Cl{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ct,endingEnd:ct}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,s=e+1,a=r[i],o=r[s];if(void 0===a)switch(this.getSettings_().endingStart){case dt:i=e,a=2*t-n;break;case ht:i=r.length-2,a=t+r[i]-r[i+1];break;default:i=e,a=n}if(void 0===o)switch(this.getSettings_().endingEnd){case dt:s=e,o=2*n-t;break;case ht:s=1,o=n+r[1]-r[0];break;default:s=e-1,o=t}const l=.5*(n-t),u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(o-n),this._offsetPrev=i*u,this._offsetNext=s*u}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,u=this._offsetPrev,c=this._offsetNext,d=this._weightPrev,h=this._weightNext,p=(n-t)/(r-t),f=p*p,m=f*p,g=-d*m+2*d*f-d*p,v=(1+d)*m+(-1.5-2*d)*f+(-.5+d)*p+1,y=(-1-h)*m+(1.5+h)*f+.5*p,_=h*m-h*f;for(let e=0;e!==a;++e)i[e]=g*s[u+e]+v*s[l+e]+y*s[o+e]+_*s[c+e];return i}}class Nl extends Cl{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=e*a,l=o-a,u=(n-t)/(r-t),c=1-u;for(let e=0;e!==a;++e)i[e]=s[l+e]*c+s[o+e]*u;return i}}class Pl extends Cl{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Il{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Sl(t,this.TimeBufferType),this.values=Sl(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Sl(e.times,Array),values:Sl(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Pl(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Nl(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Rl(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case ot:t=this.InterpolantFactoryMethodDiscrete;break;case lt:t=this.InterpolantFactoryMethodLinear;break;case ut:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ot;case this.InterpolantFactoryMethodLinear:return lt;case this.InterpolantFactoryMethodSmooth:return ut}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,s=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==s&&n[s]>t;)--s;if(++s,0!==i||s!==r){i>=s&&(s=Math.max(s,1),i=s-1);const e=this.getValueSize();this.times=n.slice(i,s),this.values=this.values.slice(i*e,s*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(e=!1);let s=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){e=!1;break}if(null!==s&&s>r){e=!1;break}s=r}if(void 0!==r&&Tl(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),r=this.getInterpolation()===ut,i=e.length-1;let s=1;for(let a=1;a<i;++a){let i=!1;const o=e[a];if(o!==e[a+1]&&(1!==a||o!==e[0]))if(r)i=!0;else{const e=a*n,r=e-n,s=e+n;for(let a=0;a!==n;++a){const n=t[e+a];if(n!==t[r+a]||n!==t[s+a]){i=!0;break}}}if(i){if(a!==s){e[s]=e[a];const r=a*n,i=s*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++s}}if(i>0){e[s]=e[i];for(let e=i*n,r=s*n,a=0;a!==n;++a)t[r+a]=t[e+a];++s}return s!==e.length?(this.times=e.slice(0,s),this.values=t.slice(0,s*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Il.prototype.TimeBufferType=Float32Array,Il.prototype.ValueBufferType=Float32Array,Il.prototype.DefaultInterpolation=lt;class Ll extends Il{constructor(e,t,n){super(e,t,n)}}Ll.prototype.ValueTypeName="bool",Ll.prototype.ValueBufferType=Array,Ll.prototype.DefaultInterpolation=ot,Ll.prototype.InterpolantFactoryMethodLinear=void 0,Ll.prototype.InterpolantFactoryMethodSmooth=void 0;class Ul extends Il{}Ul.prototype.ValueTypeName="color";class Dl extends Il{}Dl.prototype.ValueTypeName="number";class Fl extends Cl{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(n-t)/(r-t);let l=e*a;for(let e=l+a;l!==e;l+=4)Sn.slerpFlat(i,0,s,l-a,s,l,o);return i}}class Bl extends Il{InterpolantFactoryMethodLinear(e){return new Fl(this.times,this.values,this.getValueSize(),e)}}Bl.prototype.ValueTypeName="quaternion",Bl.prototype.InterpolantFactoryMethodSmooth=void 0;class Ol extends Il{constructor(e,t,n){super(e,t,n)}}Ol.prototype.ValueTypeName="string",Ol.prototype.ValueBufferType=Array,Ol.prototype.DefaultInterpolation=ot,Ol.prototype.InterpolantFactoryMethodLinear=void 0,Ol.prototype.InterpolantFactoryMethodSmooth=void 0;class kl extends Il{}kl.prototype.ValueTypeName="vector";class zl{constructor(e="",t=-1,n=[],r=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=zt(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(Vl(n[e]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(Il.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,s=[];for(let e=0;e<i;e++){let a=[],o=[];a.push((e+i-1)%i,e,(e+1)%i),o.push(0,1,0);const l=wl(a);a=Ml(a,1,l),o=Ml(o,1,l),r||0!==a[0]||(a.push(i),o.push(o[0])),s.push(new Dl(".morphTargetInfluences["+t[e].name+"]",a,o).scale(1/n))}return new this(e,-1,s)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],s=n.name.match(i);if(s&&s.length>1){const e=s[1];let t=r[e];t||(r[e]=t=[]),t.push(n)}}const s=[];for(const e in r)s.push(this.CreateFromMorphTargetSequence(e,r[e],t,n));return s}static parseAnimation(e,t){if(!e)return null;const n=function(e,t,n,r,i){if(0!==n.length){const s=[],a=[];El(n,s,a,r),0!==s.length&&i.push(new e(t,s,a))}},r=[],i=e.name||"default",s=e.fps||30,a=e.blendMode;let o=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const i=l[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],s=[];for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),s.push(r.morphTarget===n?1:0)}r.push(new Dl(".morphTargetInfluence["+n+"]",e,s))}o=e.length*s}else{const s=".bones["+t[e].name+"]";n(kl,s+".position",i,"pos",r),n(Bl,s+".quaternion",i,"rot",r),n(kl,s+".scale",i,"scl",r)}}if(0===r.length)return null;return new this(i,o,r,a)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Vl(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Dl;case"vector":case"vector2":case"vector3":case"vector4":return kl;case"color":return Ul;case"quaternion":return Bl;case"bool":case"boolean":return Ll;case"string":return Ol}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];El(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const Gl={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Hl{constructor(e,t,n){const r=this;let i,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===s&&void 0!==r.onStart&&r.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(s=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],r=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}const Wl=new Hl;class jl{constructor(e){this.manager=void 0!==e?e:Wl,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(r,i){n.load(e,r,t,i)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}jl.DEFAULT_MATERIAL_NAME="__DEFAULT";const ql={};class Xl extends Error{constructor(e,t){super(e),this.response=t}}class $l extends jl{constructor(e){super(e)}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=Gl.get(e);if(void 0!==i)return this.manager.itemStart(e),setTimeout(()=>{t&&t(i),this.manager.itemEnd(e)},0),i;if(void 0!==ql[e])return void ql[e].push({onLoad:t,onProgress:n,onError:r});ql[e]=[],ql[e].push({onLoad:t,onProgress:n,onError:r});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(t=>{if(200===t.status||0===t.status){if(t.status,"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=ql[e],r=t.body.getReader(),i=t.headers.get("X-File-Size")||t.headers.get("Content-Length"),s=i?parseInt(i):0,a=0!==s;let o=0;const l=new ReadableStream({start(e){!function t(){r.read().then(({done:r,value:i})=>{if(r)e.close();else{o+=i.byteLength;const r=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(r)}e.enqueue(i),t()}},t=>{e.error(t)})}()}});return new Response(l)}throw new Xl(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`,t)}).then(e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then(e=>(new DOMParser).parseFromString(e,a));case"json":return e.json();default:if(void 0===a)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(a),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then(e=>r.decode(e))}}}).then(t=>{Gl.add(e,t);const n=ql[e];delete ql[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onLoad&&r.onLoad(t)}}).catch(t=>{const n=ql[e];if(void 0===n)throw this.manager.itemError(e),t;delete ql[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Yl extends jl{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,s=Gl.get(e);if(void 0!==s)return i.manager.itemStart(e),setTimeout(function(){t&&t(s),i.manager.itemEnd(e)},0),s;const a=Jt("img");function o(){u(),Gl.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){u(),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}function u(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}}class Kl extends jl{constructor(e){super(e)}load(e,t,n,r){const i=new gn,s=new Yl(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)},n,r),i}}class Ql extends Er{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new jr(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),void 0!==this.target&&(t.object.target=this.target.uuid),t}}class Zl extends Ql{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Er.DEFAULT_UP),this.updateMatrix(),this.groundColor=new jr(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const Jl=new Jn,eu=new Tn,tu=new Tn;class nu{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Xt(512,512),this.map=null,this.mapPass=null,this.matrix=new Jn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new $s,this._frameExtents=new Xt(1,1),this._viewportCount=1,this._viewports=[new vn(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;eu.setFromMatrixPosition(e.matrixWorld),t.position.copy(eu),tu.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(tu),t.updateMatrixWorld(),Jl.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jl),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(Jl)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 1!==this.intensity&&(e.intensity=this.intensity),0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class ru extends nu{constructor(){super(new ki(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=2*kt*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class iu extends Ql{constructor(e,t,n=0,r=Math.PI/3,i=0,s=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Er.DEFAULT_UP),this.updateMatrix(),this.target=new Er,this.distance=n,this.angle=r,this.penumbra=i,this.decay=s,this.map=null,this.shadow=new ru}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const su=new Jn,au=new Tn,ou=new Tn;class lu extends nu{constructor(){super(new ki(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Xt(4,2),this._viewportCount=6,this._viewports=[new vn(2,1,1,1),new vn(0,1,1,1),new vn(3,1,1,1),new vn(1,1,1,1),new vn(3,0,1,1),new vn(1,0,1,1)],this._cubeDirections=[new Tn(1,0,0),new Tn(-1,0,0),new Tn(0,0,1),new Tn(0,0,-1),new Tn(0,1,0),new Tn(0,-1,0)],this._cubeUps=[new Tn(0,1,0),new Tn(0,1,0),new Tn(0,1,0),new Tn(0,1,0),new Tn(0,0,1),new Tn(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),au.setFromMatrixPosition(e.matrixWorld),n.position.copy(au),ou.copy(n.position),ou.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(ou),n.updateMatrixWorld(),r.makeTranslation(-au.x,-au.y,-au.z),su.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(su)}}class uu extends Ql{constructor(e,t,n=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new lu}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class cu extends Di{constructor(e=-1,t=1,n=1,r=-1,i=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,s=n+e,a=r+t,o=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,s=i+e*this.view.width,a-=t*this.view.offsetY,o=a-t*this.view.height}this.projectionMatrix.makeOrthographic(i,s,a,o,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}class du extends nu{constructor(){super(new cu(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class hu extends Ql{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Er.DEFAULT_UP),this.updateMatrix(),this.target=new Er,this.shadow=new du}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class pu extends Ql{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class fu extends Ql{constructor(e,t,n=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class mu{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Tn)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.282095),t.addScaledVector(s[1],.488603*r),t.addScaledVector(s[2],.488603*i),t.addScaledVector(s[3],.488603*n),t.addScaledVector(s[4],n*r*1.092548),t.addScaledVector(s[5],r*i*1.092548),t.addScaledVector(s[6],.315392*(3*i*i-1)),t.addScaledVector(s[7],n*i*1.092548),t.addScaledVector(s[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,s=this.coefficients;return t.copy(s[0]).multiplyScalar(.886227),t.addScaledVector(s[1],1.023328*r),t.addScaledVector(s[2],1.023328*i),t.addScaledVector(s[3],1.023328*n),t.addScaledVector(s[4],.858086*n*r),t.addScaledVector(s[5],.858086*r*i),t.addScaledVector(s[6],.743125*i*i-.247708),t.addScaledVector(s[7],.858086*n*i),t.addScaledVector(s[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}class gu extends Ql{constructor(e=new mu,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class vu extends jl{constructor(e){super(e),this.textures={}}load(e,t,n,r){const i=this,s=new $l(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r&&r(t),i.manager.itemError(e)}},n,r)}parse(e){const t=this.textures;function n(e){return t[e],t[e]}const r=this.createMaterialFromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new jr).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.dispersion&&(r.dispersion=e.dispersion),void 0!==e.iridescence&&(r.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(r.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.anisotropy&&(r.anisotropy=e.anisotropy),void 0!==e.anisotropyRotation&&(r.anisotropyRotation=e.anisotropyRotation),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.alphaHash&&(r.alphaHash=e.alphaHash),void 0!==e.depthFunc&&(r.depthFunc=e.depthFunc),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.blendSrc&&(r.blendSrc=e.blendSrc),void 0!==e.blendDst&&(r.blendDst=e.blendDst),void 0!==e.blendEquation&&(r.blendEquation=e.blendEquation),void 0!==e.blendSrcAlpha&&(r.blendSrcAlpha=e.blendSrcAlpha),void 0!==e.blendDstAlpha&&(r.blendDstAlpha=e.blendDstAlpha),void 0!==e.blendEquationAlpha&&(r.blendEquationAlpha=e.blendEquationAlpha),void 0!==e.blendColor&&void 0!==r.blendColor&&r.blendColor.setHex(e.blendColor),void 0!==e.blendAlpha&&(r.blendAlpha=e.blendAlpha),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),void 0!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.forceSinglePass&&(r.forceSinglePass=e.forceSinglePass),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const i=e.uniforms[t];switch(r.uniforms[t]={},i.type){case"t":r.uniforms[t].value=n(i.value);break;case"c":r.uniforms[t].value=(new jr).setHex(i.value);break;case"v2":r.uniforms[t].value=(new Xt).fromArray(i.value);break;case"v3":r.uniforms[t].value=(new Tn).fromArray(i.value);break;case"v4":r.uniforms[t].value=(new vn).fromArray(i.value);break;case"m3":r.uniforms[t].value=(new $t).fromArray(i.value);break;case"m4":r.uniforms[t].value=(new Jn).fromArray(i.value);break;default:r.uniforms[t].value=i.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.glslVersion&&(r.glslVersion=e.glslVersion),void 0!==e.extensions)for(const t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.lights&&(r.lights=e.lights),void 0!==e.clipping&&(r.clipping=e.clipping),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new Xt).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapRotation&&r.envMapRotation.fromArray(e.envMapRotation),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Xt).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(r.iridescenceMap=n(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(r.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),void 0!==e.anisotropyMap&&(r.anisotropyMap=n(e.anisotropyMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return vu.createMaterialFromType(e)}static createMaterialFromType(e){return new{ShadowMaterial:cl,SpriteMaterial:Ji,RawShaderMaterial:dl,ShaderMaterial:Ui,PointsMaterial:Aa,MeshPhysicalMaterial:pl,MeshStandardMaterial:hl,MeshPhongMaterial:fl,MeshToonMaterial:ml,MeshNormalMaterial:gl,MeshLambertMaterial:vl,MeshDepthMaterial:yl,MeshDistanceMaterial:_l,MeshBasicMaterial:Yr,MeshMatcapMaterial:xl,LineDashedMaterial:bl,LineBasicMaterial:pa,Material:$r}[e]}}class yu{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class _u extends mi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class xu extends jl{constructor(e){super(e)}load(e,t,n,r){const i=this,s=new $l(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r&&r(t),i.manager.itemError(e)}},n,r)}parse(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],s=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers,i=r[t],s=new Uint32Array(i).buffer;return n[t]=s,s}(e,i.buffer),a=Zt(i.type,s),o=new Ki(a,i.stride);return o.uuid=i.uuid,t[r]=o,o}const i=e.isInstancedBufferGeometry?new _u:new mi,s=e.data.index;if(void 0!==s){const e=Zt(s.type,s.array);i.setIndex(new ri(e,1))}const a=e.data.attributes;for(const t in a){const n=a[t];let s;if(n.isInterleavedBufferAttribute){const t=r(e.data,n.data);s=new Zi(t,n.itemSize,n.offset,n.normalized)}else{const e=Zt(n.type,n.array);s=new(n.isInstancedBufferAttribute?Ls:ri)(e,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),void 0!==n.usage&&s.setUsage(n.usage),i.setAttribute(t,s)}const o=e.data.morphAttributes;if(o)for(const t in o){const n=o[t],s=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];let a;if(i.isInterleavedBufferAttribute){const t=r(e.data,i.data);a=new Zi(t,i.itemSize,i.offset,i.normalized)}else{const e=Zt(i.type,i.array);a=new ri(e,i.itemSize,i.normalized)}void 0!==i.name&&(a.name=i.name),s.push(a)}i.morphAttributes[t]=s}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];i.addGroup(t.start,t.count,t.materialIndex)}const u=e.data.boundingSphere;if(void 0!==u){const e=new Tn;void 0!==u.center&&e.fromArray(u.center),i.boundingSphere=new Wn(e,u.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}const bu={UVMapping:W,CubeReflectionMapping:j,CubeRefractionMapping:q,EquirectangularReflectionMapping:X,EquirectangularRefractionMapping:$,CubeUVReflectionMapping:Y},Su={RepeatWrapping:K,ClampToEdgeWrapping:Q,MirroredRepeatWrapping:Z},Tu={NearestFilter:J,NearestMipmapNearestFilter:ee,NearestMipmapLinearFilter:te,LinearFilter:ne,LinearMipmapNearestFilter:re,LinearMipmapLinearFilter:ie};let wu;class Mu{static getContext(){return void 0===wu&&(wu=new(window.AudioContext||window.webkitAudioContext)),wu}static setContext(e){wu=e}}const Eu=new Jn,Au=new Jn,Cu=new Jn;class Ru extends ki{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e,this.index=0}}class Nu{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Pu(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Pu();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Pu(){return performance.now()}const Iu=new Tn,Lu=new Sn,Uu=new Tn,Du=new Tn;class Fu extends Er{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return;if(!1===this.hasPlaybackControl)return;this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(!1!==this.hasPlaybackControl)return this._progress=0,null!==this.source&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(!1!==this._connected){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,!0===this.isPlaying&&void 0!==this.source.detune&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return!1!==this.hasPlaybackControl&&this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),"buffer"!==e.sourceType||(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice()),this}clone(e){return new this.constructor(this.listener).copy(this,e)}}const Bu=new Tn,Ou=new Sn,ku=new Tn,zu=new Tn;class Vu{constructor(e,t,n){let r,i,s;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let s=this.cumulativeWeight;if(0===s){for(let e=0;e!==r;++e)n[i+e]=n[e];s=t}else{s+=t;const e=t/s;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=s}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}s>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){a.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]}_slerp(e,t,n,r){Sn.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){const s=this._workIndex*i;Sn.multiplyQuaternionsFlat(e,s,e,t,e,n),Sn.slerpFlat(e,t,e,t,e,s,r)}_lerp(e,t,n,r,i){const s=1-r;for(let a=0;a!==i;++a){const i=t+a;e[i]=e[i]*s+e[n+a]*r}}_lerpAdditive(e,t,n,r,i){for(let s=0;s!==i;++s){const i=t+s;e[i]=e[i]+e[n+s]*r}}}const Gu="\\[\\]\\.:\\/",Hu=new RegExp("["+Gu+"]","g"),Wu="[^"+Gu+"]",ju="[^"+Gu.replace("\\.","")+"]",qu=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Wu)+/(WCOD+)?/.source.replace("WCOD",ju)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Wu)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Wu)+"$"),Xu=["material","materials","bones","map"];class $u{constructor(e,t,n){this.path=t,this.parsedPath=n||$u.parseTrackName(t),this.node=$u.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new $u.Composite(e,t,n):new $u(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Hu,"")}static parseTrackName(e){const t=qu.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==Xu.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const s=n(i.children);if(s)return s}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=$u.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return;if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return;if(!e.material.materials)return;e=e.material.materials;break;case"bones":if(!e.skeleton)return;e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material)return;if(!e.material.map)return;e=e.material.map;break;default:if(void 0===e[n])return;e=e[n]}if(void 0!==r){if(void 0===e[r])return;e=e[r]}}const s=e[r];if(void 0===s){t.nodeName;return}let a=this.Versioning.None;this.targetObject=e,!0===e.isMaterial?a=this.Versioning.NeedsUpdate:!0===e.isObject3D&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return;if(!e.geometry.morphAttributes)return;void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}$u.Composite=class{constructor(e,t,n){const r=n||$u.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},$u.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},$u.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},$u.prototype.GetterByBindingType=[$u.prototype._getValue_direct,$u.prototype._getValue_array,$u.prototype._getValue_arrayElement,$u.prototype._getValue_toArray],$u.prototype.SetterByBindingTypeAndVersioning=[[$u.prototype._setValue_direct,$u.prototype._setValue_direct_setNeedsUpdate,$u.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[$u.prototype._setValue_array,$u.prototype._setValue_array_setNeedsUpdate,$u.prototype._setValue_array_setMatrixWorldNeedsUpdate],[$u.prototype._setValue_arrayElement,$u.prototype._setValue_arrayElement_setNeedsUpdate,$u.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[$u.prototype._setValue_fromArray,$u.prototype._setValue_fromArray_setNeedsUpdate,$u.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Yu{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,s=i.length,a=new Array(s),o={endingStart:ct,endingEnd:ct};for(let e=0;e!==s;++e){const t=i[e].createInterpolant(null);a[e]=t,t.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,r=e._clip.duration,i=r/n,s=n/r;e.warp(1,i,t),this.warp(s,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=i,o[1]=i+n,l[0]=e/s,l[1]=t/s,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;r<0||0===n?t=0:(this._startTime=null,t=n*r)}t*=this._updateTimeScale(e);const s=this._updateTime(t),a=this._updateWeight(e);if(a>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===ft)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(s),t[n].accumulateAdditive(a);else for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(s),t[n].accumulate(r,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const s=2202===n;if(0===e)return-1===i||!s||1&~i?r:t-r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const a=this.repetitions-i;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===a){const t=e<0;this._setEndings(t,!t,s)}else this._setEndings(!1,!1,s);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(s&&!(1&~i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=dt,r.endingEnd=dt):(r.endingStart=e?this.zeroSlopeAtStart?dt:ct:ht,r.endingEnd=t?this.zeroSlopeAtEnd?dt:ct:ht)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let s=this._weightInterpolant;null===s&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=i,o[0]=t,a[1]=i+e,o[1]=n,this}}const Ku=new Float32Array(1);class Qu{constructor(e){this.value=e}clone(){return new Qu(void 0===this.value.clone?this.value:this.value.clone())}}let Zu=0;class Ju extends Ki{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}const ec=new Jn;class tc{constructor(e,t,n=0,r=1/0){this.ray=new Zn(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new cr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera&&(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t)}setFromXRController(e){return ec.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(ec),this}intersectObject(e,t=!0,n=[]){return rc(e,this,n,t),n.sort(nc),n}intersectObjects(e,t=!0,n=[]){for(let r=0,i=e.length;r<i;r++)rc(e[r],this,n,t);return n.sort(nc),n}}function nc(e,t){return e.distance-t.distance}function rc(e,t,n,r){let i=!0;if(e.layers.test(t.layers)){!1===e.raycast(t,n)&&(i=!1)}if(!0===i&&!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)rc(r[e],t,n,!0)}}class ic{constructor(e,t,n,r){ic.prototype.isMatrix2=!0,this.elements=[1,0,0,1],void 0!==e&&this.set(e,t,n,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,r){const i=this.elements;return i[0]=e,i[2]=t,i[1]=n,i[3]=r,this}}const sc=new Xt;const ac=new Tn,oc=new Tn;const lc=new Tn;const uc=new Tn,cc=new Jn,dc=new Jn;function hc(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push(...hc(e.children[n]));return t}const pc=new Tn,fc=new jr,mc=new jr;const gc=new Tn,vc=new Tn,yc=new Tn;const _c=new Tn,xc=new Di;function bc(e,t,n,r,i,s,a){_c.set(i,s,a).unproject(r);const o=t[e];if(void 0!==o){const e=n.getAttribute("position");for(let t=0,n=o.length;t<n;t++)e.setXYZ(o[t],_c.x,_c.y,_c.z)}}const Sc=new En;const Tc=new Tn;let wc,Mc;function Ec(e,t,n,r){const i=function(e){switch(e){case se:case ae:return{byteLength:1,components:1};case le:case oe:case he:return{byteLength:2,components:1};case pe:case fe:return{byteLength:2,components:4};case ce:case ue:case de:return{byteLength:4,components:1};case ge:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${e}.`)}(r);switch(n){case ve:case xe:return e*t;case be:return e*t*2;case we:case Me:return e*t/i.components*i.byteLength;case Ee:case Ae:return e*t*2/i.components*i.byteLength;case ye:return e*t*3/i.components*i.byteLength;case _e:case Ce:return e*t*4/i.components*i.byteLength;case Re:case Ne:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case Pe:case Ie:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case Ue:case Fe:return Math.max(e,16)*Math.max(t,8)/4;case Le:case De:return Math.max(e,8)*Math.max(t,8)/2;case Be:case Oe:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*8;case ke:case ze:return Math.floor((e+3)/4)*Math.floor((t+3)/4)*16;case Ve:return Math.floor((e+4)/5)*Math.floor((t+3)/4)*16;case Ge:return Math.floor((e+4)/5)*Math.floor((t+4)/5)*16;case He:return Math.floor((e+5)/6)*Math.floor((t+4)/5)*16;case We:return Math.floor((e+5)/6)*Math.floor((t+5)/6)*16;case je:return Math.floor((e+7)/8)*Math.floor((t+4)/5)*16;case qe:return Math.floor((e+7)/8)*Math.floor((t+5)/6)*16;case Xe:return Math.floor((e+7)/8)*Math.floor((t+7)/8)*16;case $e:return Math.floor((e+9)/10)*Math.floor((t+4)/5)*16;case Ye:return Math.floor((e+9)/10)*Math.floor((t+5)/6)*16;case Ke:return Math.floor((e+9)/10)*Math.floor((t+7)/8)*16;case Qe:return Math.floor((e+9)/10)*Math.floor((t+9)/10)*16;case Ze:return Math.floor((e+11)/12)*Math.floor((t+9)/10)*16;case Je:return Math.floor((e+11)/12)*Math.floor((t+11)/12)*16;case et:case tt:case nt:return Math.ceil(e/4)*Math.ceil(t/4)*16;case rt:case it:return Math.ceil(e/4)*Math.ceil(t/4)*8;case st:case at:return Math.ceil(e/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${n} format.`)}function Ac(){let e=null,t=!1,n=null,r=null;function i(t,s){n(t,s),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function Cc(e){const t=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t.get(e)},remove:function(n){n.isInterleavedBufferAttribute&&(n=n.data);const r=t.get(n);r&&(e.deleteBuffer(r.buffer),t.delete(n))},update:function(n,r){if(n.isInterleavedBufferAttribute&&(n=n.data),n.isGLBufferAttribute){const e=t.get(n);return void((!e||e.version<n.version)&&t.set(n,{buffer:n.buffer,type:n.type,bytesPerElement:n.elementSize,version:n.version}))}const i=t.get(n);if(void 0===i)t.set(n,function(t,n){const r=t.array,i=t.usage,s=r.byteLength,a=e.createBuffer();let o;if(e.bindBuffer(n,a),e.bufferData(n,r,i),t.onUploadCallback(),r instanceof Float32Array)o=e.FLOAT;else if(r instanceof Uint16Array)o=t.isFloat16BufferAttribute?e.HALF_FLOAT:e.UNSIGNED_SHORT;else if(r instanceof Int16Array)o=e.SHORT;else if(r instanceof Uint32Array)o=e.UNSIGNED_INT;else if(r instanceof Int32Array)o=e.INT;else if(r instanceof Int8Array)o=e.BYTE;else if(r instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);o=e.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version,size:s}}(n,r));else if(i.version<n.version){if(i.size!==n.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(t,n,r){const i=n.array,s=n.updateRanges;if(e.bindBuffer(r,t),0===s.length)e.bufferSubData(r,0,i);else{s.sort((e,t)=>e.start-t.start);let t=0;for(let e=1;e<s.length;e++){const n=s[t],r=s[e];r.start<=n.start+n.count+1?n.count=Math.max(n.count,r.start+r.count-n.start):(++t,s[t]=r)}s.length=t+1;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.bufferSubData(r,n.start*i.BYTES_PER_ELEMENT,i,n.start,n.count)}n.clearUpdateRanges()}n.onUploadCallback()}(i.buffer,n,r),i.version=n.version}}}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:d}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__=d));const Rc={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\t#if ! defined( GL_ANGLE_multi_draw )\n\t#define gl_DrawID _gl_DrawID\n\tuniform int _gl_DrawID;\n\t#endif\n\tuniform highp sampler2D batchingTexture;\n\tuniform highp usampler2D batchingIdTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n\tfloat getIndirectIndex( const in int i ) {\n\t\tint size = textureSize( batchingIdTexture, 0 ).x;\n\t\tint x = i % size;\n\t\tint y = i / size;\n\t\treturn float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );\n\t}\n#endif\n#ifdef USE_BATCHING_COLOR\n\tuniform sampler2D batchingColorTexture;\n\tvec3 getBatchingColor( const in float i ) {\n\t\tint size = textureSize( batchingColorTexture, 0 ).x;\n\t\tint j = int( i );\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\treturn texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif\n#ifdef USE_BATCHING_COLOR\n\tvec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );\n\tvColor.xyz *= batchingColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE\n\t\temissiveColor = sRGBTransferEOTF( emissiveColor );\n\t#endif\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"vec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferEOTF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif ( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t#endif\n\tuniform sampler2DArray morphTargetsTexture;\n\tuniform ivec2 morphTargetsTextureSize;\n\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t}\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t}\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;\nconst float Inv255 = 1. / 255.;\nconst vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );\nconst vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );\nconst vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );\nconst vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );\nvec4 packDepthToRGBA( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec4( 0., 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec4( 1., 1., 1., 1. );\n\tfloat vuf;\n\tfloat af = modf( v * PackFactors.a, vuf );\n\tfloat bf = modf( vuf * ShiftRight8, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );\n}\nvec3 packDepthToRGB( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec3( 0., 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec3( 1., 1., 1. );\n\tfloat vuf;\n\tfloat bf = modf( v * PackFactors.b, vuf );\n\tfloat gf = modf( vuf * ShiftRight8, vuf );\n\treturn vec3( vuf * Inv255, gf * PackUpscale, bf );\n}\nvec2 packDepthToRG( const in float v ) {\n\tif( v <= 0.0 )\n\t\treturn vec2( 0., 0. );\n\tif( v >= 1.0 )\n\t\treturn vec2( 1., 1. );\n\tfloat vuf;\n\tfloat gf = modf( v * 256., vuf );\n\treturn vec2( vuf * Inv255, gf );\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors4 );\n}\nfloat unpackRGBToDepth( const in vec3 v ) {\n\treturn dot( v, UnpackFactors3 );\n}\nfloat unpackRGToDepth( const in vec2 v ) {\n\treturn v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;\n}\nvec4 pack2HalfToRGBA( const in vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( const in vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn mix( 1.0, shadow, shadowIntensity );\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowIntensity;\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 CineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t#else\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#elif DEPTH_PACKING == 3202\n\t\tgl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );\n\t#elif DEPTH_PACKING == 3203\n\t\tgl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix[ 3 ];\n\tvec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},Nc={common:{diffuse:{value:new jr(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new $t},alphaMap:{value:null},alphaMapTransform:{value:new $t},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new $t}},envmap:{envMap:{value:null},envMapRotation:{value:new $t},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new $t}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new $t}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new $t},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new $t},normalScale:{value:new Xt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new $t},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new $t}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new $t}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new $t}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new jr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new jr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new $t},alphaTest:{value:0},uvTransform:{value:new $t}},sprite:{diffuse:{value:new jr(16777215)},opacity:{value:1},center:{value:new Xt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new $t},alphaMap:{value:null},alphaMapTransform:{value:new $t},alphaTest:{value:0}}},Pc={basic:{uniforms:Pi([Nc.common,Nc.specularmap,Nc.envmap,Nc.aomap,Nc.lightmap,Nc.fog]),vertexShader:Rc.meshbasic_vert,fragmentShader:Rc.meshbasic_frag},lambert:{uniforms:Pi([Nc.common,Nc.specularmap,Nc.envmap,Nc.aomap,Nc.lightmap,Nc.emissivemap,Nc.bumpmap,Nc.normalmap,Nc.displacementmap,Nc.fog,Nc.lights,{emissive:{value:new jr(0)}}]),vertexShader:Rc.meshlambert_vert,fragmentShader:Rc.meshlambert_frag},phong:{uniforms:Pi([Nc.common,Nc.specularmap,Nc.envmap,Nc.aomap,Nc.lightmap,Nc.emissivemap,Nc.bumpmap,Nc.normalmap,Nc.displacementmap,Nc.fog,Nc.lights,{emissive:{value:new jr(0)},specular:{value:new jr(1118481)},shininess:{value:30}}]),vertexShader:Rc.meshphong_vert,fragmentShader:Rc.meshphong_frag},standard:{uniforms:Pi([Nc.common,Nc.envmap,Nc.aomap,Nc.lightmap,Nc.emissivemap,Nc.bumpmap,Nc.normalmap,Nc.displacementmap,Nc.roughnessmap,Nc.metalnessmap,Nc.fog,Nc.lights,{emissive:{value:new jr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Rc.meshphysical_vert,fragmentShader:Rc.meshphysical_frag},toon:{uniforms:Pi([Nc.common,Nc.aomap,Nc.lightmap,Nc.emissivemap,Nc.bumpmap,Nc.normalmap,Nc.displacementmap,Nc.gradientmap,Nc.fog,Nc.lights,{emissive:{value:new jr(0)}}]),vertexShader:Rc.meshtoon_vert,fragmentShader:Rc.meshtoon_frag},matcap:{uniforms:Pi([Nc.common,Nc.bumpmap,Nc.normalmap,Nc.displacementmap,Nc.fog,{matcap:{value:null}}]),vertexShader:Rc.meshmatcap_vert,fragmentShader:Rc.meshmatcap_frag},points:{uniforms:Pi([Nc.points,Nc.fog]),vertexShader:Rc.points_vert,fragmentShader:Rc.points_frag},dashed:{uniforms:Pi([Nc.common,Nc.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Rc.linedashed_vert,fragmentShader:Rc.linedashed_frag},depth:{uniforms:Pi([Nc.common,Nc.displacementmap]),vertexShader:Rc.depth_vert,fragmentShader:Rc.depth_frag},normal:{uniforms:Pi([Nc.common,Nc.bumpmap,Nc.normalmap,Nc.displacementmap,{opacity:{value:1}}]),vertexShader:Rc.meshnormal_vert,fragmentShader:Rc.meshnormal_frag},sprite:{uniforms:Pi([Nc.sprite,Nc.fog]),vertexShader:Rc.sprite_vert,fragmentShader:Rc.sprite_frag},background:{uniforms:{uvTransform:{value:new $t},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Rc.background_vert,fragmentShader:Rc.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new $t}},vertexShader:Rc.backgroundCube_vert,fragmentShader:Rc.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Rc.cube_vert,fragmentShader:Rc.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Rc.equirect_vert,fragmentShader:Rc.equirect_frag},distanceRGBA:{uniforms:Pi([Nc.common,Nc.displacementmap,{referencePosition:{value:new Tn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Rc.distanceRGBA_vert,fragmentShader:Rc.distanceRGBA_frag},shadow:{uniforms:Pi([Nc.lights,Nc.fog,{color:{value:new jr(0)},opacity:{value:1}}]),vertexShader:Rc.shadow_vert,fragmentShader:Rc.shadow_frag}};Pc.physical={uniforms:Pi([Pc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new $t},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new $t},clearcoatNormalScale:{value:new Xt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new $t},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new $t},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new $t},sheen:{value:0},sheenColor:{value:new jr(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new $t},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new $t},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new $t},transmissionSamplerSize:{value:new Xt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new $t},attenuationDistance:{value:0},attenuationColor:{value:new jr(0)},specularColor:{value:new jr(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new $t},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new $t},anisotropyVector:{value:new Xt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new $t}}]),vertexShader:Rc.meshphysical_vert,fragmentShader:Rc.meshphysical_frag};const Ic={r:0,b:0,g:0},Lc=new ur,Uc=new Jn;function Dc(e,t,n,r,i,s,a){const o=new jr(0);let l,u,c=!0===s?0:1,d=null,h=0,p=null;function f(e){let r=!0===e.isScene?e.background:null;if(r&&r.isTexture){r=(e.backgroundBlurriness>0?n:t).get(r)}return r}function m(t,n){t.getRGB(Ic,Ii(e)),r.buffers.color.setClear(Ic.r,Ic.g,Ic.b,n,a)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),c=t,m(o,c)},getClearAlpha:function(){return c},setClearAlpha:function(e){c=e,m(o,c)},render:function(t){let n=!1;const i=f(t);null===i?m(o,c):i&&i.isColor&&(m(i,1),n=!0);const s=e.xr.getEnvironmentBlendMode();"additive"===s?r.buffers.color.setClear(0,0,0,1,a):"alpha-blend"===s&&r.buffers.color.setClear(0,0,0,0,a),(e.autoClear||n)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil))},addToRenderList:function(t,n){const r=f(n);r&&(r.isCubeTexture||r.mapping===Y)?(void 0===u&&(u=new Ai(new Ri(1,1,1),new Ui({name:"BackgroundCubeMaterial",uniforms:Ni(Pc.backgroundCube.uniforms),vertexShader:Pc.backgroundCube.vertexShader,fragmentShader:Pc.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),Lc.copy(n.backgroundRotation),Lc.x*=-1,Lc.y*=-1,Lc.z*=-1,r.isCubeTexture&&!1===r.isRenderTargetTexture&&(Lc.y*=-1,Lc.z*=-1),u.material.uniforms.envMap.value=r,u.material.uniforms.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=n.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(Uc.makeRotationFromEuler(Lc)),u.material.toneMapped=on.getTransfer(r.colorSpace)!==_t,d===r&&h===r.version&&p===e.toneMapping||(u.material.needsUpdate=!0,d=r,h=r.version,p=e.toneMapping),u.layers.enableAll(),t.unshift(u,u.geometry,u.material,0,0,null)):r&&r.isTexture&&(void 0===l&&(l=new Ai(new Jo(2,2),new Ui({name:"BackgroundMaterial",uniforms:Ni(Pc.background.uniforms),vertexShader:Pc.background.vertexShader,fragmentShader:Pc.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=r,l.material.uniforms.backgroundIntensity.value=n.backgroundIntensity,l.material.toneMapped=on.getTransfer(r.colorSpace)!==_t,!0===r.matrixAutoUpdate&&r.updateMatrix(),l.material.uniforms.uvTransform.value.copy(r.matrix),d===r&&h===r.version&&p===e.toneMapping||(l.material.needsUpdate=!0,d=r,h=r.version,p=e.toneMapping),l.layers.enableAll(),t.unshift(l,l.geometry,l.material,0,0,null))},dispose:function(){void 0!==u&&(u.geometry.dispose(),u.material.dispose(),u=void 0),void 0!==l&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}}}function Fc(e,t){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),r={},i=u(null);let s=i,a=!1;function o(t){return e.bindVertexArray(t)}function l(t){return e.deleteVertexArray(t)}function u(e){const t=[],r=[],i=[];for(let e=0;e<n;e++)t[e]=0,r[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:i,object:e,attributes:{},index:null}}function c(){const e=s.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function d(e){h(e,0)}function h(t,n){const r=s.newAttributes,i=s.enabledAttributes,a=s.attributeDivisors;r[t]=1,0===i[t]&&(e.enableVertexAttribArray(t),i[t]=1),a[t]!==n&&(e.vertexAttribDivisor(t,n),a[t]=n)}function p(){const t=s.newAttributes,n=s.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function f(t,n,r,i,s,a,o){!0===o?e.vertexAttribIPointer(t,n,r,s,a):e.vertexAttribPointer(t,n,r,i,s,a)}function m(){g(),a=!0,s!==i&&(s=i,o(s.object))}function g(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:function(n,i,l,m,g){let v=!1;const y=function(t,n,i){const s=!0===i.wireframe;let a=r[t.id];void 0===a&&(a={},r[t.id]=a);let o=a[n.id];void 0===o&&(o={},a[n.id]=o);let l=o[s];void 0===l&&(l=u(e.createVertexArray()),o[s]=l);return l}(m,l,i);s!==y&&(s=y,o(s.object)),v=function(e,t,n,r){const i=s.attributes,a=t.attributes;let o=0;const l=n.getAttributes();for(const t in l){if(l[t].location>=0){const n=i[t];let r=a[t];if(void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor)),void 0===n)return!0;if(n.attribute!==r)return!0;if(r&&n.data!==r.data)return!0;o++}}return s.attributesNum!==o||s.index!==r}(n,m,l,g),v&&function(e,t,n,r){const i={},a=t.attributes;let o=0;const l=n.getAttributes();for(const t in l){if(l[t].location>=0){let n=a[t];void 0===n&&("instanceMatrix"===t&&e.instanceMatrix&&(n=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(n=e.instanceColor));const r={};r.attribute=n,n&&n.data&&(r.data=n.data),i[t]=r,o++}}s.attributes=i,s.attributesNum=o,s.index=r}(n,m,l,g),null!==g&&t.update(g,e.ELEMENT_ARRAY_BUFFER),(v||a)&&(a=!1,function(n,r,i,s){c();const a=s.attributes,o=i.getAttributes(),l=r.defaultAttributeValues;for(const r in o){const i=o[r];if(i.location>=0){let o=a[r];if(void 0===o&&("instanceMatrix"===r&&n.instanceMatrix&&(o=n.instanceMatrix),"instanceColor"===r&&n.instanceColor&&(o=n.instanceColor)),void 0!==o){const r=o.normalized,a=o.itemSize,l=t.get(o);if(void 0===l)continue;const u=l.buffer,c=l.type,p=l.bytesPerElement,m=c===e.INT||c===e.UNSIGNED_INT||o.gpuType===ue;if(o.isInterleavedBufferAttribute){const t=o.data,l=t.stride,g=o.offset;if(t.isInstancedInterleavedBuffer){for(let e=0;e<i.locationSize;e++)h(i.location+e,t.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=t.meshPerAttribute*t.count)}else for(let e=0;e<i.locationSize;e++)d(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<i.locationSize;e++)f(i.location+e,a/i.locationSize,c,r,l*p,(g+a/i.locationSize*e)*p,m)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<i.locationSize;e++)h(i.location+e,o.meshPerAttribute);!0!==n.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<i.locationSize;e++)d(i.location+e);e.bindBuffer(e.ARRAY_BUFFER,u);for(let e=0;e<i.locationSize;e++)f(i.location+e,a/i.locationSize,c,r,a*p,a/i.locationSize*e*p,m)}}else if(void 0!==l){const t=l[r];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(i.location,t);break;case 3:e.vertexAttrib3fv(i.location,t);break;case 4:e.vertexAttrib4fv(i.location,t);break;default:e.vertexAttrib1fv(i.location,t)}}}}p()}(n,i,l,m),null!==g&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t.get(g).buffer))},reset:m,resetDefaultState:g,dispose:function(){m();for(const e in r){const t=r[e];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete r[e]}},releaseStatesOfGeometry:function(e){if(void 0===r[e.id])return;const t=r[e.id];for(const e in t){const n=t[e];for(const e in n)l(n[e].object),delete n[e];delete t[e]}delete r[e.id]},releaseStatesOfProgram:function(e){for(const t in r){const n=r[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)l(i[e].object),delete i[e];delete n[e.id]}},initAttributes:c,enableAttribute:d,disableUnusedAttributes:p}}function Bc(e,t,n){let r;function i(t,i,s){0!==s&&(e.drawArraysInstanced(r,t,i,s),n.update(i,r,s))}this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=i,this.renderMultiDraw=function(e,i,s){if(0===s)return;t.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,e,0,i,0,s);let a=0;for(let e=0;e<s;e++)a+=i[e];n.update(a,r,1)},this.renderMultiDrawInstances=function(e,s,a,o){if(0===a)return;const l=t.get("WEBGL_multi_draw");if(null===l)for(let t=0;t<e.length;t++)i(e[t],s[t],o[t]);else{l.multiDrawArraysInstancedWEBGL(r,e,0,s,0,o,0,a);let t=0;for(let e=0;e<a;e++)t+=s[e]*o[e];n.update(t,r,1)}}}function Oc(e,t,n,r){let i;function s(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let a=void 0!==n.precision?n.precision:"highp";const o=s(a);o!==a&&(a=o);const l=!0===n.logarithmicDepthBuffer,u=!0===n.reverseDepthBuffer&&t.has("EXT_clip_control"),c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:s,textureFormatReadable:function(t){return t===_e||r.convert(t)===e.getParameter(e.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(n){const i=n===he&&(t.has("EXT_color_buffer_half_float")||t.has("EXT_color_buffer_float"));return!(n!==se&&r.convert(n)!==e.getParameter(e.IMPLEMENTATION_COLOR_READ_TYPE)&&n!==de&&!i)},precision:a,logarithmicDepthBuffer:l,reverseDepthBuffer:u,maxTextures:c,maxVertexTextures:d,maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),maxCubemapSize:e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:e.getParameter(e.MAX_VERTEX_ATTRIBS),maxVertexUniforms:e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:e.getParameter(e.MAX_VARYING_VECTORS),maxFragmentUniforms:e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:d>0,maxSamples:e.getParameter(e.MAX_SAMPLES)}}function kc(e){const t=this;let n=null,r=0,i=!1,s=!1;const a=new js,o=new $t,l={value:null,needsUpdate:!1};function u(e,n,r,i){const s=null!==e?e.length:0;let u=null;if(0!==s){if(u=l.value,!0!==i||null===u){const t=r+4*s,i=n.matrixWorldInverse;o.getNormalMatrix(i),(null===u||u.length<t)&&(u=new Float32Array(t));for(let t=0,n=r;t!==s;++t,n+=4)a.copy(e[t]).applyMatrix4(i,o),a.normal.toArray(u,n),u[n+3]=a.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const n=0!==e.length||t||0!==r||i;return i=t,r=e.length,n},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){n=u(e,t,0)},this.setState=function(a,o,c){const d=a.clippingPlanes,h=a.clipIntersection,p=a.clipShadows,f=e.get(a);if(!i||null===d||0===d.length||s&&!p)s?u(null):function(){l.value!==n&&(l.value=n,l.needsUpdate=r>0);t.numPlanes=r,t.numIntersection=0}();else{const e=s?0:r,t=4*e;let i=f.clippingState||null;l.value=i,i=u(d,o,t,c);for(let e=0;e!==t;++e)i[e]=n[e];f.clippingState=i,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function zc(e){let t=new WeakMap;function n(e,t){return t===X?e.mapping=j:t===$&&(e.mapping=q),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const s=i.mapping;if(s===X||s===$){if(t.has(i)){return n(t.get(i).texture,i.mapping)}{const s=i.image;if(s&&s.height>0){const a=new Hi(s.height);return a.fromEquirectangularTexture(e,i),t.set(i,a),i.addEventListener("dispose",r),n(a.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}const Vc=[.125,.215,.35,.446,.526,.582],Gc=20,Hc=new cu,Wc=new jr;let jc=null,qc=0,Xc=0,$c=!1;const Yc=(1+Math.sqrt(5))/2,Kc=1/Yc,Qc=[new Tn(-Yc,Kc,0),new Tn(Yc,Kc,0),new Tn(-Kc,0,Yc),new Tn(Kc,0,Yc),new Tn(0,Yc,-Kc),new Tn(0,Yc,Kc),new Tn(-1,1,-1),new Tn(1,1,-1),new Tn(-1,1,1),new Tn(1,1,1)],Zc=new Tn;class Jc{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100,i={}){const{size:s=256,position:a=Zc}=i;jc=this._renderer.getRenderTarget(),qc=this._renderer.getActiveCubeFace(),Xc=this._renderer.getActiveMipmapLevel(),$c=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(s);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,n,r,o,a),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=rd(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=nd(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(jc,qc,Xc),this._renderer.xr.enabled=$c,e.scissorTest=!1,td(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===j||e.mapping===q?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),jc=this._renderer.getRenderTarget(),qc=this._renderer.getActiveCubeFace(),Xc=this._renderer.getActiveMipmapLevel(),$c=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:ne,minFilter:ne,generateMipmaps:!1,type:he,format:_e,colorSpace:vt,depthBuffer:!1},r=ed(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=ed(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const s=e-4+1+Vc.length;for(let a=0;a<s;a++){const s=Math.pow(2,i);n.push(s);let o=1/s;a>e-4?o=Vc[a-e+4-1]:0===a&&(o=0),r.push(o);const l=1/(s-2),u=-l,c=1+l,d=[u,u,c,u,c,c,u,u,c,c,u,c],h=6,p=6,f=3,m=2,g=1,v=new Float32Array(f*p*h),y=new Float32Array(m*p*h),_=new Float32Array(g*p*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];v.set(r,f*p*e),y.set(d,m*p*e);const i=[e,e,e,e,e,e];_.set(i,g*p*e)}const x=new mi;x.setAttribute("position",new ri(v,f)),x.setAttribute("uv",new ri(y,m)),x.setAttribute("faceIndex",new ri(_,g)),t.push(x),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(Gc),i=new Tn(0,1,0),s=new Ui({name:"SphericalGaussianBlur",defines:{n:Gc,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:id(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return s}(r,e,t)}return r}_compileMaterial(e){const t=new Ai(this._lodPlanes[0],e);this._renderer.compile(t,Hc)}_sceneToCubeUV(e,t,n,r,i){const s=new ki(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],l=this._renderer,u=l.autoClear,c=l.toneMapping;l.getClearColor(Wc),l.toneMapping=0,l.autoClear=!1;const d=new Yr({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new Ai(new Ri,d);let p=!1;const f=e.background;f?f.isColor&&(d.color.copy(f),e.background=null,p=!0):(d.color.copy(Wc),p=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(s.up.set(0,a[t],0),s.position.set(i.x,i.y,i.z),s.lookAt(i.x+o[t],i.y,i.z)):1===n?(s.up.set(0,0,a[t]),s.position.set(i.x,i.y,i.z),s.lookAt(i.x,i.y+o[t],i.z)):(s.up.set(0,a[t],0),s.position.set(i.x,i.y,i.z),s.lookAt(i.x,i.y,i.z+o[t]));const u=this._cubeSize;td(r,n*u,t>2?u:0,u,u),l.setRenderTarget(r),p&&l.render(h,s),l.render(e,s)}h.geometry.dispose(),h.material.dispose(),l.toneMapping=c,l.autoClear=u,e.background=f}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===j||e.mapping===q;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=rd()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=nd());const i=r?this._cubemapMaterial:this._equirectMaterial,s=new Ai(this._lodPlanes[0],i);i.uniforms.envMap.value=e;const a=this._cubeSize;td(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(s,Hc)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let t=1;t<r;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),i=Qc[(r-t-1)%Qc.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,r,i){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,r,"latitudinal",i),this._halfBlur(s,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,s,a){const o=this._renderer,l=this._blurMaterial,u=new Ai(this._lodPlanes[r],l),c=l.uniforms,d=this._sizeLods[n]-1,h=isFinite(i)?Math.PI/(2*d):2*Math.PI/39,p=i/h,f=isFinite(i)?1+Math.floor(3*p):Gc,m=[];let g=0;for(let e=0;e<Gc;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=m,c.latitudinal.value="latitudinal"===s,a&&(c.poleAxis.value=a);const{_lodMax:v}=this;c.dTheta.value=h,c.mipInt.value=v-n;const y=this._sizeLods[r];td(t,3*y*(r>v-4?r-v+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(t),o.render(u,Hc)}}function ed(e,t,n){const r=new _n(e,t,n);return r.texture.mapping=Y,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function td(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function nd(){return new Ui({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:id(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function rd(){return new Ui({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:id(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function id(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function sd(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){const s=i.mapping,a=s===X||s===$,o=s===j||s===q;if(a||o){let s=t.get(i);const l=void 0!==s?s.texture.pmremVersion:0;if(i.isRenderTargetTexture&&i.pmremVersion!==l)return null===n&&(n=new Jc(e)),s=a?n.fromEquirectangular(i,s):n.fromCubemap(i,s),s.texture.pmremVersion=i.pmremVersion,t.set(i,s),s.texture;if(void 0!==s)return s.texture;{const l=i.image;return a&&l&&l.height>0||o&&l&&function(e){let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(l)?(null===n&&(n=new Jc(e)),s=a?n.fromEquirectangular(i):n.fromCubemap(i),s.texture.pmremVersion=i.pmremVersion,t.set(i,s),i.addEventListener("dispose",r),s.texture):null}}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function ad(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(e){const t=n(e);return null===t&&nn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function od(e,t,n,r){const i={},s=new WeakMap;function a(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const e in o.attributes)t.remove(o.attributes[e]);o.removeEventListener("dispose",a),delete i[o.id];const l=s.get(o);l&&(t.remove(l),s.delete(o)),r.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,n.memory.geometries--}function o(e){const n=[],r=e.index,i=e.attributes.position;let a=0;if(null!==r){const e=r.array;a=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],s=e[t+2];n.push(r,i,i,s,s,r)}}else{if(void 0===i)return;{const e=i.array;a=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}}const o=new(Kt(n)?si:ii)(n,1);o.version=a;const l=s.get(e);l&&t.remove(l),s.set(e,o)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",a),i[t.id]=!0,n.memory.geometries++),t},update:function(n){const r=n.attributes;for(const n in r)t.update(r[n],e.ARRAY_BUFFER)},getWireframeAttribute:function(e){const t=s.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return s.get(e)}}}function ld(e,t,n){let r,i,s;function a(t,a,o){0!==o&&(e.drawElementsInstanced(r,a,i,t*s,o),n.update(a,r,o))}this.setMode=function(e){r=e},this.setIndex=function(e){i=e.type,s=e.bytesPerElement},this.render=function(t,a){e.drawElements(r,a,i,t*s),n.update(a,r,1)},this.renderInstances=a,this.renderMultiDraw=function(e,s,a){if(0===a)return;t.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,s,0,i,e,0,a);let o=0;for(let e=0;e<a;e++)o+=s[e];n.update(o,r,1)},this.renderMultiDrawInstances=function(e,o,l,u){if(0===l)return;const c=t.get("WEBGL_multi_draw");if(null===c)for(let t=0;t<e.length;t++)a(e[t]/s,o[t],u[t]);else{c.multiDrawElementsInstancedWEBGL(r,o,0,i,e,0,u,0,l);let t=0;for(let e=0;e<l;e++)t+=o[e]*u[e];n.update(t,r,1)}}}function ud(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,r,i){switch(t.calls++,r){case e.TRIANGLES:t.triangles+=i*(n/3);break;case e.LINES:t.lines+=i*(n/2);break;case e.LINE_STRIP:t.lines+=i*(n-1);break;case e.LINE_LOOP:t.lines+=i*n;break;case e.POINTS:t.points+=i*n}}}}function cd(e,t,n){const r=new WeakMap,i=new vn;return{update:function(s,a,o){const l=s.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,c=void 0!==u?u.length:0;let d=r.get(a);if(void 0===d||d.count!==c){void 0!==d&&d.texture.dispose();const h=void 0!==a.morphAttributes.position,p=void 0!==a.morphAttributes.normal,f=void 0!==a.morphAttributes.color,m=a.morphAttributes.position||[],g=a.morphAttributes.normal||[],v=a.morphAttributes.color||[];let y=0;!0===h&&(y=1),!0===p&&(y=2),!0===f&&(y=3);let _=a.attributes.position.count*y,x=1;_>t.maxTextureSize&&(x=Math.ceil(_/t.maxTextureSize),_=t.maxTextureSize);const b=new Float32Array(_*x*4*c),S=new xn(b,_,x,c);S.type=de,S.needsUpdate=!0;const T=4*y;for(let M=0;M<c;M++){const E=m[M],A=g[M],C=v[M],R=_*x*4*M;for(let N=0;N<E.count;N++){const P=N*T;!0===h&&(i.fromBufferAttribute(E,N),b[R+P+0]=i.x,b[R+P+1]=i.y,b[R+P+2]=i.z,b[R+P+3]=0),!0===p&&(i.fromBufferAttribute(A,N),b[R+P+4]=i.x,b[R+P+5]=i.y,b[R+P+6]=i.z,b[R+P+7]=0),!0===f&&(i.fromBufferAttribute(C,N),b[R+P+8]=i.x,b[R+P+9]=i.y,b[R+P+10]=i.z,b[R+P+11]=4===C.itemSize?i.w:1)}}function w(){S.dispose(),r.delete(a),a.removeEventListener("dispose",w)}d={count:c,texture:S,size:new Xt(_,x)},r.set(a,d),a.addEventListener("dispose",w)}if(!0===s.isInstancedMesh&&null!==s.morphTexture)o.getUniforms().setValue(e,"morphTexture",s.morphTexture,n);else{let I=0;for(let U=0;U<l.length;U++)I+=l[U];const L=a.morphTargetsRelative?1:1-I;o.getUniforms().setValue(e,"morphTargetBaseInfluence",L),o.getUniforms().setValue(e,"morphTargetInfluences",l)}o.getUniforms().setValue(e,"morphTargetsTexture",d.texture,n),o.getUniforms().setValue(e,"morphTargetsTextureSize",d.size)}}}function dd(e,t,n,r){let i=new WeakMap;function s(e){const t=e.target;t.removeEventListener("dispose",s),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(a){const o=r.render.frame,l=a.geometry,u=t.get(a,l);if(i.get(u)!==o&&(t.update(u),i.set(u,o)),a.isInstancedMesh&&(!1===a.hasEventListener("dispose",s)&&a.addEventListener("dispose",s),i.get(a)!==o&&(n.update(a.instanceMatrix,e.ARRAY_BUFFER),null!==a.instanceColor&&n.update(a.instanceColor,e.ARRAY_BUFFER),i.set(a,o))),a.isSkinnedMesh){const e=a.skeleton;i.get(e)!==o&&(e.update(),i.set(e,o))}return u},dispose:function(){i=new WeakMap}}}const hd=new gn,pd=new Oa(1,1),fd=new xn,md=new bn,gd=new Gi,vd=[],yd=[],_d=new Float32Array(16),xd=new Float32Array(9),bd=new Float32Array(4);function Sd(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let s=vd[i];if(void 0===s&&(s=new Float32Array(i),vd[i]=s),0!==t){r.toArray(s,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(s,i)}return s}function Td(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function wd(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function Md(e,t){let n=yd[t];void 0===n&&(n=new Int32Array(t),yd[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Ed(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Ad(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Td(n,t))return;e.uniform2fv(this.addr,t),wd(n,t)}}function Cd(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Td(n,t))return;e.uniform3fv(this.addr,t),wd(n,t)}}function Rd(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Td(n,t))return;e.uniform4fv(this.addr,t),wd(n,t)}}function Nd(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Td(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),wd(n,t)}else{if(Td(n,r))return;bd.set(r),e.uniformMatrix2fv(this.addr,!1,bd),wd(n,r)}}function Pd(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Td(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),wd(n,t)}else{if(Td(n,r))return;xd.set(r),e.uniformMatrix3fv(this.addr,!1,xd),wd(n,r)}}function Id(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(Td(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),wd(n,t)}else{if(Td(n,r))return;_d.set(r),e.uniformMatrix4fv(this.addr,!1,_d),wd(n,r)}}function Ld(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Ud(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2i(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Td(n,t))return;e.uniform2iv(this.addr,t),wd(n,t)}}function Dd(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3i(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Td(n,t))return;e.uniform3iv(this.addr,t),wd(n,t)}}function Fd(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4i(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Td(n,t))return;e.uniform4iv(this.addr,t),wd(n,t)}}function Bd(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Od(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2ui(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Td(n,t))return;e.uniform2uiv(this.addr,t),wd(n,t)}}function kd(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3ui(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else{if(Td(n,t))return;e.uniform3uiv(this.addr,t),wd(n,t)}}function zd(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4ui(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Td(n,t))return;e.uniform4uiv(this.addr,t),wd(n,t)}}function Vd(e,t,n){const r=this.cache,i=n.allocateTextureUnit();let s;r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),this.type===e.SAMPLER_2D_SHADOW?(pd.compareFunction=Mt,s=pd):s=hd,n.setTexture2D(t||s,i)}function Gd(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||md,i)}function Hd(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||gd,i)}function Wd(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||fd,i)}function jd(e,t){e.uniform1fv(this.addr,t)}function qd(e,t){const n=Sd(t,this.size,2);e.uniform2fv(this.addr,n)}function Xd(e,t){const n=Sd(t,this.size,3);e.uniform3fv(this.addr,n)}function $d(e,t){const n=Sd(t,this.size,4);e.uniform4fv(this.addr,n)}function Yd(e,t){const n=Sd(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Kd(e,t){const n=Sd(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Qd(e,t){const n=Sd(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Zd(e,t){e.uniform1iv(this.addr,t)}function Jd(e,t){e.uniform2iv(this.addr,t)}function eh(e,t){e.uniform3iv(this.addr,t)}function th(e,t){e.uniform4iv(this.addr,t)}function nh(e,t){e.uniform1uiv(this.addr,t)}function rh(e,t){e.uniform2uiv(this.addr,t)}function ih(e,t){e.uniform3uiv(this.addr,t)}function sh(e,t){e.uniform4uiv(this.addr,t)}function ah(e,t,n){const r=this.cache,i=t.length,s=Md(n,i);Td(r,s)||(e.uniform1iv(this.addr,s),wd(r,s));for(let e=0;e!==i;++e)n.setTexture2D(t[e]||hd,s[e])}function oh(e,t,n){const r=this.cache,i=t.length,s=Md(n,i);Td(r,s)||(e.uniform1iv(this.addr,s),wd(r,s));for(let e=0;e!==i;++e)n.setTexture3D(t[e]||md,s[e])}function lh(e,t,n){const r=this.cache,i=t.length,s=Md(n,i);Td(r,s)||(e.uniform1iv(this.addr,s),wd(r,s));for(let e=0;e!==i;++e)n.setTextureCube(t[e]||gd,s[e])}function uh(e,t,n){const r=this.cache,i=t.length,s=Md(n,i);Td(r,s)||(e.uniform1iv(this.addr,s),wd(r,s));for(let e=0;e!==i;++e)n.setTexture2DArray(t[e]||fd,s[e])}class ch{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=function(e){switch(e){case 5126:return Ed;case 35664:return Ad;case 35665:return Cd;case 35666:return Rd;case 35674:return Nd;case 35675:return Pd;case 35676:return Id;case 5124:case 35670:return Ld;case 35667:case 35671:return Ud;case 35668:case 35672:return Dd;case 35669:case 35673:return Fd;case 5125:return Bd;case 36294:return Od;case 36295:return kd;case 36296:return zd;case 35678:case 36198:case 36298:case 36306:case 35682:return Vd;case 35679:case 36299:case 36307:return Gd;case 35680:case 36300:case 36308:case 36293:return Hd;case 36289:case 36303:case 36311:case 36292:return Wd}}(t.type)}}class dh{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return jd;case 35664:return qd;case 35665:return Xd;case 35666:return $d;case 35674:return Yd;case 35675:return Kd;case 35676:return Qd;case 5124:case 35670:return Zd;case 35667:case 35671:return Jd;case 35668:case 35672:return eh;case 35669:case 35673:return th;case 5125:return nh;case 36294:return rh;case 36295:return ih;case 36296:return sh;case 35678:case 36198:case 36298:case 36306:case 35682:return ah;case 35679:case 36299:case 36307:return oh;case 35680:case 36300:case 36308:case 36293:return lh;case 36289:case 36303:case 36311:case 36292:return uh}}(t.type)}}class hh{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const r=this.seq;for(let i=0,s=r.length;i!==s;++i){const s=r[i];s.setValue(e,t[s.id],n)}}}const ph=/(\w+)(\])?(\[|\.)?/g;function fh(e,t){e.seq.push(t),e.map[t.id]=t}function mh(e,t,n){const r=e.name,i=r.length;for(ph.lastIndex=0;;){const s=ph.exec(r),a=ph.lastIndex;let o=s[1];const l="]"===s[2],u=s[3];if(l&&(o|=0),void 0===u||"["===u&&a+2===i){fh(n,void 0===u?new ch(o,e,t):new dh(o,e,t));break}{let e=n.map[o];void 0===e&&(e=new hh(o),fh(n,e)),n=e}}}class gh{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);mh(n,e.getUniformLocation(t,n.name),this)}}setValue(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)}setOptional(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)}static upload(e,t,n,r){for(let i=0,s=t.length;i!==s;++i){const s=t[i],a=n[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,r)}}static seqWithValue(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n}}function vh(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}let yh=0;const _h=new $t;function xh(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const r=parseInt(s[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let e=i;e<s;e++){const i=e+1;r.push(`${i===t?">":" "} ${i}: ${n[e]}`)}return r.join("\n")}(e.getShaderSource(t),r)}return i}function bh(e,t){const n=function(e){on._getMatrix(_h,on.workingColorSpace,e);const t=`mat3( ${_h.elements.map(e=>e.toFixed(4))} )`;switch(on.getTransfer(e)){case yt:return[t,"LinearTransferOETF"];case _t:return[t,"sRGBTransferOETF"];default:return[t,"LinearTransferOETF"]}}(t);return[`vec4 ${e}( vec4 value ) {`,`\treturn ${n[1]}( vec4( value.rgb * ${n[0]}, value.a ) );`,"}"].join("\n")}function Sh(e,t){let n;switch(t){case 1:default:n="Linear";break;case 2:n="Reinhard";break;case 3:n="Cineon";break;case 4:n="ACESFilmic";break;case 6:n="AgX";break;case 7:n="Neutral";break;case 5:n="Custom"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}const Th=new Tn;function wh(){on.getLuminanceCoefficients(Th);return["float luminance( const in vec3 rgb ) {",`\tconst vec3 weights = vec3( ${Th.x.toFixed(4)}, ${Th.y.toFixed(4)}, ${Th.z.toFixed(4)} );`,"\treturn dot( weights, rgb );","}"].join("\n")}function Mh(e){return""!==e}function Eh(e,t){const n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ah(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Ch=/^[ \t]*#include +<([\w\d./]+)>/gm;function Rh(e){return e.replace(Ch,Ph)}const Nh=new Map;function Ph(e,t){let n=Rc[t];if(void 0===n){const e=Nh.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");n=Rc[e]}return Rh(n)}const Ih=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Lh(e){return e.replace(Ih,Uh)}function Uh(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function Dh(e){let t=`precision ${e.precision} float;\n\tprecision ${e.precision} int;\n\tprecision ${e.precision} sampler2D;\n\tprecision ${e.precision} samplerCube;\n\tprecision ${e.precision} sampler3D;\n\tprecision ${e.precision} sampler2DArray;\n\tprecision ${e.precision} sampler2DShadow;\n\tprecision ${e.precision} samplerCubeShadow;\n\tprecision ${e.precision} sampler2DArrayShadow;\n\tprecision ${e.precision} isampler2D;\n\tprecision ${e.precision} isampler3D;\n\tprecision ${e.precision} isamplerCube;\n\tprecision ${e.precision} isampler2DArray;\n\tprecision ${e.precision} usampler2D;\n\tprecision ${e.precision} usampler3D;\n\tprecision ${e.precision} usamplerCube;\n\tprecision ${e.precision} usampler2DArray;\n\t`;return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Fh(e,t,n,r){const i=e.getContext(),s=n.defines;let a=n.vertexShader,o=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),u=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case j:case q:t="ENVMAP_TYPE_CUBE";break;case Y:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),c=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===q&&(t="ENVMAP_MODE_REFRACTION");return t}(n),d=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),h=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),p=function(e){return[e.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",e.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Mh).join("\n")}(n),f=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),m=i.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(Mh).join("\n"),g.length>0&&(g+="\n"),v=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f].filter(Mh).join("\n"),v.length>0&&(v+="\n")):(g=[Dh(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.batchingColor?"#define USE_BATCHING_COLOR":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Mh).join("\n"),v=[Dh(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,f,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+u:"",n.envMap?"#define "+c:"",n.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&!1===n.flatShading?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor||n.batchingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Rc.tonemapping_pars_fragment:"",0!==n.toneMapping?Sh("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Rc.colorspace_pars_fragment,bh("linearToOutputTexel",n.outputColorSpace),wh(),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Mh).join("\n")),a=Rh(a),a=Eh(a,n),a=Ah(a,n),o=Rh(o),o=Eh(o,n),o=Ah(o,n),a=Lh(a),o=Lh(o),!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in",n.glslVersion===It?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===It?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const _=y+g+a,x=y+v+o,b=vh(i,i.VERTEX_SHADER,_),S=vh(i,i.FRAGMENT_SHADER,x);function T(t){if(e.debug.checkShaderErrors){const n=i.getProgramInfoLog(m).trim(),r=i.getShaderInfoLog(b).trim(),s=i.getShaderInfoLog(S).trim();let a=!0,o=!0;if(!1===i.getProgramParameter(m,i.LINK_STATUS))if(a=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(i,m,b,S);else{xh(i,b,"vertex"),xh(i,S,"fragment")}else""!==n||""!==r&&""!==s||(o=!1);o&&(t.diagnostics={runnable:a,programLog:n,vertexShader:{log:r,prefix:g},fragmentShader:{log:s,prefix:v}})}i.deleteShader(b),i.deleteShader(S),w=new gh(i,m),M=function(e,t){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),s=r.name;let a=1;r.type===e.FLOAT_MAT2&&(a=2),r.type===e.FLOAT_MAT3&&(a=3),r.type===e.FLOAT_MAT4&&(a=4),n[s]={type:r.type,location:e.getAttribLocation(t,s),locationSize:a}}return n}(i,m)}let w,M;i.attachShader(m,b),i.attachShader(m,S),void 0!==n.index0AttributeName?i.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),this.getUniforms=function(){return void 0===w&&T(this),w},this.getAttributes=function(){return void 0===M&&T(this),M};let E=!1===n.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===E&&(E=i.getProgramParameter(m,37297)),E},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=yh++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=b,this.fragmentShader=S,this}let Bh=0;class Oh{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),s=this._getShaderCacheForMaterial(e);return!1===s.has(r)&&(s.add(r),r.usedTimes++),!1===s.has(i)&&(s.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return void 0===n&&(n=new kh(e),t.set(e,n)),n}}class kh{constructor(e){this.id=Bh++,this.code=e,this.usedTimes=0}}function zh(e,t,n,r,i,s,a){const o=new cr,l=new Oh,u=new Set,c=[],d=i.logarithmicDepthBuffer,h=i.vertexTextures;let p=i.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function m(e){return u.add(e),0===e?"uv":`uv${e}`}return{getParameters:function(s,o,c,g,v){const y=g.fog,_=v.geometry,x=s.isMeshStandardMaterial?g.environment:null,b=(s.isMeshStandardMaterial?n:t).get(s.envMap||x),S=b&&b.mapping===Y?b.image.height:null,T=f[s.type];null!==s.precision&&(p=i.getMaxPrecision(s.precision),s.precision);const w=_.morphAttributes.position||_.morphAttributes.normal||_.morphAttributes.color,M=void 0!==w?w.length:0;let E,A,C,R,N=0;if(void 0!==_.morphAttributes.position&&(N=1),void 0!==_.morphAttributes.normal&&(N=2),void 0!==_.morphAttributes.color&&(N=3),T){const e=Pc[T];E=e.vertexShader,A=e.fragmentShader}else E=s.vertexShader,A=s.fragmentShader,l.update(s),C=l.getVertexShaderID(s),R=l.getFragmentShaderID(s);const P=e.getRenderTarget(),I=e.state.buffers.depth.getReversed(),L=!0===v.isInstancedMesh,U=!0===v.isBatchedMesh,D=!!s.map,F=!!s.matcap,B=!!b,O=!!s.aoMap,k=!!s.lightMap,z=!!s.bumpMap,V=!!s.normalMap,G=!!s.displacementMap,H=!!s.emissiveMap,W=!!s.metalnessMap,j=!!s.roughnessMap,q=s.anisotropy>0,X=s.clearcoat>0,$=s.dispersion>0,K=s.iridescence>0,Q=s.sheen>0,Z=s.transmission>0,J=q&&!!s.anisotropyMap,ee=X&&!!s.clearcoatMap,te=X&&!!s.clearcoatNormalMap,ne=X&&!!s.clearcoatRoughnessMap,re=K&&!!s.iridescenceMap,ie=K&&!!s.iridescenceThicknessMap,se=Q&&!!s.sheenColorMap,ae=Q&&!!s.sheenRoughnessMap,oe=!!s.specularMap,le=!!s.specularColorMap,ue=!!s.specularIntensityMap,ce=Z&&!!s.transmissionMap,de=Z&&!!s.thicknessMap,he=!!s.gradientMap,pe=!!s.alphaMap,fe=s.alphaTest>0,me=!!s.alphaHash,ge=!!s.extensions;let ve=0;s.toneMapped&&(null!==P&&!0!==P.isXRRenderTarget||(ve=e.toneMapping));const ye={shaderID:T,shaderType:s.type,shaderName:s.name,vertexShader:E,fragmentShader:A,defines:s.defines,customVertexShaderID:C,customFragmentShaderID:R,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:p,batching:U,batchingColor:U&&null!==v._colorsTexture,instancing:L,instancingColor:L&&null!==v.instanceColor,instancingMorph:L&&null!==v.morphTexture,supportsVertexTextures:h,outputColorSpace:null===P?e.outputColorSpace:!0===P.isXRRenderTarget?P.texture.colorSpace:vt,alphaToCoverage:!!s.alphaToCoverage,map:D,matcap:F,envMap:B,envMapMode:B&&b.mapping,envMapCubeUVHeight:S,aoMap:O,lightMap:k,bumpMap:z,normalMap:V,displacementMap:h&&G,emissiveMap:H,normalMapObjectSpace:V&&1===s.normalMapType,normalMapTangentSpace:V&&0===s.normalMapType,metalnessMap:W,roughnessMap:j,anisotropy:q,anisotropyMap:J,clearcoat:X,clearcoatMap:ee,clearcoatNormalMap:te,clearcoatRoughnessMap:ne,dispersion:$,iridescence:K,iridescenceMap:re,iridescenceThicknessMap:ie,sheen:Q,sheenColorMap:se,sheenRoughnessMap:ae,specularMap:oe,specularColorMap:le,specularIntensityMap:ue,transmission:Z,transmissionMap:ce,thicknessMap:de,gradientMap:he,opaque:!1===s.transparent&&1===s.blending&&!1===s.alphaToCoverage,alphaMap:pe,alphaTest:fe,alphaHash:me,combine:s.combine,mapUv:D&&m(s.map.channel),aoMapUv:O&&m(s.aoMap.channel),lightMapUv:k&&m(s.lightMap.channel),bumpMapUv:z&&m(s.bumpMap.channel),normalMapUv:V&&m(s.normalMap.channel),displacementMapUv:G&&m(s.displacementMap.channel),emissiveMapUv:H&&m(s.emissiveMap.channel),metalnessMapUv:W&&m(s.metalnessMap.channel),roughnessMapUv:j&&m(s.roughnessMap.channel),anisotropyMapUv:J&&m(s.anisotropyMap.channel),clearcoatMapUv:ee&&m(s.clearcoatMap.channel),clearcoatNormalMapUv:te&&m(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:ne&&m(s.clearcoatRoughnessMap.channel),iridescenceMapUv:re&&m(s.iridescenceMap.channel),iridescenceThicknessMapUv:ie&&m(s.iridescenceThicknessMap.channel),sheenColorMapUv:se&&m(s.sheenColorMap.channel),sheenRoughnessMapUv:ae&&m(s.sheenRoughnessMap.channel),specularMapUv:oe&&m(s.specularMap.channel),specularColorMapUv:le&&m(s.specularColorMap.channel),specularIntensityMapUv:ue&&m(s.specularIntensityMap.channel),transmissionMapUv:ce&&m(s.transmissionMap.channel),thicknessMapUv:de&&m(s.thicknessMap.channel),alphaMapUv:pe&&m(s.alphaMap.channel),vertexTangents:!!_.attributes.tangent&&(V||q),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!_.attributes.color&&4===_.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!_.attributes.uv&&(D||pe),fog:!!y,useFog:!0===s.fog,fogExp2:!!y&&y.isFogExp2,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:d,reverseDepthBuffer:I,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==_.morphAttributes.position,morphNormals:void 0!==_.morphAttributes.normal,morphColors:void 0!==_.morphAttributes.color,morphTargetsCount:M,morphTextureStride:N,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numLightProbes:o.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:ve,decodeVideoTexture:D&&!0===s.map.isVideoTexture&&on.getTransfer(s.map.colorSpace)===_t,decodeVideoTextureEmissive:H&&!0===s.emissiveMap.isVideoTexture&&on.getTransfer(s.emissiveMap.colorSpace)===_t,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionClipCullDistance:ge&&!0===s.extensions.clipCullDistance&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(ge&&!0===s.extensions.multiDraw||U)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:s.customProgramCacheKey()};return ye.vertexUv1s=u.has(1),ye.vertexUv2s=u.has(2),ye.vertexUv3s=u.has(3),u.clear(),ye},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){o.disableAll(),t.supportsVertexTextures&&o.enable(0);t.instancing&&o.enable(1);t.instancingColor&&o.enable(2);t.instancingMorph&&o.enable(3);t.matcap&&o.enable(4);t.envMap&&o.enable(5);t.normalMapObjectSpace&&o.enable(6);t.normalMapTangentSpace&&o.enable(7);t.clearcoat&&o.enable(8);t.iridescence&&o.enable(9);t.alphaTest&&o.enable(10);t.vertexColors&&o.enable(11);t.vertexAlphas&&o.enable(12);t.vertexUv1s&&o.enable(13);t.vertexUv2s&&o.enable(14);t.vertexUv3s&&o.enable(15);t.vertexTangents&&o.enable(16);t.anisotropy&&o.enable(17);t.alphaHash&&o.enable(18);t.batching&&o.enable(19);t.dispersion&&o.enable(20);t.batchingColor&&o.enable(21);e.push(o.mask),o.disableAll(),t.fog&&o.enable(0);t.useFog&&o.enable(1);t.flatShading&&o.enable(2);t.logarithmicDepthBuffer&&o.enable(3);t.reverseDepthBuffer&&o.enable(4);t.skinning&&o.enable(5);t.morphTargets&&o.enable(6);t.morphNormals&&o.enable(7);t.morphColors&&o.enable(8);t.premultipliedAlpha&&o.enable(9);t.shadowMapEnabled&&o.enable(10);t.doubleSided&&o.enable(11);t.flipSided&&o.enable(12);t.useDepthPacking&&o.enable(13);t.dithering&&o.enable(14);t.transmission&&o.enable(15);t.sheen&&o.enable(16);t.opaque&&o.enable(17);t.pointsUvs&&o.enable(18);t.decodeVideoTexture&&o.enable(19);t.decodeVideoTextureEmissive&&o.enable(20);t.alphaToCoverage&&o.enable(21);e.push(o.mask)}(n,t),n.push(e.outputColorSpace)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=f[e.type];let n;if(t){const e=Pc[t];n=Li.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=c.length;e<t;e++){const t=c[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new Fh(e,n,t,s),c.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){const t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:c,dispose:function(){l.dispose()}}}function Vh(){let e=new WeakMap;return{has:function(t){return e.has(t)},get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Gh(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Hh(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Wh(){const e=[];let t=0;const n=[],r=[],i=[];function s(n,r,i,s,a,o){let l=e[t];return void 0===l?(l={id:n.id,object:n,geometry:r,material:i,groupOrder:s,renderOrder:n.renderOrder,z:a,group:o},e[t]=l):(l.id=n.id,l.object=n,l.geometry=r,l.material=i,l.groupOrder=s,l.renderOrder=n.renderOrder,l.z=a,l.group=o),t++,l}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,a,o,l,u){const c=s(e,t,a,o,l,u);a.transmission>0?r.push(c):!0===a.transparent?i.push(c):n.push(c)},unshift:function(e,t,a,o,l,u){const c=s(e,t,a,o,l,u);a.transmission>0?r.unshift(c):!0===a.transparent?i.unshift(c):n.unshift(c)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Gh),r.length>1&&r.sort(t||Hh),i.length>1&&i.sort(t||Hh)}}}function jh(){let e=new WeakMap;return{get:function(t,n){const r=e.get(t);let i;return void 0===r?(i=new Wh,e.set(t,[i])):n>=r.length?(i=new Wh,r.push(i)):i=r[n],i},dispose:function(){e=new WeakMap}}}function qh(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new Tn,color:new jr};break;case"SpotLight":n={position:new Tn,direction:new Tn,color:new jr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Tn,color:new jr,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Tn,skyColor:new jr,groundColor:new jr};break;case"RectAreaLight":n={color:new jr,position:new Tn,halfWidth:new Tn,halfHeight:new Tn}}return e[t.id]=n,n}}}let Xh=0;function $h(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Yh(e){const t=new qh,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xt};break;case"PointLight":n={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xt,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let e=0;e<9;e++)r.probe.push(new Tn);const i=new Tn,s=new Jn,a=new Jn;return{setup:function(i){let s=0,a=0,o=0;for(let e=0;e<9;e++)r.probe[e].set(0,0,0);let l=0,u=0,c=0,d=0,h=0,p=0,f=0,m=0,g=0,v=0,y=0;i.sort($h);for(let e=0,_=i.length;e<_;e++){const _=i[e],x=_.color,b=_.intensity,S=_.distance,T=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)s+=x.r*b,a+=x.g*b,o+=x.b*b;else if(_.isLightProbe){for(let e=0;e<9;e++)r.probe[e].addScaledVector(_.sh.coefficients[e],b);y++}else if(_.isDirectionalLight){const e=t.get(_);if(e.color.copy(_.color).multiplyScalar(_.intensity),_.castShadow){const e=_.shadow,t=n.get(_);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,r.directionalShadow[l]=t,r.directionalShadowMap[l]=T,r.directionalShadowMatrix[l]=_.shadow.matrix,p++}r.directional[l]=e,l++}else if(_.isSpotLight){const e=t.get(_);e.position.setFromMatrixPosition(_.matrixWorld),e.color.copy(x).multiplyScalar(b),e.distance=S,e.coneCos=Math.cos(_.angle),e.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),e.decay=_.decay,r.spot[c]=e;const i=_.shadow;if(_.map&&(r.spotLightMap[g]=_.map,g++,i.updateMatrices(_),_.castShadow&&v++),r.spotLightMatrix[c]=i.matrix,_.castShadow){const e=n.get(_);e.shadowIntensity=i.intensity,e.shadowBias=i.bias,e.shadowNormalBias=i.normalBias,e.shadowRadius=i.radius,e.shadowMapSize=i.mapSize,r.spotShadow[c]=e,r.spotShadowMap[c]=T,m++}c++}else if(_.isRectAreaLight){const e=t.get(_);e.color.copy(x).multiplyScalar(b),e.halfWidth.set(.5*_.width,0,0),e.halfHeight.set(0,.5*_.height,0),r.rectArea[d]=e,d++}else if(_.isPointLight){const e=t.get(_);if(e.color.copy(_.color).multiplyScalar(_.intensity),e.distance=_.distance,e.decay=_.decay,_.castShadow){const e=_.shadow,t=n.get(_);t.shadowIntensity=e.intensity,t.shadowBias=e.bias,t.shadowNormalBias=e.normalBias,t.shadowRadius=e.radius,t.shadowMapSize=e.mapSize,t.shadowCameraNear=e.camera.near,t.shadowCameraFar=e.camera.far,r.pointShadow[u]=t,r.pointShadowMap[u]=T,r.pointShadowMatrix[u]=_.shadow.matrix,f++}r.point[u]=e,u++}else if(_.isHemisphereLight){const e=t.get(_);e.skyColor.copy(_.color).multiplyScalar(b),e.groundColor.copy(_.groundColor).multiplyScalar(b),r.hemi[h]=e,h++}}d>0&&(!0===e.has("OES_texture_float_linear")?(r.rectAreaLTC1=Nc.LTC_FLOAT_1,r.rectAreaLTC2=Nc.LTC_FLOAT_2):(r.rectAreaLTC1=Nc.LTC_HALF_1,r.rectAreaLTC2=Nc.LTC_HALF_2)),r.ambient[0]=s,r.ambient[1]=a,r.ambient[2]=o;const _=r.hash;_.directionalLength===l&&_.pointLength===u&&_.spotLength===c&&_.rectAreaLength===d&&_.hemiLength===h&&_.numDirectionalShadows===p&&_.numPointShadows===f&&_.numSpotShadows===m&&_.numSpotMaps===g&&_.numLightProbes===y||(r.directional.length=l,r.spot.length=c,r.rectArea.length=d,r.point.length=u,r.hemi.length=h,r.directionalShadow.length=p,r.directionalShadowMap.length=p,r.pointShadow.length=f,r.pointShadowMap.length=f,r.spotShadow.length=m,r.spotShadowMap.length=m,r.directionalShadowMatrix.length=p,r.pointShadowMatrix.length=f,r.spotLightMatrix.length=m+g-v,r.spotLightMap.length=g,r.numSpotLightShadowsWithMaps=v,r.numLightProbes=y,_.directionalLength=l,_.pointLength=u,_.spotLength=c,_.rectAreaLength=d,_.hemiLength=h,_.numDirectionalShadows=p,_.numPointShadows=f,_.numSpotShadows=m,_.numSpotMaps=g,_.numLightProbes=y,r.version=Xh++)},setupView:function(e,t){let n=0,o=0,l=0,u=0,c=0;const d=t.matrixWorldInverse;for(let t=0,h=e.length;t<h;t++){const h=e[t];if(h.isDirectionalLight){const e=r.directional[n];e.direction.setFromMatrixPosition(h.matrixWorld),i.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(d),n++}else if(h.isSpotLight){const e=r.spot[l];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),e.direction.setFromMatrixPosition(h.matrixWorld),i.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(i),e.direction.transformDirection(d),l++}else if(h.isRectAreaLight){const e=r.rectArea[u];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),a.identity(),s.copy(h.matrixWorld),s.premultiply(d),a.extractRotation(s),e.halfWidth.set(.5*h.width,0,0),e.halfHeight.set(0,.5*h.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),u++}else if(h.isPointLight){const e=r.point[o];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(d),o++}else if(h.isHemisphereLight){const e=r.hemi[c];e.direction.setFromMatrixPosition(h.matrixWorld),e.direction.transformDirection(d),c++}}},state:r}}function Kh(e){const t=new Yh(e),n=[],r=[];const i={lightsArray:n,shadowsArray:r,camera:null,lights:t,transmissionRenderTarget:{}};return{init:function(e){i.camera=e,n.length=0,r.length=0},state:i,setupLights:function(){t.setup(n)},setupLightsView:function(e){t.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){r.push(e)}}}function Qh(e){let t=new WeakMap;return{get:function(n,r=0){const i=t.get(n);let s;return void 0===i?(s=new Kh(e),t.set(n,[s])):r>=i.length?(s=new Kh(e),i.push(s)):s=i[r],s},dispose:function(){t=new WeakMap}}}function Zh(e,t,n){let r=new $s;const i=new Xt,s=new Xt,a=new vn,o=new yl({depthPacking:3201}),l=new _l,u={},c=n.maxTextureSize,d={[h]:1,[p]:0,[f]:2},m=new Ui({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Xt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),g=m.clone();g.defines.HORIZONTAL_PASS=1;const v=new mi;v.setAttribute("position",new ri(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new Ai(v,m),_=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1;let x=this.type;function b(n,r){const s=t.update(y);m.defines.VSM_SAMPLES!==n.blurSamples&&(m.defines.VSM_SAMPLES=n.blurSamples,g.defines.VSM_SAMPLES=n.blurSamples,m.needsUpdate=!0,g.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new _n(i.x,i.y)),m.uniforms.shadow_pass.value=n.map.texture,m.uniforms.resolution.value=n.mapSize,m.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,s,m,y,null),g.uniforms.shadow_pass.value=n.mapPass.texture,g.uniforms.resolution.value=n.mapSize,g.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,s,g,y,null)}function S(t,n,r,i){let s=null;const a=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(void 0!==a)s=a;else if(s=!0===r.isPointLight?l:o,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0||n.map&&n.alphaTest>0){const e=s.uuid,t=n.uuid;let r=u[e];void 0===r&&(r={},u[e]=r);let i=r[t];void 0===i&&(i=s.clone(),r[t]=i,n.addEventListener("dispose",w)),s=i}if(s.visible=n.visible,s.wireframe=n.wireframe,s.side=3===i?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],s.alphaMap=n.alphaMap,s.alphaTest=n.alphaTest,s.map=n.map,s.clipShadows=n.clipShadows,s.clippingPlanes=n.clippingPlanes,s.clipIntersection=n.clipIntersection,s.displacementMap=n.displacementMap,s.displacementScale=n.displacementScale,s.displacementBias=n.displacementBias,s.wireframeLinewidth=n.wireframeLinewidth,s.linewidth=n.linewidth,!0===r.isPointLight&&!0===s.isMeshDistanceMaterial){e.properties.get(s).light=r}return s}function T(n,i,s,a,o){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===o)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const r=t.update(n),l=n.material;if(Array.isArray(l)){const t=r.groups;for(let u=0,c=t.length;u<c;u++){const c=t[u],d=l[c.materialIndex];if(d&&d.visible){const t=S(n,d,a,o);n.onBeforeShadow(e,n,i,s,r,t,c),e.renderBufferDirect(s,null,r,t,n,c),n.onAfterShadow(e,n,i,s,r,t,c)}}}else if(l.visible){const t=S(n,l,a,o);n.onBeforeShadow(e,n,i,s,r,t,null),e.renderBufferDirect(s,null,r,t,n,null),n.onAfterShadow(e,n,i,s,r,t,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)T(l[e],i,s,a,o)}function w(e){e.target.removeEventListener("dispose",w);for(const t in u){const n=u[t],r=e.target.uuid;if(r in n){n[r].dispose(),delete n[r]}}}this.render=function(t,n,o){if(!1===_.enabled)return;if(!1===_.autoUpdate&&!1===_.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),u=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),h=e.state;h.setBlending(0),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);const p=3!==x&&3===this.type,f=3===x&&3!==this.type;for(let l=0,u=t.length;l<u;l++){const u=t[l],d=u.shadow;if(void 0===d)continue;if(!1===d.autoUpdate&&!1===d.needsUpdate)continue;i.copy(d.mapSize);const m=d.getFrameExtents();if(i.multiply(m),s.copy(d.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(s.x=Math.floor(c/m.x),i.x=s.x*m.x,d.mapSize.x=s.x),i.y>c&&(s.y=Math.floor(c/m.y),i.y=s.y*m.y,d.mapSize.y=s.y)),null===d.map||!0===p||!0===f){const e=3!==this.type?{minFilter:J,magFilter:J}:{};null!==d.map&&d.map.dispose(),d.map=new _n(i.x,i.y,e),d.map.texture.name=u.name+".shadowMap",d.camera.updateProjectionMatrix()}e.setRenderTarget(d.map),e.clear();const g=d.getViewportCount();for(let e=0;e<g;e++){const t=d.getViewport(e);a.set(s.x*t.x,s.y*t.y,s.x*t.z,s.y*t.w),h.viewport(a),d.updateMatrices(u,e),r=d.getFrustum(),T(n,o,d.camera,u,this.type)}!0!==d.isPointLightShadow&&3===this.type&&b(d,o),d.needsUpdate=!1}x=this.type,_.needsUpdate=!1,e.setRenderTarget(l,u,d)}}const Jh={[U]:1,[F]:6,[O]:7,[B]:5,[D]:0,[z]:2,[V]:4,[k]:3};function ep(e,t){const n=new function(){let t=!1;const n=new vn;let r=null;const i=new vn(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,s,a,o){!0===o&&(t*=a,r*=a,s*=a),n.set(t,r,s,a),!1===i.equals(n)&&(e.clearColor(t,r,s,a),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},r=new function(){let n=!1,r=!1,i=null,s=null,a=null;return{setReversed:function(e){if(r!==e){const e=t.get("EXT_clip_control");r?e.clipControlEXT(e.LOWER_LEFT_EXT,e.ZERO_TO_ONE_EXT):e.clipControlEXT(e.LOWER_LEFT_EXT,e.NEGATIVE_ONE_TO_ONE_EXT);const n=a;a=null,this.setClear(n)}r=e},getReversed:function(){return r},setTest:function(t){t?ie(e.DEPTH_TEST):se(e.DEPTH_TEST)},setMask:function(t){i===t||n||(e.depthMask(t),i=t)},setFunc:function(t){if(r&&(t=Jh[t]),s!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}s=t}},setLocked:function(e){n=e},setClear:function(t){a!==t&&(r&&(t=1-t),e.clearDepth(t),a=t)},reset:function(){n=!1,i=null,s=null,a=null,r=!1}}},i=new function(){let t=!1,n=null,r=null,i=null,s=null,a=null,o=null,l=null,u=null;return{setTest:function(n){t||(n?ie(e.STENCIL_TEST):se(e.STENCIL_TEST))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,a){r===t&&i===n&&s===a||(e.stencilFunc(t,n,a),r=t,i=n,s=a)},setOp:function(t,n,r){a===t&&o===n&&l===r||(e.stencilOp(t,n,r),a=t,o=n,l=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,r=null,i=null,s=null,a=null,o=null,l=null,u=null}}},s=new WeakMap,a=new WeakMap;let o={},l={},u=new WeakMap,c=[],d=null,h=!1,p=null,f=null,m=null,U=null,D=null,F=null,B=null,O=new jr(0,0,0),k=0,z=!1,V=null,G=null,H=null,W=null,j=null;const q=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let X=!1,$=0;const Y=e.getParameter(e.VERSION);-1!==Y.indexOf("WebGL")?($=parseFloat(/^WebGL (\d)/.exec(Y)[1]),X=$>=1):-1!==Y.indexOf("OpenGL ES")&&($=parseFloat(/^OpenGL ES (\d)/.exec(Y)[1]),X=$>=2);let K=null,Q={};const Z=e.getParameter(e.SCISSOR_BOX),J=e.getParameter(e.VIEWPORT),ee=(new vn).fromArray(Z),te=(new vn).fromArray(J);function ne(t,n,r,i){const s=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let a=0;a<r;a++)t===e.TEXTURE_3D||t===e.TEXTURE_2D_ARRAY?e.texImage3D(n,0,e.RGBA,1,1,i,0,e.RGBA,e.UNSIGNED_BYTE,s):e.texImage2D(n+a,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s);return a}const re={};function ie(t){!0!==o[t]&&(e.enable(t),o[t]=!0)}function se(t){!1!==o[t]&&(e.disable(t),o[t]=!1)}re[e.TEXTURE_2D]=ne(e.TEXTURE_2D,e.TEXTURE_2D,1),re[e.TEXTURE_CUBE_MAP]=ne(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),re[e.TEXTURE_2D_ARRAY]=ne(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),re[e.TEXTURE_3D]=ne(e.TEXTURE_3D,e.TEXTURE_3D,1,1),n.setClear(0,0,0,1),r.setClear(1),i.setClear(0),ie(e.DEPTH_TEST),r.setFunc(3),ue(!1),ce(1),ie(e.CULL_FACE),le(0);const ae={[g]:e.FUNC_ADD,[v]:e.FUNC_SUBTRACT,[y]:e.FUNC_REVERSE_SUBTRACT};ae[103]=e.MIN,ae[104]=e.MAX;const oe={[_]:e.ZERO,[x]:e.ONE,[b]:e.SRC_COLOR,[T]:e.SRC_ALPHA,[R]:e.SRC_ALPHA_SATURATE,[A]:e.DST_COLOR,[M]:e.DST_ALPHA,[S]:e.ONE_MINUS_SRC_COLOR,[w]:e.ONE_MINUS_SRC_ALPHA,[C]:e.ONE_MINUS_DST_COLOR,[E]:e.ONE_MINUS_DST_ALPHA,[N]:e.CONSTANT_COLOR,[P]:e.ONE_MINUS_CONSTANT_COLOR,[I]:e.CONSTANT_ALPHA,[L]:e.ONE_MINUS_CONSTANT_ALPHA};function le(t,n,r,i,s,a,o,l,u,c){if(0!==t){if(!1===h&&(ie(e.BLEND),h=!0),5===t)s=s||n,a=a||r,o=o||i,n===f&&s===D||(e.blendEquationSeparate(ae[n],ae[s]),f=n,D=s),r===m&&i===U&&a===F&&o===B||(e.blendFuncSeparate(oe[r],oe[i],oe[a],oe[o]),m=r,U=i,F=a,B=o),!1!==l.equals(O)&&u===k||(e.blendColor(l.r,l.g,l.b,u),O.copy(l),k=u),p=t,z=!1;else if(t!==p||c!==z){if(f===g&&D===g||(e.blendEquation(e.FUNC_ADD),f=g,D=g),c)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR)}m=null,U=null,F=null,B=null,O.set(0,0,0),k=0,p=t,z=c}}else!0===h&&(se(e.BLEND),h=!1)}function ue(t){V!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),V=t)}function ce(t){0!==t?(ie(e.CULL_FACE),t!==G&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):se(e.CULL_FACE),G=t}function de(t,n,r){t?(ie(e.POLYGON_OFFSET_FILL),W===n&&j===r||(e.polygonOffset(n,r),W=n,j=r)):se(e.POLYGON_OFFSET_FILL)}return{buffers:{color:n,depth:r,stencil:i},enable:ie,disable:se,bindFramebuffer:function(t,n){return l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,t===e.DRAW_FRAMEBUFFER&&(l[e.FRAMEBUFFER]=n),t===e.FRAMEBUFFER&&(l[e.DRAW_FRAMEBUFFER]=n),!0)},drawBuffers:function(t,n){let r=c,i=!1;if(t){r=u.get(n),void 0===r&&(r=[],u.set(n,r));const s=t.textures;if(r.length!==s.length||r[0]!==e.COLOR_ATTACHMENT0){for(let t=0,n=s.length;t<n;t++)r[t]=e.COLOR_ATTACHMENT0+t;r.length=s.length,i=!0}}else r[0]!==e.BACK&&(r[0]=e.BACK,i=!0);i&&e.drawBuffers(r)},useProgram:function(t){return d!==t&&(e.useProgram(t),d=t,!0)},setBlending:le,setMaterial:function(t,s){2===t.side?se(e.CULL_FACE):ie(e.CULL_FACE);let a=1===t.side;s&&(a=!a),ue(a),1===t.blending&&!1===t.transparent?le(0):le(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.blendColor,t.blendAlpha,t.premultipliedAlpha),r.setFunc(t.depthFunc),r.setTest(t.depthTest),r.setMask(t.depthWrite),n.setMask(t.colorWrite);const o=t.stencilWrite;i.setTest(o),o&&(i.setMask(t.stencilWriteMask),i.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),i.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),de(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?ie(e.SAMPLE_ALPHA_TO_COVERAGE):se(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:ue,setCullFace:ce,setLineWidth:function(t){t!==H&&(X&&e.lineWidth(t),H=t)},setPolygonOffset:de,setScissorTest:function(t){t?ie(e.SCISSOR_TEST):se(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+q-1),K!==t&&(e.activeTexture(t),K=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===K?e.TEXTURE0+q-1:K);let i=Q[r];void 0===i&&(i={type:void 0,texture:void 0},Q[r]=i),i.type===t&&i.texture===n||(K!==r&&(e.activeTexture(r),K=r),e.bindTexture(t,n||re[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=Q[K];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D(...arguments)}catch(e){}},compressedTexImage3D:function(){try{e.compressedTexImage3D(...arguments)}catch(e){}},texImage2D:function(){try{e.texImage2D(...arguments)}catch(e){}},texImage3D:function(){try{e.texImage3D(...arguments)}catch(e){}},updateUBOMapping:function(t,n){let r=a.get(n);void 0===r&&(r=new WeakMap,a.set(n,r));let i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){const r=a.get(n).get(t);s.get(n)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),s.set(n,r))},texStorage2D:function(){try{e.texStorage2D(...arguments)}catch(e){}},texStorage3D:function(){try{e.texStorage3D(...arguments)}catch(e){}},texSubImage2D:function(){try{e.texSubImage2D(...arguments)}catch(e){}},texSubImage3D:function(){try{e.texSubImage3D(...arguments)}catch(e){}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D(...arguments)}catch(e){}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D(...arguments)}catch(e){}},scissor:function(t){!1===ee.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),ee.copy(t))},viewport:function(t){!1===te.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),te.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.blendColor(0,0,0,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),r.setReversed(!1),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),o={},K=null,Q={},l={},u=new WeakMap,c=[],d=null,h=!1,p=null,f=null,m=null,U=null,D=null,F=null,B=null,O=new jr(0,0,0),k=0,z=!1,V=null,G=null,H=null,W=null,j=null,ee.set(0,0,e.canvas.width,e.canvas.height),te.set(0,0,e.canvas.width,e.canvas.height),n.reset(),r.reset(),i.reset()}}}function tp(e,t,n,r,i,s,a){const o=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),u=new Xt,c=new WeakMap;let d;const h=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function f(e,t){return p?new OffscreenCanvas(e,t):Jt("canvas")}function m(e,t,n){let r=1;const i=V(e);if((i.width>n||i.height>n)&&(r=n/Math.max(i.width,i.height)),r<1){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame){const n=Math.floor(r*i.width),s=Math.floor(r*i.height);void 0===d&&(d=f(n,s));const a=t?f(n,s):d;a.width=n,a.height=s;return a.getContext("2d").drawImage(e,0,0,n,s),a}return e}return e}function g(e){return e.generateMipmaps}function v(t){e.generateMipmap(t)}function y(t){return t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:t.isWebGL3DRenderTarget?e.TEXTURE_3D:t.isWebGLArrayRenderTarget||t.isCompressedArrayTexture?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D}function _(n,r,i,s,a=!1){if(null!==n&&void 0!==e[n])return e[n];let o=r;if(r===e.RED&&(i===e.FLOAT&&(o=e.R32F),i===e.HALF_FLOAT&&(o=e.R16F),i===e.UNSIGNED_BYTE&&(o=e.R8)),r===e.RED_INTEGER&&(i===e.UNSIGNED_BYTE&&(o=e.R8UI),i===e.UNSIGNED_SHORT&&(o=e.R16UI),i===e.UNSIGNED_INT&&(o=e.R32UI),i===e.BYTE&&(o=e.R8I),i===e.SHORT&&(o=e.R16I),i===e.INT&&(o=e.R32I)),r===e.RG&&(i===e.FLOAT&&(o=e.RG32F),i===e.HALF_FLOAT&&(o=e.RG16F),i===e.UNSIGNED_BYTE&&(o=e.RG8)),r===e.RG_INTEGER&&(i===e.UNSIGNED_BYTE&&(o=e.RG8UI),i===e.UNSIGNED_SHORT&&(o=e.RG16UI),i===e.UNSIGNED_INT&&(o=e.RG32UI),i===e.BYTE&&(o=e.RG8I),i===e.SHORT&&(o=e.RG16I),i===e.INT&&(o=e.RG32I)),r===e.RGB_INTEGER&&(i===e.UNSIGNED_BYTE&&(o=e.RGB8UI),i===e.UNSIGNED_SHORT&&(o=e.RGB16UI),i===e.UNSIGNED_INT&&(o=e.RGB32UI),i===e.BYTE&&(o=e.RGB8I),i===e.SHORT&&(o=e.RGB16I),i===e.INT&&(o=e.RGB32I)),r===e.RGBA_INTEGER&&(i===e.UNSIGNED_BYTE&&(o=e.RGBA8UI),i===e.UNSIGNED_SHORT&&(o=e.RGBA16UI),i===e.UNSIGNED_INT&&(o=e.RGBA32UI),i===e.BYTE&&(o=e.RGBA8I),i===e.SHORT&&(o=e.RGBA16I),i===e.INT&&(o=e.RGBA32I)),r===e.RGB&&i===e.UNSIGNED_INT_5_9_9_9_REV&&(o=e.RGB9_E5),r===e.RGBA){const t=a?yt:on.getTransfer(s);i===e.FLOAT&&(o=e.RGBA32F),i===e.HALF_FLOAT&&(o=e.RGBA16F),i===e.UNSIGNED_BYTE&&(o=t===_t?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)}return o!==e.R16F&&o!==e.R32F&&o!==e.RG16F&&o!==e.RG32F&&o!==e.RGBA16F&&o!==e.RGBA32F||t.get("EXT_color_buffer_float"),o}function x(t,n){let r;return t?null===n||n===ce||n===me?r=e.DEPTH24_STENCIL8:n===de?r=e.DEPTH32F_STENCIL8:n===le&&(r=e.DEPTH24_STENCIL8):null===n||n===ce||n===me?r=e.DEPTH_COMPONENT24:n===de?r=e.DEPTH_COMPONENT32F:n===le&&(r=e.DEPTH_COMPONENT16),r}function b(e,t){return!0===g(e)||e.isFramebufferTexture&&e.minFilter!==J&&e.minFilter!==ne?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function S(e){const t=e.target;t.removeEventListener("dispose",S),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=h.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&w(e),0===Object.keys(i).length&&h.delete(n)}r.remove(e)}(t),t.isVideoTexture&&c.delete(t)}function T(t){const n=t.target;n.removeEventListener("dispose",T),function(t){const n=r.get(t);t.depthTexture&&(t.depthTexture.dispose(),r.remove(t.depthTexture));if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(n.__webglFramebuffer[t]))for(let r=0;r<n.__webglFramebuffer[t].length;r++)e.deleteFramebuffer(n.__webglFramebuffer[t][r]);else e.deleteFramebuffer(n.__webglFramebuffer[t]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}const i=t.textures;for(let t=0,n=i.length;t<n;t++){const n=r.get(i[t]);n.__webglTexture&&(e.deleteTexture(n.__webglTexture),a.memory.textures--),r.remove(i[t])}r.remove(t)}(n)}function w(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete h.get(i)[n.__cacheKey],a.memory.textures--}let M=0;function E(t,i){const s=r.get(t);if(t.isVideoTexture&&function(e){const t=a.render.frame;c.get(e)!==t&&(c.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version){const e=t.image;if(null===e);else if(!1!==e.complete)return void I(s,t,i)}n.bindTexture(e.TEXTURE_2D,s.__webglTexture,e.TEXTURE0+i)}const A={[K]:e.REPEAT,[Q]:e.CLAMP_TO_EDGE,[Z]:e.MIRRORED_REPEAT},C={[J]:e.NEAREST,[ee]:e.NEAREST_MIPMAP_NEAREST,[te]:e.NEAREST_MIPMAP_LINEAR,[ne]:e.LINEAR,[re]:e.LINEAR_MIPMAP_NEAREST,[ie]:e.LINEAR_MIPMAP_LINEAR},R={[St]:e.NEVER,[Rt]:e.ALWAYS,[Tt]:e.LESS,[Mt]:e.LEQUAL,[wt]:e.EQUAL,[Ct]:e.GEQUAL,[Et]:e.GREATER,[At]:e.NOTEQUAL};function N(n,s){if(s.type===de&&!1===t.has("OES_texture_float_linear")&&(s.magFilter===ne||s.magFilter===re||s.magFilter===te||s.magFilter===ie||s.minFilter===ne||s.minFilter===re||s.minFilter===te||s.minFilter),e.texParameteri(n,e.TEXTURE_WRAP_S,A[s.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,A[s.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,A[s.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,C[s.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,C[s.minFilter]),s.compareFunction&&(e.texParameteri(n,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(n,e.TEXTURE_COMPARE_FUNC,R[s.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){if(s.magFilter===J)return;if(s.minFilter!==te&&s.minFilter!==ie)return;if(s.type===de&&!1===t.has("OES_texture_float_linear"))return;if(s.anisotropy>1||r.get(s).__currentAnisotropy){const a=t.get("EXT_texture_filter_anisotropic");e.texParameterf(n,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,i.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy}}}function P(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",S));const i=n.source;let s=h.get(i);void 0===s&&(s={},h.set(i,s));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(n);if(o!==t.__cacheKey){void 0===s[o]&&(s[o]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,r=!0),s[o].usedTimes++;const i=s[t.__cacheKey];void 0!==i&&(s[t.__cacheKey].usedTimes--,0===i.usedTimes&&w(n)),t.__cacheKey=o,t.__webglTexture=s[o].texture}return r}function I(t,a,o){let l=e.TEXTURE_2D;(a.isDataArrayTexture||a.isCompressedArrayTexture)&&(l=e.TEXTURE_2D_ARRAY),a.isData3DTexture&&(l=e.TEXTURE_3D);const u=P(t,a),c=a.source;n.bindTexture(l,t.__webglTexture,e.TEXTURE0+o);const d=r.get(c);if(c.version!==d.__version||!0===u){n.activeTexture(e.TEXTURE0+o);const t=on.getPrimaries(on.workingColorSpace),r=a.colorSpace===mt?null:on.getPrimaries(a.colorSpace),h=a.colorSpace===mt||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,h);let p=m(a.image,!1,i.maxTextureSize);p=z(a,p);const f=s.convert(a.format,a.colorSpace),y=s.convert(a.type);let S,T=_(a.internalFormat,f,y,a.colorSpace,a.isVideoTexture);N(l,a);const w=a.mipmaps,M=!0!==a.isVideoTexture,E=void 0===d.__version||!0===u,A=c.dataReady,C=b(a,p);if(a.isDepthTexture)T=x(a.format===Te,a.type),E&&(M?n.texStorage2D(e.TEXTURE_2D,1,T,p.width,p.height):n.texImage2D(e.TEXTURE_2D,0,T,p.width,p.height,0,f,y,null));else if(a.isDataTexture)if(w.length>0){M&&E&&n.texStorage2D(e.TEXTURE_2D,C,T,w[0].width,w[0].height);for(let t=0,r=w.length;t<r;t++)S=w[t],M?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,f,y,S.data):n.texImage2D(e.TEXTURE_2D,t,T,S.width,S.height,0,f,y,S.data);a.generateMipmaps=!1}else M?(E&&n.texStorage2D(e.TEXTURE_2D,C,T,p.width,p.height),A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,p.width,p.height,f,y,p.data)):n.texImage2D(e.TEXTURE_2D,0,T,p.width,p.height,0,f,y,p.data);else if(a.isCompressedTexture)if(a.isCompressedArrayTexture){M&&E&&n.texStorage3D(e.TEXTURE_2D_ARRAY,C,T,w[0].width,w[0].height,p.depth);for(let t=0,r=w.length;t<r;t++)if(S=w[t],a.format!==_e){if(null!==f)if(M){if(A)if(a.layerUpdates.size>0){const r=Ec(S.width,S.height,a.format,a.type);for(const i of a.layerUpdates){const s=S.data.subarray(i*r/S.data.BYTES_PER_ELEMENT,(i+1)*r/S.data.BYTES_PER_ELEMENT);n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,i,S.width,S.height,1,f,s)}a.clearLayerUpdates()}else n.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,p.depth,f,S.data)}else n.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,T,S.width,S.height,p.depth,0,S.data,0,0)}else M?A&&n.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,S.width,S.height,p.depth,f,y,S.data):n.texImage3D(e.TEXTURE_2D_ARRAY,t,T,S.width,S.height,p.depth,0,f,y,S.data)}else{M&&E&&n.texStorage2D(e.TEXTURE_2D,C,T,w[0].width,w[0].height);for(let t=0,r=w.length;t<r;t++)S=w[t],a.format!==_e?null!==f&&(M?A&&n.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,f,S.data):n.compressedTexImage2D(e.TEXTURE_2D,t,T,S.width,S.height,0,S.data)):M?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,S.width,S.height,f,y,S.data):n.texImage2D(e.TEXTURE_2D,t,T,S.width,S.height,0,f,y,S.data)}else if(a.isDataArrayTexture)if(M){if(E&&n.texStorage3D(e.TEXTURE_2D_ARRAY,C,T,p.width,p.height,p.depth),A)if(a.layerUpdates.size>0){const t=Ec(p.width,p.height,a.format,a.type);for(const r of a.layerUpdates){const i=p.data.subarray(r*t/p.data.BYTES_PER_ELEMENT,(r+1)*t/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,r,p.width,p.height,1,f,y,i)}a.clearLayerUpdates()}else n.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,f,y,p.data)}else n.texImage3D(e.TEXTURE_2D_ARRAY,0,T,p.width,p.height,p.depth,0,f,y,p.data);else if(a.isData3DTexture)M?(E&&n.texStorage3D(e.TEXTURE_3D,C,T,p.width,p.height,p.depth),A&&n.texSubImage3D(e.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,f,y,p.data)):n.texImage3D(e.TEXTURE_3D,0,T,p.width,p.height,p.depth,0,f,y,p.data);else if(a.isFramebufferTexture){if(E)if(M)n.texStorage2D(e.TEXTURE_2D,C,T,p.width,p.height);else{let t=p.width,r=p.height;for(let i=0;i<C;i++)n.texImage2D(e.TEXTURE_2D,i,T,t,r,0,f,y,null),t>>=1,r>>=1}}else if(w.length>0){if(M&&E){const t=V(w[0]);n.texStorage2D(e.TEXTURE_2D,C,T,t.width,t.height)}for(let t=0,r=w.length;t<r;t++)S=w[t],M?A&&n.texSubImage2D(e.TEXTURE_2D,t,0,0,f,y,S):n.texImage2D(e.TEXTURE_2D,t,T,f,y,S);a.generateMipmaps=!1}else if(M){if(E){const t=V(p);n.texStorage2D(e.TEXTURE_2D,C,T,t.width,t.height)}A&&n.texSubImage2D(e.TEXTURE_2D,0,0,0,f,y,p)}else n.texImage2D(e.TEXTURE_2D,0,T,f,y,p);g(a)&&v(l),d.__version=c.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}function L(t,i,a,l,u,c){const d=s.convert(a.format,a.colorSpace),h=s.convert(a.type),p=_(a.internalFormat,d,h,a.colorSpace),f=r.get(i),m=r.get(a);if(m.__renderTarget=i,!f.__hasExternalTextures){const t=Math.max(1,i.width>>c),r=Math.max(1,i.height>>c);u===e.TEXTURE_3D||u===e.TEXTURE_2D_ARRAY?n.texImage3D(u,c,p,t,r,i.depth,0,d,h,null):n.texImage2D(u,c,p,t,r,0,d,h,null)}n.bindFramebuffer(e.FRAMEBUFFER,t),k(i)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,l,u,m.__webglTexture,0,O(i)):(u===e.TEXTURE_2D||u>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&u<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,l,u,m.__webglTexture,c),n.bindFramebuffer(e.FRAMEBUFFER,null)}function U(t,n,r){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer){const i=n.depthTexture,s=i&&i.isDepthTexture?i.type:null,a=x(n.stencilBuffer,s),l=n.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=O(n);k(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,a,n.width,n.height):r?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,a,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,a,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,t)}else{const t=n.textures;for(let i=0;i<t.length;i++){const a=t[i],l=s.convert(a.format,a.colorSpace),u=s.convert(a.type),c=_(a.internalFormat,l,u,a.colorSpace),d=O(n);r&&!1===k(n)?e.renderbufferStorageMultisample(e.RENDERBUFFER,d,c,n.width,n.height):k(n)?o.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,d,c,n.width,n.height):e.renderbufferStorage(e.RENDERBUFFER,c,n.width,n.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function D(t){const i=r.get(t),s=!0===t.isWebGLCubeRenderTarget;if(i.__boundDepthTexture!==t.depthTexture){const e=t.depthTexture;if(i.__depthDisposeCallback&&i.__depthDisposeCallback(),e){const t=()=>{delete i.__boundDepthTexture,delete i.__depthDisposeCallback,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t),i.__depthDisposeCallback=t}i.__boundDepthTexture=e}if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const s=r.get(i.depthTexture);s.__renderTarget=i,s.__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),E(i.depthTexture,0);const a=s.__webglTexture,l=O(i);if(i.depthTexture.format===Se)k(i)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else{if(i.depthTexture.format!==Te)throw new Error("Unknown depthTexture format");k(i)?o.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0,l):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}}(i.__webglFramebuffer,t)}else if(s){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)if(n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[r]),void 0===i.__webglDepthbuffer[r])i.__webglDepthbuffer[r]=e.createRenderbuffer(),U(i.__webglDepthbuffer[r],t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,s=i.__webglDepthbuffer[r];e.bindRenderbuffer(e.RENDERBUFFER,s),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,s)}}else if(n.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),void 0===i.__webglDepthbuffer)i.__webglDepthbuffer=e.createRenderbuffer(),U(i.__webglDepthbuffer,t,!1);else{const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,r=i.__webglDepthbuffer;e.bindRenderbuffer(e.RENDERBUFFER,r),e.framebufferRenderbuffer(e.FRAMEBUFFER,n,e.RENDERBUFFER,r)}n.bindFramebuffer(e.FRAMEBUFFER,null)}const F=[],B=[];function O(e){return Math.min(i.maxSamples,e.samples)}function k(e){const n=r.get(e);return e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function z(e,t){const n=e.colorSpace;e.format,e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||n!==vt&&n!==mt&&on.getTransfer(n),t}function V(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?(u.width=e.naturalWidth||e.width,u.height=e.naturalHeight||e.height):"undefined"!=typeof VideoFrame&&e instanceof VideoFrame?(u.width=e.displayWidth,u.height=e.displayHeight):(u.width=e.width,u.height=e.height),u}this.allocateTextureUnit=function(){const e=M;return i.maxTextures,M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=E,this.setTexture2DArray=function(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?I(s,t,i):n.bindTexture(e.TEXTURE_2D_ARRAY,s.__webglTexture,e.TEXTURE0+i)},this.setTexture3D=function(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?I(s,t,i):n.bindTexture(e.TEXTURE_3D,s.__webglTexture,e.TEXTURE0+i)},this.setTextureCube=function(t,a){const o=r.get(t);t.version>0&&o.__version!==t.version?function(t,a,o){if(6!==a.image.length)return;const l=P(t,a),u=a.source;n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture,e.TEXTURE0+o);const c=r.get(u);if(u.version!==c.__version||!0===l){n.activeTexture(e.TEXTURE0+o);const t=on.getPrimaries(on.workingColorSpace),r=a.colorSpace===mt?null:on.getPrimaries(a.colorSpace),d=a.colorSpace===mt||t===r?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,a.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,a.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);const h=a.isCompressedTexture||a.image[0].isCompressedTexture,p=a.image[0]&&a.image[0].isDataTexture,f=[];for(let e=0;e<6;e++)f[e]=h||p?p?a.image[e].image:a.image[e]:m(a.image[e],!0,i.maxCubemapSize),f[e]=z(a,f[e]);const y=f[0],x=s.convert(a.format,a.colorSpace),S=s.convert(a.type),T=_(a.internalFormat,x,S,a.colorSpace),w=!0!==a.isVideoTexture,M=void 0===c.__version||!0===l,E=u.dataReady;let A,C=b(a,y);if(N(e.TEXTURE_CUBE_MAP,a),h){w&&M&&n.texStorage2D(e.TEXTURE_CUBE_MAP,C,T,y.width,y.height);for(let t=0;t<6;t++){A=f[t].mipmaps;for(let r=0;r<A.length;r++){const i=A[r];a.format!==_e?null!==x&&(w?E&&n.compressedTexSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,x,i.data):n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,T,i.width,i.height,0,i.data)):w?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,0,0,i.width,i.height,x,S,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r,T,i.width,i.height,0,x,S,i.data)}}}else{if(A=a.mipmaps,w&&M){A.length>0&&C++;const t=V(f[0]);n.texStorage2D(e.TEXTURE_CUBE_MAP,C,T,t.width,t.height)}for(let t=0;t<6;t++)if(p){w?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,f[t].width,f[t].height,x,S,f[t].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,T,f[t].width,f[t].height,0,x,S,f[t].data);for(let r=0;r<A.length;r++){const i=A[r].image[t].image;w?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,i.width,i.height,x,S,i.data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,T,i.width,i.height,0,x,S,i.data)}}else{w?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,x,S,f[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,T,x,S,f[t]);for(let r=0;r<A.length;r++){const i=A[r];w?E&&n.texSubImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,0,0,x,S,i.image[t]):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,r+1,T,x,S,i.image[t])}}}g(a)&&v(e.TEXTURE_CUBE_MAP),c.__version=u.version,a.onUpdate&&a.onUpdate(a)}t.__version=a.version}(o,t,a):n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture,e.TEXTURE0+a)},this.rebindTextures=function(t,n,i){const s=r.get(t);void 0!==n&&L(s.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==i&&D(t)},this.setupRenderTarget=function(t){const i=t.texture,o=r.get(t),l=r.get(i);t.addEventListener("dispose",T);const u=t.textures,c=!0===t.isWebGLCubeRenderTarget,d=u.length>1;if(d||(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=i.version,a.memory.textures++),c){o.__webglFramebuffer=[];for(let t=0;t<6;t++)if(i.mipmaps&&i.mipmaps.length>0){o.__webglFramebuffer[t]=[];for(let n=0;n<i.mipmaps.length;n++)o.__webglFramebuffer[t][n]=e.createFramebuffer()}else o.__webglFramebuffer[t]=e.createFramebuffer()}else{if(i.mipmaps&&i.mipmaps.length>0){o.__webglFramebuffer=[];for(let t=0;t<i.mipmaps.length;t++)o.__webglFramebuffer[t]=e.createFramebuffer()}else o.__webglFramebuffer=e.createFramebuffer();if(d)for(let t=0,n=u.length;t<n;t++){const n=r.get(u[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),a.memory.textures++)}if(t.samples>0&&!1===k(t)){o.__webglMultisampledFramebuffer=e.createFramebuffer(),o.__webglColorRenderbuffer=[],n.bindFramebuffer(e.FRAMEBUFFER,o.__webglMultisampledFramebuffer);for(let n=0;n<u.length;n++){const r=u[n];o.__webglColorRenderbuffer[n]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,o.__webglColorRenderbuffer[n]);const i=s.convert(r.format,r.colorSpace),a=s.convert(r.type),l=_(r.internalFormat,i,a,r.colorSpace,!0===t.isXRRenderTarget),c=O(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,c,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+n,e.RENDERBUFFER,o.__webglColorRenderbuffer[n])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(o.__webglDepthRenderbuffer=e.createRenderbuffer(),U(o.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}}if(c){n.bindTexture(e.TEXTURE_CUBE_MAP,l.__webglTexture),N(e.TEXTURE_CUBE_MAP,i);for(let n=0;n<6;n++)if(i.mipmaps&&i.mipmaps.length>0)for(let r=0;r<i.mipmaps.length;r++)L(o.__webglFramebuffer[n][r],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,r);else L(o.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0);g(i)&&v(e.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(d){for(let i=0,s=u.length;i<s;i++){const s=u[i],a=r.get(s);n.bindTexture(e.TEXTURE_2D,a.__webglTexture),N(e.TEXTURE_2D,s),L(o.__webglFramebuffer,t,s,e.COLOR_ATTACHMENT0+i,e.TEXTURE_2D,0),g(s)&&v(e.TEXTURE_2D)}n.unbindTexture()}else{let r=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(r=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY),n.bindTexture(r,l.__webglTexture),N(r,i),i.mipmaps&&i.mipmaps.length>0)for(let n=0;n<i.mipmaps.length;n++)L(o.__webglFramebuffer[n],t,i,e.COLOR_ATTACHMENT0,r,n);else L(o.__webglFramebuffer,t,i,e.COLOR_ATTACHMENT0,r,0);g(i)&&v(r),n.unbindTexture()}t.depthBuffer&&D(t)},this.updateRenderTargetMipmap=function(e){const t=e.textures;for(let i=0,s=t.length;i<s;i++){const s=t[i];if(g(s)){const t=y(e),i=r.get(s).__webglTexture;n.bindTexture(t,i),v(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.samples>0)if(!1===k(t)){const i=t.textures,s=t.width,a=t.height;let o=e.COLOR_BUFFER_BIT;const u=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,c=r.get(t),d=i.length>1;if(d)for(let t=0;t<i.length;t++)n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),n.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);n.bindFramebuffer(e.READ_FRAMEBUFFER,c.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglFramebuffer);for(let n=0;n<i.length;n++){if(t.resolveDepthBuffer&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&t.resolveStencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),d){e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,c.__webglColorRenderbuffer[n]);const t=r.get(i[n]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,s,a,0,0,s,a,o,e.NEAREST),!0===l&&(F.length=0,B.length=0,F.push(e.COLOR_ATTACHMENT0+n),t.depthBuffer&&!1===t.resolveDepthBuffer&&(F.push(u),B.push(u),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,B)),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,F))}if(n.bindFramebuffer(e.READ_FRAMEBUFFER,null),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),d)for(let t=0;t<i.length;t++){n.bindFramebuffer(e.FRAMEBUFFER,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,c.__webglColorRenderbuffer[t]);const s=r.get(i[t]).__webglTexture;n.bindFramebuffer(e.FRAMEBUFFER,c.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,s,0)}n.bindFramebuffer(e.DRAW_FRAMEBUFFER,c.__webglMultisampledFramebuffer)}else if(t.depthBuffer&&!1===t.resolveDepthBuffer&&l){const n=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[n])}},this.setupDepthRenderbuffer=D,this.setupFrameBufferTexture=L,this.useMultisampledRTT=k}function np(e,t){return{convert:function(n,r=""){let i;const s=on.getTransfer(r);if(n===se)return e.UNSIGNED_BYTE;if(n===pe)return e.UNSIGNED_SHORT_4_4_4_4;if(n===fe)return e.UNSIGNED_SHORT_5_5_5_1;if(n===ge)return e.UNSIGNED_INT_5_9_9_9_REV;if(n===ae)return e.BYTE;if(n===oe)return e.SHORT;if(n===le)return e.UNSIGNED_SHORT;if(n===ue)return e.INT;if(n===ce)return e.UNSIGNED_INT;if(n===de)return e.FLOAT;if(n===he)return e.HALF_FLOAT;if(n===ve)return e.ALPHA;if(n===ye)return e.RGB;if(n===_e)return e.RGBA;if(n===xe)return e.LUMINANCE;if(n===be)return e.LUMINANCE_ALPHA;if(n===Se)return e.DEPTH_COMPONENT;if(n===Te)return e.DEPTH_STENCIL;if(n===we)return e.RED;if(n===Me)return e.RED_INTEGER;if(n===Ee)return e.RG;if(n===Ae)return e.RG_INTEGER;if(n===Ce)return e.RGBA_INTEGER;if(n===Re||n===Ne||n===Pe||n===Ie)if(s===_t){if(i=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(n===Re)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Ne)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Pe)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Ie)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(n===Re)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Ne)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Pe)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Ie)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Le||n===Ue||n===De||n===Fe){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(n===Le)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Ue)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===De)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Fe)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===Be||n===Oe||n===ke){if(i=t.get("WEBGL_compressed_texture_etc"),null===i)return null;if(n===Be||n===Oe)return s===_t?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===ke)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(n===ze||n===Ve||n===Ge||n===He||n===We||n===je||n===qe||n===Xe||n===$e||n===Ye||n===Ke||n===Qe||n===Ze||n===Je){if(i=t.get("WEBGL_compressed_texture_astc"),null===i)return null;if(n===ze)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Ve)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Ge)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===He)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===We)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===je)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===qe)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Xe)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===$e)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Ye)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Ke)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Qe)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===Ze)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===Je)return s===_t?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===et||n===tt||n===nt){if(i=t.get("EXT_texture_compression_bptc"),null===i)return null;if(n===et)return s===_t?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===tt)return i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===nt)return i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(n===rt||n===it||n===st||n===at){if(i=t.get("EXT_texture_compression_rgtc"),null===i)return null;if(n===et)return i.COMPRESSED_RED_RGTC1_EXT;if(n===it)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===st)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===at)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return n===me?e.UNSIGNED_INT_24_8:void 0!==e[n]?e[n]:null}}}class rp{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(null===this.texture){const r=new gn;e.properties.get(r).__webglTexture=t.texture,t.depthNear===n.depthNear&&t.depthFar===n.depthFar||(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(null!==this.texture&&null===this.mesh){const t=e.cameras[0].viewport,n=new Ui({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Ai(new Jo(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class ip extends Dt{constructor(e,t){super();const n=this;let r=null,i=1,s=null,a="local-floor",o=1,l=null,u=null,c=null,d=null,h=null,p=null;const f=new rp,m=t.getContextAttributes();let g=null,v=null;const y=[],_=[],x=new Xt;let b=null;const S=new ki;S.viewport=new vn;const T=new ki;T.viewport=new vn;const w=[S,T],M=new Ru;let E=null,A=null;function C(e){const t=_.indexOf(e.inputSource);if(-1===t)return;const n=y[t];void 0!==n&&(n.update(e.inputSource,e.frame,l||s),n.dispatchEvent({type:e.type,data:e.inputSource}))}function R(){r.removeEventListener("select",C),r.removeEventListener("selectstart",C),r.removeEventListener("selectend",C),r.removeEventListener("squeeze",C),r.removeEventListener("squeezestart",C),r.removeEventListener("squeezeend",C),r.removeEventListener("end",R),r.removeEventListener("inputsourceschange",N);for(let e=0;e<y.length;e++){const t=_[e];null!==t&&(_[e]=null,y[e].disconnect(t))}E=null,A=null,f.reset(),e.setRenderTarget(g),h=null,d=null,c=null,r=null,v=null,D.stop(),n.isPresenting=!1,e.setPixelRatio(b),e.setSize(x.width,x.height,!1),n.dispatchEvent({type:"sessionend"})}function N(e){for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=_.indexOf(n);r>=0&&(_[r]=null,y[r].disconnect(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t];let r=_.indexOf(n);if(-1===r){for(let e=0;e<y.length;e++){if(e>=_.length){_.push(n),r=e;break}if(null===_[e]){_[e]=n,r=e;break}}if(-1===r)break}const i=y[r];i&&i.connect(n)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=y[e];return void 0===t&&(t=new qi,y[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=y[e];return void 0===t&&(t=new qi,y[e]=t),t.getGripSpace()},this.getHand=function(e){let t=y[e];return void 0===t&&(t=new qi,y[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,n.isPresenting},this.setReferenceSpaceType=function(e){a=e,n.isPresenting},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(e){l=e},this.getBaseLayer=function(){return null!==d?d:h},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return r},this.setSession=async function(u){if(r=u,null!==r){g=e.getRenderTarget(),r.addEventListener("select",C),r.addEventListener("selectstart",C),r.addEventListener("selectend",C),r.addEventListener("squeeze",C),r.addEventListener("squeezestart",C),r.addEventListener("squeezeend",C),r.addEventListener("end",R),r.addEventListener("inputsourceschange",N),!0!==m.xrCompatible&&await t.makeXRCompatible(),b=e.getPixelRatio(),e.getSize(x);if("undefined"!=typeof XRWebGLBinding&&"createProjectionLayer"in XRWebGLBinding.prototype){let n=null,s=null,a=null;m.depth&&(a=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,n=m.stencil?Te:Se,s=m.stencil?me:ce);const o={colorFormat:t.RGBA8,depthFormat:a,scaleFactor:i};c=new XRWebGLBinding(r,t),d=c.createProjectionLayer(o),r.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),v=new _n(d.textureWidth,d.textureHeight,{format:_e,type:se,depthTexture:new Oa(d.textureWidth,d.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:!1===d.ignoreDepthValues,resolveStencilBuffer:!1===d.ignoreDepthValues})}else{const n={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:i};h=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:h}),e.setPixelRatio(1),e.setSize(h.framebufferWidth,h.framebufferHeight,!1),v=new _n(h.framebufferWidth,h.framebufferHeight,{format:_e,type:se,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil,resolveDepthBuffer:!1===h.ignoreDepthValues,resolveStencilBuffer:!1===h.ignoreDepthValues})}v.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(a),D.setContext(r),D.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==r)return r.environmentBlendMode},this.getDepthTexture=function(){return f.getDepthTexture()};const P=new Tn,I=new Tn;function L(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;let t=e.near,n=e.far;null!==f.texture&&(f.depthNear>0&&(t=f.depthNear),f.depthFar>0&&(n=f.depthFar)),M.near=T.near=S.near=t,M.far=T.far=S.far=n,E===M.near&&A===M.far||(r.updateRenderState({depthNear:M.near,depthFar:M.far}),E=M.near,A=M.far),S.layers.mask=2|e.layers.mask,T.layers.mask=4|e.layers.mask,M.layers.mask=S.layers.mask|T.layers.mask;const i=e.parent,s=M.cameras;L(M,i);for(let e=0;e<s.length;e++)L(s[e],i);2===s.length?function(e,t,n){P.setFromMatrixPosition(t.matrixWorld),I.setFromMatrixPosition(n.matrixWorld);const r=P.distanceTo(I),i=t.projectionMatrix.elements,s=n.projectionMatrix.elements,a=i[14]/(i[10]-1),o=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],c=(i[8]-1)/i[0],d=(s[8]+1)/s[0],h=a*c,p=a*d,f=r/(-c+d),m=f*-c;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===i[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=a+f,n=o+f,i=h-m,s=p+(r-m),c=l*o/n*t,d=u*o/n*t;e.projectionMatrix.makePerspective(i,s,c,d,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(M,S,T):M.projectionMatrix.copy(S.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*kt*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,M,i)},this.getCamera=function(){return M},this.getFoveation=function(){if(null!==d||null!==h)return o},this.setFoveation=function(e){o=e,null!==d&&(d.fixedFoveation=e),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=e)},this.hasDepthSensing=function(){return null!==f.texture},this.getDepthSensingMesh=function(){return f.getMesh(M)};let U=null;const D=new Ac;D.setAnimationLoop(function(t,i){if(u=i.getViewerPose(l||s),p=i,null!==u){const t=u.views;null!==h&&(e.setRenderTargetFramebuffer(v,h.framebuffer),e.setRenderTarget(v));let n=!1;t.length!==M.cameras.length&&(M.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r];let s=null;if(null!==h)s=h.getViewport(i);else{const t=c.getViewSubImage(d,i);s=t.viewport,0===r&&(e.setRenderTargetTextures(v,t.colorTexture,d.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(v))}let a=w[r];void 0===a&&(a=new ki,a.layers.enable(r),a.viewport=new vn,w[r]=a),a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.quaternion,a.scale),a.projectionMatrix.fromArray(i.projectionMatrix),a.projectionMatrixInverse.copy(a.projectionMatrix).invert(),a.viewport.set(s.x,s.y,s.width,s.height),0===r&&(M.matrix.copy(a.matrix),M.matrix.decompose(M.position,M.quaternion,M.scale)),!0===n&&M.cameras.push(a)}const i=r.enabledFeatures;if(i&&i.includes("depth-sensing")&&"gpu-optimized"==r.depthUsage&&c){const n=c.getDepthInformation(t[0]);n&&n.isValid&&n.texture&&f.init(e,n,r.renderState)}}for(let e=0;e<y.length;e++){const t=_[e],n=y[e];null!==t&&void 0!==n&&n.update(t,i,l||s)}U&&U(t,i),i.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:i}),p=null}),this.setAnimationLoop=function(e){U=e},this.dispose=function(){}}}const sp=new ur,ap=new Jn;function op(e,t){function n(e,t){!0===e.matrixAutoUpdate&&e.updateMatrix(),t.value.copy(e.matrix)}function r(e,r){e.opacity.value=r.opacity,r.color&&e.diffuse.value.copy(r.color),r.emissive&&e.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(e.map.value=r.map,n(r.map,e.mapTransform)),r.alphaMap&&(e.alphaMap.value=r.alphaMap,n(r.alphaMap,e.alphaMapTransform)),r.bumpMap&&(e.bumpMap.value=r.bumpMap,n(r.bumpMap,e.bumpMapTransform),e.bumpScale.value=r.bumpScale,1===r.side&&(e.bumpScale.value*=-1)),r.normalMap&&(e.normalMap.value=r.normalMap,n(r.normalMap,e.normalMapTransform),e.normalScale.value.copy(r.normalScale),1===r.side&&e.normalScale.value.negate()),r.displacementMap&&(e.displacementMap.value=r.displacementMap,n(r.displacementMap,e.displacementMapTransform),e.displacementScale.value=r.displacementScale,e.displacementBias.value=r.displacementBias),r.emissiveMap&&(e.emissiveMap.value=r.emissiveMap,n(r.emissiveMap,e.emissiveMapTransform)),r.specularMap&&(e.specularMap.value=r.specularMap,n(r.specularMap,e.specularMapTransform)),r.alphaTest>0&&(e.alphaTest.value=r.alphaTest);const i=t.get(r),s=i.envMap,a=i.envMapRotation;s&&(e.envMap.value=s,sp.copy(a),sp.x*=-1,sp.y*=-1,sp.z*=-1,s.isCubeTexture&&!1===s.isRenderTargetTexture&&(sp.y*=-1,sp.z*=-1),e.envMapRotation.value.setFromMatrix4(ap.makeRotationFromEuler(sp)),e.flipEnvMap.value=s.isCubeTexture&&!1===s.isRenderTargetTexture?-1:1,e.reflectivity.value=r.reflectivity,e.ior.value=r.ior,e.refractionRatio.value=r.refractionRatio),r.lightMap&&(e.lightMap.value=r.lightMap,e.lightMapIntensity.value=r.lightMapIntensity,n(r.lightMap,e.lightMapTransform)),r.aoMap&&(e.aoMap.value=r.aoMap,e.aoMapIntensity.value=r.aoMapIntensity,n(r.aoMap,e.aoMapTransform))}return{refreshFogUniforms:function(t,n){n.color.getRGB(t.fogColor.value,Ii(e)),n.isFog?(t.fogNear.value=n.near,t.fogFar.value=n.far):n.isFogExp2&&(t.fogDensity.value=n.density)},refreshMaterialUniforms:function(e,i,s,a,o){i.isMeshBasicMaterial||i.isMeshLambertMaterial?r(e,i):i.isMeshToonMaterial?(r(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,i)):i.isMeshPhongMaterial?(r(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,i)):i.isMeshStandardMaterial?(r(e,i),function(e,t){e.metalness.value=t.metalness,t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap,n(t.metalnessMap,e.metalnessMapTransform));e.roughness.value=t.roughness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap,n(t.roughnessMap,e.roughnessMapTransform));t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}(e,i),i.isMeshPhysicalMaterial&&function(e,t,r){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap,n(t.sheenColorMap,e.sheenColorMapTransform)),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap,n(t.sheenRoughnessMap,e.sheenRoughnessMapTransform)));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap,n(t.clearcoatMap,e.clearcoatMapTransform)),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap,n(t.clearcoatRoughnessMap,e.clearcoatRoughnessMapTransform)),t.clearcoatNormalMap&&(e.clearcoatNormalMap.value=t.clearcoatNormalMap,n(t.clearcoatNormalMap,e.clearcoatNormalMapTransform),e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),1===t.side&&e.clearcoatNormalScale.value.negate()));t.dispersion>0&&(e.dispersion.value=t.dispersion);t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap,n(t.iridescenceMap,e.iridescenceMapTransform)),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap,n(t.iridescenceThicknessMap,e.iridescenceThicknessMapTransform)));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap,n(t.transmissionMap,e.transmissionMapTransform)),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap,n(t.thicknessMap,e.thicknessMapTransform)),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));t.anisotropy>0&&(e.anisotropyVector.value.set(t.anisotropy*Math.cos(t.anisotropyRotation),t.anisotropy*Math.sin(t.anisotropyRotation)),t.anisotropyMap&&(e.anisotropyMap.value=t.anisotropyMap,n(t.anisotropyMap,e.anisotropyMapTransform)));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap,n(t.specularColorMap,e.specularColorMapTransform));t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap,n(t.specularIntensityMap,e.specularIntensityMapTransform))}(e,i,o)):i.isMeshMatcapMaterial?(r(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,i)):i.isMeshDepthMaterial?r(e,i):i.isMeshDistanceMaterial?(r(e,i),function(e,n){const r=t.get(n).light;e.referencePosition.value.setFromMatrixPosition(r.matrixWorld),e.nearDistance.value=r.shadow.camera.near,e.farDistance.value=r.shadow.camera.far}(e,i)):i.isMeshNormalMaterial?r(e,i):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform))}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,r,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*r,e.scale.value=.5*i,t.map&&(e.map.value=t.map,n(t.map,e.uvTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i,s,a):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map,n(t.map,e.mapTransform));t.alphaMap&&(e.alphaMap.value=t.alphaMap,n(t.alphaMap,e.alphaMapTransform));t.alphaTest>0&&(e.alphaTest.value=t.alphaTest)}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function lp(e,t,n,r){let i={},s={},a=[];const o=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS);function l(e,t,n,r){const i=e.value,s=t+"_"+n;if(void 0===r[s])return r[s]="number"==typeof i||"boolean"==typeof i?i:i.clone(),!0;{const e=r[s];if("number"==typeof i||"boolean"==typeof i){if(e!==i)return r[s]=i,!0}else if(!1===e.equals(i))return e.copy(i),!0}return!1}function u(e){const t={boundary:0,storage:0};return"number"==typeof e||"boolean"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture,t}function c(t){const n=t.target;n.removeEventListener("dispose",c);const r=a.indexOf(n.__bindingPointIndex);a.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete s[n.id]}return{bind:function(e,t){const n=t.program;r.uniformBlockBinding(e,n)},update:function(n,d){let h=i[n.id];void 0===h&&(!function(e){const t=e.uniforms;let n=0;const r=16;for(let e=0,i=t.length;e<i;e++){const i=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0,t=i.length;e<t;e++){const t=i[e],s=Array.isArray(t.value)?t.value:[t.value];for(let e=0,i=s.length;e<i;e++){const i=u(s[e]),a=n%r,o=a%i.boundary,l=a+o;n+=o,0!==l&&r-l<i.storage&&(n+=r-l),t.__data=new Float32Array(i.storage/Float32Array.BYTES_PER_ELEMENT),t.__offset=n,n+=i.storage}}}const i=n%r;i>0&&(n+=r-i);e.__size=n,e.__cache={}}(n),h=function(t){const n=function(){for(let e=0;e<o;e++)if(-1===a.indexOf(e))return a.push(e),e;return 0}();t.__bindingPointIndex=n;const r=e.createBuffer(),i=t.__size,s=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,r),e.bufferData(e.UNIFORM_BUFFER,i,s),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,n,r),r}(n),i[n.id]=h,n.addEventListener("dispose",c));const p=d.program;r.updateUBOMapping(n,p);const f=t.render.frame;s[n.id]!==f&&(!function(t){const n=i[t.id],r=t.uniforms,s=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,n);for(let t=0,n=r.length;t<n;t++){const n=Array.isArray(r[t])?r[t]:[r[t]];for(let r=0,i=n.length;r<i;r++){const i=n[r];if(!0===l(i,t,r,s)){const t=i.__offset,n=Array.isArray(i.value)?i.value:[i.value];let r=0;for(let s=0;s<n.length;s++){const a=n[s],o=u(a);"number"==typeof a||"boolean"==typeof a?(i.__data[0]=a,e.bufferSubData(e.UNIFORM_BUFFER,t+r,i.__data)):a.isMatrix3?(i.__data[0]=a.elements[0],i.__data[1]=a.elements[1],i.__data[2]=a.elements[2],i.__data[3]=0,i.__data[4]=a.elements[3],i.__data[5]=a.elements[4],i.__data[6]=a.elements[5],i.__data[7]=0,i.__data[8]=a.elements[6],i.__data[9]=a.elements[7],i.__data[10]=a.elements[8],i.__data[11]=0):(a.toArray(i.__data,r),r+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,i.__data)}}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(n),s[n.id]=f)},dispose:function(){for(const t in i)e.deleteBuffer(i[t]);a=[],i={},s={}}}}class up{constructor(e={}){const{canvas:t=en(),context:n=null,depth:r=!0,stencil:i=!1,alpha:s=!1,antialias:a=!1,premultipliedAlpha:o=!0,preserveDrawingBuffer:l=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:c=!1,reverseDepthBuffer:h=!1}=e;let p;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!=typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");p=n.getContextAttributes().alpha}else p=s;const f=new Uint32Array(4),m=new Int32Array(4);let g=null,v=null;const y=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=gt,this.toneMapping=0,this.toneMappingExposure=1;const x=this;let b=!1,S=0,T=0,w=null,M=-1,E=null;const A=new vn,C=new vn;let R=null;const N=new jr(0);let P=0,I=t.width,L=t.height,U=1,D=null,F=null;const B=new vn(0,0,I,L),O=new vn(0,0,I,L);let k=!1;const z=new $s;let V=!1,G=!1;this.transmissionResolutionScale=1;const H=new Jn,W=new Jn,j=new Tn,q=new vn,X={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let $=!1;function Y(){return null===w?U:1}let K,Q,Z,J,ee,te,ne,re,ae,oe,ue,de,ge,ve,ye,_e,xe,be,Se,Te,we,Ee,Re,Ne,Pe=n;function Ie(e,n){return t.getContext(e,n)}try{const e={alpha:!0,depth:r,stencil:i,antialias:a,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:c};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${d}`),t.addEventListener("webglcontextlost",De,!1),t.addEventListener("webglcontextrestored",Fe,!1),t.addEventListener("webglcontextcreationerror",Be,!1),null===Pe){const t="webgl2";if(Pe=Ie(t,e),null===Pe)throw Ie(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(e){throw e}function Le(){K=new ad(Pe),K.init(),Ee=new np(Pe,K),Q=new Oc(Pe,K,e,Ee),Z=new ep(Pe,K),Q.reverseDepthBuffer&&h&&Z.buffers.depth.setReversed(!0),J=new ud(Pe),ee=new Vh,te=new tp(Pe,K,Z,ee,Q,Ee,J),ne=new zc(x),re=new sd(x),ae=new Cc(Pe),Re=new Fc(Pe,ae),oe=new od(Pe,ae,J,Re),ue=new dd(Pe,oe,ae,J),Se=new cd(Pe,Q,te),_e=new kc(ee),de=new zh(x,ne,re,K,Q,Re,_e),ge=new op(x,ee),ve=new jh,ye=new Qh(K),be=new Dc(x,ne,re,Z,ue,p,o),xe=new Zh(x,ue,Q),Ne=new lp(Pe,J,Q,Z),Te=new Bc(Pe,K,J),we=new ld(Pe,K,J),J.programs=de.programs,x.capabilities=Q,x.extensions=K,x.properties=ee,x.renderLists=ve,x.shadowMap=xe,x.state=Z,x.info=J}Le();const Ue=new ip(x,Pe);function De(e){e.preventDefault(),b=!0}function Fe(){b=!1;const e=J.autoReset,t=xe.enabled,n=xe.autoUpdate,r=xe.needsUpdate,i=xe.type;Le(),J.autoReset=e,xe.enabled=t,xe.autoUpdate=n,xe.needsUpdate=r,xe.type=i}function Be(e){}function Oe(e){const t=e.target;t.removeEventListener("dispose",Oe),function(e){(function(e){const t=ee.get(e).programs;void 0!==t&&(t.forEach(function(e){de.releaseProgram(e)}),e.isShaderMaterial&&de.releaseShaderCache(e))})(e),ee.remove(e)}(t)}function ke(e,t,n){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Ye(e,t,n),e.side=0,e.needsUpdate=!0,Ye(e,t,n),e.side=2):Ye(e,t,n)}this.xr=Ue,this.getContext=function(){return Pe},this.getContextAttributes=function(){return Pe.getContextAttributes()},this.forceContextLoss=function(){const e=K.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=K.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return U},this.setPixelRatio=function(e){void 0!==e&&(U=e,this.setSize(I,L,!1))},this.getSize=function(e){return e.set(I,L)},this.setSize=function(e,n,r=!0){Ue.isPresenting||(I=e,L=n,t.width=Math.floor(e*U),t.height=Math.floor(n*U),!0===r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(I*U,L*U).floor()},this.setDrawingBufferSize=function(e,n,r){I=e,L=n,U=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(A)},this.getViewport=function(e){return e.copy(B)},this.setViewport=function(e,t,n,r){e.isVector4?B.set(e.x,e.y,e.z,e.w):B.set(e,t,n,r),Z.viewport(A.copy(B).multiplyScalar(U).round())},this.getScissor=function(e){return e.copy(O)},this.setScissor=function(e,t,n,r){e.isVector4?O.set(e.x,e.y,e.z,e.w):O.set(e,t,n,r),Z.scissor(C.copy(O).multiplyScalar(U).round())},this.getScissorTest=function(){return k},this.setScissorTest=function(e){Z.setScissorTest(k=e)},this.setOpaqueSort=function(e){D=e},this.setTransparentSort=function(e){F=e},this.getClearColor=function(e){return e.copy(be.getClearColor())},this.setClearColor=function(){be.setClearColor(...arguments)},this.getClearAlpha=function(){return be.getClearAlpha()},this.setClearAlpha=function(){be.setClearAlpha(...arguments)},this.clear=function(e=!0,t=!0,n=!0){let r=0;if(e){let e=!1;if(null!==w){const t=w.texture.format;e=t===Ce||t===Ae||t===Me}if(e){const e=w.texture.type,t=e===se||e===ce||e===le||e===me||e===pe||e===fe,n=be.getClearColor(),r=be.getClearAlpha(),i=n.r,s=n.g,a=n.b;t?(f[0]=i,f[1]=s,f[2]=a,f[3]=r,Pe.clearBufferuiv(Pe.COLOR,0,f)):(m[0]=i,m[1]=s,m[2]=a,m[3]=r,Pe.clearBufferiv(Pe.COLOR,0,m))}else r|=Pe.COLOR_BUFFER_BIT}t&&(r|=Pe.DEPTH_BUFFER_BIT),n&&(r|=Pe.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Pe.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",De,!1),t.removeEventListener("webglcontextrestored",Fe,!1),t.removeEventListener("webglcontextcreationerror",Be,!1),be.dispose(),ve.dispose(),ye.dispose(),ee.dispose(),ne.dispose(),re.dispose(),ue.dispose(),Re.dispose(),Ne.dispose(),de.dispose(),Ue.dispose(),Ue.removeEventListener("sessionstart",Ve),Ue.removeEventListener("sessionend",Ge),He.stop()},this.renderBufferDirect=function(e,t,n,r,i,s){null===t&&(t=X);const a=i.isMesh&&i.matrixWorld.determinant()<0,o=function(e,t,n,r,i){!0!==t.isScene&&(t=X);te.resetTextureUnits();const s=t.fog,a=r.isMeshStandardMaterial?t.environment:null,o=null===w?x.outputColorSpace:!0===w.isXRRenderTarget?w.texture.colorSpace:vt,l=(r.isMeshStandardMaterial?re:ne).get(r.envMap||a),u=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!n.attributes.tangent&&(!!r.normalMap||r.anisotropy>0),d=!!n.morphAttributes.position,h=!!n.morphAttributes.normal,p=!!n.morphAttributes.color;let f=0;r.toneMapped&&(null!==w&&!0!==w.isXRRenderTarget||(f=x.toneMapping));const m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,g=void 0!==m?m.length:0,y=ee.get(r),_=v.state.lights;if(!0===V&&(!0===G||e!==E)){const t=e===E&&r.id===M;_e.setState(r,e,t)}let b=!1;r.version===y.__version?y.needsLights&&y.lightsStateVersion!==_.state.version||y.outputColorSpace!==o||i.isBatchedMesh&&!1===y.batching?b=!0:i.isBatchedMesh||!0!==y.batching?i.isBatchedMesh&&!0===y.batchingColor&&null===i.colorTexture||i.isBatchedMesh&&!1===y.batchingColor&&null!==i.colorTexture||i.isInstancedMesh&&!1===y.instancing?b=!0:i.isInstancedMesh||!0!==y.instancing?i.isSkinnedMesh&&!1===y.skinning?b=!0:i.isSkinnedMesh||!0!==y.skinning?i.isInstancedMesh&&!0===y.instancingColor&&null===i.instanceColor||i.isInstancedMesh&&!1===y.instancingColor&&null!==i.instanceColor||i.isInstancedMesh&&!0===y.instancingMorph&&null===i.morphTexture||i.isInstancedMesh&&!1===y.instancingMorph&&null!==i.morphTexture||y.envMap!==l||!0===r.fog&&y.fog!==s?b=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===_e.numPlanes&&y.numIntersection===_e.numIntersection?(y.vertexAlphas!==u||y.vertexTangents!==c||y.morphTargets!==d||y.morphNormals!==h||y.morphColors!==p||y.toneMapping!==f||y.morphTargetsCount!==g)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,y.__version=r.version);let S=y.currentProgram;!0===b&&(S=Ye(r,t,i));let T=!1,A=!1,C=!1;const R=S.getUniforms(),N=y.uniforms;Z.useProgram(S.program)&&(T=!0,A=!0,C=!0);r.id!==M&&(M=r.id,A=!0);if(T||E!==e){Z.buffers.depth.getReversed()?(H.copy(e.projectionMatrix),function(e){const t=e.elements;t[2]=.5*t[2]+.5*t[3],t[6]=.5*t[6]+.5*t[7],t[10]=.5*t[10]+.5*t[11],t[14]=.5*t[14]+.5*t[15]}(H),function(e){const t=e.elements;-1===t[11]?(t[10]=-t[10]-1,t[14]=-t[14]):(t[10]=-t[10],t[14]=1-t[14])}(H),R.setValue(Pe,"projectionMatrix",H)):R.setValue(Pe,"projectionMatrix",e.projectionMatrix),R.setValue(Pe,"viewMatrix",e.matrixWorldInverse);const t=R.map.cameraPosition;void 0!==t&&t.setValue(Pe,j.setFromMatrixPosition(e.matrixWorld)),Q.logarithmicDepthBuffer&&R.setValue(Pe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&R.setValue(Pe,"isOrthographic",!0===e.isOrthographicCamera),E!==e&&(E=e,A=!0,C=!0)}if(i.isSkinnedMesh){R.setOptional(Pe,i,"bindMatrix"),R.setOptional(Pe,i,"bindMatrixInverse");const e=i.skeleton;e&&(null===e.boneTexture&&e.computeBoneTexture(),R.setValue(Pe,"boneTexture",e.boneTexture,te))}i.isBatchedMesh&&(R.setOptional(Pe,i,"batchingTexture"),R.setValue(Pe,"batchingTexture",i._matricesTexture,te),R.setOptional(Pe,i,"batchingIdTexture"),R.setValue(Pe,"batchingIdTexture",i._indirectTexture,te),R.setOptional(Pe,i,"batchingColorTexture"),null!==i._colorsTexture&&R.setValue(Pe,"batchingColorTexture",i._colorsTexture,te));const P=n.morphAttributes;void 0===P.position&&void 0===P.normal&&void 0===P.color||Se.update(i,n,S);(A||y.receiveShadow!==i.receiveShadow)&&(y.receiveShadow=i.receiveShadow,R.setValue(Pe,"receiveShadow",i.receiveShadow));r.isMeshGouraudMaterial&&null!==r.envMap&&(N.envMap.value=l,N.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);r.isMeshStandardMaterial&&null===r.envMap&&null!==t.environment&&(N.envMapIntensity.value=t.environmentIntensity);A&&(R.setValue(Pe,"toneMappingExposure",x.toneMappingExposure),y.needsLights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(N,C),s&&!0===r.fog&&ge.refreshFogUniforms(N,s),ge.refreshMaterialUniforms(N,r,U,L,v.state.transmissionRenderTarget[e.id]),gh.upload(Pe,Ke(y),N,te));r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(gh.upload(Pe,Ke(y),N,te),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&R.setValue(Pe,"center",i.center);if(R.setValue(Pe,"modelViewMatrix",i.modelViewMatrix),R.setValue(Pe,"normalMatrix",i.normalMatrix),R.setValue(Pe,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial){const e=r.uniformsGroups;for(let t=0,n=e.length;t<n;t++){const n=e[t];Ne.update(n,S),Ne.bind(n,S)}}return S}(e,t,n,r,i);Z.setMaterial(r,a);let l=n.index,u=1;if(!0===r.wireframe){if(l=oe.getWireframeAttribute(n),void 0===l)return;u=2}const c=n.drawRange,d=n.attributes.position;let h=c.start*u,p=(c.start+c.count)*u;null!==s&&(h=Math.max(h,s.start*u),p=Math.min(p,(s.start+s.count)*u)),null!==l?(h=Math.max(h,0),p=Math.min(p,l.count)):null!=d&&(h=Math.max(h,0),p=Math.min(p,d.count));const f=p-h;if(f<0||f===1/0)return;let m;Re.setup(i,r,o,n,l);let g=Te;if(null!==l&&(m=ae.get(l),g=we,g.setIndex(m)),i.isMesh)!0===r.wireframe?(Z.setLineWidth(r.wireframeLinewidth*Y()),g.setMode(Pe.LINES)):g.setMode(Pe.TRIANGLES);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),Z.setLineWidth(e*Y()),i.isLineSegments?g.setMode(Pe.LINES):i.isLineLoop?g.setMode(Pe.LINE_LOOP):g.setMode(Pe.LINE_STRIP)}else i.isPoints?g.setMode(Pe.POINTS):i.isSprite&&g.setMode(Pe.TRIANGLES);if(i.isBatchedMesh)if(null!==i._multiDrawInstances)nn("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),g.renderMultiDrawInstances(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount,i._multiDrawInstances);else if(K.get("WEBGL_multi_draw"))g.renderMultiDraw(i._multiDrawStarts,i._multiDrawCounts,i._multiDrawCount);else{const e=i._multiDrawStarts,t=i._multiDrawCounts,n=i._multiDrawCount,s=l?ae.get(l).bytesPerElement:1,a=ee.get(r).currentProgram.getUniforms();for(let r=0;r<n;r++)a.setValue(Pe,"_gl_DrawID",r),g.render(e[r]/s,t[r])}else if(i.isInstancedMesh)g.renderInstances(h,f,i.count);else if(n.isInstancedBufferGeometry){const e=void 0!==n._maxInstanceCount?n._maxInstanceCount:1/0,t=Math.min(n.instanceCount,e);g.renderInstances(h,f,t)}else g.render(h,f)},this.compile=function(e,t,n=null){null===n&&(n=e),v=ye.get(n),v.init(t),_.push(v),n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(v.pushLight(e),e.castShadow&&v.pushShadow(e))}),e!==n&&e.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&(v.pushLight(e),e.castShadow&&v.pushShadow(e))}),v.setupLights();const r=new Set;return e.traverse(function(e){if(!(e.isMesh||e.isPoints||e.isLine||e.isSprite))return;const t=e.material;if(t)if(Array.isArray(t))for(let i=0;i<t.length;i++){const s=t[i];ke(s,n,e),r.add(s)}else ke(t,n,e),r.add(t)}),v=_.pop(),r},this.compileAsync=function(e,t,n=null){const r=this.compile(e,t,n);return new Promise(t=>{function n(){r.forEach(function(e){ee.get(e).currentProgram.isReady()&&r.delete(e)}),0!==r.size?setTimeout(n,10):t(e)}null!==K.get("KHR_parallel_shader_compile")?n():setTimeout(n,10)})};let ze=null;function Ve(){He.stop()}function Ge(){He.start()}const He=new Ac;function We(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)v.pushLight(e),e.castShadow&&v.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||z.intersectsSprite(e)){r&&q.setFromMatrixPosition(e.matrixWorld).applyMatrix4(W);const t=ue.update(e),i=e.material;i.visible&&g.push(e,t,i,n,q.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||z.intersectsObject(e))){const t=ue.update(e),i=e.material;if(r&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),q.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),q.copy(t.boundingSphere.center)),q.applyMatrix4(e.matrixWorld).applyMatrix4(W)),Array.isArray(i)){const r=t.groups;for(let s=0,a=r.length;s<a;s++){const a=r[s],o=i[a.materialIndex];o&&o.visible&&g.push(e,t,o,n,q.z,a)}}else i.visible&&g.push(e,t,i,n,q.z,null)}const i=e.children;for(let e=0,s=i.length;e<s;e++)We(i[e],t,n,r)}function je(e,t,n,r){const i=e.opaque,s=e.transmissive,a=e.transparent;v.setupLightsView(n),!0===V&&_e.setGlobalState(x.clippingPlanes,n),r&&Z.viewport(A.copy(r)),i.length>0&&Xe(i,t,n),s.length>0&&Xe(s,t,n),a.length>0&&Xe(a,t,n),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function qe(e,t,n,r){if(null!==(!0===n.isScene?n.overrideMaterial:null))return;void 0===v.state.transmissionRenderTarget[r.id]&&(v.state.transmissionRenderTarget[r.id]=new _n(1,1,{generateMipmaps:!0,type:K.has("EXT_color_buffer_half_float")||K.has("EXT_color_buffer_float")?he:se,minFilter:ie,samples:4,stencilBuffer:i,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:on.workingColorSpace}));const s=v.state.transmissionRenderTarget[r.id],a=r.viewport||A;s.setSize(a.z*x.transmissionResolutionScale,a.w*x.transmissionResolutionScale);const o=x.getRenderTarget();x.setRenderTarget(s),x.getClearColor(N),P=x.getClearAlpha(),P<1&&x.setClearColor(16777215,.5),x.clear(),$&&be.render(n);const l=x.toneMapping;x.toneMapping=0;const u=r.viewport;if(void 0!==r.viewport&&(r.viewport=void 0),v.setupLightsView(r),!0===V&&_e.setGlobalState(x.clippingPlanes,r),Xe(e,n,r),te.updateMultisampleRenderTarget(s),te.updateRenderTargetMipmap(s),!1===K.has("WEBGL_multisampled_render_to_texture")){let e=!1;for(let i=0,s=t.length;i<s;i++){const s=t[i],a=s.object,o=s.geometry,l=s.material,u=s.group;if(2===l.side&&a.layers.test(r.layers)){const t=l.side;l.side=1,l.needsUpdate=!0,$e(a,n,r,o,l,u),l.side=t,l.needsUpdate=!0,e=!0}}!0===e&&(te.updateMultisampleRenderTarget(s),te.updateRenderTargetMipmap(s))}x.setRenderTarget(o),x.setClearColor(N,P),void 0!==u&&(r.viewport=u),x.toneMapping=l}function Xe(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,s=e.length;i<s;i++){const s=e[i],a=s.object,o=s.geometry,l=null===r?s.material:r,u=s.group;a.layers.test(n.layers)&&$e(a,t,n,o,l,u)}}function $e(e,t,n,r,i,s){e.onBeforeRender(x,t,n,r,i,s),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(x,t,n,r,e,s),!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,i.needsUpdate=!0,x.renderBufferDirect(n,t,r,i,e,s),i.side=0,i.needsUpdate=!0,x.renderBufferDirect(n,t,r,i,e,s),i.side=2):x.renderBufferDirect(n,t,r,i,e,s),e.onAfterRender(x,t,n,r,i,s)}function Ye(e,t,n){!0!==t.isScene&&(t=X);const r=ee.get(e),i=v.state.lights,s=v.state.shadowsArray,a=i.state.version,o=de.getParameters(e,i.state,s,t,n),l=de.getProgramCacheKey(o);let u=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?re:ne).get(e.envMap||r.environment),r.envMapRotation=null!==r.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation,void 0===u&&(e.addEventListener("dispose",Oe),u=new Map,r.programs=u);let c=u.get(l);if(void 0!==c){if(r.currentProgram===c&&r.lightsStateVersion===a)return Qe(e,o),c}else o.uniforms=de.getUniforms(e),e.onBeforeCompile(o,x),c=de.acquireProgram(o,l),u.set(l,c),r.uniforms=o.uniforms;const d=r.uniforms;return(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(d.clippingPlanes=_e.uniform),Qe(e,o),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=a,r.needsLights&&(d.ambientLightColor.value=i.state.ambient,d.lightProbe.value=i.state.probe,d.directionalLights.value=i.state.directional,d.directionalLightShadows.value=i.state.directionalShadow,d.spotLights.value=i.state.spot,d.spotLightShadows.value=i.state.spotShadow,d.rectAreaLights.value=i.state.rectArea,d.ltc_1.value=i.state.rectAreaLTC1,d.ltc_2.value=i.state.rectAreaLTC2,d.pointLights.value=i.state.point,d.pointLightShadows.value=i.state.pointShadow,d.hemisphereLights.value=i.state.hemi,d.directionalShadowMap.value=i.state.directionalShadowMap,d.directionalShadowMatrix.value=i.state.directionalShadowMatrix,d.spotShadowMap.value=i.state.spotShadowMap,d.spotLightMatrix.value=i.state.spotLightMatrix,d.spotLightMap.value=i.state.spotLightMap,d.pointShadowMap.value=i.state.pointShadowMap,d.pointShadowMatrix.value=i.state.pointShadowMatrix),r.currentProgram=c,r.uniformsList=null,c}function Ke(e){if(null===e.uniformsList){const t=e.currentProgram.getUniforms();e.uniformsList=gh.seqWithValue(t.seq,e.uniforms)}return e.uniformsList}function Qe(e,t){const n=ee.get(e);n.outputColorSpace=t.outputColorSpace,n.batching=t.batching,n.batchingColor=t.batchingColor,n.instancing=t.instancing,n.instancingColor=t.instancingColor,n.instancingMorph=t.instancingMorph,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}He.setAnimationLoop(function(e){ze&&ze(e)}),"undefined"!=typeof self&&He.setContext(self),this.setAnimationLoop=function(e){ze=e,Ue.setAnimationLoop(e),null===e?He.stop():He.start()},Ue.addEventListener("sessionstart",Ve),Ue.addEventListener("sessionend",Ge),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return;if(!0===b)return;if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===Ue.enabled&&!0===Ue.isPresenting&&(!0===Ue.cameraAutoUpdate&&Ue.updateCamera(t),t=Ue.getCamera()),!0===e.isScene&&e.onBeforeRender(x,e,t,w),v=ye.get(e,_.length),v.init(t),_.push(v),W.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),z.setFromProjectionMatrix(W),G=this.localClippingEnabled,V=_e.init(this.clippingPlanes,G),g=ve.get(e,y.length),g.init(),y.push(g),!0===Ue.enabled&&!0===Ue.isPresenting){const e=x.xr.getDepthSensingMesh();null!==e&&We(e,t,-1/0,x.sortObjects)}We(e,t,0,x.sortObjects),g.finish(),!0===x.sortObjects&&g.sort(D,F),$=!1===Ue.enabled||!1===Ue.isPresenting||!1===Ue.hasDepthSensing(),$&&be.addToRenderList(g,e),this.info.render.frame++,!0===V&&_e.beginShadows();const n=v.state.shadowsArray;xe.render(n,e,t),!0===V&&_e.endShadows(),!0===this.info.autoReset&&this.info.reset();const r=g.opaque,i=g.transmissive;if(v.setupLights(),t.isArrayCamera){const n=t.cameras;if(i.length>0)for(let t=0,s=n.length;t<s;t++){qe(r,i,e,n[t])}$&&be.render(e);for(let t=0,r=n.length;t<r;t++){const r=n[t];je(g,e,r,r.viewport)}}else i.length>0&&qe(r,i,e,t),$&&be.render(e),je(g,e,t);null!==w&&0===T&&(te.updateMultisampleRenderTarget(w),te.updateRenderTargetMipmap(w)),!0===e.isScene&&e.onAfterRender(x,e,t),Re.resetDefaultState(),M=-1,E=null,_.pop(),_.length>0?(v=_[_.length-1],!0===V&&_e.setGlobalState(x.clippingPlanes,v.state.camera)):v=null,y.pop(),g=y.length>0?y[y.length-1]:null},this.getActiveCubeFace=function(){return S},this.getActiveMipmapLevel=function(){return T},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(e,t,n){ee.get(e.texture).__webglTexture=t,ee.get(e.depthTexture).__webglTexture=n;const r=ee.get(e);r.__hasExternalTextures=!0,r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===K.has("WEBGL_multisampled_render_to_texture")&&(r.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(e,t){const n=ee.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t};const Ze=Pe.createFramebuffer();this.setRenderTarget=function(e,t=0,n=0){w=e,S=t,T=n;let r=!0,i=null,s=!1,a=!1;if(e){const o=ee.get(e);if(void 0!==o.__useDefaultFramebuffer)Z.bindFramebuffer(Pe.FRAMEBUFFER,null),r=!1;else if(void 0===o.__webglFramebuffer)te.setupRenderTarget(e);else if(o.__hasExternalTextures)te.rebindTextures(e,ee.get(e.texture).__webglTexture,ee.get(e.depthTexture).__webglTexture);else if(e.depthBuffer){const t=e.depthTexture;if(o.__boundDepthTexture!==t){if(null!==t&&ee.has(t)&&(e.width!==t.image.width||e.height!==t.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");te.setupDepthRenderbuffer(e)}}const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(a=!0);const u=ee.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=Array.isArray(u[t])?u[t][n]:u[t],s=!0):i=e.samples>0&&!1===te.useMultisampledRTT(e)?ee.get(e).__webglMultisampledFramebuffer:Array.isArray(u)?u[n]:u,A.copy(e.viewport),C.copy(e.scissor),R=e.scissorTest}else A.copy(B).multiplyScalar(U).floor(),C.copy(O).multiplyScalar(U).floor(),R=k;0!==n&&(i=Ze);if(Z.bindFramebuffer(Pe.FRAMEBUFFER,i)&&r&&Z.drawBuffers(e,i),Z.viewport(A),Z.scissor(C),Z.setScissorTest(R),s){const r=ee.get(e.texture);Pe.framebufferTexture2D(Pe.FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,Pe.TEXTURE_CUBE_MAP_POSITIVE_X+t,r.__webglTexture,n)}else if(a){const r=ee.get(e.texture),i=t;Pe.framebufferTextureLayer(Pe.FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,r.__webglTexture,n,i)}else if(null!==e&&0!==n){const t=ee.get(e.texture);Pe.framebufferTexture2D(Pe.FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,Pe.TEXTURE_2D,t.__webglTexture,n)}M=-1},this.readRenderTargetPixels=function(e,t,n,r,i,s,a){if(!e||!e.isWebGLRenderTarget)return;let o=ee.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){Z.bindFramebuffer(Pe.FRAMEBUFFER,o);try{const a=e.texture,o=a.format,l=a.type;if(!Q.textureFormatReadable(o))return;if(!Q.textureTypeReadable(l))return;t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&Pe.readPixels(t,n,r,i,Ee.convert(o),Ee.convert(l),s)}finally{const e=null!==w?ee.get(w).__webglFramebuffer:null;Z.bindFramebuffer(Pe.FRAMEBUFFER,e)}}},this.readRenderTargetPixelsAsync=async function(e,t,n,r,i,s,a){if(!e||!e.isWebGLRenderTarget)throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=ee.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){const a=e.texture,l=a.format,u=a.type;if(!Q.textureFormatReadable(l))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Q.textureTypeReadable(u))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i){Z.bindFramebuffer(Pe.FRAMEBUFFER,o);const e=Pe.createBuffer();Pe.bindBuffer(Pe.PIXEL_PACK_BUFFER,e),Pe.bufferData(Pe.PIXEL_PACK_BUFFER,s.byteLength,Pe.STREAM_READ),Pe.readPixels(t,n,r,i,Ee.convert(l),Ee.convert(u),0);const a=null!==w?ee.get(w).__webglFramebuffer:null;Z.bindFramebuffer(Pe.FRAMEBUFFER,a);const c=Pe.fenceSync(Pe.SYNC_GPU_COMMANDS_COMPLETE,0);return Pe.flush(),await function(e,t,n){return new Promise(function(r,i){setTimeout(function s(){switch(e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0)){case e.WAIT_FAILED:i();break;case e.TIMEOUT_EXPIRED:setTimeout(s,n);break;default:r()}},n)})}(Pe,c,4),Pe.bindBuffer(Pe.PIXEL_PACK_BUFFER,e),Pe.getBufferSubData(Pe.PIXEL_PACK_BUFFER,0,s),Pe.deleteBuffer(e),Pe.deleteSync(c),s}throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(e,t=null,n=0){!0!==e.isTexture&&(nn("WebGLRenderer: copyFramebufferToTexture function signature has changed."),t=arguments[0]||null,e=arguments[1]);const r=Math.pow(2,-n),i=Math.floor(e.image.width*r),s=Math.floor(e.image.height*r),a=null!==t?t.x:0,o=null!==t?t.y:0;te.setTexture2D(e,0),Pe.copyTexSubImage2D(Pe.TEXTURE_2D,n,0,0,a,o,i,s),Z.unbindTexture()};const Je=Pe.createFramebuffer(),et=Pe.createFramebuffer();this.copyTextureToTexture=function(e,t,n=null,r=null,i=0,s=null){let a,o,l,u,c,d,h,p,f;!0!==e.isTexture&&(nn("WebGLRenderer: copyTextureToTexture function signature has changed."),r=arguments[0]||null,e=arguments[1],t=arguments[2],s=arguments[3]||0,n=null),null===s&&(0!==i?(nn("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),s=i,i=0):s=0);const m=e.isCompressedTexture?e.mipmaps[s]:e.image;if(null!==n)a=n.max.x-n.min.x,o=n.max.y-n.min.y,l=n.isBox3?n.max.z-n.min.z:1,u=n.min.x,c=n.min.y,d=n.isBox3?n.min.z:0;else{const t=Math.pow(2,-i);a=Math.floor(m.width*t),o=Math.floor(m.height*t),l=e.isDataArrayTexture?m.depth:e.isData3DTexture?Math.floor(m.depth*t):1,u=0,c=0,d=0}null!==r?(h=r.x,p=r.y,f=r.z):(h=0,p=0,f=0);const g=Ee.convert(t.format),v=Ee.convert(t.type);let y;t.isData3DTexture?(te.setTexture3D(t,0),y=Pe.TEXTURE_3D):t.isDataArrayTexture||t.isCompressedArrayTexture?(te.setTexture2DArray(t,0),y=Pe.TEXTURE_2D_ARRAY):(te.setTexture2D(t,0),y=Pe.TEXTURE_2D),Pe.pixelStorei(Pe.UNPACK_FLIP_Y_WEBGL,t.flipY),Pe.pixelStorei(Pe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),Pe.pixelStorei(Pe.UNPACK_ALIGNMENT,t.unpackAlignment);const _=Pe.getParameter(Pe.UNPACK_ROW_LENGTH),x=Pe.getParameter(Pe.UNPACK_IMAGE_HEIGHT),b=Pe.getParameter(Pe.UNPACK_SKIP_PIXELS),S=Pe.getParameter(Pe.UNPACK_SKIP_ROWS),T=Pe.getParameter(Pe.UNPACK_SKIP_IMAGES);Pe.pixelStorei(Pe.UNPACK_ROW_LENGTH,m.width),Pe.pixelStorei(Pe.UNPACK_IMAGE_HEIGHT,m.height),Pe.pixelStorei(Pe.UNPACK_SKIP_PIXELS,u),Pe.pixelStorei(Pe.UNPACK_SKIP_ROWS,c),Pe.pixelStorei(Pe.UNPACK_SKIP_IMAGES,d);const w=e.isDataArrayTexture||e.isData3DTexture,M=t.isDataArrayTexture||t.isData3DTexture;if(e.isDepthTexture){const n=ee.get(e),r=ee.get(t),m=ee.get(n.__renderTarget),g=ee.get(r.__renderTarget);Z.bindFramebuffer(Pe.READ_FRAMEBUFFER,m.__webglFramebuffer),Z.bindFramebuffer(Pe.DRAW_FRAMEBUFFER,g.__webglFramebuffer);for(let n=0;n<l;n++)w&&(Pe.framebufferTextureLayer(Pe.READ_FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,ee.get(e).__webglTexture,i,d+n),Pe.framebufferTextureLayer(Pe.DRAW_FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,ee.get(t).__webglTexture,s,f+n)),Pe.blitFramebuffer(u,c,a,o,h,p,a,o,Pe.DEPTH_BUFFER_BIT,Pe.NEAREST);Z.bindFramebuffer(Pe.READ_FRAMEBUFFER,null),Z.bindFramebuffer(Pe.DRAW_FRAMEBUFFER,null)}else if(0!==i||e.isRenderTargetTexture||ee.has(e)){const n=ee.get(e),r=ee.get(t);Z.bindFramebuffer(Pe.READ_FRAMEBUFFER,Je),Z.bindFramebuffer(Pe.DRAW_FRAMEBUFFER,et);for(let e=0;e<l;e++)w?Pe.framebufferTextureLayer(Pe.READ_FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,n.__webglTexture,i,d+e):Pe.framebufferTexture2D(Pe.READ_FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,Pe.TEXTURE_2D,n.__webglTexture,i),M?Pe.framebufferTextureLayer(Pe.DRAW_FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,r.__webglTexture,s,f+e):Pe.framebufferTexture2D(Pe.DRAW_FRAMEBUFFER,Pe.COLOR_ATTACHMENT0,Pe.TEXTURE_2D,r.__webglTexture,s),0!==i?Pe.blitFramebuffer(u,c,a,o,h,p,a,o,Pe.COLOR_BUFFER_BIT,Pe.NEAREST):M?Pe.copyTexSubImage3D(y,s,h,p,f+e,u,c,a,o):Pe.copyTexSubImage2D(y,s,h,p,u,c,a,o);Z.bindFramebuffer(Pe.READ_FRAMEBUFFER,null),Z.bindFramebuffer(Pe.DRAW_FRAMEBUFFER,null)}else M?e.isDataTexture||e.isData3DTexture?Pe.texSubImage3D(y,s,h,p,f,a,o,l,g,v,m.data):t.isCompressedArrayTexture?Pe.compressedTexSubImage3D(y,s,h,p,f,a,o,l,g,m.data):Pe.texSubImage3D(y,s,h,p,f,a,o,l,g,v,m):e.isDataTexture?Pe.texSubImage2D(Pe.TEXTURE_2D,s,h,p,a,o,g,v,m.data):e.isCompressedTexture?Pe.compressedTexSubImage2D(Pe.TEXTURE_2D,s,h,p,m.width,m.height,g,m.data):Pe.texSubImage2D(Pe.TEXTURE_2D,s,h,p,a,o,g,v,m);Pe.pixelStorei(Pe.UNPACK_ROW_LENGTH,_),Pe.pixelStorei(Pe.UNPACK_IMAGE_HEIGHT,x),Pe.pixelStorei(Pe.UNPACK_SKIP_PIXELS,b),Pe.pixelStorei(Pe.UNPACK_SKIP_ROWS,S),Pe.pixelStorei(Pe.UNPACK_SKIP_IMAGES,T),0===s&&t.generateMipmaps&&Pe.generateMipmap(y),Z.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n=null,r=null,i=0){return!0!==e.isTexture&&(nn("WebGLRenderer: copyTextureToTexture3D function signature has changed."),n=arguments[0]||null,r=arguments[1]||null,e=arguments[2],t=arguments[3],i=arguments[4]||0),nn('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(e,t,n,r,i)},this.initRenderTarget=function(e){void 0===ee.get(e).__webglFramebuffer&&te.setupRenderTarget(e)},this.initTexture=function(e){e.isCubeTexture?te.setTextureCube(e,0):e.isData3DTexture?te.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?te.setTexture2DArray(e,0):te.setTexture2D(e,0),Z.unbindTexture()},this.resetState=function(){S=0,T=0,w=null,Z.reset(),Re.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Lt}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorspace=on._getDrawingBufferColorSpace(e),t.unpackColorSpace=on._getUnpackColorSpace()}}var cp,dp=Object.freeze({__proto__:null,ACESFilmicToneMapping:4,AddEquation:g,AddOperation:2,AdditiveBlending:2,AgXToneMapping:6,AlphaFormat:ve,AlwaysCompare:Rt,AlwaysDepth:1,ArrayCamera:Ru,BackSide:1,BoxGeometry:Ri,BufferAttribute:ri,BufferGeometry:mi,ByteType:ae,CineonToneMapping:3,ClampToEdgeWrapping:Q,Color:jr,ColorManagement:on,ConstantAlphaFactor:213,ConstantColorFactor:211,CubeReflectionMapping:j,CubeRefractionMapping:q,CubeTexture:Gi,CubeUVReflectionMapping:Y,CullFaceBack:1,CullFaceFront:2,CullFaceNone:0,CustomBlending:5,CustomToneMapping:5,Data3DTexture:bn,DataArrayTexture:xn,DepthFormat:Se,DepthStencilFormat:Te,DepthTexture:Oa,DoubleSide:2,DstAlphaFactor:M,DstColorFactor:A,EqualCompare:wt,EqualDepth:4,EquirectangularReflectionMapping:X,EquirectangularRefractionMapping:$,Euler:ur,EventDispatcher:Dt,FloatType:de,FrontSide:0,Frustum:$s,GLSL3:It,GreaterCompare:Et,GreaterDepth:6,GreaterEqualCompare:Ct,GreaterEqualDepth:5,HalfFloatType:he,IntType:ue,Layers:cr,LessCompare:Tt,LessDepth:2,LessEqualCompare:Mt,LessEqualDepth:3,LinearFilter:ne,LinearMipmapLinearFilter:ie,LinearMipmapNearestFilter:re,LinearSRGBColorSpace:vt,LinearToneMapping:1,LinearTransfer:yt,LuminanceAlphaFormat:be,LuminanceFormat:xe,Matrix3:$t,Matrix4:Jn,MaxEquation:104,Mesh:Ai,MeshBasicMaterial:Yr,MeshDepthMaterial:yl,MeshDistanceMaterial:_l,MinEquation:103,MirroredRepeatWrapping:Z,MixOperation:1,MultiplyBlending:4,MultiplyOperation:0,NearestFilter:J,NearestMipmapLinearFilter:te,NearestMipmapNearestFilter:ee,NeutralToneMapping:7,NeverCompare:St,NeverDepth:0,NoBlending:0,NoColorSpace:mt,NoToneMapping:0,NormalBlending:1,NotEqualCompare:At,NotEqualDepth:7,ObjectSpaceNormalMap:1,OneFactor:x,OneMinusConstantAlphaFactor:214,OneMinusConstantColorFactor:212,OneMinusDstAlphaFactor:E,OneMinusDstColorFactor:C,OneMinusSrcAlphaFactor:w,OneMinusSrcColorFactor:S,OrthographicCamera:cu,PCFShadowMap:1,PCFSoftShadowMap:2,PMREMGenerator:Jc,PerspectiveCamera:ki,Plane:js,PlaneGeometry:Jo,RED_GREEN_RGTC2_Format:st,RED_RGTC1_Format:rt,REVISION:d,RGBADepthPacking:3201,RGBAFormat:_e,RGBAIntegerFormat:Ce,RGBA_ASTC_10x10_Format:Qe,RGBA_ASTC_10x5_Format:$e,RGBA_ASTC_10x6_Format:Ye,RGBA_ASTC_10x8_Format:Ke,RGBA_ASTC_12x10_Format:Ze,RGBA_ASTC_12x12_Format:Je,RGBA_ASTC_4x4_Format:ze,RGBA_ASTC_5x4_Format:Ve,RGBA_ASTC_5x5_Format:Ge,RGBA_ASTC_6x5_Format:He,RGBA_ASTC_6x6_Format:We,RGBA_ASTC_8x5_Format:je,RGBA_ASTC_8x6_Format:qe,RGBA_ASTC_8x8_Format:Xe,RGBA_BPTC_Format:et,RGBA_ETC2_EAC_Format:ke,RGBA_PVRTC_2BPPV1_Format:Fe,RGBA_PVRTC_4BPPV1_Format:De,RGBA_S3TC_DXT1_Format:Ne,RGBA_S3TC_DXT3_Format:Pe,RGBA_S3TC_DXT5_Format:Ie,RGBFormat:ye,RGB_BPTC_SIGNED_Format:tt,RGB_BPTC_UNSIGNED_Format:nt,RGB_ETC1_Format:Be,RGB_ETC2_Format:Oe,RGB_PVRTC_2BPPV1_Format:Ue,RGB_PVRTC_4BPPV1_Format:Le,RGB_S3TC_DXT1_Format:Re,RGFormat:Ee,RGIntegerFormat:Ae,RedFormat:we,RedIntegerFormat:Me,ReinhardToneMapping:2,RepeatWrapping:K,ReverseSubtractEquation:y,SIGNED_RED_GREEN_RGTC2_Format:at,SIGNED_RED_RGTC1_Format:it,SRGBColorSpace:gt,SRGBTransfer:_t,ShaderChunk:Rc,ShaderLib:Pc,ShaderMaterial:Ui,ShortType:oe,SrcAlphaFactor:T,SrcAlphaSaturateFactor:R,SrcColorFactor:b,SubtractEquation:v,SubtractiveBlending:3,TangentSpaceNormalMap:0,Texture:gn,Uint16BufferAttribute:ii,Uint32BufferAttribute:si,UniformsLib:Nc,UniformsUtils:Li,UnsignedByteType:se,UnsignedInt248Type:me,UnsignedInt5999Type:ge,UnsignedIntType:ce,UnsignedShort4444Type:pe,UnsignedShort5551Type:fe,UnsignedShortType:le,VSMShadowMap:3,Vector2:Xt,Vector3:Tn,Vector4:vn,WebGLCoordinateSystem:Lt,WebGLCubeRenderTarget:Hi,WebGLRenderTarget:_n,WebGLRenderer:up,WebGLUtils:np,WebXRController:qi,ZeroFactor:_,createCanvasElement:en,AdditiveAnimationBlendMode:ft,AlwaysStencilFunc:bt,AmbientLight:pu,AnimationAction:Yu,AnimationClip:zl,AnimationLoader:class extends jl{constructor(e){super(e)}load(e,t,n,r){const i=this,s=new $l(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r&&r(t),i.manager.itemError(e)}},n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=zl.parse(e[n]);t.push(r)}return t}},AnimationMixer:class extends Dt{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,s=e._propertyBindings,a=e._interpolants,o=n.uuid,l=this._bindingsByRootAndName;let u=l[o];void 0===u&&(u={},l[o]=u);for(let e=0;e!==i;++e){const i=r[e],l=i.name;let c=u[l];if(void 0!==c)++c.referenceCount,s[e]=c;else{if(c=s[e],void 0!==c){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,o,l));continue}const r=t&&t._propertyBindings[e].binding.parsedPath;c=new Vu($u.create(n,l,r),i.ValueTypeName,i.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,o,l),s[e]=c}a[e].resultBuffer=c.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let s=i[t];if(void 0===s)s={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=s;else{const t=s.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),s.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,s=this._actionsByClip,a=s[i],o=a.knownActions,l=o[o.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,o[u]=l,o.pop(),e._byClipCacheIndex=null;delete a.actionByRoot[(e._localRoot||this._root).uuid],0===o.length&&delete s[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0===--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let s=r[t];void 0===s&&(s={},r[t]=s),s[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,s=this._bindingsByRootAndName,a=s[r],o=t[t.length-1],l=e._cacheIndex;o._cacheIndex=l,t[l]=o,t.pop(),delete a[i],0===Object.keys(a).length&&delete s[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Nl(new Float32Array(2),new Float32Array(2),1,Ku),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){const r=t||this._root,i=r.uuid;let s="string"==typeof e?zl.findByName(r,e):e;const a=null!==s?s.uuid:e,o=this._actionsByClip[a];let l=null;if(void 0===n&&(n=null!==s?s.blendMode:pt),void 0!==o){const e=o.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const u=new Yu(this,s,t,n);return this._bindAction(u,l),this._addInactiveAction(u,a,i),u}existingAction(e,t){const n=t||this._root,r=n.uuid,i="string"==typeof e?zl.findByName(n,e):e,s=i?i.uuid:e,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),s=this._accuIndex^=1;for(let a=0;a!==n;++a){t[a]._update(r,e,i,s)}const a=this._bindings,o=this._nActiveBindings;for(let e=0;e!==o;++e)a[e].apply(s);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,s=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,s._cacheIndex=i,t[i]=s,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}},AnimationObjectGroup:class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=zt(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,s=i.length;let a,o=e.length,l=this.nCachedObjects_;for(let u=0,c=arguments.length;u!==c;++u){const c=arguments[u],d=c.uuid;let h=t[d];if(void 0===h){h=o++,t[d]=h,e.push(c);for(let e=0,t=s;e!==t;++e)i[e].push(new $u(c,n[e],r[e]))}else if(h<l){a=e[h];const o=--l,u=e[o];t[u.uuid]=h,e[h]=u,t[d]=o,e[o]=c;for(let e=0,t=s;e!==t;++e){const t=i[e],s=t[o];let a=t[h];t[h]=s,void 0===a&&(a=new $u(c,n[e],r[e])),t[o]=a}}else e[h]}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=t[o];if(void 0!==l&&l>=i){const s=i++,u=e[s];t[u.uuid]=l,e[l]=u,t[o]=s,e[s]=a;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[s],i=t[l];t[l]=r,t[s]=i}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,s=e.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=t[o];if(void 0!==l)if(delete t[o],l<i){const a=--i,o=e[a],u=--s,c=e[u];t[o.uuid]=l,e[l]=o,t[c.uuid]=a,e[a]=c,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[a],i=t[u];t[l]=r,t[a]=i,t.pop()}}else{const i=--s,a=e[i];i>0&&(t[a.uuid]=l),e[l]=a,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[l]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,u=this.nCachedObjects_,c=new Array(l);r=i.length,n[e]=r,s.push(e),a.push(t),i.push(c);for(let n=u,r=o.length;n!==r;++n){const r=o[n];c[n]=new $u(r,e,t)}return c}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];t[e[a]]=n,s[n]=o,s.pop(),i[n]=i[a],i.pop(),r[n]=r[a],r.pop()}}},AnimationUtils:Al,ArcCurve:Va,ArrowHelper:class extends Er{constructor(e=new Tn(0,0,1),t=new Tn(0,0,0),n=1,r=16776960,i=.2*n,s=.2*i){super(),this.type="ArrowHelper",void 0===wc&&(wc=new mi,wc.setAttribute("position",new oi([0,0,0,0,1,0],3)),Mc=new co(0,.5,1,5,1),Mc.translate(0,-.5,0)),this.position.copy(t),this.line=new ba(wc,new pa({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ai(Mc,new Yr({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,s)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Tc.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Tc,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}},AttachedBindMode:G,Audio:Fu,AudioAnalyser:class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}},AudioContext:Mu,AudioListener:class extends Er{constructor(){super(),this.type="AudioListener",this.context=Mu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Nu}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Iu,Lu,Uu),Du.set(0,0,-1).applyQuaternion(Lu),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Iu.x,e),t.positionY.linearRampToValueAtTime(Iu.y,e),t.positionZ.linearRampToValueAtTime(Iu.z,e),t.forwardX.linearRampToValueAtTime(Du.x,e),t.forwardY.linearRampToValueAtTime(Du.y,e),t.forwardZ.linearRampToValueAtTime(Du.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(Iu.x,Iu.y,Iu.z),t.setOrientation(Du.x,Du.y,Du.z,n.x,n.y,n.z)}},AudioLoader:class extends jl{constructor(e){super(e)}load(e,t,n,r){const i=this,s=new $l(this.manager);function a(t){r&&r(t),i.manager.itemError(e)}s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(e){try{const n=e.slice(0);Mu.getContext().decodeAudioData(n,function(e){t(e)}).catch(a)}catch(e){a(e)}},n,r)}},AxesHelper:class extends Ma{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new mi;n.setAttribute("position",new oi(t,3)),n.setAttribute("color",new oi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new pa({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const r=new jr,i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BasicDepthPacking:3200,BasicShadowMap:0,BatchedMesh:ha,Bone:Cs,BooleanKeyframeTrack:Ll,Box2:class{constructor(e=new Xt(1/0,1/0),t=new Xt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=sc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,sc).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}},Box3:En,Box3Helper:class extends Ma{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new mi;r.setIndex(new ri(n,1)),r.setAttribute("position",new oi([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new pa({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}},BoxHelper:class extends Ma{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new mi;i.setIndex(new ri(n,1)),i.setAttribute("position",new ri(r,3)),super(i,new pa({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(void 0!==this.object&&Sc.setFromObject(this.object),Sc.isEmpty())return;const e=Sc.min,t=Sc.max,n=this.geometry.attributes.position,r=n.array;r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=e.x,r[4]=t.y,r[5]=t.z,r[6]=e.x,r[7]=e.y,r[8]=t.z,r[9]=t.x,r[10]=e.y,r[11]=t.z,r[12]=t.x,r[13]=t.y,r[14]=e.z,r[15]=e.x,r[16]=t.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=t.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}},BufferGeometryLoader:xu,Cache:Gl,Camera:Di,CameraHelper:class extends Ma{constructor(e){const t=new mi,n=new pa({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],s={};function a(e,t){o(e),o(t)}function o(e){r.push(0,0,0),i.push(0,0,0),void 0===s[e]&&(s[e]=[]),s[e].push(r.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),t.setAttribute("position",new oi(r,3)),t.setAttribute("color",new oi(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new jr(16755200),u=new jr(16711680),c=new jr(43775),d=new jr(16777215),h=new jr(3355443);this.setColors(l,u,c,d,h)}setColors(e,t,n,r,i){const s=this.geometry.getAttribute("color");s.setXYZ(0,e.r,e.g,e.b),s.setXYZ(1,e.r,e.g,e.b),s.setXYZ(2,e.r,e.g,e.b),s.setXYZ(3,e.r,e.g,e.b),s.setXYZ(4,e.r,e.g,e.b),s.setXYZ(5,e.r,e.g,e.b),s.setXYZ(6,e.r,e.g,e.b),s.setXYZ(7,e.r,e.g,e.b),s.setXYZ(8,e.r,e.g,e.b),s.setXYZ(9,e.r,e.g,e.b),s.setXYZ(10,e.r,e.g,e.b),s.setXYZ(11,e.r,e.g,e.b),s.setXYZ(12,e.r,e.g,e.b),s.setXYZ(13,e.r,e.g,e.b),s.setXYZ(14,e.r,e.g,e.b),s.setXYZ(15,e.r,e.g,e.b),s.setXYZ(16,e.r,e.g,e.b),s.setXYZ(17,e.r,e.g,e.b),s.setXYZ(18,e.r,e.g,e.b),s.setXYZ(19,e.r,e.g,e.b),s.setXYZ(20,e.r,e.g,e.b),s.setXYZ(21,e.r,e.g,e.b),s.setXYZ(22,e.r,e.g,e.b),s.setXYZ(23,e.r,e.g,e.b),s.setXYZ(24,t.r,t.g,t.b),s.setXYZ(25,t.r,t.g,t.b),s.setXYZ(26,t.r,t.g,t.b),s.setXYZ(27,t.r,t.g,t.b),s.setXYZ(28,t.r,t.g,t.b),s.setXYZ(29,t.r,t.g,t.b),s.setXYZ(30,t.r,t.g,t.b),s.setXYZ(31,t.r,t.g,t.b),s.setXYZ(32,n.r,n.g,n.b),s.setXYZ(33,n.r,n.g,n.b),s.setXYZ(34,n.r,n.g,n.b),s.setXYZ(35,n.r,n.g,n.b),s.setXYZ(36,n.r,n.g,n.b),s.setXYZ(37,n.r,n.g,n.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,i.r,i.g,i.b),s.setXYZ(41,i.r,i.g,i.b),s.setXYZ(42,i.r,i.g,i.b),s.setXYZ(43,i.r,i.g,i.b),s.setXYZ(44,i.r,i.g,i.b),s.setXYZ(45,i.r,i.g,i.b),s.setXYZ(46,i.r,i.g,i.b),s.setXYZ(47,i.r,i.g,i.b),s.setXYZ(48,i.r,i.g,i.b),s.setXYZ(49,i.r,i.g,i.b),s.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap;xc.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const n=this.camera.coordinateSystem===Lt?-1:0;bc("c",t,e,xc,0,0,n),bc("t",t,e,xc,0,0,1),bc("n1",t,e,xc,-1,-1,n),bc("n2",t,e,xc,1,-1,n),bc("n3",t,e,xc,-1,1,n),bc("n4",t,e,xc,1,1,n),bc("f1",t,e,xc,-1,-1,1),bc("f2",t,e,xc,1,-1,1),bc("f3",t,e,xc,-1,1,1),bc("f4",t,e,xc,1,1,1),bc("u1",t,e,xc,.7,1.1,n),bc("u2",t,e,xc,-.7,1.1,n),bc("u3",t,e,xc,0,2,n),bc("cf1",t,e,xc,-1,0,1),bc("cf2",t,e,xc,1,0,1),bc("cf3",t,e,xc,0,-1,1),bc("cf4",t,e,xc,0,1,1),bc("cn1",t,e,xc,-1,0,n),bc("cn2",t,e,xc,1,0,n),bc("cn3",t,e,xc,0,-1,n),bc("cn4",t,e,xc,0,1,n),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},CanvasTexture:Ba,CapsuleGeometry:lo,CatmullRomCurve3:Xa,CircleGeometry:uo,Clock:Nu,ColorKeyframeTrack:Ul,CompressedArrayTexture:class extends Fa{constructor(e,t,n,r,i,s){super(e,t,n,i,s),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Q,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}},CompressedCubeTexture:class extends Fa{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,j),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}},CompressedTexture:Fa,CompressedTextureLoader:class extends jl{constructor(e){super(e)}load(e,t,n,r){const i=this,s=[],a=new Fa,o=new $l(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(i.withCredentials);let l=0;function u(u){o.load(e[u],function(e){const n=i.parse(e,!0);s[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(a.minFilter=ne),a.image=s,a.format=n.format,a.needsUpdate=!0,t&&t(a))},n,r)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)u(t);else o.load(e,function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){s[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)s[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),s[t].format=n.format,s[t].width=n.width,s[t].height=n.height}a.image=s}else a.image.width=n.width,a.image.height=n.height,a.mipmaps=n.mipmaps;1===n.mipmapCount&&(a.minFilter=ne),a.format=n.format,a.needsUpdate=!0,t&&t(a)},n,r);return a}},ConeGeometry:ho,Controls:class extends Dt{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}},CubeCamera:Vi,CubeTextureLoader:class extends jl{constructor(e){super(e)}load(e,t,n,r){const i=new Gi;i.colorSpace=gt;const s=new Yl(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(n){s.load(e[n],function(e){i.images[n]=e,a++,6===a&&(i.needsUpdate=!0,t&&t(i))},void 0,r)}for(let t=0;t<e.length;++t)o(t);return i}},CubicBezierCurve:Qa,CubicBezierCurve3:Za,CubicInterpolant:Rl,CullFaceFrontBack:3,Curve:ka,CurvePath:so,CylinderGeometry:co,Cylindrical:class{constructor(e=1,t=0,n=0){this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}},DataTexture:Rs,DataTextureLoader:class extends jl{constructor(e){super(e)}load(e,t,n,r){const i=this,s=new Rs,a=new $l(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(i.withCredentials),a.load(e,function(e){let n;try{n=i.parse(e)}catch(e){if(void 0===r)return;r(e)}void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:Q,s.wrapT=void 0!==n.wrapT?n.wrapT:Q,s.magFilter=void 0!==n.magFilter?n.magFilter:ne,s.minFilter=void 0!==n.minFilter?n.minFilter:ne,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.colorSpace&&(s.colorSpace=n.colorSpace),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=ie),1===n.mipmapCount&&(s.minFilter=ne),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,t&&t(s,n)},n,r),s}},DataUtils:class{static toHalfFloat(e){return Zr(e)}static fromHalfFloat(e){return Jr(e)}},DecrementStencilOp:7683,DecrementWrapStencilOp:34056,DefaultLoadingManager:Wl,DetachedBindMode:H,DirectionalLight:hu,DirectionalLightHelper:class extends Er{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",void 0===t&&(t=1);let r=new mi;r.setAttribute("position",new oi([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new pa({fog:!1,toneMapped:!1});this.lightPlane=new ba(r,i),this.add(this.lightPlane),r=new mi,r.setAttribute("position",new oi([0,0,0,0,0,1],3)),this.targetLine=new ba(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),gc.setFromMatrixPosition(this.light.matrixWorld),vc.setFromMatrixPosition(this.light.target.matrixWorld),yc.subVectors(vc,gc),this.lightPlane.lookAt(vc),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(vc),this.targetLine.scale.z=yc.length()}},DiscreteInterpolant:Pl,DodecahedronGeometry:fo,DynamicCopyUsage:35050,DynamicDrawUsage:Pt,DynamicReadUsage:35049,EdgesGeometry:_o,EllipseCurve:za,EqualStencilFunc:514,ExtrudeGeometry:Yo,FileLoader:$l,Float16BufferAttribute:ai,Float32BufferAttribute:oi,Fog:$i,FogExp2:Xi,FramebufferTexture:Da,GLBufferAttribute:class{constructor(e,t,n,r,i){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}},GLSL1:"100",GreaterEqualStencilFunc:518,GreaterStencilFunc:516,GridHelper:class extends Ma{constructor(e=10,t=10,n=4473924,r=8947848){n=new jr(n),r=new jr(r);const i=t/2,s=e/t,a=e/2,o=[],l=[];for(let e=0,u=0,c=-a;e<=t;e++,c+=s){o.push(-a,0,c,a,0,c),o.push(c,0,-a,c,0,a);const t=e===i?n:r;t.toArray(l,u),u+=3,t.toArray(l,u),u+=3,t.toArray(l,u),u+=3,t.toArray(l,u),u+=3}const u=new mi;u.setAttribute("position",new oi(o,3)),u.setAttribute("color",new oi(l,3));super(u,new pa({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},Group:Wi,HemisphereLight:Zl,HemisphereLightHelper:class extends Er{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const r=new Zo(t);r.rotateY(.5*Math.PI),this.material=new Yr({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),s=new Float32Array(3*i.count);r.setAttribute("color",new ri(s,3)),this.add(new Ai(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");fc.copy(this.light.color),mc.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?fc:mc;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(pc.setFromMatrixPosition(this.light.matrixWorld).negate())}},IcosahedronGeometry:Qo,ImageBitmapLoader:class extends jl{constructor(e){super(e),this.isImageBitmapLoader=!0,this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,s=Gl.get(e);if(void 0!==s)return i.manager.itemStart(e),s.then?void s.then(n=>{t&&t(n),i.manager.itemEnd(e)}).catch(e=>{r&&r(e)}):(setTimeout(function(){t&&t(s),i.manager.itemEnd(e)},0),s);const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader;const o=fetch(e,a).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))}).then(function(n){return Gl.add(e,n),t&&t(n),i.manager.itemEnd(e),n}).catch(function(t){r&&r(t),Gl.remove(e),i.manager.itemError(e),i.manager.itemEnd(e)});Gl.add(e,o),i.manager.itemStart(e)}},ImageLoader:Yl,ImageUtils:dn,IncrementStencilOp:7682,IncrementWrapStencilOp:34055,InstancedBufferAttribute:Ls,InstancedBufferGeometry:_u,InstancedInterleavedBuffer:Ju,InstancedMesh:Vs,Int16BufferAttribute:class extends ri{constructor(e,t,n){super(new Int16Array(e),t,n)}},Int32BufferAttribute:class extends ri{constructor(e,t,n){super(new Int32Array(e),t,n)}},Int8BufferAttribute:class extends ri{constructor(e,t,n){super(new Int8Array(e),t,n)}},InterleavedBuffer:Ki,InterleavedBufferAttribute:Zi,Interpolant:Cl,InterpolateDiscrete:ot,InterpolateLinear:lt,InterpolateSmooth:ut,InvertStencilOp:5386,KeepStencilOp:xt,KeyframeTrack:Il,LOD:vs,LatheGeometry:oo,LessEqualStencilFunc:515,LessStencilFunc:513,Light:Ql,LightProbe:gu,Line:ba,Line3:class{constructor(e=new Tn,t=new Tn){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){ac.subVectors(e,this.start),oc.subVectors(this.end,this.start);const n=oc.dot(oc);let r=oc.dot(ac)/n;return t&&(r=Vt(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},LineBasicMaterial:pa,LineCurve:Ja,LineCurve3:eo,LineDashedMaterial:bl,LineLoop:Ea,LineSegments:Ma,LinearInterpolant:Nl,LinearMipMapLinearFilter:1008,LinearMipMapNearestFilter:1007,Loader:jl,LoaderUtils:yu,LoadingManager:Hl,LoopOnce:2200,LoopPingPong:2202,LoopRepeat:2201,MOUSE:{LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Material:$r,MaterialLoader:vu,MathUtils:qt,Matrix2:ic,MeshLambertMaterial:vl,MeshMatcapMaterial:xl,MeshNormalMaterial:gl,MeshPhongMaterial:fl,MeshPhysicalMaterial:pl,MeshStandardMaterial:hl,MeshToonMaterial:ml,NearestMipMapLinearFilter:1005,NearestMipMapNearestFilter:1004,NeverStencilFunc:512,NormalAnimationBlendMode:pt,NotEqualStencilFunc:517,NumberKeyframeTrack:Dl,Object3D:Er,ObjectLoader:class extends jl{constructor(e){super(e)}load(e,t,n,r){const i=this,s=""===this.path?yu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||s;const a=new $l(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(n){let s=null;try{s=JSON.parse(n)}catch(e){return void(void 0!==r&&r(e))}const a=s.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?i.parse(s,t):void 0!==r&&r(new Error("THREE.ObjectLoader: Can't load "+e))},n,r)}async loadAsync(e,t){const n=""===this.path?yu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new $l(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const i=await r.loadAsync(e,t),s=JSON.parse(i),a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(s)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),s=this.parseImages(e.images,function(){void 0!==t&&t(l)}),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,i,o,a,n),u=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,u),this.bindLightTargets(l),void 0!==t){let e=!1;for(const t in s)if(s[t].data instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),i=await this.parseImagesAsync(e.images),s=this.parseTextures(e.textures,i),a=this.parseMaterials(e.materials,s),o=this.parseObject(e.object,r,a,s,t),l=this.parseSkeletons(e.skeletons,o);return this.bindSkeletons(o,l),this.bindLightTargets(o),o}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new xo).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse(function(e){e.isBone&&(r[e.uuid]=e)}),void 0!==e)for(let t=0,i=e.length;t<i;t++){const i=(new Is).fromJSON(e[t],r);n[i.uuid]=i}return n}parseGeometries(e,t){const n={};if(void 0!==e){const r=new xu;for(let i=0,s=e.length;i<s;i++){let s;const a=e[i];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":s=r.parse(a);break;default:a.type in ul&&(s=ul[a.type].fromJSON(a,t))}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),void 0!==a.userData&&(s.userData=a.userData),n[a.uuid]=s}}return n}parseMaterials(e,t){const n={},r={};if(void 0!==e){const i=new vu;i.setTextures(t);for(let t=0,s=e.length;t<s;t++){const s=e[t];void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],i=zl.parse(r);t[i.uuid]=i}return t}parseImages(e,t){const n=this,r={};let i;function s(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),i.load(e,function(){n.manager.itemEnd(e)},void 0,function(){n.manager.itemError(e),n.manager.itemEnd(e)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:Zt(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new Hl(t);i=new Yl(n),i.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],i=n.url;if(Array.isArray(i)){const e=[];for(let t=0,n=i.length;t<n;t++){const n=s(i[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new Rs(n.data,n.width,n.height)))}r[n.uuid]=new pn(e)}else{const e=s(n.url);r[n.uuid]=new pn(e)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function i(e){if("string"==typeof e){const n=e,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await r.loadAsync(i)}return e.data?{data:Zt(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){r=new Yl(this.manager),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],s=r.url;if(Array.isArray(s)){const e=[];for(let t=0,n=s.length;t<n;t++){const n=s[t],r=await i(n);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new Rs(r.data,r.width,r.height)))}n[r.uuid]=new pn(e)}else{const e=await i(r.url);n[r.uuid]=new pn(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:t[e]}const r={};if(void 0!==e)for(let i=0,s=e.length;i<s;i++){const s=e[i];s.image,t[s.image];const a=t[s.image],o=a.data;let l;Array.isArray(o)?(l=new Gi,6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new Rs:new gn,o&&(l.needsUpdate=!0)),l.source=a,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=n(s.mapping,bu)),void 0!==s.channel&&(l.channel=s.channel),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=n(s.wrap[0],Su),l.wrapT=n(s.wrap[1],Su)),void 0!==s.format&&(l.format=s.format),void 0!==s.internalFormat&&(l.internalFormat=s.internalFormat),void 0!==s.type&&(l.type=s.type),void 0!==s.colorSpace&&(l.colorSpace=s.colorSpace),void 0!==s.minFilter&&(l.minFilter=n(s.minFilter,Tu)),void 0!==s.magFilter&&(l.magFilter=n(s.magFilter,Tu)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.generateMipmaps&&(l.generateMipmaps=s.generateMipmaps),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.compareFunction&&(l.compareFunction=s.compareFunction),void 0!==s.userData&&(l.userData=s.userData),r[s.uuid]=l}return r}parseObject(e,t,n,r,i){let s,a,o;function l(e){return t[e],t[e]}function u(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];n[i],t.push(n[i])}return t}return n[e],n[e]}}function c(e){return r[e],r[e]}switch(e.type){case"Scene":s=new Yi,void 0!==e.background&&(Number.isInteger(e.background)?s.background=new jr(e.background):s.background=c(e.background)),void 0!==e.environment&&(s.environment=c(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?s.fog=new $i(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(s.fog=new Xi(e.fog.color,e.fog.density)),""!==e.fog.name&&(s.fog.name=e.fog.name)),void 0!==e.backgroundBlurriness&&(s.backgroundBlurriness=e.backgroundBlurriness),void 0!==e.backgroundIntensity&&(s.backgroundIntensity=e.backgroundIntensity),void 0!==e.backgroundRotation&&s.backgroundRotation.fromArray(e.backgroundRotation),void 0!==e.environmentIntensity&&(s.environmentIntensity=e.environmentIntensity),void 0!==e.environmentRotation&&s.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":s=new ki(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(s.focus=e.focus),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.filmGauge&&(s.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(s.filmOffset=e.filmOffset),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"OrthographicCamera":s=new cu(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(s.zoom=e.zoom),void 0!==e.view&&(s.view=Object.assign({},e.view));break;case"AmbientLight":s=new pu(e.color,e.intensity);break;case"DirectionalLight":s=new hu(e.color,e.intensity),s.target=e.target||"";break;case"PointLight":s=new uu(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":s=new fu(e.color,e.intensity,e.width,e.height);break;case"SpotLight":s=new iu(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),s.target=e.target||"";break;case"HemisphereLight":s=new Zl(e.color,e.groundColor,e.intensity);break;case"LightProbe":s=(new gu).fromJSON(e);break;case"SkinnedMesh":a=l(e.geometry),o=u(e.material),s=new As(a,o),void 0!==e.bindMode&&(s.bindMode=e.bindMode),void 0!==e.bindMatrix&&s.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(s.skeleton=e.skeleton);break;case"Mesh":a=l(e.geometry),o=u(e.material),s=new Ai(a,o);break;case"InstancedMesh":a=l(e.geometry),o=u(e.material);const t=e.count,n=e.instanceMatrix,r=e.instanceColor;s=new Vs(a,o,t),s.instanceMatrix=new Ls(new Float32Array(n.array),16),void 0!==r&&(s.instanceColor=new Ls(new Float32Array(r.array),r.itemSize));break;case"BatchedMesh":a=l(e.geometry),o=u(e.material),s=new ha(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,o),s.geometry=a,s.perObjectFrustumCulled=e.perObjectFrustumCulled,s.sortObjects=e.sortObjects,s._drawRanges=e.drawRanges,s._reservedRanges=e.reservedRanges,s._visibility=e.visibility,s._active=e.active,s._bounds=e.bounds.map(e=>{const t=new En;t.min.fromArray(e.boxMin),t.max.fromArray(e.boxMax);const n=new Wn;return n.radius=e.sphereRadius,n.center.fromArray(e.sphereCenter),{boxInitialized:e.boxInitialized,box:t,sphereInitialized:e.sphereInitialized,sphere:n}}),s._maxInstanceCount=e.maxInstanceCount,s._maxVertexCount=e.maxVertexCount,s._maxIndexCount=e.maxIndexCount,s._geometryInitialized=e.geometryInitialized,s._geometryCount=e.geometryCount,s._matricesTexture=c(e.matricesTexture.uuid),void 0!==e.colorsTexture&&(s._colorsTexture=c(e.colorsTexture.uuid));break;case"LOD":s=new vs;break;case"Line":s=new ba(l(e.geometry),u(e.material));break;case"LineLoop":s=new Ea(l(e.geometry),u(e.material));break;case"LineSegments":s=new Ma(l(e.geometry),u(e.material));break;case"PointCloud":case"Points":s=new Ia(l(e.geometry),u(e.material));break;case"Sprite":s=new ps(u(e.material));break;case"Group":s=new Wi;break;case"Bone":s=new Cs;break;default:s=new Er}if(s.uuid=e.uuid,void 0!==e.name&&(s.name=e.name),void 0!==e.matrix?(s.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(s.matrixAutoUpdate=e.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==e.position&&s.position.fromArray(e.position),void 0!==e.rotation&&s.rotation.fromArray(e.rotation),void 0!==e.quaternion&&s.quaternion.fromArray(e.quaternion),void 0!==e.scale&&s.scale.fromArray(e.scale)),void 0!==e.up&&s.up.fromArray(e.up),void 0!==e.castShadow&&(s.castShadow=e.castShadow),void 0!==e.receiveShadow&&(s.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.intensity&&(s.shadow.intensity=e.shadow.intensity),void 0!==e.shadow.bias&&(s.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(s.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(s.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&s.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(s.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(s.visible=e.visible),void 0!==e.frustumCulled&&(s.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(s.renderOrder=e.renderOrder),void 0!==e.userData&&(s.userData=e.userData),void 0!==e.layers&&(s.layers.mask=e.layers),void 0!==e.children){const a=e.children;for(let e=0;e<a.length;e++)s.add(this.parseObject(a[e],t,n,r,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];s.animations.push(i[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(s.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=s.getObjectByProperty("uuid",n.object);void 0!==r&&s.addLevel(r,n.distance,n.hysteresis)}}return s}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse(function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n||e.bind(n,e.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,r=e.getObjectByProperty("uuid",n);t.target=void 0!==r?r:new Er}})}},OctahedronGeometry:Zo,Path:ao,PlaneHelper:class extends ba{constructor(e,t=1,n=16776960){const r=n,i=new mi;i.setAttribute("position",new oi([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),i.computeBoundingSphere(),super(i,new pa({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const s=new mi;s.setAttribute("position",new oi([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new Ai(s,new Yr({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}},PointLight:uu,PointLightHelper:class extends Ai{constructor(e,t,n){super(new nl(t,4,2),new Yr({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},Points:Ia,PointsMaterial:Aa,PolarGridHelper:class extends Ma{constructor(e=10,t=16,n=8,r=64,i=4473924,s=8947848){i=new jr(i),s=new jr(s);const a=[],o=[];if(t>1)for(let n=0;n<t;n++){const r=n/t*(2*Math.PI),l=Math.sin(r)*e,u=Math.cos(r)*e;a.push(0,0,0),a.push(l,0,u);const c=1&n?i:s;o.push(c.r,c.g,c.b),o.push(c.r,c.g,c.b)}for(let t=0;t<n;t++){const l=1&t?i:s,u=e-e/n*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),n=Math.sin(t)*u,i=Math.cos(t)*u;a.push(n,0,i),o.push(l.r,l.g,l.b),t=(e+1)/r*(2*Math.PI),n=Math.sin(t)*u,i=Math.cos(t)*u,a.push(n,0,i),o.push(l.r,l.g,l.b)}}const l=new mi;l.setAttribute("position",new oi(a,3)),l.setAttribute("color",new oi(o,3));super(l,new pa({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}},PolyhedronGeometry:po,PositionalAudio:class extends Fu{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Bu,Ou,ku),zu.set(0,0,1).applyQuaternion(Ou);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Bu.x,e),t.positionY.linearRampToValueAtTime(Bu.y,e),t.positionZ.linearRampToValueAtTime(Bu.z,e),t.orientationX.linearRampToValueAtTime(zu.x,e),t.orientationY.linearRampToValueAtTime(zu.y,e),t.orientationZ.linearRampToValueAtTime(zu.z,e)}else t.setPosition(Bu.x,Bu.y,Bu.z),t.setOrientation(zu.x,zu.y,zu.z)}},PropertyBinding:$u,PropertyMixer:Vu,QuadraticBezierCurve:to,QuadraticBezierCurve3:no,Quaternion:Sn,QuaternionKeyframeTrack:Bl,QuaternionLinearInterpolant:Fl,RGBDepthPacking:3202,RGBIntegerFormat:1032,RGDepthPacking:3203,RawShaderMaterial:dl,Ray:Zn,Raycaster:tc,RectAreaLight:fu,RenderTarget:yn,RenderTarget3D:class extends yn{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isRenderTarget3D=!0,this.depth=n,this.texture=new bn(null,e,t,n),this.texture.isRenderTargetTexture=!0}},RenderTargetArray:class extends yn{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isRenderTargetArray=!0,this.depth=n,this.texture=new xn(null,e,t,n),this.texture.isRenderTargetTexture=!0}},ReplaceStencilOp:7681,RingGeometry:el,Scene:Yi,ShadowMaterial:cl,Shape:xo,ShapeGeometry:tl,ShapePath:class{constructor(){this.type="ShapePath",this.color=new jr,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new ao,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,s){return this.currentPath.bezierCurveTo(e,t,n,r,i,s),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(e,t){const n=t.length;let r=!1;for(let i=n-1,s=0;s<n;i=s++){let n=t[i],a=t[s],o=a.x-n.x,l=a.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=t[s],o=-o,a=t[i],l=-l),e.y<n.y||e.y>a.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=l*(e.x-n.x)-o*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(a.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=a.x)return!0}}return r}const n=qo.isClockWise,r=this.subPaths;if(0===r.length)return[];let i,s,a;const o=[];if(1===r.length)return s=r[0],a=new xo,a.curves=s.curves,o.push(a),o;let l=!n(r[0].getPoints());l=e?!l:l;const u=[],c=[];let d,h,p=[],f=0;c[f]=void 0,p[f]=[];for(let t=0,a=r.length;t<a;t++)s=r[t],d=s.getPoints(),i=n(d),i=e?!i:i,i?(!l&&c[f]&&f++,c[f]={s:new xo,p:d},c[f].s.curves=s.curves,l&&f++,p[f]=[]):p[f].push({h:s,p:d[0]});if(!c[0])return function(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new xo;i.curves=r.curves,t.push(i)}return t}(r);if(c.length>1){let e=!1,n=0;for(let e=0,t=c.length;e<t;e++)u[e]=[];for(let r=0,i=c.length;r<i;r++){const i=p[r];for(let s=0;s<i.length;s++){const a=i[s];let o=!0;for(let i=0;i<c.length;i++)t(a.p,c[i].p)&&(r!==i&&n++,o?(o=!1,u[i].push(a)):e=!0);o&&u[r].push(a)}}n>0&&!1===e&&(p=u)}for(let e=0,t=c.length;e<t;e++){a=c[e].s,o.push(a),h=p[e];for(let e=0,t=h.length;e<t;e++)a.holes.push(h[e].h)}return o}},ShapeUtils:qo,Skeleton:Is,SkeletonHelper:class extends Ma{constructor(e){const t=hc(e),n=new mi,r=[],i=[],s=new jr(0,0,1),a=new jr(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(s.r,s.g,s.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new oi(r,3)),n.setAttribute("color",new oi(i,3));super(n,new pa({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");dc.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(cc.multiplyMatrices(dc,i.matrixWorld),uc.setFromMatrixPosition(cc),r.setXYZ(n,uc.x,uc.y,uc.z),cc.multiplyMatrices(dc,i.parent.matrixWorld),uc.setFromMatrixPosition(cc),r.setXYZ(n+1,uc.x,uc.y,uc.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}},SkinnedMesh:As,Source:pn,Sphere:Wn,SphereGeometry:nl,Spherical:class{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Vt(this.phi,e,Math.PI-e),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Vt(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},SphericalHarmonics3:mu,SplineCurve:ro,SpotLight:iu,SpotLightHelper:class extends Er{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new mi,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const i=e/n*Math.PI*2,s=t/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new oi(r,3));const i=new pa({fog:!1,toneMapped:!1});this.cone=new Ma(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),lc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(lc),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},Sprite:ps,SpriteMaterial:Ji,StaticCopyUsage:35046,StaticDrawUsage:Nt,StaticReadUsage:35045,StereoCamera:class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ki,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ki,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Cu.copy(e.projectionMatrix);const n=t.eyeSep/2,r=n*t.near/t.focus,i=t.near*Math.tan(Ot*t.fov*.5)/t.zoom;let s,a;Au.elements[12]=-n,Eu.elements[12]=n,s=-i*t.aspect+r,a=i*t.aspect+r,Cu.elements[0]=2*t.near/(a-s),Cu.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(Cu),s=-i*t.aspect-r,a=i*t.aspect-r,Cu.elements[0]=2*t.near/(a-s),Cu.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(Cu)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Au),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Eu)}},StreamCopyUsage:35042,StreamDrawUsage:35040,StreamReadUsage:35041,StringKeyframeTrack:Ol,TOUCH:{ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},TetrahedronGeometry:rl,TextureLoader:Kl,TextureUtils:class{static contain(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2):(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0),e}(e,t)}static cover(e,t){return function(e,t){const n=e.image&&e.image.width?e.image.width/e.image.height:1;return n>t?(e.repeat.x=t/n,e.repeat.y=1,e.offset.x=(1-e.repeat.x)/2,e.offset.y=0):(e.repeat.x=1,e.repeat.y=n/t,e.offset.x=0,e.offset.y=(1-e.repeat.y)/2),e}(e,t)}static fill(e){return function(e){return e.repeat.x=1,e.repeat.y=1,e.offset.x=0,e.offset.y=0,e}(e)}static getByteLength(e,t,n,r){return Ec(e,t,n,r)}},TimestampQuery:{COMPUTE:"compute",RENDER:"render"},TorusGeometry:il,TorusKnotGeometry:sl,Triangle:zr,TriangleFanDrawMode:2,TriangleStripDrawMode:1,TrianglesDrawMode:0,TubeGeometry:al,UVMapping:W,Uint8BufferAttribute:class extends ri{constructor(e,t,n){super(new Uint8Array(e),t,n)}},Uint8ClampedBufferAttribute:class extends ri{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}},Uniform:Qu,UniformsGroup:class extends Dt{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Zu++}),this.name="",this.usage=Nt,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let e=0,n=t.length;e<n;e++){const n=Array.isArray(t[e])?t[e]:[t[e]];for(let e=0;e<n.length;e++)this.uniforms.push(n[e].clone())}return this}clone(){return(new this.constructor).copy(this)}},VectorKeyframeTrack:kl,VideoFrameTexture:class extends Ua{constructor(e,t,n,r,i,s,a,o){super({},e,t,n,r,i,s,a,o),this.isVideoFrameTexture=!0}update(){}clone(){return(new this.constructor).copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}},VideoTexture:Ua,WebGL3DRenderTarget:class extends _n{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new bn(null,e,t,n),this.texture.isRenderTargetTexture=!0}},WebGLArrayRenderTarget:class extends _n{constructor(e=1,t=1,n=1,r={}){super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new xn(null,e,t,n),this.texture.isRenderTargetTexture=!0}},WebGPUCoordinateSystem:Ut,WireframeGeometry:ol,WrapAroundEnding:ht,ZeroCurvatureEnding:ct,ZeroSlopeEnding:dt,ZeroStencilOp:0}),hp={exports:{}},pp={};var fp,mp,gp={};var vp=(mp||(mp=1,"production"===process.env.NODE_ENV?hp.exports=(cp||(cp=1,pp.ConcurrentRoot=1,pp.ContinuousEventPriority=4,pp.DefaultEventPriority=16,pp.DiscreteEventPriority=1,pp.IdleEventPriority=536870912,pp.LegacyRoot=0),pp):hp.exports=(fp||(fp=1,"production"!==process.env.NODE_ENV&&(gp.ConcurrentRoot=1,gp.ContinuousEventPriority=4,gp.DefaultEventPriority=16,gp.DiscreteEventPriority=1,gp.IdleEventPriority=536870912,gp.LegacyRoot=0)),gp)),hp.exports);function yp(e){let t;const n=new Set,r=(e,r)=>{const i="function"==typeof e?e(t):e;if(i!==t){const e=t;t=r?i:Object.assign({},t,i),n.forEach(n=>n(t,e))}},i=()=>t,s={setState:r,getState:i,subscribe:(e,r,s)=>r||s?((e,r=i,s=Object.is)=>{let a=r(t);function o(){const n=r(t);if(!s(a,n)){const t=a;e(a=n,t)}}return n.add(o),()=>n.delete(o)})(e,r,s):(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(r,i,s),s}const _p="undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?s:a;const xp=[];function bp(e,t,n=(e,t)=>e===t){if(e===t)return!0;if(!e||!t)return!1;const r=e.length;if(t.length!==r)return!1;for(let i=0;i<r;i++)if(!n(e[i],t[i]))return!1;return!0}function Sp(e,t=null,n=!1,r={}){null===t&&(t=[e]);for(const e of xp)if(bp(t,e.keys,e.equal)){if(n)return;if(Object.prototype.hasOwnProperty.call(e,"error"))throw e.error;if(Object.prototype.hasOwnProperty.call(e,"response"))return r.lifespan&&r.lifespan>0&&(e.timeout&&clearTimeout(e.timeout),e.timeout=setTimeout(e.remove,r.lifespan)),e.response;if(!n)throw e.promise}const i={keys:t,equal:r.equal,remove:()=>{const e=xp.indexOf(i);-1!==e&&xp.splice(e,1)},promise:(s=e,"object"==typeof s&&"function"==typeof s.then?e:e(...t)).then(e=>{i.response=e,r.lifespan&&r.lifespan>0&&(i.timeout=setTimeout(i.remove,r.lifespan))}).catch(e=>i.error=e)};var s;if(xp.push(i),!n)throw i.promise}var Tp,wp={exports:{}},Mp={exports:{}},Ep={};var Ap,Cp,Rp,Np,Pp={};function Ip(){return Ap||(Ap=1,e=Pp,"production"!==process.env.NODE_ENV&&function(){function t(e,t){var n=e.length;e.push(t),function(e,t,n){for(var r=n;r>0;){var s=r-1>>>1,a=e[s];if(!(i(a,t)>0))return;e[s]=t,e[r]=a,r=s}}(e,t,n)}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();return n!==t&&(e[0]=n,function(e,t,n){for(var r=n,s=e.length,a=s>>>1;r<a;){var o=2*(r+1)-1,l=e[o],u=o+1,c=e[u];if(i(l,t)<0)u<s&&i(c,l)<0?(e[r]=c,e[u]=t,r=u):(e[r]=l,e[o]=t,r=o);else{if(!(u<s&&i(c,t)<0))return;e[r]=c,e[u]=t,r=u}}}(e,n,0)),t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error),"object"==typeof performance&&"function"==typeof performance.now){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,d=null,h=3,p=!1,f=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,y="undefined"!=typeof setImmediate?setImmediate:null;function _(e){for(var i=n(u);null!==i;){if(null===i.callback)r(u);else{if(!(i.startTime<=e))return;r(u),i.sortIndex=i.expirationTime,t(l,i)}i=n(u)}}function x(e){if(m=!1,_(e),!f)if(null!==n(l))f=!0,I(b);else{var t=n(u);null!==t&&L(x,t.startTime-e)}}function b(t,i){f=!1,m&&(m=!1,U()),p=!0;var s=h;try{return function(t,i){var s=i;for(_(s),d=n(l);null!==d&&(!(d.expirationTime>s)||t&&!A());){var a=d.callback;if("function"==typeof a){d.callback=null,h=d.priorityLevel;var o=a(d.expirationTime<=s);s=e.unstable_now(),"function"==typeof o?d.callback=o:d===n(l)&&r(l),_(s)}else r(l);d=n(l)}if(null!==d)return!0;var c=n(u);return null!==c&&L(x,c.startTime-s),!1}(t,i)}finally{d=null,h=s,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S=!1,T=null,w=-1,M=5,E=-1;function A(){return!(e.unstable_now()-E<M)}var C,R=function(){if(null!==T){var t=e.unstable_now();E=t;var n=!0;try{n=T(!0,t)}finally{n?C():(S=!1,T=null)}}else S=!1};if("function"==typeof y)C=function(){y(R)};else if("undefined"!=typeof MessageChannel){var N=new MessageChannel,P=N.port2;N.port1.onmessage=R,C=function(){P.postMessage(null)}}else C=function(){g(R,0)};function I(e){T=e,S||(S=!0,C())}function L(t,n){w=g(function(){t(e.unstable_now())},n)}function U(){v(w),w=-1}var D=function(){};e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,I(b))},e.unstable_forceFrameRate=function(e){e<0||e>125||(M=e>0?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){var t;switch(h){case 1:case 2:case 3:t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=D,e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},e.unstable_scheduleCallback=function(r,i,s){var a,o,d=e.unstable_now();if("object"==typeof s&&null!==s){var h=s.delay;a="number"==typeof h&&h>0?d+h:d}else a=d;switch(r){case 1:o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}var g=a+o,v={id:c++,callback:i,priorityLevel:r,startTime:a,expirationTime:g,sortIndex:-1};return a>d?(v.sortIndex=a,t(u,v),null===n(l)&&v===n(u)&&(m?U():m=!0,L(x,a-d))):(v.sortIndex=g,t(l,v),f||p||(f=!0,I(b))),v},e.unstable_shouldYield=A,e.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)}()),Pp;var e}function Lp(){return Cp||(Cp=1,"production"===process.env.NODE_ENV?Mp.exports=(Tp||(Tp=1,function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,s=e[r];if(!(0<i(s,t)))break e;e[r]=t,e[n]=s,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,s=e.length,a=s>>>1;r<a;){var o=2*(r+1)-1,l=e[o],u=o+1,c=e[u];if(0>i(l,n))u<s&&0>i(c,l)?(e[r]=c,e[u]=n,r=u):(e[r]=l,e[o]=n,r=o);else{if(!(u<s&&0>i(c,n)))break e;e[r]=c,e[u]=n,r=u}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var s=performance;e.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();e.unstable_now=function(){return a.now()-o}}var l=[],u=[],c=1,d=null,h=3,p=!1,f=!1,m=!1,g="function"==typeof setTimeout?setTimeout:null,v="function"==typeof clearTimeout?clearTimeout:null,y="undefined"!=typeof setImmediate?setImmediate:null;function _(e){for(var i=n(u);null!==i;){if(null===i.callback)r(u);else{if(!(i.startTime<=e))break;r(u),i.sortIndex=i.expirationTime,t(l,i)}i=n(u)}}function x(e){if(m=!1,_(e),!f)if(null!==n(l))f=!0,I(b);else{var t=n(u);null!==t&&L(x,t.startTime-e)}}function b(t,i){f=!1,m&&(m=!1,v(M),M=-1),p=!0;var s=h;try{for(_(i),d=n(l);null!==d&&(!(d.expirationTime>i)||t&&!C());){var a=d.callback;if("function"==typeof a){d.callback=null,h=d.priorityLevel;var o=a(d.expirationTime<=i);i=e.unstable_now(),"function"==typeof o?d.callback=o:d===n(l)&&r(l),_(i)}else r(l);d=n(l)}if(null!==d)var c=!0;else{var g=n(u);null!==g&&L(x,g.startTime-i),c=!1}return c}finally{d=null,h=s,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,T=!1,w=null,M=-1,E=5,A=-1;function C(){return!(e.unstable_now()-A<E)}function R(){if(null!==w){var t=e.unstable_now();A=t;var n=!0;try{n=w(!0,t)}finally{n?S():(T=!1,w=null)}}else T=!1}if("function"==typeof y)S=function(){y(R)};else if("undefined"!=typeof MessageChannel){var N=new MessageChannel,P=N.port2;N.port1.onmessage=R,S=function(){P.postMessage(null)}}else S=function(){g(R,0)};function I(e){w=e,T||(T=!0,S())}function L(t,n){M=g(function(){t(e.unstable_now())},n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){f||p||(f=!0,I(b))},e.unstable_forceFrameRate=function(e){0>e||125<e||(E=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){switch(h){case 1:case 2:case 3:var t=3;break;default:t=h}var n=h;h=t;try{return e()}finally{h=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=h;h=e;try{return t()}finally{h=n}},e.unstable_scheduleCallback=function(r,i,s){var a=e.unstable_now();switch(s="object"==typeof s&&null!==s&&"number"==typeof(s=s.delay)&&0<s?a+s:a,r){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return r={id:c++,callback:i,priorityLevel:r,startTime:s,expirationTime:o=s+o,sortIndex:-1},s>a?(r.sortIndex=s,t(u,r),null===n(l)&&r===n(u)&&(m?(v(M),M=-1):m=!0,L(x,s-a))):(r.sortIndex=o,t(l,r),f||p||(f=!0,I(b))),r},e.unstable_shouldYield=C,e.unstable_wrapCallback=function(e){var t=h;return function(){var n=h;h=t;try{return e.apply(this,arguments)}finally{h=n}}}}(Ep)),Ep):Mp.exports=Ip()),Mp.exports}function Up(){return Np||(Np=1,Rp=function(e){var n={},r=t,i=Lp(),s=Object.assign;function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),u=Symbol.for("react.portal"),c=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),p=Symbol.for("react.provider"),f=Symbol.for("react.context"),m=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),x=Symbol.for("react.offscreen"),b=Symbol.iterator;function S(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=b&&e[b]||e["@@iterator"])?e:null}function T(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case c:return"Fragment";case u:return"Portal";case h:return"Profiler";case d:return"StrictMode";case g:return"Suspense";case v:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case f:return(e.displayName||"Context")+".Consumer";case p:return(e._context.displayName||"Context")+".Provider";case m:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case y:return null!==(t=e.displayName||null)?t:T(e.type)||"Memo";case _:t=e._payload,e=e._init;try{return T(e(t))}catch(e){}}return null}function w(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return T(t);case 8:return t===d?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof t)return t.displayName||t.name||null;if("string"==typeof t)return t}return null}function M(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{!!(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function E(e){if(M(e)!==e)throw Error(a(188))}function A(e){var t=e.alternate;if(!t){if(null===(t=M(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(r=i.return)){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return E(i),e;if(s===r)return E(i),t;s=s.sibling}throw Error(a(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,l=i.child;l;){if(l===n){o=!0,n=i,r=s;break}if(l===r){o=!0,r=i,n=s;break}l=l.sibling}if(!o){for(l=s.child;l;){if(l===n){o=!0,n=s,r=i;break}if(l===r){o=!0,r=s,n=i;break}l=l.sibling}if(!o)throw Error(a(189))}}if(n.alternate!==r)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}function C(e){return null!==(e=A(e))?R(e):null}function R(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=R(e);if(null!==t)return t;e=e.sibling}return null}function N(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){if(4!==e.tag){var t=N(e);if(null!==t)return t}e=e.sibling}return null}var P,I=Array.isArray,L=e.getPublicInstance,U=e.getRootHostContext,D=e.getChildHostContext,F=e.prepareForCommit,B=e.resetAfterCommit,O=e.createInstance,k=e.appendInitialChild,z=e.finalizeInitialChildren,V=e.prepareUpdate,G=e.shouldSetTextContent,H=e.createTextInstance,W=e.scheduleTimeout,j=e.cancelTimeout,q=e.noTimeout,X=e.isPrimaryRenderer,$=e.supportsMutation,Y=e.supportsPersistence,K=e.supportsHydration,Q=e.getInstanceFromNode,Z=e.preparePortalMount,J=e.getCurrentEventPriority,ee=e.detachDeletedInstance,te=e.supportsMicrotasks,ne=e.scheduleMicrotask,re=e.supportsTestSelectors,ie=e.findFiberRoot,se=e.getBoundingRect,ae=e.getTextContent,oe=e.isHiddenSubtree,le=e.matchAccessibilityRole,ue=e.setFocusIfFocusable,ce=e.setupIntersectionObserver,de=e.appendChild,he=e.appendChildToContainer,pe=e.commitTextUpdate,fe=e.commitMount,me=e.commitUpdate,ge=e.insertBefore,ve=e.insertInContainerBefore,ye=e.removeChild,_e=e.removeChildFromContainer,xe=e.resetTextContent,be=e.hideInstance,Se=e.hideTextInstance,Te=e.unhideInstance,we=e.unhideTextInstance,Me=e.clearContainer,Ee=e.cloneInstance,Ae=e.createContainerChildSet,Ce=e.appendChildToContainerChildSet,Re=e.finalizeContainerChildren,Ne=e.replaceContainerChildren,Pe=e.cloneHiddenInstance,Ie=e.cloneHiddenTextInstance,Le=e.canHydrateInstance,Ue=e.canHydrateTextInstance,De=e.canHydrateSuspenseInstance,Fe=e.isSuspenseInstancePending,Be=e.isSuspenseInstanceFallback,Oe=e.registerSuspenseInstanceRetry,ke=e.getNextHydratableSibling,ze=e.getFirstHydratableChild,Ve=e.getFirstHydratableChildWithinContainer,Ge=e.getFirstHydratableChildWithinSuspenseInstance,He=e.hydrateInstance,We=e.hydrateTextInstance,je=e.hydrateSuspenseInstance,qe=e.getNextHydratableInstanceAfterSuspenseInstance,Xe=e.commitHydratedContainer,$e=e.commitHydratedSuspenseInstance,Ye=e.clearSuspenseBoundary,Ke=e.clearSuspenseBoundaryFromContainer,Qe=e.shouldDeleteUnhydratedTailInstances,Ze=e.didNotMatchHydratedContainerTextInstance,Je=e.didNotMatchHydratedTextInstance;function et(e){if(void 0===P)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);P=t&&t[1]||""}return"\n"+P+e}var tt=!1;function nt(e,t){if(!e||tt)return"";tt=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var r=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){r=e}e.call(t.prototype)}else{try{throw Error()}catch(e){r=e}e()}}catch(t){if(t&&r&&"string"==typeof t.stack){for(var i=t.stack.split("\n"),s=r.stack.split("\n"),a=i.length-1,o=s.length-1;1<=a&&0<=o&&i[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(i[a]!==s[o]){if(1!==a||1!==o)do{if(a--,0>--o||i[a]!==s[o]){var l="\n"+i[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=o);break}}}finally{tt=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?et(e):""}var rt=Object.prototype.hasOwnProperty,it=[],st=-1;function at(e){return{current:e}}function ot(e){0>st||(e.current=it[st],it[st]=null,st--)}function lt(e,t){st++,it[st]=e.current,e.current=t}var ut={},ct=at(ut),dt=at(!1),ht=ut;function pt(e,t){var n=e.type.contextTypes;if(!n)return ut;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,s={};for(i in n)s[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function ft(e){return null!=(e=e.childContextTypes)}function mt(){ot(dt),ot(ct)}function gt(e,t,n){if(ct.current!==ut)throw Error(a(168));lt(ct,t),lt(dt,n)}function vt(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!=typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(a(108,w(e)||"Unknown",i));return s({},n,r)}function yt(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ut,ht=ct.current,lt(ct,e),lt(dt,dt.current),!0}function _t(e,t,n){var r=e.stateNode;if(!r)throw Error(a(169));n?(e=vt(e,t,ht),r.__reactInternalMemoizedMergedChildContext=e,ot(dt),ot(ct),lt(ct,e)):ot(dt),lt(dt,n)}var xt=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(bt(e)/St|0)|0},bt=Math.log,St=Math.LN2;var Tt=64,wt=4194304;function Mt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Et(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,s=e.pingedLanes,a=268435455&n;if(0!==a){var o=a&~i;0!==o?r=Mt(o):0!==(s&=a)&&(r=Mt(s))}else 0!==(a=n&~i)?r=Mt(a):0!==s&&(r=Mt(s));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(s=t&-t)||16===i&&4194240&s))return t;if(4&r&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-xt(t)),r|=e[n],t&=~i;return r}function At(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Ct(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Rt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Nt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-xt(t)]=n}function Pt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-xt(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var It=0;function Lt(e){return 1<(e&=-e)?4<e?268435455&e?16:536870912:4:1}var Ut=i.unstable_scheduleCallback,Dt=i.unstable_cancelCallback,Ft=i.unstable_shouldYield,Bt=i.unstable_requestPaint,Ot=i.unstable_now,kt=i.unstable_ImmediatePriority,zt=i.unstable_UserBlockingPriority,Vt=i.unstable_NormalPriority,Gt=i.unstable_IdlePriority,Ht=null,Wt=null;var jt="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},qt=null,Xt=!1,$t=!1;function Yt(e){null===qt?qt=[e]:qt.push(e)}function Kt(){if(!$t&&null!==qt){$t=!0;var e=0,t=It;try{var n=qt;for(It=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}qt=null,Xt=!1}catch(t){throw null!==qt&&(qt=qt.slice(e+1)),Ut(kt,Kt),t}finally{It=t,$t=!1}}return null}var Qt=o.ReactCurrentBatchConfig;function Zt(e,t){if(jt(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!rt.call(t,i)||!jt(e[i],t[i]))return!1}return!0}function Jt(e){switch(e.tag){case 5:return et(e.type);case 16:return et("Lazy");case 13:return et("Suspense");case 19:return et("SuspenseList");case 0:case 2:case 15:return e=nt(e.type,!1);case 11:return e=nt(e.type.render,!1);case 1:return e=nt(e.type,!0);default:return""}}function en(e,t){if(e&&e.defaultProps){for(var n in t=s({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var tn=at(null),nn=null,rn=null,sn=null;function an(){sn=rn=nn=null}function on(e,t,n){X?(lt(tn,t._currentValue),t._currentValue=n):(lt(tn,t._currentValue2),t._currentValue2=n)}function ln(e){var t=tn.current;ot(tn),X?e._currentValue=t:e._currentValue2=t}function un(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function cn(e,t){nn=e,sn=rn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Di=!0),e.firstContext=null)}function dn(e){var t=X?e._currentValue:e._currentValue2;if(sn!==e)if(e={context:e,memoizedValue:t,next:null},null===rn){if(null===nn)throw Error(a(308));rn=e,nn.dependencies={lanes:0,firstContext:e}}else rn=rn.next=e;return t}var hn=null,pn=!1;function fn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function gn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function vn(e,t){var n=e.updateQueue;null!==n&&(n=n.shared,null!==Xs&&1&e.mode&&!(2&qs)?(null===(e=n.interleaved)?(t.next=t,null===hn?hn=[n]:hn.push(n)):(t.next=e.next,e.next=t),n.interleaved=t):(null===(e=n.pending)?t.next=t:(t.next=e.next,e.next=t),n.pending=t))}function yn(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Pt(e,n)}}function _n(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,s=null;if(null!==(n=n.firstBaseUpdate)){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===s?i=s=a:s=s.next=a,n=n.next}while(null!==n);null===s?i=s=t:s=s.next=t}else i=s=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function xn(e,t,n,r){var i=e.updateQueue;pn=!1;var a=i.firstBaseUpdate,o=i.lastBaseUpdate,l=i.shared.pending;if(null!==l){i.shared.pending=null;var u=l,c=u.next;u.next=null,null===o?a=c:o.next=c,o=u;var d=e.alternate;null!==d&&((l=(d=d.updateQueue).lastBaseUpdate)!==o&&(null===l?d.firstBaseUpdate=c:l.next=c,d.lastBaseUpdate=u))}if(null!==a){var h=i.baseState;for(o=0,d=c=u=null,l=a;;){var p=l.lane,f=l.eventTime;if((r&p)===p){null!==d&&(d=d.next={eventTime:f,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var m=e,g=l;switch(p=t,f=n,g.tag){case 1:if("function"==typeof(m=g.payload)){h=m.call(f,h,p);break e}h=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null==(p="function"==typeof(m=g.payload)?m.call(f,h,p):m))break e;h=s({},h,p);break e;case 2:pn=!0}}null!==l.callback&&0!==l.lane&&(e.flags|=64,null===(p=i.effects)?i.effects=[l]:p.push(l))}else f={eventTime:f,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},null===d?(c=d=f,u=h):d=d.next=f,o|=p;if(null===(l=l.next)){if(null===(l=i.shared.pending))break;l=(p=l).next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}if(null===d&&(u=h),i.baseState=u,i.firstBaseUpdate=c,i.lastBaseUpdate=d,null!==(t=i.shared.interleaved)){i=t;do{o|=i.lane,i=i.next}while(i!==t)}else null===a&&(i.shared.lanes=0);ea|=o,e.lanes=o,e.memoizedState=h}}function bn(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!=typeof i)throw Error(a(191,i));i.call(r)}}}var Sn=(new r.Component).refs;function Tn(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:s({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var wn={isMounted:function(e){return!!(e=e._reactInternals)&&M(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=_a(),i=xa(e),s=gn(r,i);s.payload=t,null!=n&&(s.callback=n),vn(e,s),null!==(t=ba(e,i,r))&&yn(t,e,i)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=_a(),i=xa(e),s=gn(r,i);s.tag=1,s.payload=t,null!=n&&(s.callback=n),vn(e,s),null!==(t=ba(e,i,r))&&yn(t,e,i)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=_a(),r=xa(e),i=gn(n,r);i.tag=2,null!=t&&(i.callback=t),vn(e,i),null!==(t=ba(e,r,n))&&yn(t,e,r)}};function Mn(e,t,n,r,i,s,a){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,s,a):!t.prototype||!t.prototype.isPureReactComponent||(!Zt(n,r)||!Zt(i,s))}function En(e,t,n){var r=!1,i=ut,s=t.contextType;return"object"==typeof s&&null!==s?s=dn(s):(i=ft(t)?ht:ct.current,s=(r=null!=(r=t.contextTypes))?pt(e,i):ut),t=new t(n,s),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=wn,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=s),t}function An(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&wn.enqueueReplaceState(t,t.state,null)}function Cn(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=Sn,fn(e);var s=t.contextType;"object"==typeof s&&null!==s?i.context=dn(s):(s=ft(t)?ht:ct.current,i.context=pt(e,s)),i.state=e.memoizedState,"function"==typeof(s=t.getDerivedStateFromProps)&&(Tn(e,t,s,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(t=i.state,"function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&wn.enqueueReplaceState(i,i.state,null),xn(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount&&(e.flags|=4194308)}var Rn=[],Nn=0,Pn=null,In=0,Ln=[],Un=0,Dn=null,Fn=1,Bn="";function On(e,t){Rn[Nn++]=In,Rn[Nn++]=Pn,Pn=e,In=t}function kn(e,t,n){Ln[Un++]=Fn,Ln[Un++]=Bn,Ln[Un++]=Dn,Dn=e;var r=Fn;e=Bn;var i=32-xt(r)-1;r&=~(1<<i),n+=1;var s=32-xt(t)+i;if(30<s){var a=i-i%5;s=(r&(1<<a)-1).toString(32),r>>=a,i-=a,Fn=1<<32-xt(t)+i|n<<i|r,Bn=s+e}else Fn=1<<s|n<<i|r,Bn=e}function zn(e){null!==e.return&&(On(e,1),kn(e,1,0))}function Vn(e){for(;e===Pn;)Pn=Rn[--Nn],Rn[Nn]=null,In=Rn[--Nn],Rn[Nn]=null;for(;e===Dn;)Dn=Ln[--Un],Ln[Un]=null,Bn=Ln[--Un],Ln[Un]=null,Fn=Ln[--Un],Ln[Un]=null}var Gn=null,Hn=null,Wn=!1,jn=!1,qn=null;function Xn(e,t){var n=Ka(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function $n(e,t){switch(e.tag){case 5:return null!==(t=Le(t,e.type,e.pendingProps))&&(e.stateNode=t,Gn=e,Hn=ze(t),!0);case 6:return null!==(t=Ue(t,e.pendingProps))&&(e.stateNode=t,Gn=e,Hn=null,!0);case 13:if(null!==(t=De(t))){var n=null!==Dn?{id:Fn,overflow:Bn}:null;return e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Ka(18,null,null,0)).stateNode=t,n.return=e,e.child=n,Gn=e,Hn=null,!0}return!1;default:return!1}}function Yn(e){return!(!(1&e.mode)||128&e.flags)}function Kn(e){if(Wn){var t=Hn;if(t){var n=t;if(!$n(e,t)){if(Yn(e))throw Error(a(418));t=ke(n);var r=Gn;t&&$n(e,t)?Xn(r,n):(e.flags=-4097&e.flags|2,Wn=!1,Gn=e)}}else{if(Yn(e))throw Error(a(418));e.flags=-4097&e.flags|2,Wn=!1,Gn=e}}}function Qn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Gn=e}function Zn(e){if(!K||e!==Gn)return!1;if(!Wn)return Qn(e),Wn=!0,!1;if(3!==e.tag&&(5!==e.tag||Qe(e.type)&&!G(e.type,e.memoizedProps))){var t=Hn;if(t){if(Yn(e)){for(e=Hn;e;)e=ke(e);throw Error(a(418))}for(;t;)Xn(e,t),t=ke(t)}}if(Qn(e),13===e.tag){if(!K)throw Error(a(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));Hn=qe(e)}else Hn=Gn?ke(e.stateNode):null;return!0}function Jn(){K&&(Hn=Gn=null,jn=Wn=!1)}function er(e){null===qn?qn=[e]:qn.push(e)}function tr(e,t,n){if(null!==(e=n.ref)&&"function"!=typeof e&&"object"!=typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var r=n.stateNode}if(!r)throw Error(a(147,e));var i=r,s=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=i.refs;t===Sn&&(t=i.refs={}),null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!=typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function nr(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function rr(e){return(0,e._init)(e._payload)}function ir(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Za(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function d(e,t,n,r){return null===t||6!==t.tag?((t=no(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n,r){var s=n.type;return s===c?f(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===s||"object"==typeof s&&null!==s&&s.$$typeof===_&&rr(s)===t.type)?((r=i(t,n.props)).ref=tr(e,t,n),r.return=e,r):((r=Ja(n.type,n.key,n.props,null,e.mode,r)).ref=tr(e,t,n),r.return=e,r)}function p(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=ro(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function f(e,t,n,r,s){return null===t||7!==t.tag?((t=eo(n,e.mode,r,s)).return=e,t):((t=i(t,n)).return=e,t)}function m(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t)return(t=no(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case l:return(n=Ja(t.type,t.key,t.props,null,e.mode,n)).ref=tr(e,null,t),n.return=e,n;case u:return(t=ro(t,e.mode,n)).return=e,t;case _:return m(e,(0,t._init)(t._payload),n)}if(I(t)||S(t))return(t=eo(t,e.mode,n,null)).return=e,t;nr(e,t)}return null}function g(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==i?null:d(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case l:return n.key===i?h(e,t,n,r):null;case u:return n.key===i?p(e,t,n,r):null;case _:return g(e,t,(i=n._init)(n._payload),r)}if(I(n)||S(n))return null!==i?null:f(e,t,n,r,null);nr(e,n)}return null}function v(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return d(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case l:return h(t,e=e.get(null===r.key?n:r.key)||null,r,i);case u:return p(t,e=e.get(null===r.key?n:r.key)||null,r,i);case _:return v(e,t,n,(0,r._init)(r._payload),i)}if(I(r)||S(r))return f(t,e=e.get(n)||null,r,i,null);nr(t,r)}return null}function y(i,a,o,l){for(var u=null,c=null,d=a,h=a=0,p=null;null!==d&&h<o.length;h++){d.index>h?(p=d,d=null):p=d.sibling;var f=g(i,d,o[h],l);if(null===f){null===d&&(d=p);break}e&&d&&null===f.alternate&&t(i,d),a=s(f,a,h),null===c?u=f:c.sibling=f,c=f,d=p}if(h===o.length)return n(i,d),Wn&&On(i,h),u;if(null===d){for(;h<o.length;h++)null!==(d=m(i,o[h],l))&&(a=s(d,a,h),null===c?u=d:c.sibling=d,c=d);return Wn&&On(i,h),u}for(d=r(i,d);h<o.length;h++)null!==(p=v(d,i,h,o[h],l))&&(e&&null!==p.alternate&&d.delete(null===p.key?h:p.key),a=s(p,a,h),null===c?u=p:c.sibling=p,c=p);return e&&d.forEach(function(e){return t(i,e)}),Wn&&On(i,h),u}function x(i,o,l,u){var c=S(l);if("function"!=typeof c)throw Error(a(150));if(null==(l=c.call(l)))throw Error(a(151));for(var d=c=null,h=o,p=o=0,f=null,y=l.next();null!==h&&!y.done;p++,y=l.next()){h.index>p?(f=h,h=null):f=h.sibling;var _=g(i,h,y.value,u);if(null===_){null===h&&(h=f);break}e&&h&&null===_.alternate&&t(i,h),o=s(_,o,p),null===d?c=_:d.sibling=_,d=_,h=f}if(y.done)return n(i,h),Wn&&On(i,p),c;if(null===h){for(;!y.done;p++,y=l.next())null!==(y=m(i,y.value,u))&&(o=s(y,o,p),null===d?c=y:d.sibling=y,d=y);return Wn&&On(i,p),c}for(h=r(i,h);!y.done;p++,y=l.next())null!==(y=v(h,i,p,y.value,u))&&(e&&null!==y.alternate&&h.delete(null===y.key?p:y.key),o=s(y,o,p),null===d?c=y:d.sibling=y,d=y);return e&&h.forEach(function(e){return t(i,e)}),Wn&&On(i,p),c}return function e(r,s,a,d){if("object"==typeof a&&null!==a&&a.type===c&&null===a.key&&(a=a.props.children),"object"==typeof a&&null!==a){switch(a.$$typeof){case l:e:{for(var h=a.key,p=s;null!==p;){if(p.key===h){if((h=a.type)===c){if(7===p.tag){n(r,p.sibling),(s=i(p,a.props.children)).return=r,r=s;break e}}else if(p.elementType===h||"object"==typeof h&&null!==h&&h.$$typeof===_&&rr(h)===p.type){n(r,p.sibling),(s=i(p,a.props)).ref=tr(r,p,a),s.return=r,r=s;break e}n(r,p);break}t(r,p),p=p.sibling}a.type===c?((s=eo(a.props.children,r.mode,d,a.key)).return=r,r=s):((d=Ja(a.type,a.key,a.props,null,r.mode,d)).ref=tr(r,s,a),d.return=r,r=d)}return o(r);case u:e:{for(p=a.key;null!==s;){if(s.key===p){if(4===s.tag&&s.stateNode.containerInfo===a.containerInfo&&s.stateNode.implementation===a.implementation){n(r,s.sibling),(s=i(s,a.children||[])).return=r,r=s;break e}n(r,s);break}t(r,s),s=s.sibling}(s=ro(a,r.mode,d)).return=r,r=s}return o(r);case _:return e(r,s,(p=a._init)(a._payload),d)}if(I(a))return y(r,s,a,d);if(S(a))return x(r,s,a,d);nr(r,a)}return"string"==typeof a&&""!==a||"number"==typeof a?(a=""+a,null!==s&&6===s.tag?(n(r,s.sibling),(s=i(s,a)).return=r,r=s):(n(r,s),(s=no(a,r.mode,d)).return=r,r=s),o(r)):n(r,s)}}var sr=ir(!0),ar=ir(!1),or={},lr=at(or),ur=at(or),cr=at(or);function dr(e){if(e===or)throw Error(a(174));return e}function hr(e,t){lt(cr,t),lt(ur,e),lt(lr,or),e=U(t),ot(lr),lt(lr,e)}function pr(){ot(lr),ot(ur),ot(cr)}function fr(e){var t=dr(cr.current),n=dr(lr.current);n!==(t=D(n,e.type,t))&&(lt(ur,e),lt(lr,t))}function mr(e){ur.current===e&&(ot(lr),ot(ur))}var gr=at(0);function vr(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Fe(n)||Be(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(128&t.flags)return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var yr=[];function _r(){for(var e=0;e<yr.length;e++){var t=yr[e];X?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}yr.length=0}var xr=o.ReactCurrentDispatcher,br=o.ReactCurrentBatchConfig,Sr=0,Tr=null,wr=null,Mr=null,Er=!1,Ar=!1,Cr=0,Rr=0;function Nr(){throw Error(a(321))}function Pr(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!jt(e[n],t[n]))return!1;return!0}function Ir(e,t,n,r,i,s){if(Sr=s,Tr=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,xr.current=null===e||null===e.memoizedState?fi:mi,e=n(r,i),Ar){s=0;do{if(Ar=!1,Cr=0,25<=s)throw Error(a(301));s+=1,Mr=wr=null,t.updateQueue=null,xr.current=gi,e=n(r,i)}while(Ar)}if(xr.current=pi,t=null!==wr&&null!==wr.next,Sr=0,Mr=wr=Tr=null,Er=!1,t)throw Error(a(300));return e}function Lr(){var e=0!==Cr;return Cr=0,e}function Ur(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Mr?Tr.memoizedState=Mr=e:Mr=Mr.next=e,Mr}function Dr(){if(null===wr){var e=Tr.alternate;e=null!==e?e.memoizedState:null}else e=wr.next;var t=null===Mr?Tr.memoizedState:Mr.next;if(null!==t)Mr=t,wr=e;else{if(null===e)throw Error(a(310));e={memoizedState:(wr=e).memoizedState,baseState:wr.baseState,baseQueue:wr.baseQueue,queue:wr.queue,next:null},null===Mr?Tr.memoizedState=Mr=e:Mr=Mr.next=e}return Mr}function Fr(e,t){return"function"==typeof t?t(e):t}function Br(e){var t=Dr(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=wr,i=r.baseQueue,s=n.pending;if(null!==s){if(null!==i){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(null!==i){s=i.next,r=r.baseState;var l=o=null,u=null,c=s;do{var d=c.lane;if((Sr&d)===d)null!==u&&(u=u.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:e(r,c.action);else{var h={lane:d,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};null===u?(l=u=h,o=r):u=u.next=h,Tr.lanes|=d,ea|=d}c=c.next}while(null!==c&&c!==s);null===u?o=r:u.next=l,jt(r,t.memoizedState)||(Di=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=u,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{s=i.lane,Tr.lanes|=s,ea|=s,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Or(e){var t=Dr(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(null!==i){n.pending=null;var o=i=i.next;do{s=e(s,o.action),o=o.next}while(o!==i);jt(s,t.memoizedState)||(Di=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function kr(){}function zr(e,t){var n=Tr,r=Dr(),i=t(),s=!jt(r.memoizedState,i);if(s&&(r.memoizedState=i,Di=!0),r=r.queue,Qr(Hr.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==Mr&&1&Mr.memoizedState.tag){if(n.flags|=2048,qr(9,Gr.bind(null,n,r,i,t),void 0,null),null===Xs)throw Error(a(349));30&Sr||Vr(n,t,i)}return i}function Vr(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=Tr.updateQueue)?(t={lastEffect:null,stores:null},Tr.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Gr(e,t,n,r){t.value=n,t.getSnapshot=r,Wr(t)&&ba(e,1,-1)}function Hr(e,t,n){return n(function(){Wr(t)&&ba(e,1,-1)})}function Wr(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!jt(e,n)}catch(e){return!0}}function jr(e){var t=Ur();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Fr,lastRenderedState:e},t.queue=e,e=e.dispatch=li.bind(null,Tr,e),[t.memoizedState,e]}function qr(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Tr.updateQueue)?(t={lastEffect:null,stores:null},Tr.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Xr(){return Dr().memoizedState}function $r(e,t,n,r){var i=Ur();Tr.flags|=e,i.memoizedState=qr(1|t,n,void 0,void 0===r?null:r)}function Yr(e,t,n,r){var i=Dr();r=void 0===r?null:r;var s=void 0;if(null!==wr){var a=wr.memoizedState;if(s=a.destroy,null!==r&&Pr(r,a.deps))return void(i.memoizedState=qr(t,n,s,r))}Tr.flags|=e,i.memoizedState=qr(1|t,n,s,r)}function Kr(e,t){return $r(8390656,8,e,t)}function Qr(e,t){return Yr(2048,8,e,t)}function Zr(e,t){return Yr(4,2,e,t)}function Jr(e,t){return Yr(4,4,e,t)}function ei(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function ti(e,t,n){return n=null!=n?n.concat([e]):null,Yr(4,4,ei.bind(null,t,e),n)}function ni(){}function ri(e,t){var n=Dr();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Pr(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function ii(e,t){var n=Dr();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Pr(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function si(e,t){var n=It;It=0!==n&&4>n?n:4,e(!0);var r=br.transition;br.transition={};try{e(!1),t()}finally{It=n,br.transition=r}}function ai(){return Dr().memoizedState}function oi(e,t,n){var r=xa(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ui(e)?ci(t,n):(di(e,t,n),null!==(e=ba(e,r,n=_a()))&&hi(e,t,r))}function li(e,t,n){var r=xa(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ui(e))ci(t,i);else{di(e,t,i);var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var a=t.lastRenderedState,o=s(a,n);if(i.hasEagerState=!0,i.eagerState=o,jt(o,a))return}catch(e){}null!==(e=ba(e,r,n=_a()))&&hi(e,t,r)}}function ui(e){var t=e.alternate;return e===Tr||null!==t&&t===Tr}function ci(e,t){Ar=Er=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function di(e,t,n){null!==Xs&&1&e.mode&&!(2&qs)?(null===(e=t.interleaved)?(n.next=n,null===hn?hn=[t]:hn.push(t)):(n.next=e.next,e.next=n),t.interleaved=n):(null===(e=t.pending)?n.next=n:(n.next=e.next,e.next=n),t.pending=n)}function hi(e,t,n){if(4194240&n){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Pt(e,n)}}var pi={readContext:dn,useCallback:Nr,useContext:Nr,useEffect:Nr,useImperativeHandle:Nr,useInsertionEffect:Nr,useLayoutEffect:Nr,useMemo:Nr,useReducer:Nr,useRef:Nr,useState:Nr,useDebugValue:Nr,useDeferredValue:Nr,useTransition:Nr,useMutableSource:Nr,useSyncExternalStore:Nr,useId:Nr,unstable_isNewReconciler:!1},fi={readContext:dn,useCallback:function(e,t){return Ur().memoizedState=[e,void 0===t?null:t],e},useContext:dn,useEffect:Kr,useImperativeHandle:function(e,t,n){return n=null!=n?n.concat([e]):null,$r(4194308,4,ei.bind(null,t,e),n)},useLayoutEffect:function(e,t){return $r(4194308,4,e,t)},useInsertionEffect:function(e,t){return $r(4,2,e,t)},useMemo:function(e,t){var n=Ur();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ur();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=oi.bind(null,Tr,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ur().memoizedState=e},useState:jr,useDebugValue:ni,useDeferredValue:function(e){var t=jr(e),n=t[0],r=t[1];return Kr(function(){var t=br.transition;br.transition={};try{r(e)}finally{br.transition=t}},[e]),n},useTransition:function(){var e=jr(!1),t=e[0];return e=si.bind(null,e[1]),Ur().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=Tr,i=Ur();if(Wn){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Xs)throw Error(a(349));30&Sr||Vr(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,Kr(Hr.bind(null,r,s,e),[e]),r.flags|=2048,qr(9,Gr.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=Ur(),t=Xs.identifierPrefix;if(Wn){var n=Bn;t=":"+t+"R"+(n=(Fn&~(1<<32-xt(Fn)-1)).toString(32)+n),0<(n=Cr++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Rr++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},mi={readContext:dn,useCallback:ri,useContext:dn,useEffect:Qr,useImperativeHandle:ti,useInsertionEffect:Zr,useLayoutEffect:Jr,useMemo:ii,useReducer:Br,useRef:Xr,useState:function(){return Br(Fr)},useDebugValue:ni,useDeferredValue:function(e){var t=Br(Fr),n=t[0],r=t[1];return Qr(function(){var t=br.transition;br.transition={};try{r(e)}finally{br.transition=t}},[e]),n},useTransition:function(){return[Br(Fr)[0],Dr().memoizedState]},useMutableSource:kr,useSyncExternalStore:zr,useId:ai,unstable_isNewReconciler:!1},gi={readContext:dn,useCallback:ri,useContext:dn,useEffect:Qr,useImperativeHandle:ti,useInsertionEffect:Zr,useLayoutEffect:Jr,useMemo:ii,useReducer:Or,useRef:Xr,useState:function(){return Or(Fr)},useDebugValue:ni,useDeferredValue:function(e){var t=Or(Fr),n=t[0],r=t[1];return Qr(function(){var t=br.transition;br.transition={};try{r(e)}finally{br.transition=t}},[e]),n},useTransition:function(){return[Or(Fr)[0],Dr().memoizedState]},useMutableSource:kr,useSyncExternalStore:zr,useId:ai,unstable_isNewReconciler:!1};function vi(e,t){try{var n="",r=t;do{n+=Jt(r),r=r.return}while(r);var i=n}catch(e){i="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:i}}var yi,_i,xi,bi,Si="function"==typeof WeakMap?WeakMap:Map;function Ti(e,t,n){(n=gn(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){ua||(ua=!0,ca=r)},n}function wi(e,t,n){(n=gn(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"==typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){}}var s=e.stateNode;return null!==s&&"function"==typeof s.componentDidCatch&&(n.callback=function(){"function"!=typeof r&&(null===da?da=new Set([this]):da.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function Mi(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new Si;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Wa.bind(null,e,t,n),t.then(e,e))}function Ei(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Ai(e,t,n,r,i){return 1&e.mode?(e.flags|=65536,e.lanes=i,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=gn(-1,1)).tag=2,vn(n,t))),n.lanes|=1),e)}function Ci(e){e.flags|=4}function Ri(e,t){if(null!==e&&e.child===t.child)return!0;if(16&t.flags)return!1;for(e=t.child;null!==e;){if(12854&e.flags||12854&e.subtreeFlags)return!1;e=e.sibling}return!0}if($)yi=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)k(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},_i=function(){},xi=function(e,t,n,r,i){if((e=e.memoizedProps)!==r){var s=t.stateNode,a=dr(lr.current);n=V(s,n,e,r,i,a),(t.updateQueue=n)&&Ci(t)}},bi=function(e,t,n,r){n!==r&&Ci(t)};else if(Y){yi=function(e,t,n,r){for(var i=t.child;null!==i;){if(5===i.tag){var s=i.stateNode;n&&r&&(s=Pe(s,i.type,i.memoizedProps,i)),k(e,s)}else if(6===i.tag)s=i.stateNode,n&&r&&(s=Ie(s,i.memoizedProps,i)),k(e,s);else if(4!==i.tag)if(22===i.tag&&null!==i.memoizedState)null!==(s=i.child)&&(s.return=i),yi(e,i,!0,!0);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};var Ni=function(e,t,n,r){for(var i=t.child;null!==i;){if(5===i.tag){var s=i.stateNode;n&&r&&(s=Pe(s,i.type,i.memoizedProps,i)),Ce(e,s)}else if(6===i.tag)s=i.stateNode,n&&r&&(s=Ie(s,i.memoizedProps,i)),Ce(e,s);else if(4!==i.tag)if(22===i.tag&&null!==i.memoizedState)null!==(s=i.child)&&(s.return=i),Ni(e,i,!0,!0);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};_i=function(e,t){var n=t.stateNode;if(!Ri(e,t)){e=n.containerInfo;var r=Ae(e);Ni(r,t,!1,!1),n.pendingChildren=r,Ci(t),Re(e,r)}},xi=function(e,t,n,r,i){var s=e.stateNode,a=e.memoizedProps;if((e=Ri(e,t))&&a===r)t.stateNode=s;else{var o=t.stateNode,l=dr(lr.current),u=null;a!==r&&(u=V(o,n,a,r,i,l)),e&&null===u?t.stateNode=s:(s=Ee(s,u,n,a,r,t,e,o),z(s,n,r,i,l)&&Ci(t),t.stateNode=s,e?Ci(t):yi(s,t,!1,!1))}},bi=function(e,t,n,r){n!==r?(e=dr(cr.current),n=dr(lr.current),t.stateNode=H(r,e,n,t),Ci(t)):t.stateNode=e.stateNode}}else _i=function(){},xi=function(){},bi=function(){};function Pi(e,t){if(!Wn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ii(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Li(e,t,n){var r=t.pendingProps;switch(Vn(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ii(t),null;case 1:case 17:return ft(t.type)&&mt(),Ii(t),null;case 3:return r=t.stateNode,pr(),ot(dt),ot(ct),_r(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Zn(t)?Ci(t):null===e||e.memoizedState.isDehydrated&&!(256&t.flags)||(t.flags|=1024,null!==qn&&(Ea(qn),qn=null))),_i(e,t),Ii(t),null;case 5:mr(t),n=dr(cr.current);var i=t.type;if(null!==e&&null!=t.stateNode)xi(e,t,i,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Ii(t),null}if(e=dr(lr.current),Zn(t)){if(!K)throw Error(a(175));e=He(t.stateNode,t.type,t.memoizedProps,n,e,t,!jn),t.updateQueue=e,null!==e&&Ci(t)}else{var s=O(i,r,n,e,t);yi(s,t,!1,!1),t.stateNode=s,z(s,i,r,n,e)&&Ci(t)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ii(t),null;case 6:if(e&&null!=t.stateNode)bi(e,t,e.memoizedProps,r);else{if("string"!=typeof r&&null===t.stateNode)throw Error(a(166));if(e=dr(cr.current),n=dr(lr.current),Zn(t)){if(!K)throw Error(a(176));if(e=t.stateNode,r=t.memoizedProps,(n=We(e,r,t,!jn))&&null!==(i=Gn))switch(s=!!(1&i.mode),i.tag){case 3:Ze(i.stateNode.containerInfo,e,r,s);break;case 5:Je(i.type,i.memoizedProps,i.stateNode,e,r,s)}n&&Ci(t)}else t.stateNode=H(r,e,n,t)}return Ii(t),null;case 13:if(ot(gr),r=t.memoizedState,Wn&&null!==Hn&&1&t.mode&&!(128&t.flags)){for(e=Hn;e;)e=ke(e);return Jn(),t.flags|=98560,t}if(null!==r&&null!==r.dehydrated){if(r=Zn(t),null===e){if(!r)throw Error(a(318));if(!K)throw Error(a(344));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(a(317));je(e,t)}else Jn(),!(128&t.flags)&&(t.memoizedState=null),t.flags|=4;return Ii(t),null}return null!==qn&&(Ea(qn),qn=null),128&t.flags?(t.lanes=n,t):(r=null!==r,n=!1,null===e?Zn(t):n=null!==e.memoizedState,r&&!n&&(t.child.flags|=8192,1&t.mode&&(null===e||1&gr.current?0===Zs&&(Zs=3):Ua())),null!==t.updateQueue&&(t.flags|=4),Ii(t),null);case 4:return pr(),_i(e,t),null===e&&Z(t.stateNode.containerInfo),Ii(t),null;case 10:return ln(t.type._context),Ii(t),null;case 19:if(ot(gr),null===(i=t.memoizedState))return Ii(t),null;if(r=!!(128&t.flags),null===(s=i.rendering))if(r)Pi(i,!1);else{if(0!==Zs||null!==e&&128&e.flags)for(e=t.child;null!==e;){if(null!==(s=vr(e))){for(t.flags|=128,Pi(i,!1),null!==(e=s.updateQueue)&&(t.updateQueue=e,t.flags|=4),t.subtreeFlags=0,e=n,r=t.child;null!==r;)i=e,(n=r).flags&=14680066,null===(s=n.alternate)?(n.childLanes=0,n.lanes=i,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=s.childLanes,n.lanes=s.lanes,n.child=s.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=s.memoizedProps,n.memoizedState=s.memoizedState,n.updateQueue=s.updateQueue,n.type=s.type,i=s.dependencies,n.dependencies=null===i?null:{lanes:i.lanes,firstContext:i.firstContext}),r=r.sibling;return lt(gr,1&gr.current|2),t.child}e=e.sibling}null!==i.tail&&Ot()>aa&&(t.flags|=128,r=!0,Pi(i,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=vr(s))){if(t.flags|=128,r=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),Pi(i,!0),null===i.tail&&"hidden"===i.tailMode&&!s.alternate&&!Wn)return Ii(t),null}else 2*Ot()-i.renderingStartTime>aa&&1073741824!==n&&(t.flags|=128,r=!0,Pi(i,!1),t.lanes=4194304);i.isBackwards?(s.sibling=t.child,t.child=s):(null!==(e=i.last)?e.sibling=s:t.child=s,i.last=s)}return null!==i.tail?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Ot(),t.sibling=null,e=gr.current,lt(gr,r?1&e|2:1&e),t):(Ii(t),null);case 22:case 23:return Na(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&1&t.mode?!!(1073741824&Ks)&&(Ii(t),$&&6&t.subtreeFlags&&(t.flags|=8192)):Ii(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}var Ui=o.ReactCurrentOwner,Di=!1;function Fi(e,t,n,r){t.child=null===e?ar(t,null,n,r):sr(t,e.child,n,r)}function Bi(e,t,n,r,i){n=n.render;var s=t.ref;return cn(t,i),r=Ir(e,t,n,r,s,i),n=Lr(),null===e||Di?(Wn&&n&&zn(t),t.flags|=1,Fi(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,rs(e,t,i))}function Oi(e,t,n,r,i){if(null===e){var s=n.type;return"function"!=typeof s||Qa(s)||void 0!==s.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ja(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,ki(e,t,s,r,i))}if(s=e.child,0===(e.lanes&i)){var a=s.memoizedProps;if((n=null!==(n=n.compare)?n:Zt)(a,r)&&e.ref===t.ref)return rs(e,t,i)}return t.flags|=1,(e=Za(s,r)).ref=t.ref,e.return=t,t.child=e}function ki(e,t,n,r,i){if(null!==e&&Zt(e.memoizedProps,r)&&e.ref===t.ref){if(Di=!1,0===(e.lanes&i))return t.lanes=e.lanes,rs(e,t,i);131072&e.flags&&(Di=!0)}return Gi(e,t,n,r,i)}function zi(e,t,n){var r=t.pendingProps,i=r.children,s=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(1&t.mode){if(!(1073741824&n))return e=null!==s?s.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,lt(Qs,Ks),Ks|=e,null;t.memoizedState={baseLanes:0,cachePool:null},r=null!==s?s.baseLanes:n,lt(Qs,Ks),Ks|=r}else t.memoizedState={baseLanes:0,cachePool:null},lt(Qs,Ks),Ks|=n;else null!==s?(r=s.baseLanes|n,t.memoizedState=null):r=n,lt(Qs,Ks),Ks|=r;return Fi(e,t,i,n),t.child}function Vi(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Gi(e,t,n,r,i){var s=ft(n)?ht:ct.current;return s=pt(t,s),cn(t,i),n=Ir(e,t,n,r,s,i),r=Lr(),null===e||Di?(Wn&&r&&zn(t),t.flags|=1,Fi(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,rs(e,t,i))}function Hi(e,t,n,r,i){if(ft(n)){var s=!0;yt(t)}else s=!1;if(cn(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),En(t,n,r),Cn(t,n,r,i),r=!0;else if(null===e){var a=t.stateNode,o=t.memoizedProps;a.props=o;var l=a.context,u=n.contextType;"object"==typeof u&&null!==u?u=dn(u):u=pt(t,u=ft(n)?ht:ct.current);var c=n.getDerivedStateFromProps,d="function"==typeof c||"function"==typeof a.getSnapshotBeforeUpdate;d||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==r||l!==u)&&An(t,a,r,u),pn=!1;var h=t.memoizedState;a.state=h,xn(t,r,a,i),l=t.memoizedState,o!==r||h!==l||dt.current||pn?("function"==typeof c&&(Tn(t,n,c,r),l=t.memoizedState),(o=pn||Mn(t,n,o,r,h,l,u))?(d||"function"!=typeof a.UNSAFE_componentWillMount&&"function"!=typeof a.componentWillMount||("function"==typeof a.componentWillMount&&a.componentWillMount(),"function"==typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"==typeof a.componentDidMount&&(t.flags|=4194308)):("function"==typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),a.props=r,a.state=l,a.context=u,r=o):("function"==typeof a.componentDidMount&&(t.flags|=4194308),r=!1)}else{a=t.stateNode,mn(e,t),o=t.memoizedProps,u=t.type===t.elementType?o:en(t.type,o),a.props=u,d=t.pendingProps,h=a.context,"object"==typeof(l=n.contextType)&&null!==l?l=dn(l):l=pt(t,l=ft(n)?ht:ct.current);var p=n.getDerivedStateFromProps;(c="function"==typeof p||"function"==typeof a.getSnapshotBeforeUpdate)||"function"!=typeof a.UNSAFE_componentWillReceiveProps&&"function"!=typeof a.componentWillReceiveProps||(o!==d||h!==l)&&An(t,a,r,l),pn=!1,h=t.memoizedState,a.state=h,xn(t,r,a,i);var f=t.memoizedState;o!==d||h!==f||dt.current||pn?("function"==typeof p&&(Tn(t,n,p,r),f=t.memoizedState),(u=pn||Mn(t,n,u,r,h,f,l)||!1)?(c||"function"!=typeof a.UNSAFE_componentWillUpdate&&"function"!=typeof a.componentWillUpdate||("function"==typeof a.componentWillUpdate&&a.componentWillUpdate(r,f,l),"function"==typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(r,f,l)),"function"==typeof a.componentDidUpdate&&(t.flags|=4),"function"==typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),a.props=r,a.state=f,a.context=l,r=u):("function"!=typeof a.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof a.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Wi(e,t,n,r,s,i)}function Wi(e,t,n,r,i,s){Vi(e,t);var a=!!(128&t.flags);if(!r&&!a)return i&&_t(t,n,!1),rs(e,t,s);r=t.stateNode,Ui.current=t;var o=a&&"function"!=typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&a?(t.child=sr(t,e.child,null,s),t.child=sr(t,null,o,s)):Fi(e,t,o,s),t.memoizedState=r.state,i&&_t(t,n,!0),t.child}function ji(e){var t=e.stateNode;t.pendingContext?gt(0,t.pendingContext,t.pendingContext!==t.context):t.context&&gt(0,t.context,!1),hr(e,t.containerInfo)}function qi(e,t,n,r,i){return Jn(),er(i),t.flags|=256,Fi(e,t,n,r),t.child}var Xi={dehydrated:null,treeContext:null,retryLane:0};function $i(e){return{baseLanes:e,cachePool:null}}function Yi(e,t,n){var r,i=t.pendingProps,s=gr.current,o=!1,l=!!(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&!!(2&s)),r?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),lt(gr,1&s),null===e)return Kn(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(1&t.mode?Be(e)?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(s=i.children,e=i.fallback,o?(i=t.mode,o=t.child,s={mode:"hidden",children:s},1&i||null===o?o=to(s,i,0,null):(o.childLanes=0,o.pendingProps=s),e=eo(e,i,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=$i(n),t.memoizedState=Xi,e):Ki(t,s));if(null!==(s=e.memoizedState)){if(null!==(r=s.dehydrated)){if(l)return 256&t.flags?(t.flags&=-257,Ji(e,t,n,Error(a(422)))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=i.fallback,s=t.mode,i=to({mode:"visible",children:i.children},s,0,null),(o=eo(o,s,n,null)).flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,1&t.mode&&sr(t,e.child,null,n),t.child.memoizedState=$i(n),t.memoizedState=Xi,o);if(1&t.mode)if(Be(r))t=Ji(e,t,n,Error(a(419)));else if(i=0!==(n&e.childLanes),Di||i){if(null!==(i=Xs)){switch(n&-n){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}0!==(i=0!==(o&(i.suspendedLanes|n))?0:o)&&i!==s.retryLane&&(s.retryLane=i,ba(e,i,-1))}Ua(),t=Ji(e,t,n,Error(a(421)))}else Fe(r)?(t.flags|=128,t.child=e.child,t=qa.bind(null,e),Oe(r,t),t=null):(n=s.treeContext,K&&(Hn=Ge(r),Gn=t,Wn=!0,qn=null,jn=!1,null!==n&&(Ln[Un++]=Fn,Ln[Un++]=Bn,Ln[Un++]=Dn,Fn=n.id,Bn=n.overflow,Dn=t)),(t=Ki(t,t.pendingProps.children)).flags|=4096);else t=Ji(e,t,n,null);return t}return o?(i=Zi(e,t,i.children,i.fallback,n),o=t.child,s=e.child.memoizedState,o.memoizedState=null===s?$i(n):{baseLanes:s.baseLanes|n,cachePool:null},o.childLanes=e.childLanes&~n,t.memoizedState=Xi,i):(n=Qi(e,t,i.children,n),t.memoizedState=null,n)}return o?(i=Zi(e,t,i.children,i.fallback,n),o=t.child,s=e.child.memoizedState,o.memoizedState=null===s?$i(n):{baseLanes:s.baseLanes|n,cachePool:null},o.childLanes=e.childLanes&~n,t.memoizedState=Xi,i):(n=Qi(e,t,i.children,n),t.memoizedState=null,n)}function Ki(e,t){return(t=to({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Qi(e,t,n,r){var i=e.child;return e=i.sibling,n=Za(i,{mode:"visible",children:n}),!(1&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n}function Zi(e,t,n,r,i){var s=t.mode,a=(e=e.child).sibling,o={mode:"hidden",children:n};return 1&s||t.child===e?(n=Za(e,o)).subtreeFlags=14680064&e.subtreeFlags:((n=t.child).childLanes=0,n.pendingProps=o,t.deletions=null),null!==a?r=Za(a,r):(r=eo(r,s,i,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function Ji(e,t,n,r){return null!==r&&er(r),sr(t,e.child,null,n),(e=Ki(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function es(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),un(e.return,t,n)}function ts(e,t,n,r,i){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function ns(e,t,n){var r=t.pendingProps,i=r.revealOrder,s=r.tail;if(Fi(e,t,r.children,n),2&(r=gr.current))r=1&r|2,t.flags|=128;else{if(null!==e&&128&e.flags)e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&es(e,n,t);else if(19===e.tag)es(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(lt(gr,r),1&t.mode)switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===vr(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),ts(t,!1,i,n,s);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===vr(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}ts(t,!0,n,null,s);break;case"together":ts(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}function rs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),ea|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Za(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Za(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function is(e,t){switch(Vn(t),t.tag){case 1:return ft(t.type)&&mt(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return pr(),ot(dt),ot(ct),_r(),65536&(e=t.flags)&&!(128&e)?(t.flags=-65537&e|128,t):null;case 5:return mr(t),null;case 13:if(ot(gr),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));Jn()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return ot(gr),null;case 4:return pr(),null;case 10:return ln(t.type._context),null;case 22:case 23:return Na(),null;default:return null}}var ss=!1,as=!1,os="function"==typeof WeakSet?WeakSet:Set,ls=null;function us(e,t){var n=e.ref;if(null!==n)if("function"==typeof n)try{n(null)}catch(n){Ha(e,t,n)}else n.current=null}function cs(e,t,n){try{n()}catch(n){Ha(e,t,n)}}var ds=!1;function hs(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var s=i.destroy;i.destroy=void 0,void 0!==s&&cs(t,n,s)}i=i.next}while(i!==r)}}function ps(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function fs(e){var t=e.ref;if(null!==t){var n=e.stateNode;if(5===e.tag)e=L(n);else e=n;"function"==typeof t?t(e):t.current=e}}function ms(e,t,n){if(Wt&&"function"==typeof Wt.onCommitFiberUnmount)try{Wt.onCommitFiberUnmount(Ht,t)}catch(e){}switch(t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e=e.next;do{var i=r,s=i.destroy;i=i.tag,void 0!==s&&(2&i||4&i)&&cs(t,n,s),r=r.next}while(r!==e)}break;case 1:if(us(t,n),"function"==typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(e){Ha(t,n,e)}break;case 5:us(t,n);break;case 4:$?Ts(e,t,n):Y&&Y&&(t=t.stateNode.containerInfo,n=Ae(t),Ne(t,n))}}function gs(e,t,n){for(var r=t;;)if(ms(e,r,n),null===r.child||$&&4===r.tag){if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}else r.child.return=r,r=r.child}function vs(e){var t=e.alternate;null!==t&&(e.alternate=null,vs(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&ee(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ys(e){return 5===e.tag||3===e.tag||4===e.tag}function _s(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ys(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function xs(e){if($){e:{for(var t=e.return;null!==t;){if(ys(t))break e;t=t.return}throw Error(a(160))}var n=t;switch(n.tag){case 5:t=n.stateNode,32&n.flags&&(xe(t),n.flags&=-33),Ss(e,n=_s(e),t);break;case 3:case 4:t=n.stateNode.containerInfo,bs(e,n=_s(e),t);break;default:throw Error(a(161))}}}function bs(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?ve(n,e,t):he(n,e);else if(4!==r&&null!==(e=e.child))for(bs(e,t,n),e=e.sibling;null!==e;)bs(e,t,n),e=e.sibling}function Ss(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?ge(n,e,t):de(n,e);else if(4!==r&&null!==(e=e.child))for(Ss(e,t,n),e=e.sibling;null!==e;)Ss(e,t,n),e=e.sibling}function Ts(e,t,n){for(var r,i,s=t,o=!1;;){if(!o){o=s.return;e:for(;;){if(null===o)throw Error(a(160));switch(r=o.stateNode,o.tag){case 5:i=!1;break e;case 3:case 4:r=r.containerInfo,i=!0;break e}o=o.return}o=!0}if(5===s.tag||6===s.tag)gs(e,s,n),i?_e(r,s.stateNode):ye(r,s.stateNode);else if(18===s.tag)i?Ke(r,s.stateNode):Ye(r,s.stateNode);else if(4===s.tag){if(null!==s.child){r=s.stateNode.containerInfo,i=!0,s.child.return=s,s=s.child;continue}}else if(ms(e,s,n),null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break;for(;null===s.sibling;){if(null===s.return||s.return===t)return;4===(s=s.return).tag&&(o=!1)}s.sibling.return=s.return,s=s.sibling}}function ws(e,t){if($){switch(t.tag){case 0:case 11:case 14:case 15:return hs(3,t,t.return),ps(3,t),void hs(5,t,t.return);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps;e=null!==e?e.memoizedProps:r;var i=t.type,s=t.updateQueue;t.updateQueue=null,null!==s&&me(n,s,i,e,r,t)}return;case 6:if(null===t.stateNode)throw Error(a(162));return n=t.memoizedProps,void pe(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void(K&&null!==e&&e.memoizedState.isDehydrated&&Xe(t.stateNode.containerInfo));case 13:case 19:return void Ms(t)}throw Error(a(163))}switch(t.tag){case 0:case 11:case 14:case 15:return hs(3,t,t.return),ps(3,t),void hs(5,t,t.return);case 12:case 22:case 23:return;case 13:case 19:return void Ms(t);case 3:K&&null!==e&&e.memoizedState.isDehydrated&&Xe(t.stateNode.containerInfo)}e:if(Y){switch(t.tag){case 1:case 5:case 6:break e;case 3:case 4:t=t.stateNode,Ne(t.containerInfo,t.pendingChildren);break e}throw Error(a(163))}}function Ms(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new os),t.forEach(function(t){var r=Xa.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function Es(e,t,n){ls=e,As(e)}function As(e,t,n){for(var r=!!(1&e.mode);null!==ls;){var i=ls,s=i.child;if(22===i.tag&&r){var a=null!==i.memoizedState||ss;if(!a){var o=i.alternate,l=null!==o&&null!==o.memoizedState||as;o=ss;var u=as;if(ss=a,(as=l)&&!u)for(ls=i;null!==ls;)l=(a=ls).child,22===a.tag&&null!==a.memoizedState?Ns(i):null!==l?(l.return=a,ls=l):Ns(i);for(;null!==s;)ls=s,As(s),s=s.sibling;ls=i,ss=o,as=u}Cs(e)}else 8772&i.subtreeFlags&&null!==s?(s.return=i,ls=s):Cs(e)}}function Cs(e){for(;null!==ls;){var t=ls;if(8772&t.flags){var n=t.alternate;try{if(8772&t.flags)switch(t.tag){case 0:case 11:case 15:as||ps(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!as)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:en(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&bn(t,s,r);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:n=L(t.child.stateNode);break;case 1:n=t.child.stateNode}bn(t,o,n)}break;case 5:var l=t.stateNode;null===n&&4&t.flags&&fe(l,t.type,t.memoizedProps,t);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(K&&null===t.memoizedState){var u=t.alternate;if(null!==u){var c=u.memoizedState;if(null!==c){var d=c.dehydrated;null!==d&&$e(d)}}}break;default:throw Error(a(163))}as||512&t.flags&&fs(t)}catch(e){Ha(t,t.return,e)}}if(t===e){ls=null;break}if(null!==(n=t.sibling)){n.return=t.return,ls=n;break}ls=t.return}}function Rs(e){for(;null!==ls;){var t=ls;if(t===e){ls=null;break}var n=t.sibling;if(null!==n){n.return=t.return,ls=n;break}ls=t.return}}function Ns(e){for(;null!==ls;){var t=ls;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ps(4,t)}catch(e){Ha(t,n,e)}break;case 1:var r=t.stateNode;if("function"==typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(e){Ha(t,i,e)}}var s=t.return;try{fs(t)}catch(e){Ha(t,s,e)}break;case 5:var a=t.return;try{fs(t)}catch(e){Ha(t,a,e)}}}catch(e){Ha(t,t.return,e)}if(t===e){ls=null;break}var o=t.sibling;if(null!==o){o.return=t.return,ls=o;break}ls=t.return}}var Ps=0,Is=1,Ls=2,Us=3,Ds=4;if("function"==typeof Symbol&&Symbol.for){var Fs=Symbol.for;Ps=Fs("selector.component"),Is=Fs("selector.has_pseudo_class"),Ls=Fs("selector.role"),Us=Fs("selector.test_id"),Ds=Fs("selector.text")}function Bs(e){var t=Q(e);if(null!=t){if("string"!=typeof t.memoizedProps["data-testname"])throw Error(a(364));return t}if(null===(e=ie(e)))throw Error(a(362));return e.stateNode.current}function Os(e,t){switch(t.$$typeof){case Ps:if(e.type===t.value)return!0;break;case Is:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var r=e[n++],i=e[n++],s=t[i];if(5!==r.tag||!oe(r)){for(;null!=s&&Os(r,s);)s=t[++i];if(i===t.length){t=!0;break e}for(r=r.child;null!==r;)e.push(r,i),r=r.sibling}}t=!1}return t;case Ls:if(5===e.tag&&le(e.stateNode,t.value))return!0;break;case Ds:if((5===e.tag||6===e.tag)&&(null!==(e=ae(e))&&0<=e.indexOf(t.value)))return!0;break;case Us:if(5===e.tag&&("string"==typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function ks(e){switch(e.$$typeof){case Ps:return"<"+(T(e.value)||"Unknown")+">";case Is:return":has("+(ks(e)||"")+")";case Ls:return'[role="'+e.value+'"]';case Ds:return'"'+e.value+'"';case Us:return'[data-testname="'+e.value+'"]';default:throw Error(a(365))}}function zs(e,t){var n=[];e=[e,0];for(var r=0;r<e.length;){var i=e[r++],s=e[r++],a=t[s];if(5!==i.tag||!oe(i)){for(;null!=a&&Os(i,a);)a=t[++s];if(s===t.length)n.push(i);else for(i=i.child;null!==i;)e.push(i,s),i=i.sibling}}return n}function Vs(e,t){if(!re)throw Error(a(363));e=zs(e=Bs(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var r=e[n++];if(5===r.tag)oe(r)||t.push(r.stateNode);else for(r=r.child;null!==r;)e.push(r),r=r.sibling}return t}var Gs=Math.ceil,Hs=o.ReactCurrentDispatcher,Ws=o.ReactCurrentOwner,js=o.ReactCurrentBatchConfig,qs=0,Xs=null,$s=null,Ys=0,Ks=0,Qs=at(0),Zs=0,Js=null,ea=0,ta=0,na=0,ra=null,ia=null,sa=0,aa=1/0;function oa(){aa=Ot()+500}var la,ua=!1,ca=null,da=null,ha=!1,pa=null,fa=0,ma=0,ga=null,va=-1,ya=0;function _a(){return 6&qs?Ot():-1!==va?va:va=Ot()}function xa(e){return 1&e.mode?2&qs&&0!==Ys?Ys&-Ys:null!==Qt.transition?(0===ya&&(e=Tt,!(4194240&(Tt<<=1))&&(Tt=64),ya=e),ya):0!==(e=It)?e:J():1}function ba(e,t,n){if(50<ma)throw ma=0,ga=null,Error(a(185));var r=Sa(e,t);return null===r?null:(Nt(r,t,n),2&qs&&r===Xs||(r===Xs&&(!(2&qs)&&(ta|=t),4===Zs&&Aa(r,Ys)),Ta(r,n),1===t&&0===qs&&!(1&e.mode)&&(oa(),Xt&&Kt())),r)}function Sa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function Ta(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,s=e.pendingLanes;0<s;){var a=31-xt(s),o=1<<a,l=i[a];-1===l?0!==(o&n)&&0===(o&r)||(i[a]=At(o,t)):l<=t&&(e.expiredLanes|=o),s&=~o}}(e,t);var r=Et(e,e===Xs?Ys:0);if(0===r)null!==n&&Dt(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Dt(n),1===t)0===e.tag?function(e){Xt=!0,Yt(e)}(Ca.bind(null,e)):Yt(Ca.bind(null,e)),te?ne(function(){0===qs&&Kt()}):Ut(kt,Kt),n=null;else{switch(Lt(r)){case 1:n=kt;break;case 4:n=zt;break;case 16:default:n=Vt;break;case 536870912:n=Gt}n=$a(n,wa.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function wa(e,t){if(va=-1,ya=0,6&qs)throw Error(a(327));var n=e.callbackNode;if(Va()&&e.callbackNode!==n)return null;var r=Et(e,e===Xs?Ys:0);if(0===r)return null;if(30&r||0!==(r&e.expiredLanes)||t)t=Da(e,r);else{t=r;var i=qs;qs|=2;var s=La();for(Xs===e&&Ys===t||(oa(),Pa(e,t));;)try{Ba();break}catch(t){Ia(e,t)}an(),Hs.current=s,qs=i,null!==$s?t=0:(Xs=null,Ys=0,t=Zs)}if(0!==t){if(2===t&&(0!==(i=Ct(e))&&(r=i,t=Ma(e,i))),1===t)throw n=Js,Pa(e,0),Aa(e,r),Ta(e,Ot()),n;if(6===t)Aa(e,r);else{if(i=e.current.alternate,!(30&r||function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!jt(s(),i))return!1}catch(e){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)||(t=Da(e,r),2===t&&(s=Ct(e),0!==s&&(r=s,t=Ma(e,s))),1!==t)))throw n=Js,Pa(e,0),Aa(e,r),Ta(e,Ot()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:za(e,ia);break;case 3:if(Aa(e,r),(130023424&r)===r&&10<(t=sa+500-Ot())){if(0!==Et(e,0))break;if(((i=e.suspendedLanes)&r)!==r){_a(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=W(za.bind(null,e,ia),t);break}za(e,ia);break;case 4:if(Aa(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var o=31-xt(r);s=1<<o,(o=t[o])>i&&(i=o),r&=~s}if(r=i,10<(r=(120>(r=Ot()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Gs(r/1960))-r)){e.timeoutHandle=W(za.bind(null,e,ia),r);break}za(e,ia);break;default:throw Error(a(329))}}}return Ta(e,Ot()),e.callbackNode===n?wa.bind(null,e):null}function Ma(e,t){var n=ra;return e.current.memoizedState.isDehydrated&&(Pa(e,t).flags|=256),2!==(e=Da(e,t))&&(t=ia,ia=n,null!==t&&Ea(t)),e}function Ea(e){null===ia?ia=e:ia.push.apply(ia,e)}function Aa(e,t){for(t&=~na,t&=~ta,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-xt(t),r=1<<n;e[n]=-1,t&=~r}}function Ca(e){if(6&qs)throw Error(a(327));Va();var t=Et(e,0);if(!(1&t))return Ta(e,Ot()),null;var n=Da(e,t);if(0!==e.tag&&2===n){var r=Ct(e);0!==r&&(t=r,n=Ma(e,r))}if(1===n)throw n=Js,Pa(e,0),Aa(e,t),Ta(e,Ot()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,za(e,ia),Ta(e,Ot()),null}function Ra(e){null!==pa&&0===pa.tag&&!(6&qs)&&Va();var t=qs;qs|=1;var n=js.transition,r=It;try{if(js.transition=null,It=1,e)return e()}finally{It=r,js.transition=n,!(6&(qs=t))&&Kt()}}function Na(){Ks=Qs.current,ot(Qs)}function Pa(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==q&&(e.timeoutHandle=q,j(n)),null!==$s)for(n=$s.return;null!==n;){var r=n;switch(Vn(r),r.tag){case 1:null!=(r=r.type.childContextTypes)&&mt();break;case 3:pr(),ot(dt),ot(ct),_r();break;case 5:mr(r);break;case 4:pr();break;case 13:case 19:ot(gr);break;case 10:ln(r.type._context);break;case 22:case 23:Na()}n=n.return}if(Xs=e,$s=e=Za(e.current,null),Ys=Ks=t,Zs=0,Js=null,na=ta=ea=0,ia=ra=null,null!==hn){for(t=0;t<hn.length;t++)if(null!==(r=(n=hn[t]).interleaved)){n.interleaved=null;var i=r.next,s=n.pending;if(null!==s){var a=s.next;s.next=i,r.next=a}n.pending=r}hn=null}return e}function Ia(e,t){for(;;){var n=$s;try{if(an(),xr.current=pi,Er){for(var r=Tr.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}Er=!1}if(Sr=0,Mr=wr=Tr=null,Ar=!1,Cr=0,Ws.current=null,null===n||null===n.return){Zs=1,Js=t,$s=null;break}e:{var s=e,o=n.return,l=n,u=t;if(t=Ys,l.flags|=32768,null!==u&&"object"==typeof u&&"function"==typeof u.then){var c=u,d=l,h=d.tag;if(!(1&d.mode||0!==h&&11!==h&&15!==h)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=Ei(o);if(null!==f){f.flags&=-257,Ai(f,o,l,0,t),1&f.mode&&Mi(s,c,t),u=c;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(u),t.updateQueue=g}else m.add(u);break e}if(!(1&t)){Mi(s,c,t),Ua();break e}u=Error(a(426))}else if(Wn&&1&l.mode){var v=Ei(o);if(null!==v){!(65536&v.flags)&&(v.flags|=256),Ai(v,o,l,0,t),er(u);break e}}s=u,4!==Zs&&(Zs=2),null===ra?ra=[s]:ra.push(s),u=vi(u,l),l=o;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t,_n(l,Ti(0,u,t));break e;case 1:s=u;var y=l.type,_=l.stateNode;if(!(128&l.flags||"function"!=typeof y.getDerivedStateFromError&&(null===_||"function"!=typeof _.componentDidCatch||null!==da&&da.has(_)))){l.flags|=65536,t&=-t,l.lanes|=t,_n(l,wi(l,s,t));break e}}l=l.return}while(null!==l)}ka(n)}catch(e){t=e,$s===n&&null!==n&&($s=n=n.return);continue}break}}function La(){var e=Hs.current;return Hs.current=pi,null===e?pi:e}function Ua(){0!==Zs&&3!==Zs&&2!==Zs||(Zs=4),null===Xs||!(268435455&ea)&&!(268435455&ta)||Aa(Xs,Ys)}function Da(e,t){var n=qs;qs|=2;var r=La();for(Xs===e&&Ys===t||Pa(e,t);;)try{Fa();break}catch(t){Ia(e,t)}if(an(),qs=n,Hs.current=r,null!==$s)throw Error(a(261));return Xs=null,Ys=0,Zs}function Fa(){for(;null!==$s;)Oa($s)}function Ba(){for(;null!==$s&&!Ft();)Oa($s)}function Oa(e){var t=la(e.alternate,e,Ks);e.memoizedProps=e.pendingProps,null===t?ka(e):$s=t,Ws.current=null}function ka(e){var t=e;do{var n=t.alternate;if(e=t.return,32768&t.flags){if(null!==(n=is(n,t)))return n.flags&=32767,void($s=n);if(null===e)return Zs=6,void($s=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}else if(null!==(n=Li(n,t,Ks)))return void($s=n);if(null!==(t=t.sibling))return void($s=t);$s=t=e}while(null!==t);0===Zs&&(Zs=5)}function za(e,t){var n=It,r=js.transition;try{js.transition=null,It=1,function(e,t,n){do{Va()}while(null!==pa);if(6&qs)throw Error(a(327));var r=e.finishedWork,i=e.finishedLanes;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var s=r.lanes|r.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-xt(n),s=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~s}}(e,s),e===Xs&&($s=Xs=null,Ys=0),!(2064&r.subtreeFlags)&&!(2064&r.flags)||ha||(ha=!0,$a(Vt,function(){return Va(),null})),s=!!(15990&r.flags),!!(15990&r.subtreeFlags)||s){s=js.transition,js.transition=null;var o=It;It=1;var l=qs;qs|=4,Ws.current=null,function(e,t){for(F(e.containerInfo),ls=t;null!==ls;)if(t=(e=ls).child,1028&e.subtreeFlags&&null!==t)t.return=e,ls=t;else for(;null!==ls;){e=ls;try{var n=e.alternate;if(1024&e.flags)switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==n){var r=n.memoizedProps,i=n.memoizedState,s=e.stateNode,o=s.getSnapshotBeforeUpdate(e.elementType===e.type?r:en(e.type,r),i);s.__reactInternalSnapshotBeforeUpdate=o}break;case 3:$&&Me(e.stateNode.containerInfo);break;default:throw Error(a(163))}}catch(t){Ha(e,e.return,t)}if(null!==(t=e.sibling)){t.return=e.return,ls=t;break}ls=e.return}n=ds,ds=!1}(e,r),function(e,t){for(ls=t;null!==ls;){var n=(t=ls).deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e;$?Ts(s,i,t):gs(s,i,t);var a=i.alternate;null!==a&&(a.return=null),i.return=null}catch(e){Ha(i,t,e)}}if(n=t.child,12854&t.subtreeFlags&&null!==n)n.return=t,ls=n;else for(;null!==ls;){t=ls;try{var o=t.flags;if(32&o&&$&&xe(t.stateNode),512&o){var l=t.alternate;if(null!==l){var u=l.ref;null!==u&&("function"==typeof u?u(null):u.current=null)}}if(8192&o)switch(t.tag){case 13:if(null!==t.memoizedState){var c=t.alternate;null!==c&&null!==c.memoizedState||(sa=Ot())}break;case 22:var d=null!==t.memoizedState,h=t.alternate,p=null!==h&&null!==h.memoizedState;if(n=t,$)e:if(r=n,i=d,s=null,$)for(var f=r;;){if(5===f.tag){if(null===s){s=f;var m=f.stateNode;i?be(m):Te(f.stateNode,f.memoizedProps)}}else if(6===f.tag){if(null===s){var g=f.stateNode;i?Se(g):we(g,f.memoizedProps)}}else if((22!==f.tag&&23!==f.tag||null===f.memoizedState||f===r)&&null!==f.child){f.child.return=f,f=f.child;continue}if(f===r)break;for(;null===f.sibling;){if(null===f.return||f.return===r)break e;s===f&&(s=null),f=f.return}s===f&&(s=null),f.sibling.return=f.return,f=f.sibling}if(d&&!p&&1&n.mode){ls=n;for(var v=n.child;null!==v;){for(n=ls=v;null!==ls;){var y=(r=ls).child;switch(r.tag){case 0:case 11:case 14:case 15:hs(4,r,r.return);break;case 1:us(r,r.return);var _=r.stateNode;if("function"==typeof _.componentWillUnmount){var x=r.return;try{_.props=r.memoizedProps,_.state=r.memoizedState,_.componentWillUnmount()}catch(e){Ha(r,x,e)}}break;case 5:us(r,r.return);break;case 22:if(null!==r.memoizedState){Rs(n);continue}}null!==y?(y.return=r,ls=y):Rs(n)}v=v.sibling}}}switch(4102&o){case 2:xs(t),t.flags&=-3;break;case 6:xs(t),t.flags&=-3,ws(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,ws(t.alternate,t);break;case 4:ws(t.alternate,t)}}catch(e){Ha(t,t.return,e)}if(null!==(n=t.sibling)){n.return=t.return,ls=n;break}ls=t.return}}}(e,r),B(e.containerInfo),e.current=r,Es(r),Bt(),qs=l,It=o,js.transition=s}else e.current=r;if(ha&&(ha=!1,pa=e,fa=i),s=e.pendingLanes,0===s&&(da=null),function(e){if(Wt&&"function"==typeof Wt.onCommitFiberRoot)try{Wt.onCommitFiberRoot(Ht,e,void 0,!(128&~e.current.flags))}catch(e){}}(r.stateNode),Ta(e,Ot()),null!==t)for(n=e.onRecoverableError,r=0;r<t.length;r++)n(t[r]);if(ua)throw ua=!1,e=ca,ca=null,e;!!(1&fa)&&0!==e.tag&&Va(),s=e.pendingLanes,1&s?e===ga?ma++:(ma=0,ga=e):ma=0,Kt()}(e,t,n)}finally{js.transition=r,It=n}return null}function Va(){if(null!==pa){var e=Lt(fa),t=js.transition,n=It;try{if(js.transition=null,It=16>e?16:e,null===pa)var r=!1;else{if(e=pa,pa=null,fa=0,6&qs)throw Error(a(331));var i=qs;for(qs|=4,ls=e.current;null!==ls;){var s=ls,o=s.child;if(16&ls.flags){var l=s.deletions;if(null!==l){for(var u=0;u<l.length;u++){var c=l[u];for(ls=c;null!==ls;){var d=ls;switch(d.tag){case 0:case 11:case 15:hs(8,d,s)}var h=d.child;if(null!==h)h.return=d,ls=h;else for(;null!==ls;){var p=(d=ls).sibling,f=d.return;if(vs(d),d===c){ls=null;break}if(null!==p){p.return=f,ls=p;break}ls=f}}}var m=s.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(null!==g)}}ls=s}}if(2064&s.subtreeFlags&&null!==o)o.return=s,ls=o;else e:for(;null!==ls;){if(2048&(s=ls).flags)switch(s.tag){case 0:case 11:case 15:hs(9,s,s.return)}var y=s.sibling;if(null!==y){y.return=s.return,ls=y;break e}ls=s.return}}var _=e.current;for(ls=_;null!==ls;){var x=(o=ls).child;if(2064&o.subtreeFlags&&null!==x)x.return=o,ls=x;else e:for(o=_;null!==ls;){if(2048&(l=ls).flags)try{switch(l.tag){case 0:case 11:case 15:ps(9,l)}}catch(e){Ha(l,l.return,e)}if(l===o){ls=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,ls=b;break e}ls=l.return}}if(qs=i,Kt(),Wt&&"function"==typeof Wt.onPostCommitFiberRoot)try{Wt.onPostCommitFiberRoot(Ht,e)}catch(e){}r=!0}return r}finally{It=n,js.transition=t}}return!1}function Ga(e,t,n){vn(e,t=Ti(0,t=vi(n,t),1)),t=_a(),null!==(e=Sa(e,1))&&(Nt(e,1,t),Ta(e,t))}function Ha(e,t,n){if(3===e.tag)Ga(e,e,n);else for(;null!==t;){if(3===t.tag){Ga(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===da||!da.has(r))){vn(t,e=wi(t,e=vi(n,e),1)),e=_a(),null!==(t=Sa(t,1))&&(Nt(t,1,e),Ta(t,e));break}}t=t.return}}function Wa(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=_a(),e.pingedLanes|=e.suspendedLanes&n,Xs===e&&(Ys&n)===n&&(4===Zs||3===Zs&&(130023424&Ys)===Ys&&500>Ot()-sa?Pa(e,0):na|=n),Ta(e,t)}function ja(e,t){0===t&&(1&e.mode?(t=wt,!(130023424&(wt<<=1))&&(wt=4194304)):t=1);var n=_a();null!==(e=Sa(e,t))&&(Nt(e,t,n),Ta(e,n))}function qa(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),ja(e,n)}function Xa(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),ja(e,n)}function $a(e,t){return Ut(e,t)}function Ya(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ka(e,t,n,r){return new Ya(e,t,n,r)}function Qa(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Za(e,t){var n=e.alternate;return null===n?((n=Ka(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ja(e,t,n,r,i,s){var o=2;if(r=e,"function"==typeof e)Qa(e)&&(o=1);else if("string"==typeof e)o=5;else e:switch(e){case c:return eo(n.children,i,s,t);case d:o=8,i|=8;break;case h:return(e=Ka(12,n,t,2|i)).elementType=h,e.lanes=s,e;case g:return(e=Ka(13,n,t,i)).elementType=g,e.lanes=s,e;case v:return(e=Ka(19,n,t,i)).elementType=v,e.lanes=s,e;case x:return to(n,i,s,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case p:o=10;break e;case f:o=9;break e;case m:o=11;break e;case y:o=14;break e;case _:o=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Ka(o,n,t,i)).elementType=e,t.type=r,t.lanes=s,t}function eo(e,t,n,r){return(e=Ka(7,e,r,t)).lanes=n,e}function to(e,t,n,r){return(e=Ka(22,e,r,t)).elementType=x,e.lanes=n,e.stateNode={},e}function no(e,t,n){return(e=Ka(6,e,null,t)).lanes=n,e}function ro(e,t,n){return(t=Ka(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function io(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=q,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Rt(0),this.expirationTimes=Rt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Rt(0),this.identifierPrefix=r,this.onRecoverableError=i,K&&(this.mutableSourceEagerHydrationData=null)}function so(e,t,n,r,i,s,a,o,l){return e=new io(e,t,n,o,l),1===t?(t=1,!0===s&&(t|=8)):t=0,s=Ka(3,null,null,t),e.current=s,s.stateNode=e,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null},fn(s),e}function ao(e){if(!e)return ut;e:{if(M(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(ft(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(ft(n))return vt(e,n,t)}return t}function oo(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return null===(e=C(t))?null:e.stateNode}function lo(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function uo(e,t){lo(e,t),(e=e.alternate)&&lo(e,t)}function co(e){return null===(e=C(e))?null:e.stateNode}function ho(){return null}return la=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||dt.current)Di=!0;else{if(0===(e.lanes&n)&&!(128&t.flags))return Di=!1,function(e,t,n){switch(t.tag){case 3:ji(t),Jn();break;case 5:fr(t);break;case 1:ft(t.type)&&yt(t);break;case 4:hr(t,t.stateNode.containerInfo);break;case 10:on(0,t.type._context,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(lt(gr,1&gr.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Yi(e,t,n):(lt(gr,1&gr.current),null!==(e=rs(e,t,n))?e.sibling:null);lt(gr,1&gr.current);break;case 19:if(r=0!==(n&t.childLanes),128&e.flags){if(r)return ns(e,t,n);t.flags|=128}var i=t.memoizedState;if(null!==i&&(i.rendering=null,i.tail=null,i.lastEffect=null),lt(gr,gr.current),r)break;return null;case 22:case 23:return t.lanes=0,zi(e,t,n)}return rs(e,t,n)}(e,t,n);Di=!!(131072&e.flags)}else Di=!1,Wn&&1048576&t.flags&&kn(t,In,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var i=pt(t,ct.current);cn(t,n),i=Ir(null,t,r,e,i,n);var s=Lr();return t.flags|=1,"object"==typeof i&&null!==i&&"function"==typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,ft(r)?(s=!0,yt(t)):s=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,fn(t),i.updater=wn,t.stateNode=i,i._reactInternals=t,Cn(t,r,e,n),t=Wi(null,t,r,!0,s,n)):(t.tag=0,Wn&&s&&zn(t),Fi(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"==typeof e)return Qa(e)?1:0;if(null!=e){if((e=e.$$typeof)===m)return 11;if(e===y)return 14}return 2}(r),e=en(r,e),i){case 0:t=Gi(null,t,r,e,n);break e;case 1:t=Hi(null,t,r,e,n);break e;case 11:t=Bi(null,t,r,e,n);break e;case 14:t=Oi(null,t,r,en(r.type,e),n);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Gi(e,t,r,i=t.elementType===r?i:en(r,i),n);case 1:return r=t.type,i=t.pendingProps,Hi(e,t,r,i=t.elementType===r?i:en(r,i),n);case 3:e:{if(ji(t),null===e)throw Error(a(387));r=t.pendingProps,i=(s=t.memoizedState).element,mn(e,t),xn(t,r,null,n);var o=t.memoizedState;if(r=o.element,K&&s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:o.cache,transitions:o.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=qi(e,t,r,n,i=Error(a(423)));break e}if(r!==i){t=qi(e,t,r,n,i=Error(a(424)));break e}for(K&&(Hn=Ve(t.stateNode.containerInfo),Gn=t,Wn=!0,qn=null,jn=!1),n=ar(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(Jn(),r===i){t=rs(e,t,n);break e}Fi(e,t,r,n)}t=t.child}return t;case 5:return fr(t),null===e&&Kn(t),r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,o=i.children,G(r,i)?o=null:null!==s&&G(r,s)&&(t.flags|=32),Vi(e,t),Fi(e,t,o,n),t.child;case 6:return null===e&&Kn(t),null;case 13:return Yi(e,t,n);case 4:return hr(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=sr(t,null,r,n):Fi(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Bi(e,t,r,i=t.elementType===r?i:en(r,i),n);case 7:return Fi(e,t,t.pendingProps,n),t.child;case 8:case 12:return Fi(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,on(0,r,o=i.value),null!==s)if(jt(s.value,o)){if(s.children===i.children&&!dt.current){t=rs(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){o=s.child;for(var u=l.firstContext;null!==u;){if(u.context===r){if(1===s.tag){(u=gn(-1,n&-n)).tag=2;var c=s.updateQueue;if(null!==c){var d=(c=c.shared).pending;null===d?u.next=u:(u.next=d.next,d.next=u),c.pending=u}}s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),un(s.return,n,t),l.lanes|=n;break}u=u.next}}else if(10===s.tag)o=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(o=s.return))throw Error(a(341));o.lanes|=n,null!==(l=o.alternate)&&(l.lanes|=n),un(o,n,t),o=s.sibling}else o=s.child;if(null!==o)o.return=s;else for(o=s;null!==o;){if(o===t){o=null;break}if(null!==(s=o.sibling)){s.return=o.return,o=s;break}o=o.return}s=o}Fi(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,cn(t,n),r=r(i=dn(i)),t.flags|=1,Fi(e,t,r,n),t.child;case 14:return i=en(r=t.type,t.pendingProps),Oi(e,t,r,i=en(r.type,i),n);case 15:return ki(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:en(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,ft(r)?(e=!0,yt(t)):e=!1,cn(t,n),En(t,r,i),Cn(t,r,i,n),Wi(null,t,r,!0,e,n);case 19:return ns(e,t,n);case 22:return zi(e,t,n)}throw Error(a(156,t.tag))},n.attemptContinuousHydration=function(e){13===e.tag&&(ba(e,134217728,_a()),uo(e,134217728))},n.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=_a(),n=xa(e);ba(e,n,t),uo(e,n)}},n.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Mt(t.pendingLanes);0!==n&&(Pt(t,1|n),Ta(t,Ot()),!(6&qs)&&(oa(),Kt()))}break;case 13:var r=_a();Ra(function(){return ba(e,1,r)}),uo(e,1)}},n.batchedUpdates=function(e,t){var n=qs;qs|=1;try{return e(t)}finally{0===(qs=n)&&(oa(),Xt&&Kt())}},n.createComponentSelector=function(e){return{$$typeof:Ps,value:e}},n.createContainer=function(e,t,n,r,i,s,a){return so(e,t,!1,null,0,r,0,s,a)},n.createHasPseudoClassSelector=function(e){return{$$typeof:Is,value:e}},n.createHydrationContainer=function(e,t,n,r,i,s,a,o,l){return(e=so(n,r,!0,e,0,s,0,o,l)).context=ao(null),n=e.current,(s=gn(r=_a(),i=xa(n))).callback=null!=t?t:null,vn(n,s),e.current.lanes=i,Nt(e,i,r),Ta(e,r),e},n.createPortal=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:u,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}},n.createRoleSelector=function(e){return{$$typeof:Ls,value:e}},n.createTestNameSelector=function(e){return{$$typeof:Us,value:e}},n.createTextSelector=function(e){return{$$typeof:Ds,value:e}},n.deferredUpdates=function(e){var t=It,n=js.transition;try{return js.transition=null,It=16,e()}finally{It=t,js.transition=n}},n.discreteUpdates=function(e,t,n,r,i){var s=It,a=js.transition;try{return js.transition=null,It=1,e(t,n,r,i)}finally{It=s,js.transition=a,0===qs&&oa()}},n.findAllNodes=Vs,n.findBoundingRects=function(e,t){if(!re)throw Error(a(363));t=Vs(e,t),e=[];for(var n=0;n<t.length;n++)e.push(se(t[n]));for(t=e.length-1;0<t;t--)for(var r=(n=e[t]).x,i=r+n.width,s=n.y,o=s+n.height,l=t-1;0<=l;l--)if(t!==l){var u=e[l],c=u.x,d=c+u.width,h=u.y,p=h+u.height;if(r>=c&&s>=h&&i<=d&&o<=p){e.splice(t,1);break}if(!(r!==c||n.width!==u.width||p<s||h>o)){h>s&&(u.height+=h-s,u.y=s),p<o&&(u.height=o-h),e.splice(t,1);break}if(!(s!==h||n.height!==u.height||d<r||c>i)){c>r&&(u.width+=c-r,u.x=r),d<i&&(u.width=i-c),e.splice(t,1);break}}return e},n.findHostInstance=oo,n.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=A(e))?N(e):null)?null:e.stateNode},n.findHostInstanceWithWarning=function(e){return oo(e)},n.flushControlled=function(e){var t=qs;qs|=1;var n=js.transition,r=It;try{js.transition=null,It=1,e()}finally{It=r,js.transition=n,0===(qs=t)&&(oa(),Kt())}},n.flushPassiveEffects=Va,n.flushSync=Ra,n.focusWithin=function(e,t){if(!re)throw Error(a(363));for(t=zs(e=Bs(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!oe(n)){if(5===n.tag&&ue(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},n.getCurrentUpdatePriority=function(){return It},n.getFindAllNodesFailureDescription=function(e,t){if(!re)throw Error(a(363));var n=0,r=[];e=[Bs(e),0];for(var i=0;i<e.length;){var s=e[i++],o=e[i++],l=t[o];if((5!==s.tag||!oe(s))&&(Os(s,l)&&(r.push(ks(l)),++o>n&&(n=o)),o<t.length))for(s=s.child;null!==s;)e.push(s,o),s=s.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(ks(t[n]));return"findAllNodes was able to match part of the selector:\n  "+r.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},n.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?L(e.child.stateNode):e.child.stateNode:null},n.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:co,findFiberByHostInstance:e.findFiberByHostInstance||ho,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},"undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{Ht=t.inject(e),Wt=t}catch(e){}e=!!t.checkDCE}}return e},n.isAlreadyRendering=function(){return!1},n.observeVisibleRects=function(e,t,n,r){if(!re)throw Error(a(363));e=Vs(e,t);var i=ce(e,n,r).disconnect;return{disconnect:function(){i()}}},n.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},n.runWithPriority=function(e,t){var n=It;try{return It=e,t()}finally{It=n}},n.shouldError=function(){return null},n.shouldSuspend=function(){return!1},n.updateContainer=function(e,t,n,r){var i=t.current,s=_a(),a=xa(i);return n=ao(n),null===t.context?t.context=n:t.pendingContext=n,(t=gn(s,a)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),vn(i,t),null!==(e=ba(i,a,s))&&yn(e,i,a),a},n}),Rp}var Dp,Fp,Bp={exports:{}};function Op(){return Dp||(Dp=1,"production"!==process.env.NODE_ENV&&(Bp.exports=function(e){var n={},r=t,i=Lp(),s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,a=!1;function o(e){if(!a){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];u("warn",e,n)}}function l(e){if(!a){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];u("error",e,n)}}function u(e,t,n){var r=s.ReactDebugCurrentFrame.getStackAddendum();""!==r&&(t+="%s",n=n.concat([r]));var i=n.map(function(e){return String(e)});i.unshift("Warning: "+t),Function.prototype.apply.call(console[e],console,i)}var c=Object.assign;function d(e){return e._reactInternals}var h=!1,p=!1,f=10,m=11,g=12,v=13,y=14,_=15,x=17,b=18,S=19,T=22,w=23,M=Symbol.for("react.element"),E=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),P=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),U=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),B=(Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode"),Symbol.for("react.offscreen")),O=(Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker"),Symbol.iterator);function k(e){if(null===e||"object"!=typeof e)return null;var t=O&&e[O]||e["@@iterator"];return"function"==typeof t?t:null}function z(e){return e.displayName||"Context"}function V(e){if(null==e)return null;if("number"==typeof e.tag&&l("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),"function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case A:return"Fragment";case E:return"Portal";case R:return"Profiler";case C:return"StrictMode";case L:return"Suspense";case U:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case P:return z(e)+".Consumer";case N:return z(e._context)+".Provider";case I:return function(e,t,n){var r=e.displayName;if(r)return r;var i=t.displayName||t.name||"";return""!==i?n+"("+i+")":n}(e,e.render,"ForwardRef");case D:var t=e.displayName||null;return null!==t?t:V(e.type)||"Memo";case F:var n=e,r=n._payload,i=n._init;try{return V(i(r))}catch(e){return null}}return null}function G(e){return e.displayName||"Context"}function H(e){var t,n,r,i,s=e.tag,a=e.type;switch(s){case 24:return"Cache";case 9:return G(a)+".Consumer";case f:return G(a._context)+".Provider";case b:return"DehydratedFragment";case m:return t=a,n=a.render,r="ForwardRef",i=n.displayName||n.name||"",t.displayName||(""!==i?r+"("+i+")":r);case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(a);case 8:return a===C?"StrictMode":"Mode";case T:return"Offscreen";case g:return"Profiler";case 21:return"Scope";case v:return"Suspense";case S:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case x:case 2:case y:case _:if("function"==typeof a)return a.displayName||a.name||null;if("string"==typeof a)return a}return null}var W=16,j=128,q=256,X=512,$=1024,Y=2048,K=4096,Q=8192,Z=16384,J=32768,ee=65536,te=131072,ne=1048576,re=2097152,ie=4194304,se=16777216,ae=33554432,oe=1028,le=12854,ue=8772,ce=2064,de=14680064,he=s.ReactCurrentOwner;function pe(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{var r=t;do{4098&(t=r).flags&&(n=t.return),r=t.return}while(r)}return 3===t.tag?n:null}function fe(e){if(pe(e)!==e)throw new Error("Unable to find node on an unmounted component.")}function me(e){var t=e.alternate;if(!t){var n=pe(e);if(null===n)throw new Error("Unable to find node on an unmounted component.");return n!==e?null:e}for(var r=e,i=t;;){var s=r.return;if(null===s)break;var a=s.alternate;if(null===a){var o=s.return;if(null!==o){r=i=o;continue}break}if(s.child===a.child){for(var l=s.child;l;){if(l===r)return fe(s),e;if(l===i)return fe(s),t;l=l.sibling}throw new Error("Unable to find node on an unmounted component.")}if(r.return!==i.return)r=s,i=a;else{for(var u=!1,c=s.child;c;){if(c===r){u=!0,r=s,i=a;break}if(c===i){u=!0,i=s,r=a;break}c=c.sibling}if(!u){for(c=a.child;c;){if(c===r){u=!0,r=a,i=s;break}if(c===i){u=!0,i=a,r=s;break}c=c.sibling}if(!u)throw new Error("Child was not found in either parent set. This indicates a bug in React related to the return pointer. Please file an issue.")}}if(r.alternate!==i)throw new Error("Return fibers should always be each others' alternates. This error is likely caused by a bug in React. Please file an issue.")}if(3!==r.tag)throw new Error("Unable to find node on an unmounted component.");return r.stateNode.current===r?e:t}function ge(e){var t=me(e);return null!==t?ve(t):null}function ve(e){if(5===e.tag||6===e.tag)return e;for(var t=e.child;null!==t;){var n=ve(t);if(null!==n)return n;t=t.sibling}return null}function ye(e){var t=me(e);return null!==t?_e(t):null}function _e(e){if(5===e.tag||6===e.tag)return e;for(var t=e.child;null!==t;){if(4!==t.tag){var n=_e(t);if(null!==n)return n}t=t.sibling}return null}var xe=Array.isArray;function be(e){return xe(e)}var Se=e.getPublicInstance,Te=e.getRootHostContext,we=e.getChildHostContext,Me=e.prepareForCommit,Ee=e.resetAfterCommit,Ae=e.createInstance,Ce=e.appendInitialChild,Re=e.finalizeInitialChildren,Ne=e.prepareUpdate,Pe=e.shouldSetTextContent,Ie=e.createTextInstance,Le=e.scheduleTimeout,Ue=e.cancelTimeout,De=e.noTimeout;e.now;var Fe=e.isPrimaryRenderer,Be=e.warnsIfNotActing,Oe=e.supportsMutation,ke=e.supportsPersistence,ze=e.supportsHydration,Ve=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var Ge=e.preparePortalMount;e.preparePortalMount,e.getInstanceFromScope;var He=e.getCurrentEventPriority,We=e.detachDeletedInstance,je=e.supportsMicrotasks,qe=e.scheduleMicrotask,Xe=e.supportsTestSelectors,$e=e.findFiberRoot,Ye=e.getBoundingRect,Ke=e.getTextContent,Qe=e.isHiddenSubtree,Ze=e.matchAccessibilityRole,Je=e.setFocusIfFocusable,et=e.setupIntersectionObserver,tt=e.appendChild,nt=e.appendChildToContainer,rt=e.commitTextUpdate,it=e.commitMount,st=e.commitUpdate,at=e.insertBefore,ot=e.insertInContainerBefore,lt=e.removeChild,ut=e.removeChildFromContainer,ct=e.resetTextContent,dt=e.hideInstance,ht=e.hideTextInstance,pt=e.unhideInstance,ft=e.unhideTextInstance,mt=e.clearContainer,gt=e.cloneInstance,vt=e.createContainerChildSet,yt=e.appendChildToContainerChildSet,_t=e.finalizeContainerChildren,xt=e.replaceContainerChildren;e.getOffscreenContainerType;e.getOffscreenContainerProps;var bt,St,Tt,wt,Mt,Et,At,Ct=e.cloneHiddenInstance,Rt=e.cloneHiddenTextInstance,Nt=e.canHydrateInstance,Pt=e.canHydrateTextInstance,It=e.canHydrateSuspenseInstance,Lt=e.isSuspenseInstancePending,Ut=e.isSuspenseInstanceFallback,Dt=e.registerSuspenseInstanceRetry,Ft=e.getNextHydratableSibling,Bt=e.getFirstHydratableChild,Ot=e.getFirstHydratableChildWithinContainer,kt=e.getFirstHydratableChildWithinSuspenseInstance,zt=e.hydrateInstance,Vt=e.hydrateTextInstance,Gt=e.hydrateSuspenseInstance,Ht=e.getNextHydratableInstanceAfterSuspenseInstance,Wt=e.commitHydratedContainer,jt=e.commitHydratedSuspenseInstance,qt=e.clearSuspenseBoundary,Xt=e.clearSuspenseBoundaryFromContainer,$t=e.shouldDeleteUnhydratedTailInstances,Yt=e.didNotMatchHydratedContainerTextInstance,Kt=e.didNotMatchHydratedTextInstance,Qt=e.didNotHydrateInstanceWithinContainer,Zt=e.didNotHydrateInstanceWithinSuspenseInstance,Jt=e.didNotHydrateInstance,en=e.didNotFindHydratableInstanceWithinContainer,tn=e.didNotFindHydratableTextInstanceWithinContainer,nn=e.didNotFindHydratableSuspenseInstanceWithinContainer,rn=e.didNotFindHydratableInstanceWithinSuspenseInstance,sn=e.didNotFindHydratableTextInstanceWithinSuspenseInstance,an=e.didNotFindHydratableSuspenseInstanceWithinSuspenseInstance,on=e.didNotFindHydratableInstance,ln=e.didNotFindHydratableTextInstance,un=e.didNotFindHydratableSuspenseInstance,cn=e.errorHydratingContainer,dn=0;function hn(){}hn.__reactDisabledLog=!0;var pn,fn=s.ReactCurrentDispatcher;function mn(e,t,n){if(void 0===pn)try{throw Error()}catch(e){var r=e.stack.trim().match(/\n( *(at )?)/);pn=r&&r[1]||""}return"\n"+pn+e}var gn,vn=!1,yn="function"==typeof WeakMap?WeakMap:Map;function _n(e,t){if(!e||vn)return"";var n,r=gn.get(e);if(void 0!==r)return r;vn=!0;var i,s=Error.prepareStackTrace;Error.prepareStackTrace=void 0,i=fn.current,fn.current=null,function(){if(0===dn){bt=console.log,St=console.info,Tt=console.warn,wt=console.error,Mt=console.group,Et=console.groupCollapsed,At=console.groupEnd;var e={configurable:!0,enumerable:!0,value:hn,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}dn++}();try{if(t){var a=function(){throw Error()};if(Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(a,[])}catch(e){n=e}Reflect.construct(e,[],a)}else{try{a.call()}catch(e){n=e}e.call(a.prototype)}}else{try{throw Error()}catch(e){n=e}e()}}catch(t){if(t&&n&&"string"==typeof t.stack){for(var o=t.stack.split("\n"),u=n.stack.split("\n"),d=o.length-1,h=u.length-1;d>=1&&h>=0&&o[d]!==u[h];)h--;for(;d>=1&&h>=0;d--,h--)if(o[d]!==u[h]){if(1!==d||1!==h)do{if(d--,--h<0||o[d]!==u[h]){var p="\n"+o[d].replace(" at new "," at ");return e.displayName&&p.includes("<anonymous>")&&(p=p.replace("<anonymous>",e.displayName)),"function"==typeof e&&gn.set(e,p),p}}while(d>=1&&h>=0);break}}}finally{vn=!1,fn.current=i,function(){if(0===--dn){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:c({},e,{value:bt}),info:c({},e,{value:St}),warn:c({},e,{value:Tt}),error:c({},e,{value:wt}),group:c({},e,{value:Mt}),groupCollapsed:c({},e,{value:Et}),groupEnd:c({},e,{value:At})})}dn<0&&l("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}(),Error.prepareStackTrace=s}var f=e?e.displayName||e.name:"",m=f?mn(f):"";return"function"==typeof e&&gn.set(e,m),m}function xn(e,t,n){return _n(e,!1)}function bn(e,t,n){if(null==e)return"";if("function"==typeof e)return _n(e,!(!(r=e.prototype)||!r.isReactComponent));var r;if("string"==typeof e)return mn(e);switch(e){case L:return mn("Suspense");case U:return mn("SuspenseList")}if("object"==typeof e)switch(e.$$typeof){case I:return xn(e.render);case D:return bn(e.type,t,n);case F:var i=e,s=i._payload,a=i._init;try{return bn(a(s),t,n)}catch(e){}}return""}gn=new yn;var Sn=Object.prototype.hasOwnProperty,Tn={},wn=s.ReactDebugCurrentFrame;function Mn(e){if(e){var t=e._owner,n=bn(e.type,e._source,t?t.type:null);wn.setExtraStackFrame(n)}else wn.setExtraStackFrame(null)}function En(e,t,n,r,i){var s=Function.call.bind(Sn);for(var a in e)if(s(e,a)){var o=void 0;try{if("function"!=typeof e[a]){var u=Error((r||"React class")+": "+n+" type `"+a+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[a]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw u.name="Invariant Violation",u}o=e[a](t,a,r,n,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(e){o=e}!o||o instanceof Error||(Mn(i),l("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",r||"React class",n,a,typeof o),Mn(null)),o instanceof Error&&!(o.message in Tn)&&(Tn[o.message]=!0,Mn(i),l("Failed %s type: %s",n,o.message),Mn(null))}}var An,Cn=[];An=[];var Rn,Nn=-1;function Pn(e){return{current:e}}function In(e,t){Nn<0?l("Unexpected pop."):(t!==An[Nn]&&l("Unexpected Fiber popped."),e.current=Cn[Nn],Cn[Nn]=null,An[Nn]=null,Nn--)}function Ln(e,t,n){Nn++,Cn[Nn]=e.current,An[Nn]=n,e.current=t}Rn={};var Un={};Object.freeze(Un);var Dn=Pn(Un),Fn=Pn(!1),Bn=Un;function On(e,t,n){return n&&Gn(t)?Bn:Dn.current}function kn(e,t,n){var r=e.stateNode;r.__reactInternalMemoizedUnmaskedChildContext=t,r.__reactInternalMemoizedMaskedChildContext=n}function zn(e,t){var n=e.type.contextTypes;if(!n)return Un;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i={};for(var s in n)i[s]=t[s];return En(n,i,"context",H(e)||"Unknown"),r&&kn(e,t,i),i}function Vn(){return Fn.current}function Gn(e){var t=e.childContextTypes;return null!=t}function Hn(e){In(Fn,e),In(Dn,e)}function Wn(e){In(Fn,e),In(Dn,e)}function jn(e,t,n){if(Dn.current!==Un)throw new Error("Unexpected context found on stack. This error is likely caused by a bug in React. Please file an issue.");Ln(Dn,t,e),Ln(Fn,n,e)}function qn(e,t,n){var r=e.stateNode,i=t.childContextTypes;if("function"!=typeof r.getChildContext){var s=H(e)||"Unknown";return Rn[s]||(Rn[s]=!0,l("%s.childContextTypes is specified but there is no getChildContext() method on the instance. You can either define getChildContext() on %s or remove childContextTypes from it.",s,s)),n}var a=r.getChildContext();for(var o in a)if(!(o in i))throw new Error((H(e)||"Unknown")+'.getChildContext(): key "'+o+'" is not defined in childContextTypes.');return En(i,a,"child context",H(e)||"Unknown"),c({},n,a)}function Xn(e){var t=e.stateNode,n=t&&t.__reactInternalMemoizedMergedChildContext||Un;return Bn=Dn.current,Ln(Dn,n,e),Ln(Fn,Fn.current,e),!0}function $n(e,t,n){var r=e.stateNode;if(!r)throw new Error("Expected to have an instance by this point. This error is likely caused by a bug in React. Please file an issue.");if(n){var i=qn(e,t,Bn);r.__reactInternalMemoizedMergedChildContext=i,In(Fn,e),In(Dn,e),Ln(Dn,i,e),Ln(Fn,n,e)}else In(Fn,e),Ln(Fn,n,e)}function Yn(e){if(!function(e){return pe(e)===e}(e)||1!==e.tag)throw new Error("Expected subtree parent to be a mounted class component. This error is likely caused by a bug in React. Please file an issue.");var t=e;do{switch(t.tag){case 3:return t.stateNode.context;case 1:if(Gn(t.type))return t.stateNode.__reactInternalMemoizedMergedChildContext}t=t.return}while(null!==t);throw new Error("Found unexpected detached subtree parent. This error is likely caused by a bug in React. Please file an issue.")}var Kn=16,Qn=Math.clz32?Math.clz32:function(e){var t=e>>>0;if(0===t)return 32;return 31-(Zn(t)/Jn|0)|0},Zn=Math.log,Jn=Math.LN2;var er=16,tr=4194240,nr=1024,rr=2048,ir=4096,sr=8192,ar=16384,or=32768,lr=65536,ur=131072,cr=262144,dr=524288,hr=1048576,pr=2097152,fr=130023424,mr=4194304,gr=8388608,vr=16777216,yr=33554432,_r=67108864,xr=mr,br=134217728,Sr=268435455,Tr=268435456,wr=536870912,Mr=1073741824;function Er(e){return 1&e?"Sync":2&e?"InputContinuousHydration":4&e?"InputContinuous":8&e?"DefaultHydration":e&er?"Default":32&e?"TransitionHydration":e&tr?"Transition":e&fr?"Retry":e&br?"SelectiveHydration":e&Tr?"IdleHydration":e&wr?"Idle":e&Mr?"Offscreen":void 0}var Ar=-1,Cr=64,Rr=mr;function Nr(e){switch(Or(e)){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case er:return er;case 32:return 32;case 64:case 128:case 256:case 512:case nr:case rr:case ir:case sr:case ar:case or:case lr:case ur:case cr:case dr:case hr:case pr:return e&tr;case mr:case gr:case vr:case yr:case _r:return e&fr;case br:return br;case Tr:return Tr;case wr:return wr;case Mr:return Mr;default:return l("Should have found matching lanes. This is a bug in React."),e}}function Pr(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,s=e.pingedLanes,a=n&Sr;if(0!==a){var o=a&~i;if(0!==o)r=Nr(o);else{var l=a&s;0!==l&&(r=Nr(l))}}else{var u=n&~i;0!==u?r=Nr(u):0!==s&&(r=Nr(s))}if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)){var c=Or(r),d=Or(t);if(c>=d||c===er&&0!==(d&tr))return t}4&r&&(r|=n&er);var h=e.entangledLanes;if(0!==h)for(var p=e.entanglements,f=r&h;f>0;){var m=zr(f),g=1<<m;r|=p[m],f&=~g}return r}function Ir(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case er:case 32:case 64:case 128:case 256:case 512:case nr:case rr:case ir:case sr:case ar:case or:case lr:case ur:case cr:case dr:case hr:case pr:return t+5e3;case mr:case gr:case vr:case yr:case _r:case br:case Tr:case wr:case Mr:return Ar;default:return l("Should have found matching lanes. This is a bug in React."),Ar}}function Lr(e){var t=-1073741825&e.pendingLanes;return 0!==t?t:t&Mr?Mr:0}function Ur(e){return 0!==(e&Sr)}function Dr(e){return(e&fr)===e}function Fr(e,t){return!!(30&t)}function Br(e){return 0!==(e&tr)}function Or(e){return e&-e}function kr(e){return Or(e)}function zr(e){return 31-Qn(e)}function Vr(e){return zr(e)}function Gr(e,t){return 0!==(e&t)}function Hr(e,t){return(e&t)===t}function Wr(e,t){return e|t}function jr(e,t){return e&~t}function qr(e,t){return e&t}function Xr(e){for(var t=[],n=0;n<31;n++)t.push(e);return t}function $r(e,t,n){e.pendingLanes|=t,t!==wr&&(e.suspendedLanes=0,e.pingedLanes=0),e.eventTimes[Vr(t)]=n}function Yr(e,t,n){e.pingedLanes|=e.suspendedLanes&t}function Kr(e,t){for(var n=e.entangledLanes|=t,r=e.entanglements,i=n;i;){var s=zr(i),a=1<<s;a&t|r[s]&t&&(r[s]|=t),i&=~a}}function Qr(e,t,n){if(bi)for(var r=e.pendingUpdatersLaneMap;n>0;){var i=Vr(n),s=1<<i;r[i].add(t),n&=~s}}function Zr(e,t){if(bi)for(var n=e.pendingUpdatersLaneMap,r=e.memoizedUpdaters;t>0;){var i=Vr(t),s=1<<i,a=n[i];a.size>0&&(a.forEach(function(e){var t=e.alternate;null!==t&&r.has(t)||r.add(e)}),a.clear()),t&=~s}}var Jr=er,ei=wr,ti=0;function ni(){return ti}function ri(e){ti=e}function ii(e,t){return 0!==e&&e<t}function si(e){var t=Or(e);return ii(1,t)?ii(4,t)?Ur(t)?Jr:ei:4:1}var ai=i.unstable_scheduleCallback,oi=i.unstable_cancelCallback,li=i.unstable_shouldYield,ui=i.unstable_requestPaint,ci=i.unstable_now,di=i.unstable_ImmediatePriority,hi=i.unstable_UserBlockingPriority,pi=i.unstable_NormalPriority,fi=i.unstable_IdlePriority,mi=i.unstable_yieldValue,gi=i.unstable_setDisableYieldValue,vi=null,yi=null,_i=null,xi=!1,bi="undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__;function Si(e){if("function"==typeof mi&&(gi(e),a=e),yi&&"function"==typeof yi.setStrictMode)try{yi.setStrictMode(vi,e)}catch(e){xi||(xi=!0,l("React instrumentation encountered an error: %s",e))}}function Ti(e){_i=e}function wi(){for(var e=new Map,t=1,n=0;n<31;n++){var r=Er(t);e.set(t,r),t*=2}return e}function Mi(){null!==_i&&"function"==typeof _i.markCommitStopped&&_i.markCommitStopped()}function Ei(e){null!==_i&&"function"==typeof _i.markComponentRenderStarted&&_i.markComponentRenderStarted(e)}function Ai(){null!==_i&&"function"==typeof _i.markComponentRenderStopped&&_i.markComponentRenderStopped()}function Ci(e){null!==_i&&"function"==typeof _i.markComponentPassiveEffectMountStarted&&_i.markComponentPassiveEffectMountStarted(e)}function Ri(){null!==_i&&"function"==typeof _i.markComponentPassiveEffectMountStopped&&_i.markComponentPassiveEffectMountStopped()}function Ni(e){null!==_i&&"function"==typeof _i.markComponentPassiveEffectUnmountStarted&&_i.markComponentPassiveEffectUnmountStarted(e)}function Pi(){null!==_i&&"function"==typeof _i.markComponentPassiveEffectUnmountStopped&&_i.markComponentPassiveEffectUnmountStopped()}function Ii(e){null!==_i&&"function"==typeof _i.markComponentLayoutEffectMountStarted&&_i.markComponentLayoutEffectMountStarted(e)}function Li(){null!==_i&&"function"==typeof _i.markComponentLayoutEffectMountStopped&&_i.markComponentLayoutEffectMountStopped()}function Ui(e){null!==_i&&"function"==typeof _i.markComponentLayoutEffectUnmountStarted&&_i.markComponentLayoutEffectUnmountStarted(e)}function Di(){null!==_i&&"function"==typeof _i.markComponentLayoutEffectUnmountStopped&&_i.markComponentLayoutEffectUnmountStopped()}function Fi(e,t,n){null!==_i&&"function"==typeof _i.markComponentErrored&&_i.markComponentErrored(e,t,n)}function Bi(e,t,n){null!==_i&&"function"==typeof _i.markComponentSuspended&&_i.markComponentSuspended(e,t,n)}function Oi(e){null!==_i&&"function"==typeof _i.markRenderStarted&&_i.markRenderStarted(e)}function ki(){null!==_i&&"function"==typeof _i.markRenderStopped&&_i.markRenderStopped()}function zi(e,t){null!==_i&&"function"==typeof _i.markStateUpdateScheduled&&_i.markStateUpdateScheduled(e,t)}var Vi="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},Gi=null,Hi=!1,Wi=!1;function ji(e){null===Gi?Gi=[e]:Gi.push(e)}function qi(){Hi&&Xi()}function Xi(){if(!Wi&&null!==Gi){Wi=!0;var e=0,t=ni();try{var n=Gi;for(ri(1);e<n.length;e++){var r=n[e];do{r=r(true)}while(null!==r)}Gi=null,Hi=!1}catch(t){throw null!==Gi&&(Gi=Gi.slice(e+1)),ai(di,Xi),t}finally{ri(t),Wi=!1}}return null}function $i(e){return e.current.memoizedState.isDehydrated}var Yi=s.ReactCurrentBatchConfig;function Ki(e,t){if(Vi(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++){var s=n[i];if(!Sn.call(t,s)||!Vi(e[s],t[s]))return!1}return!0}function Qi(e){switch(e._debugOwner&&e._debugOwner.type,e._debugSource,e.tag){case 5:return mn(e.type);case 16:return mn("Lazy");case v:return mn("Suspense");case S:return mn("SuspenseList");case 0:case 2:case _:return xn(e.type);case m:return xn(e.type.render);case 1:return _n(e.type,!0);default:return""}}function Zi(e){try{var t="",n=e;do{t+=Qi(n),n=n.return}while(n);return t}catch(e){return"\nError generating stack: "+e.message+"\n"+e.stack}}var Ji=s.ReactDebugCurrentFrame,es=null,ts=!1;function ns(){return null===es?"":Zi(es)}function rs(){Ji.getCurrentStack=null,es=null,ts=!1}function is(e){Ji.getCurrentStack=ns,es=e,ts=!1}function ss(e){ts=e}var as={recordUnsafeLifecycleWarnings:function(e,t){},flushPendingUnsafeLifecycleWarnings:function(){},recordLegacyContextWarning:function(e,t){},flushLegacyContextWarning:function(){},discardPendingWarnings:function(){}},os=function(e){var t=[];return e.forEach(function(e){t.push(e)}),t.sort().join(", ")},ls=[],us=[],cs=[],ds=[],hs=[],ps=[],fs=new Set;as.recordUnsafeLifecycleWarnings=function(e,t){fs.has(e.type)||("function"==typeof t.componentWillMount&&!0!==t.componentWillMount.__suppressDeprecationWarning&&ls.push(e),8&e.mode&&"function"==typeof t.UNSAFE_componentWillMount&&us.push(e),"function"==typeof t.componentWillReceiveProps&&!0!==t.componentWillReceiveProps.__suppressDeprecationWarning&&cs.push(e),8&e.mode&&"function"==typeof t.UNSAFE_componentWillReceiveProps&&ds.push(e),"function"==typeof t.componentWillUpdate&&!0!==t.componentWillUpdate.__suppressDeprecationWarning&&hs.push(e),8&e.mode&&"function"==typeof t.UNSAFE_componentWillUpdate&&ps.push(e))},as.flushPendingUnsafeLifecycleWarnings=function(){var e=new Set;ls.length>0&&(ls.forEach(function(t){e.add(H(t)||"Component"),fs.add(t.type)}),ls=[]);var t=new Set;us.length>0&&(us.forEach(function(e){t.add(H(e)||"Component"),fs.add(e.type)}),us=[]);var n=new Set;cs.length>0&&(cs.forEach(function(e){n.add(H(e)||"Component"),fs.add(e.type)}),cs=[]);var r=new Set;ds.length>0&&(ds.forEach(function(e){r.add(H(e)||"Component"),fs.add(e.type)}),ds=[]);var i=new Set;hs.length>0&&(hs.forEach(function(e){i.add(H(e)||"Component"),fs.add(e.type)}),hs=[]);var s=new Set;(ps.length>0&&(ps.forEach(function(e){s.add(H(e)||"Component"),fs.add(e.type)}),ps=[]),t.size>0)&&l("Using UNSAFE_componentWillMount in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move code with side effects to componentDidMount, and set initial state in the constructor.\n\nPlease update the following components: %s",os(t));r.size>0&&l("Using UNSAFE_componentWillReceiveProps in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state\n\nPlease update the following components: %s",os(r));s.size>0&&l("Using UNSAFE_componentWillUpdate in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n\nPlease update the following components: %s",os(s));e.size>0&&o("componentWillMount has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move code with side effects to componentDidMount, and set initial state in the constructor.\n* Rename componentWillMount to UNSAFE_componentWillMount to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",os(e));n.size>0&&o("componentWillReceiveProps has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state\n* Rename componentWillReceiveProps to UNSAFE_componentWillReceiveProps to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",os(n));i.size>0&&o("componentWillUpdate has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.\n\n* Move data fetching code or side effects to componentDidUpdate.\n* Rename componentWillUpdate to UNSAFE_componentWillUpdate to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run `npx react-codemod rename-unsafe-lifecycles` in your project source folder.\n\nPlease update the following components: %s",os(i))};var ms=new Map,gs=new Set;function vs(e){return"function"==typeof Symbol&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object"}function ys(e){try{return _s(e),!1}catch(e){return!0}}function _s(e){return""+e}function xs(e,t){if(e&&e.defaultProps){var n=c({},t),r=e.defaultProps;for(var i in r)void 0===n[i]&&(n[i]=r[i]);return n}return t}as.recordLegacyContextWarning=function(e,t){var n=function(e){for(var t=null,n=e;null!==n;)8&n.mode&&(t=n),n=n.return;return t}(e);if(null!==n){if(!gs.has(e.type)){var r=ms.get(n);(null!=e.type.contextTypes||null!=e.type.childContextTypes||null!==t&&"function"==typeof t.getChildContext)&&(void 0===r&&(r=[],ms.set(n,r)),r.push(e))}}else l("Expected to find a StrictMode component in a strict mode tree. This error is likely caused by a bug in React. Please file an issue.")},as.flushLegacyContextWarning=function(){ms.forEach(function(e,t){if(0!==e.length){var n=e[0],r=new Set;e.forEach(function(e){r.add(H(e)||"Component"),gs.add(e.type)});var i=os(r);try{is(n),l("Legacy context API has been detected within a strict-mode tree.\n\nThe old API will be supported in all 16.x releases, but applications using it should migrate to the new version.\n\nPlease update the following components: %s\n\nLearn more about this warning here: https://reactjs.org/link/legacy-context",i)}finally{rs()}}})},as.discardPendingWarnings=function(){ls=[],us=[],cs=[],ds=[],hs=[],ps=[],ms=new Map};var bs,Ss=Pn(null);bs={};var Ts=null,ws=null,Ms=null,Es=!1;function As(){Ts=null,ws=null,Ms=null,Es=!1}function Cs(){Es=!0}function Rs(){Es=!1}function Ns(e,t,n){Fe?(Ln(Ss,t._currentValue,e),t._currentValue=n,void 0!==t._currentRenderer&&null!==t._currentRenderer&&t._currentRenderer!==bs&&l("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),t._currentRenderer=bs):(Ln(Ss,t._currentValue2,e),t._currentValue2=n,void 0!==t._currentRenderer2&&null!==t._currentRenderer2&&t._currentRenderer2!==bs&&l("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),t._currentRenderer2=bs)}function Ps(e,t){var n=Ss.current;In(Ss,t),Fe?e._currentValue=n:e._currentValue2=n}function Is(e,t,n){for(var r=e;null!==r;){var i=r.alternate;if(Hr(r.childLanes,t)?null===i||Hr(i.childLanes,t)||(i.childLanes=Wr(i.childLanes,t)):(r.childLanes=Wr(r.childLanes,t),null!==i&&(i.childLanes=Wr(i.childLanes,t))),r===n)break;r=r.return}r!==n&&l("Expected to find the propagation root when scheduling context work. This error is likely caused by a bug in React. Please file an issue.")}function Ls(e,t,n){!function(e,t,n){var r=e.child;null!==r&&(r.return=e);for(;null!==r;){var i=void 0,s=r.dependencies;if(null!==s){i=r.child;for(var a=s.firstContext;null!==a;){if(a.context===t){if(1===r.tag){var o=kr(n),l=js(Ar,o);l.tag=Vs;var u=r.updateQueue;if(null===u);else{var c=u.shared,d=c.pending;null===d?l.next=l:(l.next=d.next,d.next=l),c.pending=l}}r.lanes=Wr(r.lanes,n);var h=r.alternate;null!==h&&(h.lanes=Wr(h.lanes,n)),Is(r.return,n,e),s.lanes=Wr(s.lanes,n);break}a=a.next}}else if(r.tag===f)i=r.type===e.type?null:r.child;else if(r.tag===b){var p=r.return;if(null===p)throw new Error("We just came from a parent so we must have had a parent. This is a bug in React.");p.lanes=Wr(p.lanes,n);var m=p.alternate;null!==m&&(m.lanes=Wr(m.lanes,n)),Is(p,n,e),i=r.sibling}else i=r.child;if(null!==i)i.return=r;else for(i=r;null!==i;){if(i===e){i=null;break}var g=i.sibling;if(null!==g){g.return=i.return,i=g;break}i=i.return}r=i}}(e,t,n)}function Us(e,t){Ts=e,ws=null,Ms=null;var n=e.dependencies;null!==n&&(null!==n.firstContext&&(Gr(n.lanes,t)&&Jc(),n.firstContext=null))}function Ds(e){Es&&l("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");var t=Fe?e._currentValue:e._currentValue2;if(Ms===e);else{var n={context:e,memoizedValue:t,next:null};if(null===ws){if(null===Ts)throw new Error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");ws=n,Ts.dependencies={lanes:0,firstContext:n}}else ws=ws.next=n}return t}var Fs=null;function Bs(e){null===Fs?Fs=[e]:Fs.push(e)}var Os,ks,zs=0,Vs=2,Gs=!1;function Hs(e){var t={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null};e.updateQueue=t}function Ws(e,t){var n=t.updateQueue,r=e.updateQueue;if(n===r){var i={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects};t.updateQueue=i}}function js(e,t){return{eventTime:e,lane:t,tag:zs,payload:null,callback:null,next:null}}function qs(e,t,n){var r=e.updateQueue;if(null!==r){var i=r.shared;if(Bp(e)){var s=i.interleaved;null===s?(t.next=t,Bs(i)):(t.next=s.next,s.next=t),i.interleaved=t}else{var a=i.pending;null===a?t.next=t:(t.next=a.next,a.next=t),i.pending=t}ks!==i||Os||(l("An update (setState, replaceState, or forceUpdate) was scheduled from inside an update function. Update functions should be pure, with zero side-effects. Consider using componentDidUpdate or a callback."),Os=!0)}}function Xs(e,t,n){var r=t.updateQueue;if(null!==r){var i=r.shared;if(Br(n)){var s=i.lanes,a=Wr(s=qr(s,e.pendingLanes),n);i.lanes=a,Kr(e,a)}}}function $s(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r){var i=r.updateQueue;if(n===i){var s=null,a=null,o=n.firstBaseUpdate;if(null!==o){var l=o;do{var u={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};null===a?s=a=u:(a.next=u,a=u),l=l.next}while(null!==l);null===a?s=a=t:(a.next=t,a=t)}else s=a=t;return n={baseState:i.baseState,firstBaseUpdate:s,lastBaseUpdate:a,shared:i.shared,effects:i.effects},void(e.updateQueue=n)}}var c=n.lastBaseUpdate;null===c?n.firstBaseUpdate=t:c.next=t,n.lastBaseUpdate=t}function Ys(e,t,n,r,i,s){switch(n.tag){case 1:var a=n.payload;if("function"==typeof a){Cs();var o=a.call(s,r,i);if(8&e.mode){Si(!0);try{a.call(s,r,i)}finally{Si(!1)}}return Rs(),o}return a;case 3:e.flags=-65537&e.flags|j;case zs:var l,u=n.payload;if("function"==typeof u){if(Cs(),l=u.call(s,r,i),8&e.mode){Si(!0);try{u.call(s,r,i)}finally{Si(!1)}}Rs()}else l=u;return null==l?r:c({},r,l);case Vs:return Gs=!0,r}return r}function Ks(e,t,n,r){var i=e.updateQueue;Gs=!1,ks=i.shared;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,o=i.shared.pending;if(null!==o){i.shared.pending=null;var l=o,u=l.next;l.next=null,null===a?s=u:a.next=u,a=l;var c=e.alternate;if(null!==c){var d=c.updateQueue,h=d.lastBaseUpdate;h!==a&&(null===h?d.firstBaseUpdate=u:h.next=u,d.lastBaseUpdate=l)}}if(null!==s){for(var p=i.baseState,f=0,m=null,g=null,v=null,y=s;;){var _=y.lane,x=y.eventTime;if(Hr(r,_)){if(null!==v){var b={eventTime:x,lane:0,tag:y.tag,payload:y.payload,callback:y.callback,next:null};v=v.next=b}if(p=Ys(e,0,y,p,t,n),null!==y.callback&&0!==y.lane){e.flags|=64;var S=i.effects;null===S?i.effects=[y]:S.push(y)}}else{var T={eventTime:x,lane:_,tag:y.tag,payload:y.payload,callback:y.callback,next:null};null===v?(g=v=T,m=p):v=v.next=T,f=Wr(f,_)}if(null===(y=y.next)){if(null===(o=i.shared.pending))break;var w=o,M=w.next;w.next=null,y=M,i.lastBaseUpdate=w,i.shared.pending=null}}null===v&&(m=p),i.baseState=m,i.firstBaseUpdate=g,i.lastBaseUpdate=v;var E=i.shared.interleaved;if(null!==E){var A=E;do{f=Wr(f,A.lane),A=A.next}while(A!==E)}else null===s&&(i.shared.lanes=0);Qp(f),e.lanes=f,e.memoizedState=p}ks=null}function Qs(e,t){if("function"!=typeof e)throw new Error("Invalid argument passed as callback. Expected a function. Instead received: "+e);e.call(t)}function Zs(){Gs=!1}function Js(){return Gs}function ea(e,t,n){var r=t.effects;if(t.effects=null,null!==r)for(var i=0;i<r.length;i++){var s=r[i],a=s.callback;null!==a&&(s.callback=null,Qs(a,n))}}Os=!1,ks=null;var ta,na,ra,ia,sa,aa,oa,la,ua,ca,da={},ha=(new r.Component).refs;ta=new Set,na=new Set,ra=new Set,ia=new Set,la=new Set,sa=new Set,ua=new Set,ca=new Set;var pa=new Set;function fa(e,t,n,r){var i=e.memoizedState,s=n(r,i);if(8&e.mode){Si(!0);try{s=n(r,i)}finally{Si(!1)}}aa(t,s);var a=null==s?i:c({},i,s);(e.memoizedState=a,0===e.lanes)&&(e.updateQueue.baseState=a)}oa=function(e,t){if(null!==e&&"function"!=typeof e){var n=t+"_"+e;pa.has(n)||(pa.add(n),l("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",t,e))}},aa=function(e,t){if(void 0===t){var n=V(e)||"Component";sa.has(n)||(sa.add(n),l("%s.getDerivedStateFromProps(): A valid state object (or null) must be returned. You have returned undefined.",n))}},Object.defineProperty(da,"_processChildContext",{enumerable:!1,value:function(){throw new Error("_processChildContext is not available in React 16+. This likely means you have multiple copies of React and are attempting to nest a React 15 tree inside a React 16 tree using unstable_renderSubtreeIntoContainer, which isn't supported. Try to make sure you have only one copy of React (and ideally, switch to ReactDOM.createPortal).")}}),Object.freeze(da);var ma={isMounted:function(e){var t=he.current;if(null!==t&&1===t.tag){var n=t,r=n.stateNode;r._warnedAboutRefsInRender||l("%s is accessing isMounted inside its render() function. render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",H(n)||"A component"),r._warnedAboutRefsInRender=!0}var i=d(e);return!!i&&pe(i)===i},enqueueSetState:function(e,t,n){var r=d(e),i=Pp(),s=Ip(r),a=js(i,s);a.payload=t,null!=n&&(oa(n,"setState"),a.callback=n),qs(r,a);var o=Dp(r,s,i);null!==o&&Xs(o,r,s),zi(r,s)},enqueueReplaceState:function(e,t,n){var r=d(e),i=Pp(),s=Ip(r),a=js(i,s);a.tag=1,a.payload=t,null!=n&&(oa(n,"replaceState"),a.callback=n),qs(r,a);var o=Dp(r,s,i);null!==o&&Xs(o,r,s),zi(r,s)},enqueueForceUpdate:function(e,t){var n=d(e),r=Pp(),i=Ip(n),s=js(r,i);s.tag=Vs,null!=t&&(oa(t,"forceUpdate"),s.callback=t),qs(n,s);var a=Dp(n,i,r);null!==a&&Xs(a,n,i),function(e,t){null!==_i&&"function"==typeof _i.markForceUpdateScheduled&&_i.markForceUpdateScheduled(e,t)}(n,i)}};function ga(e,t,n,r,i,s,a){var o=e.stateNode;if("function"==typeof o.shouldComponentUpdate){var u=o.shouldComponentUpdate(r,s,a);if(8&e.mode){Si(!0);try{u=o.shouldComponentUpdate(r,s,a)}finally{Si(!1)}}return void 0===u&&l("%s.shouldComponentUpdate(): Returned undefined instead of a boolean value. Make sure to return true or false.",V(t)||"Component"),u}return!t.prototype||!t.prototype.isPureReactComponent||(!Ki(n,r)||!Ki(i,s))}function va(e,t){var n;t.updater=ma,e.stateNode=t,n=e,t._reactInternals=n,t._reactInternalInstance=da}function ya(e,t,n){var r=!1,i=Un,s=Un,a=t.contextType;if("contextType"in t&&(!(null===a||void 0!==a&&a.$$typeof===P&&void 0===a._context)&&!ca.has(t))){ca.add(t);var o="";o=void 0===a?" However, it is set to undefined. This can be caused by a typo or by mixing up named and default imports. This can also happen due to a circular dependency, so try moving the createContext() call to a separate file.":"object"!=typeof a?" However, it is set to a "+typeof a+".":a.$$typeof===N?" Did you accidentally pass the Context.Provider instead?":void 0!==a._context?" Did you accidentally pass the Context.Consumer instead?":" However, it is set to an object with keys {"+Object.keys(a).join(", ")+"}.",l("%s defines an invalid contextType. contextType should point to the Context object returned by React.createContext().%s",V(t)||"Component",o)}if("object"==typeof a&&null!==a)s=Ds(a);else{i=On(0,t,!0);var u=t.contextTypes;s=(r=null!=u)?zn(e,i):Un}var c=new t(n,s);if(8&e.mode){Si(!0);try{c=new t(n,s)}finally{Si(!1)}}var d=e.memoizedState=null!==c.state&&void 0!==c.state?c.state:null;if(va(e,c),"function"==typeof t.getDerivedStateFromProps&&null===d){var h=V(t)||"Component";na.has(h)||(na.add(h),l("`%s` uses `getDerivedStateFromProps` but its initial state is %s. This is not recommended. Instead, define the initial state by assigning an object to `this.state` in the constructor of `%s`. This ensures that `getDerivedStateFromProps` arguments have a consistent shape.",h,null===c.state?"null":"undefined",h))}if("function"==typeof t.getDerivedStateFromProps||"function"==typeof c.getSnapshotBeforeUpdate){var p=null,f=null,m=null;if("function"==typeof c.componentWillMount&&!0!==c.componentWillMount.__suppressDeprecationWarning?p="componentWillMount":"function"==typeof c.UNSAFE_componentWillMount&&(p="UNSAFE_componentWillMount"),"function"==typeof c.componentWillReceiveProps&&!0!==c.componentWillReceiveProps.__suppressDeprecationWarning?f="componentWillReceiveProps":"function"==typeof c.UNSAFE_componentWillReceiveProps&&(f="UNSAFE_componentWillReceiveProps"),"function"==typeof c.componentWillUpdate&&!0!==c.componentWillUpdate.__suppressDeprecationWarning?m="componentWillUpdate":"function"==typeof c.UNSAFE_componentWillUpdate&&(m="UNSAFE_componentWillUpdate"),null!==p||null!==f||null!==m){var g=V(t)||"Component",v="function"==typeof t.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";ia.has(g)||(ia.add(g),l("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n%s uses %s but also contains the following legacy lifecycles:%s%s%s\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://reactjs.org/link/unsafe-component-lifecycles",g,v,null!==p?"\n  "+p:"",null!==f?"\n  "+f:"",null!==m?"\n  "+m:""))}}return r&&kn(e,i,s),c}function _a(e,t,n,r){var i=t.state;if("function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==i){var s=H(e)||"Component";ta.has(s)||(ta.add(s),l("%s.componentWillReceiveProps(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",s)),ma.enqueueReplaceState(t,t.state,null)}}function xa(e,t,n,r){!function(e,t,n){var r=e.stateNode,i=V(t)||"Component";r.render||(t.prototype&&"function"==typeof t.prototype.render?l("%s(...): No `render` method found on the returned component instance: did you accidentally return an object from the constructor?",i):l("%s(...): No `render` method found on the returned component instance: you may have forgotten to define `render`.",i)),!r.getInitialState||r.getInitialState.isReactClassApproved||r.state||l("getInitialState was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?",i),r.getDefaultProps&&!r.getDefaultProps.isReactClassApproved&&l("getDefaultProps was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.",i),r.propTypes&&l("propTypes was defined as an instance property on %s. Use a static property to define propTypes instead.",i),r.contextType&&l("contextType was defined as an instance property on %s. Use a static property to define contextType instead.",i),r.contextTypes&&l("contextTypes was defined as an instance property on %s. Use a static property to define contextTypes instead.",i),t.contextType&&t.contextTypes&&!ua.has(t)&&(ua.add(t),l("%s declares both contextTypes and contextType static properties. The legacy contextTypes property will be ignored.",i)),"function"==typeof r.componentShouldUpdate&&l("%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",i),t.prototype&&t.prototype.isPureReactComponent&&void 0!==r.shouldComponentUpdate&&l("%s has a method called shouldComponentUpdate(). shouldComponentUpdate should not be used when extending React.PureComponent. Please extend React.Component if shouldComponentUpdate is used.",V(t)||"A pure component"),"function"==typeof r.componentDidUnmount&&l("%s has a method called componentDidUnmount(). But there is no such lifecycle method. Did you mean componentWillUnmount()?",i),"function"==typeof r.componentDidReceiveProps&&l("%s has a method called componentDidReceiveProps(). But there is no such lifecycle method. If you meant to update the state in response to changing props, use componentWillReceiveProps(). If you meant to fetch data or run side-effects or mutations after React has updated the UI, use componentDidUpdate().",i),"function"==typeof r.componentWillRecieveProps&&l("%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",i),"function"==typeof r.UNSAFE_componentWillRecieveProps&&l("%s has a method called UNSAFE_componentWillRecieveProps(). Did you mean UNSAFE_componentWillReceiveProps()?",i);var s=r.props!==n;void 0!==r.props&&s&&l("%s(...): When calling super() in `%s`, make sure to pass up the same props that your component's constructor was passed.",i,i),r.defaultProps&&l("Setting defaultProps as an instance property on %s is not supported and will be ignored. Instead, define defaultProps as a static property on %s.",i,i),"function"!=typeof r.getSnapshotBeforeUpdate||"function"==typeof r.componentDidUpdate||ra.has(t)||(ra.add(t),l("%s: getSnapshotBeforeUpdate() should be used with componentDidUpdate(). This component defines getSnapshotBeforeUpdate() only.",V(t))),"function"==typeof r.getDerivedStateFromProps&&l("%s: getDerivedStateFromProps() is defined as an instance method and will be ignored. Instead, declare it as a static method.",i),"function"==typeof r.getDerivedStateFromError&&l("%s: getDerivedStateFromError() is defined as an instance method and will be ignored. Instead, declare it as a static method.",i),"function"==typeof t.getSnapshotBeforeUpdate&&l("%s: getSnapshotBeforeUpdate() is defined as a static method and will be ignored. Instead, declare it as an instance method.",i);var a=r.state;a&&("object"!=typeof a||be(a))&&l("%s.state: must be set to an object or null",i),"function"==typeof r.getChildContext&&"object"!=typeof t.childContextTypes&&l("%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",i)}(e,t,n);var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=ha,Hs(e);var s=t.contextType;if("object"==typeof s&&null!==s)i.context=Ds(s);else{var a=On(0,t,!0);i.context=zn(e,a)}if(i.state===n){var o=V(t)||"Component";la.has(o)||(la.add(o),l("%s: It is not recommended to assign props directly to state because updates to props won't be reflected in state. In most cases, it is better to use props directly.",o))}8&e.mode&&as.recordLegacyContextWarning(e,i),as.recordUnsafeLifecycleWarnings(e,i),i.state=e.memoizedState;var u=t.getDerivedStateFromProps;if("function"==typeof u&&(fa(e,t,u,n),i.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof i.getSnapshotBeforeUpdate||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||(!function(e,t){var n=t.state;"function"==typeof t.componentWillMount&&t.componentWillMount(),"function"==typeof t.UNSAFE_componentWillMount&&t.UNSAFE_componentWillMount(),n!==t.state&&(l("%s.componentWillMount(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",H(e)||"Component"),ma.enqueueReplaceState(t,t.state,null))}(e,i),Ks(e,n,i,r),i.state=e.memoizedState),"function"==typeof i.componentDidMount){var c=4;c|=ie,0!==(e.mode&Kn)&&(c|=se),e.flags|=c}}var ba=[],Sa=0,Ta=null,wa=0,Ma=[],Ea=0,Aa=null,Ca=1,Ra="";function Na(){var e=Ra;return(Ca&~function(e){return 1<<Ua(e)-1}(Ca)).toString(32)+e}function Pa(e,t){Fa(),ba[Sa++]=wa,ba[Sa++]=Ta,Ta=e,wa=t}function Ia(e,t,n){Fa(),Ma[Ea++]=Ca,Ma[Ea++]=Ra,Ma[Ea++]=Aa,Aa=e;var r=Ca,i=Ra,s=Ua(r)-1,a=r&~(1<<s),o=n+1,l=Ua(t)+s;if(l>30){var u=s-s%5,c=(a&(1<<u)-1).toString(32),d=a>>u,h=s-u,p=Ua(t)+h;Ca=1<<p|(o<<h|d),Ra=c+i}else{Ca=1<<l|(o<<s|a),Ra=i}}function La(e){if(Fa(),null!==e.return){Pa(e,1),Ia(e,1,0)}}function Ua(e){return 32-Qn(e)}function Da(e){for(;e===Ta;)Ta=ba[--Sa],ba[Sa]=null,wa=ba[--Sa],ba[Sa]=null;for(;e===Aa;)Aa=Ma[--Ea],Ma[Ea]=null,Ra=Ma[--Ea],Ma[Ea]=null,Ca=Ma[--Ea],Ma[Ea]=null}function Fa(){oo()||l("Expected to be hydrating. This is a bug in React. Please file an issue.")}var Ba,Oa,ka,za,Va,Ga=null,Ha=null,Wa=!1,ja=!1,qa=null;function Xa(e,t,n){return!!ze&&(Ha=kt(t),Ga=e,Wa=!0,qa=null,ja=!1,null!==n&&function(e,t){Fa(),Ma[Ea++]=Ca,Ma[Ea++]=Ra,Ma[Ea++]=Aa,Ca=t.id,Ra=t.overflow,Aa=e}(e,n),!0)}function $a(e,t){switch(e.tag){case 3:Qt(e.stateNode.containerInfo,t);break;case 5:Jt(e.type,e.memoizedProps,e.stateNode,t);break;case v:var n=e.memoizedState;null!==n.dehydrated&&Zt(n.dehydrated,t)}}function Ya(e,t){$a(e,t);var n,r=((n=Hf(5,null,null,0)).elementType="DELETED",n);r.stateNode=t,r.return=e;var i=e.deletions;null===i?(e.deletions=[r],e.flags|=W):i.push(r)}function Ka(e,t){if(!ja)switch(e.tag){case 3:var n=e.stateNode.containerInfo;switch(t.tag){case 5:var r=t.type,i=t.pendingProps;en(n,r,i);break;case 6:var s=t.pendingProps;tn(n,s);break;case v:nn(n)}break;case 5:var a=e.type,o=e.memoizedProps,l=e.stateNode;switch(t.tag){case 5:var u=t.type,c=t.pendingProps;on(a,o,l,u,c);break;case 6:var d=t.pendingProps;ln(a,o,l,d);break;case v:un(a,o,l)}break;case v:var h=e.memoizedState.dehydrated;if(null!==h)switch(t.tag){case 5:var p=t.type,f=t.pendingProps;rn(h,p,f);break;case 6:var m=t.pendingProps;sn(h,m);break;case v:an(h)}break;default:return}}function Qa(e,t){t.flags=-4097&t.flags|2,Ka(e,t)}function Za(e,t){switch(e.tag){case 5:var n=e.type,r=e.pendingProps,i=Nt(t,n,r);return null!==i&&(e.stateNode=i,Ga=e,Ha=Bt(i),!0);case 6:var s=e.pendingProps,a=Pt(t,s);return null!==a&&(e.stateNode=a,Ga=e,Ha=null,!0);case v:var o=It(t);if(null!==o){var l={dehydrated:o,treeContext:(Fa(),null!==Aa?{id:Ca,overflow:Ra}:null),retryLane:Mr};e.memoizedState=l;var u=function(e){var t=Hf(b,null,null,0);return t.stateNode=e,t}(o);return u.return=e,e.child=u,Ga=e,Ha=null,!0}return!1;default:return!1}}function Ja(e){return!!(1&e.mode)&&0===(e.flags&j)}function eo(e){throw new Error("Hydration failed because the initial UI does not match what was rendered on the server.")}function to(e){if(Wa){var t=Ha;if(!t)return Ja(e)&&(Ka(Ga,e),eo()),Qa(Ga,e),Wa=!1,void(Ga=e);var n=t;if(!Za(e,t)){Ja(e)&&(Ka(Ga,e),eo()),t=Ft(n);var r=Ga;if(!t||!Za(e,t))return Qa(Ga,e),Wa=!1,void(Ga=e);Ya(r,n)}}}function no(e){for(var t=e.return;null!==t&&5!==t.tag&&3!==t.tag&&t.tag!==v;)t=t.return;Ga=t}function ro(e){if(!ze)return!1;if(e!==Ga)return!1;if(!Wa)return no(e),Wa=!0,!1;if(3!==e.tag&&(5!==e.tag||$t(e.type)&&!Pe(e.type,e.memoizedProps))){var t=Ha;if(t)if(Ja(e))io(e),eo();else for(;t;)Ya(e,t),t=Ft(t)}return no(e),Ha=e.tag===v?function(e){if(!ze)throw new Error("Expected skipPastDehydratedSuspenseInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var t=e.memoizedState,n=null!==t?t.dehydrated:null;if(!n)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");return Ht(n)}(e):Ga?Ft(e.stateNode):null,!0}function io(e){for(var t=Ha;t;)$a(e,t),t=Ft(t)}function so(){ze&&(Ga=null,Ha=null,Wa=!1,ja=!1)}function ao(){null!==qa&&(Vp(qa),qa=null)}function oo(){return Wa}function lo(e){null===qa?qa=[e]:qa.push(e)}var uo;function co(e,t,n){var r=n.ref;if(null!==r&&"function"!=typeof r&&"object"!=typeof r){if(8&e.mode&&(!n._owner||!n._self||n._owner.stateNode===n._self)){var i=H(e)||"Component";ka[i]||(l('A string ref, "%s", has been found within a strict mode tree. String refs are a source of potential bugs and should be avoided. We recommend using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',r),ka[i]=!0)}if(n._owner){var s,a=n._owner;if(a){var o=a;if(1!==o.tag)throw new Error("Function components cannot have string refs. We recommend using useRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref");s=o.stateNode}if(!s)throw new Error("Missing owner for string ref "+r+". This error is likely caused by a bug in React. Please file an issue.");var u=s;!function(e,t){if(ys(e))l("The provided `%s` prop is an unsupported type %s. This value must be coerced to a string before before using it here.",t,vs(e)),_s(e)}(r,"ref");var c=""+r;if(null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===c)return t.ref;var d=function(e){var t=u.refs;t===ha&&(t=u.refs={}),null===e?delete t[c]:t[c]=e};return d._stringRef=c,d}if("string"!=typeof r)throw new Error("Expected ref to be a function, a string, an object returned by React.createRef(), or null.");if(!n._owner)throw new Error("Element ref was specified as a string ("+r+") but no owner was set. This could happen for one of the following reasons:\n1. You may be adding a ref to a function component\n2. You may be adding a ref to a component that was not created inside a component's render method\n3. You have multiple copies of React loaded\nSee https://reactjs.org/link/refs-must-have-owner for more information.")}return r}function ho(e,t){var n=Object.prototype.toString.call(t);throw new Error("Objects are not valid as a React child (found: "+("[object Object]"===n?"object with keys {"+Object.keys(t).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.")}function po(e){var t=H(e)||"Component";Va[t]||(Va[t]=!0,l("Functions are not valid as a React child. This may happen if you return a Component instead of <Component /> from render. Or maybe you meant to call this function rather than return it."))}function fo(e){var t=e._payload;return(0,e._init)(t)}function mo(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=W):r.push(n)}}function n(n,r){if(!e)return null;for(var i=r;null!==i;)t(n,i),i=i.sibling;return null}function r(e,t){for(var n=new Map,r=t;null!==r;)null!==r.key?n.set(r.key,r):n.set(r.index,r),r=r.sibling;return n}function i(e,t){var n=jf(e,t);return n.index=0,n.sibling=null,n}function s(t,n,r){if(t.index=r,!e)return t.flags|=ne,n;var i=t.alternate;if(null!==i){var s=i.index;return s<n?(t.flags|=2,n):s}return t.flags|=2,n}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function o(e,t,n,r){if(null===t||6!==t.tag){var s=Qf(n,e.mode,r);return s.return=e,s}var a=i(t,n);return a.return=e,a}function u(e,t,n,r){var s=n.type;if(s===A)return d(e,t,n.props.children,r,n.key);if(null!==t&&(t.elementType===s||Lf(t,n)||"object"==typeof s&&null!==s&&s.$$typeof===F&&fo(s)===t.type)){var a=i(t,n.props);return a.ref=co(e,t,n),a.return=e,a._debugSource=n._source,a._debugOwner=n._owner,a}var o=$f(n,e.mode,r);return o.ref=co(e,t,n),o.return=e,o}function c(e,t,n,r){if(null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation){var s=Zf(n,e.mode,r);return s.return=e,s}var a=i(t,n.children||[]);return a.return=e,a}function d(e,t,n,r,s){if(null===t||7!==t.tag){var a=Yf(n,e.mode,r,s);return a.return=e,a}var o=i(t,n);return o.return=e,o}function h(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t){var r=Qf(""+t,e.mode,n);return r.return=e,r}if("object"==typeof t&&null!==t){switch(t.$$typeof){case M:var i=$f(t,e.mode,n);return i.ref=co(e,null,t),i.return=e,i;case E:var s=Zf(t,e.mode,n);return s.return=e,s;case F:var a=t._payload;return h(e,(0,t._init)(a),n)}if(be(t)||k(t)){var o=Yf(t,e.mode,n,null);return o.return=e,o}ho(0,t)}return"function"==typeof t&&po(e),null}function p(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n)return null!==i?null:o(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case M:return n.key===i?u(e,t,n,r):null;case E:return n.key===i?c(e,t,n,r):null;case F:var s=n._payload;return p(e,t,(0,n._init)(s),r)}if(be(n)||k(n))return null!==i?null:d(e,t,n,r,null);ho(0,n)}return"function"==typeof n&&po(e),null}function f(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r)return o(t,e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case M:return u(t,e.get(null===r.key?n:r.key)||null,r,i);case E:return c(t,e.get(null===r.key?n:r.key)||null,r,i);case F:var s=r._payload;return f(e,t,n,(0,r._init)(s),i)}if(be(r)||k(r))return d(t,e.get(n)||null,r,i,null);ho(0,r)}return"function"==typeof r&&po(t),null}function m(e,t,n){if("object"!=typeof e||null===e)return t;switch(e.$$typeof){case M:case E:uo(e,n);var r=e.key;if("string"!=typeof r)break;if(null===t){(t=new Set).add(r);break}if(!t.has(r)){t.add(r);break}l("Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted  the behavior is unsupported and could change in a future version.",r);break;case F:var i=e._payload;m((0,e._init)(i),t,n)}return t}return function o(u,c,d,g){if("object"==typeof d&&null!==d&&d.type===A&&null===d.key&&(d=d.props.children),"object"==typeof d&&null!==d){switch(d.$$typeof){case M:return a(function(e,r,s,a){for(var o=s.key,l=r;null!==l;){if(l.key===o){var u=s.type;if(u===A){if(7===l.tag){n(e,l.sibling);var c=i(l,s.props.children);return c.return=e,c._debugSource=s._source,c._debugOwner=s._owner,c}}else if(l.elementType===u||Lf(l,s)||"object"==typeof u&&null!==u&&u.$$typeof===F&&fo(u)===l.type){n(e,l.sibling);var d=i(l,s.props);return d.ref=co(e,l,s),d.return=e,d._debugSource=s._source,d._debugOwner=s._owner,d}n(e,l);break}t(e,l),l=l.sibling}if(s.type===A){var h=Yf(s.props.children,e.mode,a,s.key);return h.return=e,h}var p=$f(s,e.mode,a);return p.ref=co(e,r,s),p.return=e,p}(u,c,d,g));case E:return a(function(e,r,s,a){for(var o=s.key,l=r;null!==l;){if(l.key===o){if(4===l.tag&&l.stateNode.containerInfo===s.containerInfo&&l.stateNode.implementation===s.implementation){n(e,l.sibling);var u=i(l,s.children||[]);return u.return=e,u}n(e,l);break}t(e,l),l=l.sibling}var c=Zf(s,e.mode,a);return c.return=e,c}(u,c,d,g));case F:var v=d._payload;return o(u,c,(0,d._init)(v),g)}if(be(d))return function(i,a,o,l){for(var u=null,c=0;c<o.length;c++)u=m(o[c],u,i);for(var d=null,g=null,v=a,y=0,_=0,x=null;null!==v&&_<o.length;_++){v.index>_?(x=v,v=null):x=v.sibling;var b=p(i,v,o[_],l);if(null===b){null===v&&(v=x);break}e&&v&&null===b.alternate&&t(i,v),y=s(b,y,_),null===g?d=b:g.sibling=b,g=b,v=x}if(_===o.length)return n(i,v),oo()&&Pa(i,_),d;if(null===v){for(;_<o.length;_++){var S=h(i,o[_],l);null!==S&&(y=s(S,y,_),null===g?d=S:g.sibling=S,g=S)}return oo()&&Pa(i,_),d}for(var T=r(0,v);_<o.length;_++){var w=f(T,i,_,o[_],l);null!==w&&(e&&null!==w.alternate&&T.delete(null===w.key?_:w.key),y=s(w,y,_),null===g?d=w:g.sibling=w,g=w)}return e&&T.forEach(function(e){return t(i,e)}),oo()&&Pa(i,_),d}(u,c,d,g);if(k(d))return function(i,a,o,u){var c=k(o);if("function"!=typeof c)throw new Error("An object is not an iterable. This error is likely caused by a bug in React. Please file an issue.");"function"==typeof Symbol&&"Generator"===o[Symbol.toStringTag]&&(Oa||l("Using Generators as children is unsupported and will likely yield unexpected results because enumerating a generator mutates it. You may convert it to an array with `Array.from()` or the `[...spread]` operator before rendering. Keep in mind you might need to polyfill these features for older browsers."),Oa=!0),o.entries===c&&(Ba||l("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),Ba=!0);var d=c.call(o);if(d)for(var g=null,v=d.next();!v.done;v=d.next())g=m(v.value,g,i);var y=c.call(o);if(null==y)throw new Error("An iterable object provided no iterator.");for(var _=null,x=null,b=a,S=0,T=0,w=null,M=y.next();null!==b&&!M.done;T++,M=y.next()){b.index>T?(w=b,b=null):w=b.sibling;var E=p(i,b,M.value,u);if(null===E){null===b&&(b=w);break}e&&b&&null===E.alternate&&t(i,b),S=s(E,S,T),null===x?_=E:x.sibling=E,x=E,b=w}if(M.done)return n(i,b),oo()&&Pa(i,T),_;if(null===b){for(;!M.done;T++,M=y.next()){var A=h(i,M.value,u);null!==A&&(S=s(A,S,T),null===x?_=A:x.sibling=A,x=A)}return oo()&&Pa(i,T),_}for(var C=r(0,b);!M.done;T++,M=y.next()){var R=f(C,i,T,M.value,u);null!==R&&(e&&null!==R.alternate&&C.delete(null===R.key?T:R.key),S=s(R,S,T),null===x?_=R:x.sibling=R,x=R)}return e&&C.forEach(function(e){return t(i,e)}),oo()&&Pa(i,T),_}(u,c,d,g);ho(0,d)}return"string"==typeof d&&""!==d||"number"==typeof d?a(function(e,t,r,s){if(null!==t&&6===t.tag){n(e,t.sibling);var a=i(t,r);return a.return=e,a}n(e,t);var o=Qf(r,e.mode,s);return o.return=e,o}(u,c,""+d,g)):("function"==typeof d&&po(u),n(u,c))}}Ba=!1,Oa=!1,ka={},za={},Va={},uo=function(e,t){if(null!==e&&"object"==typeof e&&e._store&&!e._store.validated&&null==e.key){if("object"!=typeof e._store)throw new Error("React Component in warnForMissingKey should have a _store. This error is likely caused by a bug in React. Please file an issue.");e._store.validated=!0;var n=H(t)||"Component";za[n]||(za[n]=!0,l('Each child in a list should have a unique "key" prop. See https://reactjs.org/link/warning-keys for more information.'))}};var go=mo(!0),vo=mo(!1);function yo(e,t){for(var n=e.child;null!==n;)qf(n,t),n=n.sibling}var _o={},xo=Pn(_o),bo=Pn(_o),So=Pn(_o);function To(e){if(e===_o)throw new Error("Expected host context to exist. This error is likely caused by a bug in React. Please file an issue.");return e}function wo(){return To(So.current)}function Mo(e,t){Ln(So,t,e),Ln(bo,e,e),Ln(xo,_o,e);var n=Te(t);In(xo,e),Ln(xo,n,e)}function Eo(e){In(xo,e),In(bo,e),In(So,e)}function Ao(){return To(xo.current)}function Co(e){var t=To(So.current),n=To(xo.current),r=we(n,e.type,t);n!==r&&(Ln(bo,e,e),Ln(xo,r,e))}function Ro(e){bo.current===e&&(In(xo,e),In(bo,e))}var No=1,Po=1,Io=2,Lo=Pn(0);function Uo(e,t){return 0!==(e&t)}function Do(e){return e&No}function Fo(e,t){return e&No|t}function Bo(e,t){Ln(Lo,t,e)}function Oo(e){In(Lo,e)}function ko(e,t){var n=e.memoizedState;return null!==n?null!==n.dehydrated:(e.memoizedProps,!0)}function zo(e){for(var t=e;null!==t;){if(t.tag===v){var n=t.memoizedState;if(null!==n){var r=n.dehydrated;if(null===r||Lt(r)||Ut(r))return t}}else if(t.tag===S&&void 0!==t.memoizedProps.revealOrder){if(0!==(t.flags&j))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)return null;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Vo=0,Go=1,Ho=2,Wo=4,jo=8,qo=[];function Xo(){for(var e=0;e<qo.length;e++){var t=qo[e];Fe?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}qo.length=0}var $o,Yo,Ko=s.ReactCurrentDispatcher,Qo=s.ReactCurrentBatchConfig;$o=new Set;var Zo=0,Jo=null,el=null,tl=null,nl=!1,rl=!1,il=0,sl=0,al=null,ol=null,ll=-1,ul=!1;function cl(){var e=al;null===ol?ol=[e]:ol.push(e)}function dl(){var e=al;null!==ol&&(ll++,ol[ll]!==e&&function(e){var t=H(Jo);if(!$o.has(t)&&($o.add(t),null!==ol)){for(var n="",r=30,i=0;i<=ll;i++){for(var s=ol[i],a=i===ll?e:s,o=i+1+". "+s;o.length<r;)o+=" ";n+=o+=a+"\n"}l("React has detected a change in the order of Hooks called by %s. This will lead to bugs and errors if not fixed. For more information, read the Rules of Hooks: https://reactjs.org/link/rules-of-hooks\n\n   Previous render            Next render\n   ------------------------------------------------------\n%s   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",t,n)}}(e))}function hl(e){null==e||be(e)||l("%s received a final argument that is not an array (instead, received `%s`). When specified, the final argument must be an array.",al,typeof e)}function pl(){throw new Error("Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\n1. You might have mismatching versions of React and the renderer (such as React DOM)\n2. You might be breaking the Rules of Hooks\n3. You might have more than one copy of React in the same app\nSee https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.")}function fl(e,t){if(ul)return!1;if(null===t)return l("%s received a final argument during this render, but not during the previous render. Even though the final argument is optional, its type cannot change between renders.",al),!1;e.length!==t.length&&l("The final argument passed to %s changed size between renders. The order and size of this array must remain constant.\n\nPrevious: %s\nIncoming: %s",al,"["+t.join(", ")+"]","["+e.join(", ")+"]");for(var n=0;n<t.length&&n<e.length;n++)if(!Vi(e[n],t[n]))return!1;return!0}function ml(e,t,n,r,i,s){Zo=s,Jo=t,ol=null!==e?e._debugHookTypes:null,ll=-1,ul=null!==e&&e.type!==t.type,t.memoizedState=null,t.updateQueue=null,t.lanes=0,null!==e&&null!==e.memoizedState?Ko.current=bu:Ko.current=null!==ol?xu:_u;var a=n(r,i);if(rl){var o=0;do{if(rl=!1,il=0,o>=25)throw new Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");o+=1,ul=!1,el=null,tl=null,t.updateQueue=null,ll=-1,Ko.current=Su,a=n(r,i)}while(rl)}Ko.current=yu,t._debugHookTypes=ol;var u=null!==el&&null!==el.next;if(Zo=0,Jo=null,el=null,tl=null,al=null,ol=null,ll=-1,null!==e&&(e.flags&de)!==(t.flags&de)&&1&e.mode&&l("Internal React error: Expected static flag was missing. Please notify the React team."),nl=!1,u)throw new Error("Rendered fewer hooks than expected. This may be caused by an accidental early return statement.");return a}function gl(){var e=0!==il;return il=0,e}function vl(e,t,n){t.updateQueue=e.updateQueue,0!==(t.mode&Kn)?t.flags&=-50333701:t.flags&=-2053,e.lanes=jr(e.lanes,n)}function yl(){if(Ko.current=yu,nl){for(var e=Jo.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}nl=!1}Zo=0,Jo=null,el=null,tl=null,ol=null,ll=-1,al=null,lu=!1,rl=!1,il=0}function _l(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===tl?Jo.memoizedState=tl=e:tl=tl.next=e,tl}function xl(){var e,t;if(null===el){var n=Jo.alternate;e=null!==n?n.memoizedState:null}else e=el.next;if(null!==(t=null===tl?Jo.memoizedState:tl.next))t=(tl=t).next,el=e;else{if(null===e)throw new Error("Rendered more hooks than during the previous render.");var r={memoizedState:(el=e).memoizedState,baseState:el.baseState,baseQueue:el.baseQueue,queue:el.queue,next:null};null===tl?Jo.memoizedState=tl=r:tl=tl.next=r}return tl}function bl(e,t){return"function"==typeof t?t(e):t}function Sl(e,t,n){var r,i=_l();r=void 0!==n?n(t):t,i.memoizedState=i.baseState=r;var s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:r};i.queue=s;var a=s.dispatch=du.bind(null,Jo,s);return[i.memoizedState,a]}function Tl(e,t,n){var r=xl(),i=r.queue;if(null===i)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");i.lastRenderedReducer=e;var s=el,a=s.baseQueue,o=i.pending;if(null!==o){if(null!==a){var u=a.next,c=o.next;a.next=c,o.next=u}s.baseQueue!==a&&l("Internal error: Expected work-in-progress queue to be a clone. This is a bug in React."),s.baseQueue=a=o,i.pending=null}if(null!==a){var d=a.next,h=s.baseState,p=null,f=null,m=null,g=d;do{var v=g.lane;if(Hr(Zo,v)){if(null!==m){var y={lane:0,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null};m=m.next=y}if(g.hasEagerState)h=g.eagerState;else h=e(h,g.action)}else{var _={lane:v,action:g.action,hasEagerState:g.hasEagerState,eagerState:g.eagerState,next:null};null===m?(f=m=_,p=h):m=m.next=_,Jo.lanes=Wr(Jo.lanes,v),Qp(v)}g=g.next}while(null!==g&&g!==d);null===m?p=h:m.next=f,Vi(h,r.memoizedState)||Jc(),r.memoizedState=h,r.baseState=p,r.baseQueue=m,i.lastRenderedState=h}var x=i.interleaved;if(null!==x){var b=x;do{var S=b.lane;Jo.lanes=Wr(Jo.lanes,S),Qp(S),b=b.next}while(b!==x)}else null===a&&(i.lanes=0);var T=i.dispatch;return[r.memoizedState,T]}function wl(e,t,n){var r=xl(),i=r.queue;if(null===i)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");i.lastRenderedReducer=e;var s=i.dispatch,a=i.pending,o=r.memoizedState;if(null!==a){i.pending=null;var l=a.next,u=l;do{o=e(o,u.action),u=u.next}while(u!==l);Vi(o,r.memoizedState)||Jc(),r.memoizedState=o,null===r.baseQueue&&(r.baseState=o),i.lastRenderedState=o}return[o,s]}function Ml(e,t,n){var r,i=Jo,s=_l();if(oo()){if(void 0===n)throw new Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");r=n(),Yo||r!==n()&&(l("The result of getServerSnapshot should be cached to avoid an infinite loop"),Yo=!0)}else{if(r=t(),!Yo){var a=t();Vi(r,a)||(l("The result of getSnapshot should be cached to avoid an infinite loop"),Yo=!0)}var o=Np();if(null===o)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");Fr(0,Zo)||Al(i,t,r)}s.memoizedState=r;var u={value:r,getSnapshot:t};return s.queue=u,zl(Rl.bind(null,i,u,e),[e]),i.flags|=Y,Dl(Go|jo,Cl.bind(null,i,u,r,t),void 0,null),r}function El(e,t,n){var r=Jo,i=xl(),s=t();if(!Yo){var a=t();Vi(s,a)||(l("The result of getSnapshot should be cached to avoid an infinite loop"),Yo=!0)}var o=i.memoizedState,u=!Vi(o,s);u&&(i.memoizedState=s,Jc());var c=i.queue;if(Vl(Rl.bind(null,r,c,e),[e]),c.getSnapshot!==t||u||null!==tl&&tl.memoizedState.tag&Go){r.flags|=Y,Dl(Go|jo,Cl.bind(null,r,c,s,t),void 0,null);var d=Np();if(null===d)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");Fr(0,Zo)||Al(r,t,s)}return s}function Al(e,t,n){e.flags|=Z;var r={getSnapshot:t,value:n},i=Jo.updateQueue;if(null===i)i={lastEffect:null,stores:null},Jo.updateQueue=i,i.stores=[r];else{var s=i.stores;null===s?i.stores=[r]:s.push(r)}}function Cl(e,t,n,r){t.value=n,t.getSnapshot=r,Nl(t)&&Pl(e)}function Rl(e,t,n){return n(function(){Nl(t)&&Pl(e)})}function Nl(e){var t=e.getSnapshot,n=e.value;try{var r=t();return!Vi(n,r)}catch(e){return!0}}function Pl(e){Dp(e,1,Ar)}function Il(e){var t=_l();"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e;var n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bl,lastRenderedState:e};t.queue=n;var r=n.dispatch=hu.bind(null,Jo,n);return[t.memoizedState,r]}function Ll(e){return Tl(bl)}function Ul(e){return wl(bl)}function Dl(e,t,n,r){var i={tag:e,create:t,destroy:n,deps:r,next:null},s=Jo.updateQueue;if(null===s)s={lastEffect:null,stores:null},Jo.updateQueue=s,s.lastEffect=i.next=i;else{var a=s.lastEffect;if(null===a)s.lastEffect=i.next=i;else{var o=a.next;a.next=i,i.next=o,s.lastEffect=i}}return i}function Fl(e){var t={current:e};return _l().memoizedState=t,t}function Bl(e){return xl().memoizedState}function Ol(e,t,n,r){var i=_l(),s=void 0===r?null:r;Jo.flags|=e,i.memoizedState=Dl(Go|t,n,void 0,s)}function kl(e,t,n,r){var i=xl(),s=void 0===r?null:r,a=void 0;if(null!==el){var o=el.memoizedState;if(a=o.destroy,null!==s)if(fl(s,o.deps))return void(i.memoizedState=Dl(t,n,a,s))}Jo.flags|=e,i.memoizedState=Dl(Go|t,n,a,s)}function zl(e,t){return 0!==(Jo.mode&Kn)?Ol(41945088,jo,e,t):Ol(8390656,jo,e,t)}function Vl(e,t){return kl(Y,jo,e,t)}function Gl(e,t){return Ol(4,Ho,e,t)}function Hl(e,t){return kl(4,Ho,e,t)}function Wl(e,t){var n=4;return n|=ie,0!==(Jo.mode&Kn)&&(n|=se),Ol(n,Wo,e,t)}function jl(e,t){return kl(4,Wo,e,t)}function ql(e,t){if("function"==typeof t){var n=t,r=e();return n(r),function(){n(null)}}if(null!=t){var i=t;i.hasOwnProperty("current")||l("Expected useImperativeHandle() first argument to either be a ref callback or React.createRef() object. Instead received: %s.","an object with keys {"+Object.keys(i).join(", ")+"}");var s=e();return i.current=s,function(){i.current=null}}}function Xl(e,t,n){"function"!=typeof t&&l("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",null!==t?typeof t:"null");var r=null!=n?n.concat([e]):null,i=4;return i|=ie,0!==(Jo.mode&Kn)&&(i|=se),Ol(i,Wo,ql.bind(null,t,e),r)}function $l(e,t,n){"function"!=typeof t&&l("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",null!==t?typeof t:"null");var r=null!=n?n.concat([e]):null;return kl(4,Wo,ql.bind(null,t,e),r)}function Yl(e,t){}var Kl=Yl;function Ql(e,t){var n=void 0===t?null:t;return _l().memoizedState=[e,n],e}function Zl(e,t){var n=xl(),r=void 0===t?null:t,i=n.memoizedState;if(null!==i&&(null!==r&&fl(r,i[1])))return i[0];return n.memoizedState=[e,r],e}function Jl(e,t){var n=_l(),r=void 0===t?null:t,i=e();return n.memoizedState=[i,r],i}function eu(e,t){var n=xl(),r=void 0===t?null:t,i=n.memoizedState;if(null!==i&&(null!==r&&fl(r,i[1])))return i[0];var s=e();return n.memoizedState=[s,r],s}function tu(e){var t=Il(e),n=t[0],r=t[1];return zl(function(){var t=Qo.transition;Qo.transition={};try{r(e)}finally{Qo.transition=t}},[e]),n}function nu(e){var t=Ll(),n=t[0],r=t[1];return Vl(function(){var t=Qo.transition;Qo.transition={};try{r(e)}finally{Qo.transition=t}},[e]),n}function ru(e){var t=Ul(),n=t[0],r=t[1];return Vl(function(){var t=Qo.transition;Qo.transition={};try{r(e)}finally{Qo.transition=t}},[e]),n}function iu(e,t,n){var r,i,s=ni();ri((i=4,0!==(r=s)&&r<i?r:i)),e(!0);var a=Qo.transition;Qo.transition={};var l=Qo.transition;Qo.transition._updatedFibers=new Set;try{e(!1),t()}finally{if(ri(s),Qo.transition=a,null===a&&l._updatedFibers)l._updatedFibers.size>10&&o("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),l._updatedFibers.clear()}}function su(){var e=Il(!1),t=e[0],n=e[1],r=iu.bind(null,n);return _l().memoizedState=r,[t,r]}function au(){return[Ll()[0],xl().memoizedState]}function ou(){return[Ul()[0],xl().memoizedState]}var lu=!1;function uu(){var e,t=_l(),n=Np().identifierPrefix;if(oo()){e=":"+n+"R"+Na();var r=il++;r>0&&(e+="H"+r.toString(32)),e+=":"}else{e=":"+n+"r"+(sl++).toString(32)+":"}return t.memoizedState=e,e}function cu(){return xl().memoizedState}function du(e,t,n){"function"==typeof arguments[3]&&l("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var r=Ip(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(pu(e))fu(t,i);else{mu(e,t,i);var s=Dp(e,r,Pp());null!==s&&gu(s,t,r)}vu(e,r)}function hu(e,t,n){"function"==typeof arguments[3]&&l("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var r=Ip(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(pu(e))fu(t,i);else{mu(e,t,i);var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)){var a=t.lastRenderedReducer;if(null!==a){var o;o=Ko.current,Ko.current=wu;try{var u=t.lastRenderedState,c=a(u,n);if(i.hasEagerState=!0,i.eagerState=c,Vi(c,u))return}catch(e){}finally{Ko.current=o}}}var d=Dp(e,r,Pp());null!==d&&gu(d,t,r)}vu(e,r)}function pu(e){var t=e.alternate;return e===Jo||null!==t&&t===Jo}function fu(e,t){rl=nl=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function mu(e,t,n,r){if(Bp(e)){var i=t.interleaved;null===i?(n.next=n,Bs(t)):(n.next=i.next,i.next=n),t.interleaved=n}else{var s=t.pending;null===s?n.next=n:(n.next=s.next,s.next=n),t.pending=n}}function gu(e,t,n){if(Br(n)){var r=t.lanes,i=Wr(r=qr(r,e.pendingLanes),n);t.lanes=i,Kr(e,i)}}function vu(e,t,n){zi(e,t)}var yu={readContext:Ds,useCallback:pl,useContext:pl,useEffect:pl,useImperativeHandle:pl,useInsertionEffect:pl,useLayoutEffect:pl,useMemo:pl,useReducer:pl,useRef:pl,useState:pl,useDebugValue:pl,useDeferredValue:pl,useTransition:pl,useMutableSource:pl,useSyncExternalStore:pl,useId:pl,unstable_isNewReconciler:h},_u=null,xu=null,bu=null,Su=null,Tu=null,wu=null,Mu=null,Eu=function(){l("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().")},Au=function(){l("Do not call Hooks inside useEffect(...), useMemo(...), or other built-in Hooks. You can only call Hooks at the top level of your React function. For more information, see https://reactjs.org/link/rules-of-hooks")};_u={readContext:function(e){return Ds(e)},useCallback:function(e,t){return al="useCallback",cl(),hl(t),Ql(e,t)},useContext:function(e){return al="useContext",cl(),Ds(e)},useEffect:function(e,t){return al="useEffect",cl(),hl(t),zl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",cl(),hl(n),Xl(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",cl(),hl(t),Gl(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",cl(),hl(t),Wl(e,t)},useMemo:function(e,t){al="useMemo",cl(),hl(t);var n=Ko.current;Ko.current=Tu;try{return Jl(e,t)}finally{Ko.current=n}},useReducer:function(e,t,n){al="useReducer",cl();var r=Ko.current;Ko.current=Tu;try{return Sl(e,t,n)}finally{Ko.current=r}},useRef:function(e){return al="useRef",cl(),Fl(e)},useState:function(e){al="useState",cl();var t=Ko.current;Ko.current=Tu;try{return Il(e)}finally{Ko.current=t}},useDebugValue:function(e,t){al="useDebugValue",cl()},useDeferredValue:function(e){return al="useDeferredValue",cl(),tu(e)},useTransition:function(){return al="useTransition",cl(),su()},useMutableSource:function(e,t,n){al="useMutableSource",cl()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",cl(),Ml(e,t,n)},useId:function(){return al="useId",cl(),uu()},unstable_isNewReconciler:h},xu={readContext:function(e){return Ds(e)},useCallback:function(e,t){return al="useCallback",dl(),Ql(e,t)},useContext:function(e){return al="useContext",dl(),Ds(e)},useEffect:function(e,t){return al="useEffect",dl(),zl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",dl(),Xl(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",dl(),Gl(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",dl(),Wl(e,t)},useMemo:function(e,t){al="useMemo",dl();var n=Ko.current;Ko.current=Tu;try{return Jl(e,t)}finally{Ko.current=n}},useReducer:function(e,t,n){al="useReducer",dl();var r=Ko.current;Ko.current=Tu;try{return Sl(e,t,n)}finally{Ko.current=r}},useRef:function(e){return al="useRef",dl(),Fl(e)},useState:function(e){al="useState",dl();var t=Ko.current;Ko.current=Tu;try{return Il(e)}finally{Ko.current=t}},useDebugValue:function(e,t){al="useDebugValue",dl()},useDeferredValue:function(e){return al="useDeferredValue",dl(),tu(e)},useTransition:function(){return al="useTransition",dl(),su()},useMutableSource:function(e,t,n){al="useMutableSource",dl()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",dl(),Ml(e,t,n)},useId:function(){return al="useId",dl(),uu()},unstable_isNewReconciler:h},bu={readContext:function(e){return Ds(e)},useCallback:function(e,t){return al="useCallback",dl(),Zl(e,t)},useContext:function(e){return al="useContext",dl(),Ds(e)},useEffect:function(e,t){return al="useEffect",dl(),Vl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",dl(),$l(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",dl(),Hl(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",dl(),jl(e,t)},useMemo:function(e,t){al="useMemo",dl();var n=Ko.current;Ko.current=wu;try{return eu(e,t)}finally{Ko.current=n}},useReducer:function(e,t,n){al="useReducer",dl();var r=Ko.current;Ko.current=wu;try{return Tl(e)}finally{Ko.current=r}},useRef:function(e){return al="useRef",dl(),Bl()},useState:function(e){al="useState",dl();var t=Ko.current;Ko.current=wu;try{return Ll()}finally{Ko.current=t}},useDebugValue:function(e,t){return al="useDebugValue",dl(),Kl()},useDeferredValue:function(e){return al="useDeferredValue",dl(),nu(e)},useTransition:function(){return al="useTransition",dl(),au()},useMutableSource:function(e,t,n){al="useMutableSource",dl()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",dl(),El(e,t)},useId:function(){return al="useId",dl(),cu()},unstable_isNewReconciler:h},Su={readContext:function(e){return Ds(e)},useCallback:function(e,t){return al="useCallback",dl(),Zl(e,t)},useContext:function(e){return al="useContext",dl(),Ds(e)},useEffect:function(e,t){return al="useEffect",dl(),Vl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",dl(),$l(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",dl(),Hl(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",dl(),jl(e,t)},useMemo:function(e,t){al="useMemo",dl();var n=Ko.current;Ko.current=Mu;try{return eu(e,t)}finally{Ko.current=n}},useReducer:function(e,t,n){al="useReducer",dl();var r=Ko.current;Ko.current=Mu;try{return wl(e)}finally{Ko.current=r}},useRef:function(e){return al="useRef",dl(),Bl()},useState:function(e){al="useState",dl();var t=Ko.current;Ko.current=Mu;try{return Ul()}finally{Ko.current=t}},useDebugValue:function(e,t){return al="useDebugValue",dl(),Kl()},useDeferredValue:function(e){return al="useDeferredValue",dl(),ru(e)},useTransition:function(){return al="useTransition",dl(),ou()},useMutableSource:function(e,t,n){al="useMutableSource",dl()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",dl(),El(e,t)},useId:function(){return al="useId",dl(),cu()},unstable_isNewReconciler:h},Tu={readContext:function(e){return Eu(),Ds(e)},useCallback:function(e,t){return al="useCallback",Au(),cl(),Ql(e,t)},useContext:function(e){return al="useContext",Au(),cl(),Ds(e)},useEffect:function(e,t){return al="useEffect",Au(),cl(),zl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",Au(),cl(),Xl(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",Au(),cl(),Gl(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",Au(),cl(),Wl(e,t)},useMemo:function(e,t){al="useMemo",Au(),cl();var n=Ko.current;Ko.current=Tu;try{return Jl(e,t)}finally{Ko.current=n}},useReducer:function(e,t,n){al="useReducer",Au(),cl();var r=Ko.current;Ko.current=Tu;try{return Sl(e,t,n)}finally{Ko.current=r}},useRef:function(e){return al="useRef",Au(),cl(),Fl(e)},useState:function(e){al="useState",Au(),cl();var t=Ko.current;Ko.current=Tu;try{return Il(e)}finally{Ko.current=t}},useDebugValue:function(e,t){al="useDebugValue",Au(),cl()},useDeferredValue:function(e){return al="useDeferredValue",Au(),cl(),tu(e)},useTransition:function(){return al="useTransition",Au(),cl(),su()},useMutableSource:function(e,t,n){al="useMutableSource",Au(),cl()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",Au(),cl(),Ml(e,t,n)},useId:function(){return al="useId",Au(),cl(),uu()},unstable_isNewReconciler:h},wu={readContext:function(e){return Eu(),Ds(e)},useCallback:function(e,t){return al="useCallback",Au(),dl(),Zl(e,t)},useContext:function(e){return al="useContext",Au(),dl(),Ds(e)},useEffect:function(e,t){return al="useEffect",Au(),dl(),Vl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",Au(),dl(),$l(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",Au(),dl(),Hl(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",Au(),dl(),jl(e,t)},useMemo:function(e,t){al="useMemo",Au(),dl();var n=Ko.current;Ko.current=wu;try{return eu(e,t)}finally{Ko.current=n}},useReducer:function(e,t,n){al="useReducer",Au(),dl();var r=Ko.current;Ko.current=wu;try{return Tl(e)}finally{Ko.current=r}},useRef:function(e){return al="useRef",Au(),dl(),Bl()},useState:function(e){al="useState",Au(),dl();var t=Ko.current;Ko.current=wu;try{return Ll()}finally{Ko.current=t}},useDebugValue:function(e,t){return al="useDebugValue",Au(),dl(),Kl()},useDeferredValue:function(e){return al="useDeferredValue",Au(),dl(),nu(e)},useTransition:function(){return al="useTransition",Au(),dl(),au()},useMutableSource:function(e,t,n){al="useMutableSource",Au(),dl()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",Au(),dl(),El(e,t)},useId:function(){return al="useId",Au(),dl(),cu()},unstable_isNewReconciler:h},Mu={readContext:function(e){return Eu(),Ds(e)},useCallback:function(e,t){return al="useCallback",Au(),dl(),Zl(e,t)},useContext:function(e){return al="useContext",Au(),dl(),Ds(e)},useEffect:function(e,t){return al="useEffect",Au(),dl(),Vl(e,t)},useImperativeHandle:function(e,t,n){return al="useImperativeHandle",Au(),dl(),$l(e,t,n)},useInsertionEffect:function(e,t){return al="useInsertionEffect",Au(),dl(),Hl(e,t)},useLayoutEffect:function(e,t){return al="useLayoutEffect",Au(),dl(),jl(e,t)},useMemo:function(e,t){al="useMemo",Au(),dl();var n=Ko.current;Ko.current=wu;try{return eu(e,t)}finally{Ko.current=n}},useReducer:function(e,t,n){al="useReducer",Au(),dl();var r=Ko.current;Ko.current=wu;try{return wl(e)}finally{Ko.current=r}},useRef:function(e){return al="useRef",Au(),dl(),Bl()},useState:function(e){al="useState",Au(),dl();var t=Ko.current;Ko.current=wu;try{return Ul()}finally{Ko.current=t}},useDebugValue:function(e,t){return al="useDebugValue",Au(),dl(),Kl()},useDeferredValue:function(e){return al="useDeferredValue",Au(),dl(),ru(e)},useTransition:function(){return al="useTransition",Au(),dl(),ou()},useMutableSource:function(e,t,n){al="useMutableSource",Au(),dl()},useSyncExternalStore:function(e,t,n){return al="useSyncExternalStore",Au(),dl(),El(e,t)},useId:function(){return al="useId",Au(),dl(),cu()},unstable_isNewReconciler:h};var Cu=i.unstable_now,Ru=0,Nu=-1,Pu=-1,Iu=-1,Lu=!1,Uu=!1;function Du(){return Lu}function Fu(){return Ru}function Bu(){Ru=Cu()}function Ou(e){Pu=Cu(),e.actualStartTime<0&&(e.actualStartTime=Cu())}function ku(e){Pu=-1}function zu(e,t){if(Pu>=0){var n=Cu()-Pu;e.actualDuration+=n,t&&(e.selfBaseDuration=n),Pu=-1}}function Vu(e){if(Nu>=0){var t=Cu()-Nu;Nu=-1;for(var n=e.return;null!==n;){switch(n.tag){case 3:return void(n.stateNode.effectDuration+=t);case g:return void(n.stateNode.effectDuration+=t)}n=n.return}}}function Gu(e){if(Iu>=0){var t=Cu()-Iu;Iu=-1;for(var n=e.return;null!==n;){switch(n.tag){case 3:var r=n.stateNode;return void(null!==r&&(r.passiveEffectDuration+=t));case g:var i=n.stateNode;return void(null!==i&&(i.passiveEffectDuration+=t))}n=n.return}}}function Hu(){Nu=Cu()}function Wu(){Iu=Cu()}function ju(e){for(var t=e.child;t;)e.actualDuration+=t.actualDuration,t=t.sibling}function qu(e,t){return{value:e,source:t,stack:Zi(t)}}function Xu(e,t){try{0;var n=t.value,r=t.source,i=t.stack,s=null!==i?i:"";if(null!=n&&n._suppressLogging&&1===e.tag)return;var a=r?H(r):null;3===e.tag||H(e)}catch(e){setTimeout(function(){throw e})}}var $u,Yu,Ku,Qu,Zu="function"==typeof WeakMap?WeakMap:Map;function Ju(e,t,n){var r=js(Ar,n);r.tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){lf(i),Xu(e,t)},r}function ec(e,t,n){var r=js(Ar,n);r.tag=3;var i=e.type.getDerivedStateFromError;if("function"==typeof i){var s=t.value;r.payload=function(){return i(s)},r.callback=function(){Uf(e),Xu(e,t)}}var a=e.stateNode;return null!==a&&"function"==typeof a.componentDidCatch&&(r.callback=function(){Uf(e),Xu(e,t),"function"!=typeof i&&function(e){null===yp?yp=new Set([e]):yp.add(e)}(this);var n=t.value,r=t.stack;this.componentDidCatch(n,{componentStack:null!==r?r:""}),"function"!=typeof i&&(Gr(e.lanes,1)||l("%s: Error boundaries should implement getDerivedStateFromError(). In that method, return a state update to display an error message or fallback UI.",H(e)||"Unknown"))}),r}function tc(e,t,n){var r,i=e.pingCache;if(null===i?(i=e.pingCache=new Zu,r=new Set,i.set(t,r)):void 0===(r=i.get(t))&&(r=new Set,i.set(t,r)),!r.has(n)){r.add(n);var s=df.bind(null,e,t,n);bi&&Sf(e,n),t.then(s,s)}}function nc(e){var t=e;do{if(t.tag===v&&ko(t))return t;t=t.return}while(null!==t);return null}function rc(e,t,n,r,i){if(!(1&e.mode)){if(e===t)e.flags|=ee;else{if(e.flags|=j,n.flags|=te,n.flags&=-52805,1===n.tag)if(null===n.alternate)n.tag=x;else{var s=js(Ar,1);s.tag=Vs,qs(n,s)}n.lanes=Wr(n.lanes,1)}return e}return e.flags|=ee,e.lanes=i,e}function ic(e,t,n,r,i){if(n.flags|=J,bi&&Sf(e,i),null!==r&&"object"==typeof r&&"function"==typeof r.then){var s=r;!function(e){var t=e.tag;if(!(1&e.mode||0!==t&&t!==m&&t!==_)){var n=e.alternate;n?(e.updateQueue=n.updateQueue,e.memoizedState=n.memoizedState,e.lanes=n.lanes):(e.updateQueue=null,e.memoizedState=null)}}(n);var a=nc(t);if(null!==a)return a.flags&=-257,rc(a,t,n,0,i),1&a.mode&&tc(e,s,i),void function(e,t,n){var r=e.updateQueue;if(null===r){var i=new Set;i.add(n),e.updateQueue=i}else r.add(n)}(a,0,s);if(!(1&i))return tc(e,s,i),void Zp();r=new Error("A component suspended while responding to synchronous input. This will cause the UI to be replaced with a loading indicator. To fix, updates that suspend should be wrapped with startTransition.")}else if(oo()&&1&n.mode){ja=!0;var o=nc(t);if(null!==o)return 0===(o.flags&ee)&&(o.flags|=q),rc(o,t,n,0,i),void lo(r)}!function(e){rp!==$h&&(rp=qh);null===lp?lp=[e]:lp.push(e)}(r),r=qu(r,n);var l=t;do{switch(l.tag){case 3:var u=r;l.flags|=ee;var c=kr(i);return l.lanes=Wr(l.lanes,c),void $s(l,Ju(l,u,c));case 1:var d=r,h=l.type,p=l.stateNode;if(0===(l.flags&j)&&("function"==typeof h.getDerivedStateFromError||null!==p&&"function"==typeof p.componentDidCatch&&!of(p))){l.flags|=ee;var f=kr(i);return l.lanes=Wr(l.lanes,f),void $s(l,ec(l,d,f))}}l=l.return}while(null!==l)}function sc(e){e.flags|=4}function ac(e){e.flags|=X,e.flags|=re}function oc(e,t){if(null!==e&&e.child===t.child)return!0;if(0!==(t.flags&W))return!1;for(var n=t.child;null!==n;){if(0!==(n.flags&le)||0!==(n.subtreeFlags&le))return!1;n=n.sibling}return!0}if(Oe)$u=function(e,t,n,r){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)Ce(e,i.stateNode);else if(4===i.tag);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)return;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Yu=function(e,t){},Ku=function(e,t,n,r,i){var s=e.memoizedProps;if(s!==r){var a=t.stateNode,o=Ao(),l=Ne(a,n,s,r,i,o);t.updateQueue=l,l&&sc(t)}},Qu=function(e,t,n,r){n!==r&&sc(t)};else if(ke){$u=function(e,t,n,r){for(var i=t.child;null!==i;){if(5===i.tag){var s=i.stateNode;if(n&&r){var a=i.memoizedProps,o=i.type;s=Ct(s,o,a,i)}Ce(e,s)}else if(6===i.tag){var l=i.stateNode;if(n&&r){var u=i.memoizedProps;l=Rt(l,u,i)}Ce(e,l)}else if(4===i.tag);else if(i.tag===T&&null!==i.memoizedState){var c=i.child;null!==c&&(c.return=i),$u(e,i,!0,!0)}else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)return;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};var lc=function(e,t,n,r){for(var i=t.child;null!==i;){if(5===i.tag){var s=i.stateNode;if(n&&r){var a=i.memoizedProps,o=i.type;s=Ct(s,o,a,i)}yt(e,s)}else if(6===i.tag){var l=i.stateNode;if(n&&r){var u=i.memoizedProps;l=Rt(l,u,i)}yt(e,l)}else if(4===i.tag);else if(i.tag===T&&null!==i.memoizedState){var c=i.child;null!==c&&(c.return=i),lc(e,i,!0,!0)}else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)return;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};Yu=function(e,t){var n=t.stateNode;if(oc(e,t));else{var r=n.containerInfo,i=vt(r);lc(i,t,!1,!1),n.pendingChildren=i,sc(t),_t(r,i)}},Ku=function(e,t,n,r,i){var s=e.stateNode,a=e.memoizedProps,o=oc(e,t);if(o&&a===r)t.stateNode=s;else{var l=t.stateNode,u=Ao(),c=null;if(a!==r&&(c=Ne(l,n,a,r,i,u)),o&&null===c)t.stateNode=s;else{var d=gt(s,c,n,a,r,t,o,l);Re(d,n,r,i,u)&&sc(t),t.stateNode=d,o?sc(t):$u(d,t,!1,!1)}}},Qu=function(e,t,n,r){if(n!==r){var i=wo(),s=Ao();t.stateNode=Ie(r,i,s,t),sc(t)}else t.stateNode=e.stateNode}}else Yu=function(e,t){},Ku=function(e,t,n,r,i){},Qu=function(e,t,n,r){};function uc(e,t){if(!oo())switch(e.tailMode){case"hidden":for(var n=e.tail,r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":for(var i=e.tail,s=null;null!==i;)null!==i.alternate&&(s=i),i=i.sibling;null===s?t||null===e.tail?e.tail=null:e.tail.sibling=null:s.sibling=null}}function cc(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t){if(2&e.mode){for(var i=e.selfBaseDuration,s=e.child;null!==s;)n=Wr(n,Wr(s.lanes,s.childLanes)),r|=s.subtreeFlags&de,r|=s.flags&de,i+=s.treeBaseDuration,s=s.sibling;e.treeBaseDuration=i}else for(var a=e.child;null!==a;)n=Wr(n,Wr(a.lanes,a.childLanes)),r|=a.subtreeFlags&de,r|=a.flags&de,a.return=e,a=a.sibling;e.subtreeFlags|=r}else{if(2&e.mode){for(var o=e.actualDuration,l=e.selfBaseDuration,u=e.child;null!==u;)n=Wr(n,Wr(u.lanes,u.childLanes)),r|=u.subtreeFlags,r|=u.flags,o+=u.actualDuration,l+=u.treeBaseDuration,u=u.sibling;e.actualDuration=o,e.treeBaseDuration=l}else for(var c=e.child;null!==c;)n=Wr(n,Wr(c.lanes,c.childLanes)),r|=c.subtreeFlags,r|=c.flags,c.return=e,c=c.sibling;e.subtreeFlags|=r}return e.childLanes=n,t}function dc(e,t,n){var r=t.pendingProps;switch(Da(t),t.tag){case 2:case 16:case _:case 0:case m:case 7:case 8:case g:case 9:case y:return cc(t),null;case 1:return Gn(t.type)&&Hn(t),cc(t),null;case 3:var i=t.stateNode;if(Eo(t),Wn(t),Xo(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),null===e||null===e.child)if(ro(t))sc(t);else if(null!==e)e.memoizedState.isDehydrated&&0===(t.flags&q)||(t.flags|=$,ao());return Yu(e,t),cc(t),null;case 5:Ro(t);var s=wo(),a=t.type;if(null!==e&&null!=t.stateNode)Ku(e,t,a,r,s),e.ref!==t.ref&&ac(t);else{if(!r){if(null===t.stateNode)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return cc(t),null}var o=Ao();if(ro(t))(function(e,t,n){if(!ze)throw new Error("Expected prepareToHydrateHostInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var r=e.stateNode,i=!ja,s=zt(r,e.type,e.memoizedProps,t,n,e,i);return e.updateQueue=s,null!==s})(t,s,o)&&sc(t);else{var l=Ae(a,r,s,o,t);$u(l,t,!1,!1),t.stateNode=l,Re(l,a,r,s,o)&&sc(t)}null!==t.ref&&ac(t)}return cc(t),null;case 6:var u=r;if(e&&null!=t.stateNode){var c=e.memoizedProps;Qu(e,t,c,u)}else{if("string"!=typeof u&&null===t.stateNode)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");var d=wo(),h=Ao();ro(t)?function(e){if(!ze)throw new Error("Expected prepareToHydrateHostTextInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var t=e.stateNode,n=e.memoizedProps,r=Vt(t,n,e,!ja);if(r){var i=Ga;if(null!==i){var s=!!(1&i.mode);switch(i.tag){case 3:var a=i.stateNode.containerInfo;Yt(a,t,n,s);break;case 5:var o=i.type,l=i.memoizedProps,u=i.stateNode;Kt(o,l,u,t,n,s)}}}return r}(t)&&sc(t):t.stateNode=Ie(u,d,h,t)}return cc(t),null;case v:Oo(t);var p=t.memoizedState;if(Wa&&null!==Ha&&1&t.mode&&0===(t.flags&j))return io(t),so(),t.flags|=98560,t;if(null!==p&&null!==p.dehydrated){var b=ro(t);if(null===e){if(!b)throw new Error("A dehydrated suspense component was completed without a hydrated node. This is probably a bug in React.");if(function(e){if(!ze)throw new Error("Expected prepareToHydrateHostSuspenseInstance() to never be called. This error is likely caused by a bug in React. Please file an issue.");var t=e.memoizedState,n=null!==t?t.dehydrated:null;if(!n)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");Gt(n,e)}(t),cc(t),2&t.mode)if(null!==p){var M=t.child;null!==M&&(t.treeBaseDuration-=M.treeBaseDuration)}return null}if(so(),0===(t.flags&j)&&(t.memoizedState=null),t.flags|=4,cc(t),2&t.mode&&null!==p){var E=t.child;null!==E&&(t.treeBaseDuration-=E.treeBaseDuration)}return null}if(ao(),0!==(t.flags&j))return t.lanes=n,2&t.mode&&ju(t),t;var A=null!==p,C=!1;if(null===e)ro(t);else C=null!==e.memoizedState;if(A&&!C)if(t.child.flags|=Q,1&t.mode)null===e&&(!0!==t.memoizedProps.unstable_avoidThisFallback||!0)||Uo(Lo.current,Po)?rp===Wh&&(rp=Xh):Zp();if(null!==t.updateQueue&&(t.flags|=4),cc(t),2&t.mode&&A){var R=t.child;null!==R&&(t.treeBaseDuration-=R.treeBaseDuration)}return null;case 4:return Eo(t),Yu(e,t),null===e&&Ge(t.stateNode.containerInfo),cc(t),null;case f:return Ps(t.type._context,t),cc(t),null;case x:return Gn(t.type)&&Hn(t),cc(t),null;case S:Oo(t);var N=t.memoizedState;if(null===N)return cc(t),null;var P=0!==(t.flags&j),I=N.rendering;if(null===I)if(P)uc(N,!1);else{if(!(rp===Wh&&(null===e||0===(e.flags&j))))for(var L=t.child;null!==L;){var U=zo(L);if(null!==U){P=!0,t.flags|=j,uc(N,!1);var D=U.updateQueue;return null!==D&&(t.updateQueue=D,t.flags|=4),t.subtreeFlags=0,yo(t,n),Bo(t,Fo(Lo.current,Io)),t.child}L=L.sibling}null!==N.tail&&ci()>mp()&&(t.flags|=j,P=!0,uc(N,!1),t.lanes=xr)}else{if(!P){var F=zo(I);if(null!==F){t.flags|=j,P=!0;var B=F.updateQueue;if(null!==B&&(t.updateQueue=B,t.flags|=4),uc(N,!0),null===N.tail&&"hidden"===N.tailMode&&!I.alternate&&!oo())return cc(t),null}else 2*ci()-N.renderingStartTime>mp()&&n!==Mr&&(t.flags|=j,P=!0,uc(N,!1),t.lanes=xr)}if(N.isBackwards)I.sibling=t.child,t.child=I;else{var O=N.last;null!==O?O.sibling=I:t.child=I,N.last=I}}if(null!==N.tail){var k=N.tail;N.rendering=k,N.tail=k.sibling,N.renderingStartTime=ci(),k.sibling=null;var z=Lo.current;return Bo(t,z=P?Fo(z,Io):Do(z)),k}return cc(t),null;case 21:break;case T:case w:qp(t);var V=null!==t.memoizedState;if(null!==e)null!==e.memoizedState!==V&&(t.flags|=Q);return V&&1&t.mode?Gr(tp,Mr)&&(cc(t),Oe&&6&t.subtreeFlags&&(t.flags|=Q)):cc(t),null;case 24:case 25:return null}throw new Error("Unknown unit of work tag ("+t.tag+"). This error is likely caused by a bug in React. Please file an issue.")}var hc,pc,fc,mc,gc,vc,yc,_c,xc=s.ReactCurrentOwner,bc=!1;function Sc(e,t,n,r){t.child=null===e?vo(t,null,n,r):go(t,e.child,n,r)}function Tc(e,t,n,r,i){if(t.type!==t.elementType){var s=n.propTypes;s&&En(s,r,"prop",V(n))}var a,o,l=n.render,u=t.ref;if(Us(t,i),Ei(t),xc.current=t,ss(!0),a=ml(e,t,l,r,u,i),o=gl(),8&t.mode){Si(!0);try{a=ml(e,t,l,r,u,i),o=gl()}finally{Si(!1)}}return ss(!1),Ai(),null===e||bc?(oo()&&o&&La(t),t.flags|=1,Sc(e,t,a,i),t.child):(vl(e,t,i),ed(e,t,i))}function wc(e,t,n,r,i){if(null===e){var s=n.type;if(function(e){return"function"==typeof e&&!Wf(e)&&void 0===e.defaultProps}(s)&&null===n.compare&&void 0===n.defaultProps){var a;return a=Nf(s),t.tag=_,t.type=a,Dc(t,s),Mc(e,t,a,r,i)}var o=s.propTypes;o&&En(o,r,"prop",V(s));var l=Xf(n.type,null,r,t,t.mode,i);return l.ref=t.ref,l.return=t,t.child=l,l}var u=n.type,c=u.propTypes;c&&En(c,r,"prop",V(u));var d=e.child;if(!td(e,i)){var h=d.memoizedProps,p=n.compare;if((p=null!==p?p:Ki)(h,r)&&e.ref===t.ref)return ed(e,t,i)}t.flags|=1;var f=jf(d,r);return f.ref=t.ref,f.return=t,t.child=f,f}function Mc(e,t,n,r,i){if(t.type!==t.elementType){var s=t.elementType;if(s.$$typeof===F){var a=s,o=a._payload,l=a._init;try{s=l(o)}catch(e){s=null}var u=s&&s.propTypes;u&&En(u,r,"prop",V(s))}}if(null!==e&&(Ki(e.memoizedProps,r)&&e.ref===t.ref&&t.type===e.type)){if(bc=!1,!td(e,i))return t.lanes=e.lanes,ed(e,t,i);0!==(e.flags&te)&&(bc=!0)}return Cc(e,t,n,r,i)}function Ec(e,t,n){var r,i=t.pendingProps,s=i.children,a=null!==e?e.memoizedState:null;if("hidden"===i.mode)if(1&t.mode){if(!Gr(n,Mr)){var o;if(null!==a)o=Wr(a.baseLanes,n);else o=n;t.lanes=t.childLanes=Mr;var l={baseLanes:o,cachePool:null};return t.memoizedState=l,t.updateQueue=null,jp(t,o),null}var u={baseLanes:0,cachePool:null};t.memoizedState=u,jp(t,null!==a?a.baseLanes:n)}else{var c={baseLanes:0,cachePool:null};t.memoizedState=c,jp(t,n)}else null!==a?(r=Wr(a.baseLanes,n),t.memoizedState=null):r=n,jp(t,r);return Sc(e,t,s,n),t.child}function Ac(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=X,t.flags|=re)}function Cc(e,t,n,r,i){if(t.type!==t.elementType){var s=n.propTypes;s&&En(s,r,"prop",V(n))}var a,o,l;if(a=zn(t,On(0,n,!0)),Us(t,i),Ei(t),xc.current=t,ss(!0),o=ml(e,t,n,r,a,i),l=gl(),8&t.mode){Si(!0);try{o=ml(e,t,n,r,a,i),l=gl()}finally{Si(!1)}}return ss(!1),Ai(),null===e||bc?(oo()&&l&&La(t),t.flags|=1,Sc(e,t,o,i),t.child):(vl(e,t,i),ed(e,t,i))}function Rc(e,t,n,r,i){switch(um(t)){case!1:var s=t.stateNode,a=new(0,t.type)(t.memoizedProps,s.context).state;s.updater.enqueueSetState(s,a,null);break;case!0:t.flags|=j,t.flags|=ee;var o=new Error("Simulated error coming from DevTools"),u=kr(i);t.lanes=Wr(t.lanes,u),$s(t,ec(t,qu(o,t),u))}if(t.type!==t.elementType){var c=n.propTypes;c&&En(c,r,"prop",V(n))}var d,h;Gn(n)?(d=!0,Xn(t)):d=!1,Us(t,i),null===t.stateNode?(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),ya(t,n,r),xa(t,n,r,i),h=!0):h=null===e?function(e,t,n,r){var i=e.stateNode,s=e.memoizedProps;i.props=s;var a=i.context,o=t.contextType,l=Un;l="object"==typeof o&&null!==o?Ds(o):zn(e,On(0,t,!0));var u=t.getDerivedStateFromProps,c="function"==typeof u||"function"==typeof i.getSnapshotBeforeUpdate;c||"function"!=typeof i.UNSAFE_componentWillReceiveProps&&"function"!=typeof i.componentWillReceiveProps||s===n&&a===l||_a(e,i,n,l),Zs();var d=e.memoizedState,h=i.state=d;if(Ks(e,n,i,r),h=e.memoizedState,s===n&&d===h&&!Vn()&&!Js()){if("function"==typeof i.componentDidMount){var p=4;p|=ie,0!==(e.mode&Kn)&&(p|=se),e.flags|=p}return!1}"function"==typeof u&&(fa(e,t,u,n),h=e.memoizedState);var f=Js()||ga(e,t,s,n,d,h,l);if(f){if(c||"function"!=typeof i.UNSAFE_componentWillMount&&"function"!=typeof i.componentWillMount||("function"==typeof i.componentWillMount&&i.componentWillMount(),"function"==typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount()),"function"==typeof i.componentDidMount){var m=4;m|=ie,0!==(e.mode&Kn)&&(m|=se),e.flags|=m}}else{if("function"==typeof i.componentDidMount){var g=4;g|=ie,0!==(e.mode&Kn)&&(g|=se),e.flags|=g}e.memoizedProps=n,e.memoizedState=h}return i.props=n,i.state=h,i.context=l,f}(t,n,r,i):function(e,t,n,r,i){var s=t.stateNode;Ws(e,t);var a=t.memoizedProps,o=t.type===t.elementType?a:xs(t.type,a);s.props=o;var l=t.pendingProps,u=s.context,c=n.contextType,d=Un;d="object"==typeof c&&null!==c?Ds(c):zn(t,On(0,n,!0));var h=n.getDerivedStateFromProps,f="function"==typeof h||"function"==typeof s.getSnapshotBeforeUpdate;f||"function"!=typeof s.UNSAFE_componentWillReceiveProps&&"function"!=typeof s.componentWillReceiveProps||a===l&&u===d||_a(t,s,r,d),Zs();var m=t.memoizedState,g=s.state=m;if(Ks(t,r,s,i),g=t.memoizedState,a===l&&m===g&&!Vn()&&!Js())return"function"==typeof s.componentDidUpdate&&(a===e.memoizedProps&&m===e.memoizedState||(t.flags|=4)),"function"==typeof s.getSnapshotBeforeUpdate&&(a===e.memoizedProps&&m===e.memoizedState||(t.flags|=$)),!1;"function"==typeof h&&(fa(t,n,h,r),g=t.memoizedState);var v=Js()||ga(t,n,o,r,m,g,d)||p;return v?(f||"function"!=typeof s.UNSAFE_componentWillUpdate&&"function"!=typeof s.componentWillUpdate||("function"==typeof s.componentWillUpdate&&s.componentWillUpdate(r,g,d),"function"==typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,g,d)),"function"==typeof s.componentDidUpdate&&(t.flags|=4),"function"==typeof s.getSnapshotBeforeUpdate&&(t.flags|=$)):("function"==typeof s.componentDidUpdate&&(a===e.memoizedProps&&m===e.memoizedState||(t.flags|=4)),"function"==typeof s.getSnapshotBeforeUpdate&&(a===e.memoizedProps&&m===e.memoizedState||(t.flags|=$)),t.memoizedProps=r,t.memoizedState=g),s.props=r,s.state=g,s.context=d,v}(e,t,n,r,i);var f=Nc(e,t,n,h,d,i),m=t.stateNode;return h&&m.props!==r&&(vc||l("It looks like %s is reassigning its own `this.props` while rendering. This is not supported and can lead to confusing bugs.",H(t)||"a component"),vc=!0),f}function Nc(e,t,n,r,i,s){Ac(e,t);var a=0!==(t.flags&j);if(!r&&!a)return i&&$n(t,n,!1),ed(e,t,s);var o,l=t.stateNode;if(xc.current=t,a&&"function"!=typeof n.getDerivedStateFromError)o=null,ku();else{if(Ei(t),ss(!0),o=l.render(),8&t.mode){Si(!0);try{l.render()}finally{Si(!1)}}ss(!1),Ai()}return t.flags|=1,null!==e&&a?function(e,t,n,r){t.child=go(t,e.child,null,r),t.child=go(t,null,n,r)}(e,t,o,s):Sc(e,t,o,s),t.memoizedState=l.state,i&&$n(t,n,!0),t.child}function Pc(e){var t=e.stateNode;t.pendingContext?jn(e,t.pendingContext,t.pendingContext!==t.context):t.context&&jn(e,t.context,!1),Mo(e,t.containerInfo)}function Ic(e,t,n){if(Pc(t),null===e)throw new Error("Should have a current fiber. This is a bug in React.");var r=t.pendingProps,i=t.memoizedState,s=i.element;Ws(e,t),Ks(t,r,null,n);var a=t.memoizedState;t.stateNode;var o=a.element;if(ze&&i.isDehydrated){var l={element:o,isDehydrated:!1,cache:a.cache,transitions:a.transitions};if(t.updateQueue.baseState=l,t.memoizedState=l,t.flags&q)return Lc(e,t,o,n,new Error("There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering."));if(o!==s)return Lc(e,t,o,n,new Error("This root received an early update, before anything was able hydrate. Switched the entire root to client rendering."));!function(e){if(!ze)return!1;var t=e.stateNode.containerInfo;Ha=Ot(t),Ga=e,Wa=!0,qa=null,ja=!1}(t);var u=vo(t,null,o,n);t.child=u;for(var c=u;c;)c.flags=-3&c.flags|K,c=c.sibling}else{if(so(),o===s)return ed(e,t,n);Sc(e,t,o,n)}return t.child}function Lc(e,t,n,r,i){return so(),lo(i),t.flags|=q,Sc(e,t,n,r),t.child}function Uc(e,t,n,r){null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2);var i=t.pendingProps,s=n,a=s._payload,o=(0,s._init)(a);t.type=o;var l=t.tag=function(e){if("function"==typeof e)return Wf(e)?1:0;if(null!=e){var t=e.$$typeof;if(t===I)return m;if(t===D)return y}return 2}(o),u=xs(o,i);switch(l){case 0:return Dc(t,o),t.type=o=Nf(o),Cc(null,t,o,u,r);case 1:return t.type=o=Pf(o),Rc(null,t,o,u,r);case m:return t.type=o=If(o),Tc(null,t,o,u,r);case y:if(t.type!==t.elementType){var c=o.propTypes;c&&En(c,u,"prop",V(o))}return wc(null,t,o,xs(o.type,u),r)}var d="";throw null!==o&&"object"==typeof o&&o.$$typeof===F&&(d=" Did you wrap a component in React.lazy() more than once?"),new Error("Element type is invalid. Received a promise that resolves to: "+o+". Lazy element type must resolve to a class or function."+d)}function Dc(e,t){if(t&&t.childContextTypes&&l("%s(...): childContextTypes cannot be defined on a function component.",t.displayName||t.name||"Component"),null!==e.ref){var n="",r=function(){if(null===es)return null;var e=es._debugOwner;return null!=e?H(e):null}();r&&(n+="\n\nCheck the render method of `"+r+"`.");var i=r||"",s=e._debugSource;s&&(i=s.fileName+":"+s.lineNumber),gc[i]||(gc[i]=!0,l("Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s",n))}if("function"==typeof t.getDerivedStateFromProps){var a=V(t)||"Unknown";mc[a]||(l("%s: Function components do not support getDerivedStateFromProps.",a),mc[a]=!0)}if("object"==typeof t.contextType&&null!==t.contextType){var o=V(t)||"Unknown";fc[o]||(l("%s: Function components do not support contextType.",o),fc[o]=!0)}}hc={},pc={},fc={},mc={},gc={},vc=!1,yc={},_c={};var Fc={dehydrated:null,treeContext:null,retryLane:0};function Bc(e){return{baseLanes:e,cachePool:null}}function Oc(e,t){return{baseLanes:Wr(e.baseLanes,t),cachePool:null}}function kc(e,t){return jr(e.childLanes,t)}function zc(e,t,n){var r=t.pendingProps;dm(t)&&(t.flags|=j);var i=Lo.current,s=!1,a=0!==(t.flags&j);if(a||function(e,t){return(null===t||null!==t.memoizedState)&&Uo(e,Io)}(i,e)?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i=i|Po),Bo(t,i=Do(i)),null===e){to(t);var o=t.memoizedState;if(null!==o){var u=o.dehydrated;if(null!==u)return function(e,t){1&e.mode?Ut(t)?e.lanes=8:e.lanes=Mr:(l("Cannot hydrate Suspense in legacy mode. Switch from ReactDOM.hydrate(element, container) to ReactDOMClient.hydrateRoot(container, <App />).render(element) or remove the Suspense components from the server rendered components."),e.lanes=1);return null}(t,u)}var c=r.children,d=r.fallback;if(s){var h=function(e,t,n,r){var i,s,a=e.mode,o=e.child,l={mode:"hidden",children:t};1&a||null===o?(i=Gc(l,a),s=Yf(n,a,r,null)):((i=o).childLanes=0,i.pendingProps=l,2&e.mode&&(i.actualDuration=0,i.actualStartTime=-1,i.selfBaseDuration=0,i.treeBaseDuration=0),s=Yf(n,a,r,null));return i.return=e,s.return=e,i.sibling=s,e.child=i,s}(t,c,d,n);return t.child.memoizedState=Bc(n),t.memoizedState=Fc,h}return Vc(t,c)}var p=e.memoizedState;if(null!==p){var f=p.dehydrated;if(null!==f){if(a){if(t.flags&q)return t.flags&=-257,qc(e,t,n,new Error("There was an error while hydrating this Suspense boundary. Switched to client rendering."));if(null!==t.memoizedState)return t.child=e.child,t.flags|=j,null;var m=function(e,t,n,r,i){var s=t.mode,a=Gc({mode:"visible",children:n},s),o=Yf(r,s,i,null);o.flags|=2,a.return=t,o.return=t,a.sibling=o,t.child=a,!(1&t.mode)||go(t,e.child,null,i);return o}(e,t,r.children,r.fallback,n);return t.child.memoizedState=Bc(n),t.memoizedState=Fc,m}return function(e,t,n,r,i){if(function(){Wa&&l("We should not be hydrating here. This is a bug in React. Please file a bug.")}(),!(1&t.mode))return qc(e,t,i,null);if(Ut(n))return qc(e,t,i,new Error("The server could not finish this Suspense boundary, likely due to an error during server rendering. Switched to client rendering."));var s=Gr(i,e.childLanes);if(bc||s){var a=Np();if(null!==a){var o=function(e,t){var n;switch(Or(t)){case 4:n=2;break;case er:n=8;break;case 64:case 128:case 256:case 512:case nr:case rr:case ir:case sr:case ar:case or:case lr:case ur:case cr:case dr:case hr:case pr:case mr:case gr:case vr:case yr:case _r:n=32;break;case wr:n=Tr;break;default:n=0}return 0!==(n&(e.suspendedLanes|t))?0:n}(a,i);if(0!==o&&o!==r.retryLane)r.retryLane=o,Dp(e,o,Ar)}return Zp(),qc(e,t,i,new Error("This Suspense boundary received an update before it finished hydrating. This caused the boundary to switch to client rendering. The usual way to fix this is to wrap the original update in startTransition."))}if(Lt(n)){t.flags|=j,t.child=e.child;var u=pf.bind(null,e);return Dt(n,u),null}Xa(t,n,r.treeContext);var c=Vc(t,t.pendingProps.children);return c.flags|=K,c}(e,t,f,p,n)}if(s){var g=r.fallback,v=jc(e,t,r.children,g,n),y=t.child,_=e.child.memoizedState;return y.memoizedState=null===_?Bc(n):Oc(_,n),y.childLanes=kc(e,n),t.memoizedState=Fc,v}var x=Wc(e,t,r.children,n);return t.memoizedState=null,x}if(s){var b=r.fallback,S=jc(e,t,r.children,b,n),T=t.child,w=e.child.memoizedState;return T.memoizedState=null===w?Bc(n):Oc(w,n),T.childLanes=kc(e,n),t.memoizedState=Fc,S}var M=Wc(e,t,r.children,n);return t.memoizedState=null,M}function Vc(e,t,n){var r=Gc({mode:"visible",children:t},e.mode);return r.return=e,e.child=r,r}function Gc(e,t,n){return Kf(e,t,0,null)}function Hc(e,t){return jf(e,t)}function Wc(e,t,n,r){var i=e.child,s=i.sibling,a=Hc(i,{mode:"visible",children:n});if(1&t.mode||(a.lanes=r),a.return=t,a.sibling=null,null!==s){var o=t.deletions;null===o?(t.deletions=[s],t.flags|=W):o.push(s)}return t.child=a,a}function jc(e,t,n,r,i){var s,a,o=t.mode,l=e.child,u=l.sibling,c={mode:"hidden",children:n};1&o||t.child===l?(s=Hc(l,c)).subtreeFlags=l.subtreeFlags&de:((s=t.child).childLanes=0,s.pendingProps=c,2&t.mode&&(s.actualDuration=0,s.actualStartTime=-1,s.selfBaseDuration=l.selfBaseDuration,s.treeBaseDuration=l.treeBaseDuration),t.deletions=null);return null!==u?a=jf(u,r):(a=Yf(r,o,i,null)).flags|=2,a.return=t,s.return=t,s.sibling=a,t.child=s,a}function qc(e,t,n,r){null!==r&&lo(r),go(t,e.child,null,n);var i=Vc(t,t.pendingProps.children);return i.flags|=2,t.memoizedState=null,i}function Xc(e,t,n){e.lanes=Wr(e.lanes,t);var r=e.alternate;null!==r&&(r.lanes=Wr(r.lanes,t)),Is(e.return,t,n)}function $c(e,t){var n=be(e),r=!n&&"function"==typeof k(e);if(n||r){var i=n?"array":"iterable";return l("A nested %s was passed to row #%s in <SuspenseList />. Wrap it in an additional SuspenseList to configure its revealOrder: <SuspenseList revealOrder=...> ... <SuspenseList revealOrder=...>{%s}</SuspenseList> ... </SuspenseList>",i,t,i),!1}return!0}function Yc(e,t,n,r,i){var s=e.memoizedState;null===s?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=t,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function Kc(e,t,n){var r=t.pendingProps,i=r.revealOrder,s=r.tail,a=r.children;!function(e){if(void 0!==e&&"forwards"!==e&&"backwards"!==e&&"together"!==e&&!yc[e])if(yc[e]=!0,"string"==typeof e)switch(e.toLowerCase()){case"together":case"forwards":case"backwards":l('"%s" is not a valid value for revealOrder on <SuspenseList />. Use lowercase "%s" instead.',e,e.toLowerCase());break;case"forward":case"backward":l('"%s" is not a valid value for revealOrder on <SuspenseList />. React uses the -s suffix in the spelling. Use "%ss" instead.',e,e.toLowerCase());break;default:l('"%s" is not a supported revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',e)}else l('%s is not a supported value for revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',e)}(i),function(e,t){void 0===e||_c[e]||("collapsed"!==e&&"hidden"!==e?(_c[e]=!0,l('"%s" is not a supported value for tail on <SuspenseList />. Did you mean "collapsed" or "hidden"?',e)):"forwards"!==t&&"backwards"!==t&&(_c[e]=!0,l('<SuspenseList tail="%s" /> is only valid if revealOrder is "forwards" or "backwards". Did you mean to specify revealOrder="forwards"?',e)))}(s,i),function(e,t){if(("forwards"===t||"backwards"===t)&&null!=e&&!1!==e)if(be(e)){for(var n=0;n<e.length;n++)if(!$c(e[n],n))return}else{var r=k(e);if("function"==typeof r){var i=r.call(e);if(i)for(var s=i.next(),a=0;!s.done;s=i.next()){if(!$c(s.value,a))return;a++}}else l('A single row was passed to a <SuspenseList revealOrder="%s" />. This is not useful since it needs multiple rows. Did you mean to pass multiple children or an array?',t)}}(a,i),Sc(e,t,a,n);var o=Lo.current;Uo(o,Io)?(o=Fo(o,Io),t.flags|=j):(null!==e&&0!==(e.flags&j)&&function(e,t,n){for(var r=t;null!==r;){if(r.tag===v)null!==r.memoizedState&&Xc(r,n,e);else if(r.tag===S)Xc(r,n,e);else if(null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)return;for(;null===r.sibling;){if(null===r.return||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}}(t,t.child,n),o=Do(o));if(Bo(t,o),1&t.mode)switch(i){case"forwards":var u,c=function(e){for(var t=e,n=null;null!==t;){var r=t.alternate;null!==r&&null===zo(r)&&(n=t),t=t.sibling}return n}(t.child);null===c?(u=t.child,t.child=null):(u=c.sibling,c.sibling=null),Yc(t,!1,u,c,s);break;case"backwards":var d=null,h=t.child;for(t.child=null;null!==h;){var p=h.alternate;if(null!==p&&null===zo(p)){t.child=h;break}var f=h.sibling;h.sibling=d,d=h,h=f}Yc(t,!0,d,null,s);break;case"together":Yc(t,!1,null,null,void 0);break;default:t.memoizedState=null}else t.memoizedState=null;return t.child}var Qc=!1;var Zc=!1;function Jc(){bc=!0}function ed(e,t,n){return null!==e&&(t.dependencies=e.dependencies),ku(),Qp(t.lanes),Gr(n,t.childLanes)?(function(e,t){if(null!==e&&t.child!==e.child)throw new Error("Resuming work not yet implemented.");if(null!==t.child){var n=t.child,r=jf(n,n.pendingProps);for(t.child=r,r.return=t;null!==n.sibling;)n=n.sibling,(r=r.sibling=jf(n,n.pendingProps)).return=t;r.sibling=null}}(e,t),t.child):null}function td(e,t){return!!Gr(e.lanes,t)}function nd(e,t,n){if(t._debugNeedsRemount&&null!==e)return function(e,t,n){var r=t.return;if(null===r)throw new Error("Cannot swap the root fiber.");if(e.alternate=null,t.alternate=null,n.index=t.index,n.sibling=t.sibling,n.return=t.return,n.ref=t.ref,t===r.child)r.child=n;else{var i=r.child;if(null===i)throw new Error("Expected parent to have a child.");for(;i.sibling!==t;)if(null===(i=i.sibling))throw new Error("Expected to find the previous sibling.");i.sibling=n}var s=r.deletions;return null===s?(r.deletions=[e],r.flags|=W):s.push(e),n.flags|=2,n}(e,t,Xf(t.type,t.key,t.pendingProps,t._debugOwner||null,t.mode,t.lanes));if(null!==e)if(e.memoizedProps!==t.pendingProps||Vn()||t.type!==e.type)bc=!0;else{if(!td(e,n)&&0===(t.flags&j))return bc=!1,function(e,t,n){switch(t.tag){case 3:Pc(t),t.stateNode,so();break;case 5:Co(t);break;case 1:Gn(t.type)&&Xn(t);break;case 4:Mo(t,t.stateNode.containerInfo);break;case f:var r=t.memoizedProps.value;Ns(t,t.type._context,r);break;case g:Gr(n,t.childLanes)&&(t.flags|=4);var i=t.stateNode;i.effectDuration=0,i.passiveEffectDuration=0;break;case v:var s=t.memoizedState;if(null!==s){if(null!==s.dehydrated)return Bo(t,Do(Lo.current)),t.flags|=j,null;if(Gr(n,t.child.childLanes))return zc(e,t,n);Bo(t,Do(Lo.current));var a=ed(e,t,n);return null!==a?a.sibling:null}Bo(t,Do(Lo.current));break;case S:var o=0!==(e.flags&j),l=Gr(n,t.childLanes);if(o){if(l)return Kc(e,t,n);t.flags|=j}var u=t.memoizedState;if(null!==u&&(u.rendering=null,u.tail=null,u.lastEffect=null),Bo(t,Lo.current),l)break;return null;case T:case w:return t.lanes=0,Ec(e,t,n)}return ed(e,t,n)}(e,t,n);bc=0!==(e.flags&te)}else if(bc=!1,oo()&&function(e){return Fa(),0!==(e.flags&ne)}(t)){var r=t.index;Ia(t,(Fa(),wa),r)}switch(t.lanes=0,t.tag){case 2:return function(e,t,n,r){null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2);var i,s,a,o=t.pendingProps;if(i=zn(t,On(0,n,!1)),Us(t,r),Ei(t),n.prototype&&"function"==typeof n.prototype.render){var u=V(n)||"Unknown";hc[u]||(l("The <%s /> component appears to have a render method, but doesn't extend React.Component. This is likely to cause errors. Change %s to extend React.Component instead.",u,u),hc[u]=!0)}if(8&t.mode&&as.recordLegacyContextWarning(t,null),ss(!0),xc.current=t,s=ml(null,t,n,o,i,r),a=gl(),ss(!1),Ai(),t.flags|=1,"object"==typeof s&&null!==s&&"function"==typeof s.render&&void 0===s.$$typeof){var c=V(n)||"Unknown";pc[c]||(l("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",c,c,c),pc[c]=!0)}if("object"==typeof s&&null!==s&&"function"==typeof s.render&&void 0===s.$$typeof){var d=V(n)||"Unknown";pc[d]||(l("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",d,d,d),pc[d]=!0),t.tag=1,t.memoizedState=null,t.updateQueue=null;var h=!1;return Gn(n)?(h=!0,Xn(t)):h=!1,t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,Hs(t),va(t,s),xa(t,n,o,r),Nc(null,t,n,!0,h,r)}if(t.tag=0,8&t.mode){Si(!0);try{s=ml(null,t,n,o,i,r),a=gl()}finally{Si(!1)}}return oo()&&a&&La(t),Sc(null,t,s,r),Dc(t,n),t.child}(e,t,t.type,n);case 16:return Uc(e,t,t.elementType,n);case 0:var i=t.type,s=t.pendingProps;return Cc(e,t,i,t.elementType===i?s:xs(i,s),n);case 1:var a=t.type,o=t.pendingProps;return Rc(e,t,a,t.elementType===a?o:xs(a,o),n);case 3:return Ic(e,t,n);case 5:return function(e,t,n){Co(t),null===e&&to(t);var r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,a=i.children;return Pe(r,i)?a=null:null!==s&&Pe(r,s)&&(t.flags|=32),Ac(e,t),Sc(e,t,a,n),t.child}(e,t,n);case 6:return function(e,t){return null===e&&to(t),null}(e,t);case v:return zc(e,t,n);case 4:return function(e,t,n){Mo(t,t.stateNode.containerInfo);var r=t.pendingProps;return null===e?t.child=go(t,null,r,n):Sc(e,t,r,n),t.child}(e,t,n);case m:var u=t.type,c=t.pendingProps;return Tc(e,t,u,t.elementType===u?c:xs(u,c),n);case 7:return function(e,t,n){return Sc(e,t,t.pendingProps,n),t.child}(e,t,n);case 8:return function(e,t,n){return Sc(e,t,t.pendingProps.children,n),t.child}(e,t,n);case g:return function(e,t,n){t.flags|=4;var r=t.stateNode;return r.effectDuration=0,r.passiveEffectDuration=0,Sc(e,t,t.pendingProps.children,n),t.child}(e,t,n);case f:return function(e,t,n){var r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value;"value"in i||Qc||(Qc=!0,l("The `value` prop is required for the `<Context.Provider>`. Did you misspell it or forget to pass it?"));var o=t.type.propTypes;if(o&&En(o,i,"prop","Context.Provider"),Ns(t,r,a),null!==s){var u=s.value;if(Vi(u,a)){if(s.children===i.children&&!Vn())return ed(e,t,n)}else Ls(t,r,n)}return Sc(e,t,i.children,n),t.child}(e,t,n);case 9:return function(e,t,n){var r=t.type;void 0===r._context?r!==r.Consumer&&(Zc||(Zc=!0,l("Rendering <Context> directly is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?"))):r=r._context;var i=t.pendingProps.children;"function"!=typeof i&&l("A context consumer was rendered with multiple children, or a child that isn't a function. A context consumer expects a single child that is a function. If you did pass a function, make sure there is no trailing or leading whitespace around it."),Us(t,n);var s,a=Ds(r);return Ei(t),xc.current=t,ss(!0),s=i(a),ss(!1),Ai(),t.flags|=1,Sc(e,t,s,n),t.child}(e,t,n);case y:var d=t.type,h=xs(d,t.pendingProps);if(t.type!==t.elementType){var p=d.propTypes;p&&En(p,h,"prop",V(d))}return wc(e,t,d,h=xs(d.type,h),n);case _:return Mc(e,t,t.type,t.pendingProps,n);case x:var b=t.type,M=t.pendingProps;return function(e,t,n,r,i){var s;return null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,Gn(n)?(s=!0,Xn(t)):s=!1,Us(t,i),ya(t,n,r),xa(t,n,r,i),Nc(null,t,n,!0,s,i)}(e,t,b,t.elementType===b?M:xs(b,M),n);case S:return Kc(e,t,n);case 21:break;case T:return Ec(e,t,n)}throw new Error("Unknown unit of work tag ("+t.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function rd(e,t,n){switch(Da(t),t.tag){case 1:Gn(t.type)&&Hn(t);var r=t.flags;return r&ee?(t.flags=-65537&r|j,2&t.mode&&ju(t),t):null;case 3:Eo(t),Wn(t),Xo();var i=t.flags;return 0!==(i&ee)&&0===(i&j)?(t.flags=-65537&i|j,t):null;case 5:return Ro(t),null;case v:Oo(t);var s=t.memoizedState;if(null!==s&&null!==s.dehydrated){if(null===t.alternate)throw new Error("Threw in newly mounted dehydrated component. This is likely a bug in React. Please file an issue.");so()}var a=t.flags;return a&ee?(t.flags=-65537&a|j,2&t.mode&&ju(t),t):null;case S:return Oo(t),null;case 4:return Eo(t),null;case f:return Ps(t.type._context,t),null;case T:case w:return qp(t),null;default:return null}}function id(e,t,n){switch(Da(t),t.tag){case 1:var r=t.type.childContextTypes;null!=r&&Hn(t);break;case 3:Eo(t),Wn(t),Xo();break;case 5:Ro(t);break;case 4:Eo(t);break;case v:case S:Oo(t);break;case f:Ps(t.type._context,t);break;case T:case w:qp(t)}}function sd(e,t,n,r,i,s,a,o,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(e){this.onError(e)}}var ad=sd;if("undefined"!=typeof window&&"function"==typeof window.dispatchEvent&&"undefined"!=typeof document&&"function"==typeof document.createEvent){var od=document.createElement("react");ad=function(e,t,n,r,i,s,a,o,l){if("undefined"==typeof document||null===document)throw new Error("The `document` global was defined when React was initialized, but is not defined anymore. This can happen in a test environment if a component schedules an update from an asynchronous callback, but the test has already finished running. To solve this, you can either unmount the component at the end of your test (and ensure that any asynchronous operations get canceled in `componentWillUnmount`), or you can change the test itself to be asynchronous.");var u=document.createEvent("Event"),c=!1,d=!0,h=window.event,p=Object.getOwnPropertyDescriptor(window,"event");function f(){od.removeEventListener(b,v,!1),void 0!==window.event&&window.hasOwnProperty("event")&&(window.event=h)}var m,g=Array.prototype.slice.call(arguments,3);function v(){c=!0,f(),t.apply(n,g),d=!1}var y=!1,_=!1;function x(e){if(m=e.error,y=!0,null===m&&0===e.colno&&0===e.lineno&&(_=!0),e.defaultPrevented&&null!=m&&"object"==typeof m)try{m._suppressLogging=!0}catch(e){}}var b="react-"+(e||"invokeguardedcallback");if(window.addEventListener("error",x),od.addEventListener(b,v,!1),u.initEvent(b,!1,!1),od.dispatchEvent(u),p&&Object.defineProperty(window,"event",p),c&&d&&(y?_&&(m=new Error("A cross-origin error was thrown. React doesn't have access to the actual error object in development. See https://reactjs.org/link/crossorigin-error for more information.")):m=new Error("An error was thrown inside one of your components, but React doesn't know what it was. This is likely due to browser flakiness. React does its best to preserve the \"Pause on exceptions\" behavior of the DevTools, which requires some DEV-mode only tricks. It's possible that these don't work in your browser. Try triggering the error in production mode, or switching to a modern browser. If you suspect that this is actually an issue with React, please file an issue."),this.onError(m)),window.removeEventListener("error",x),!c)return f(),sd.apply(this,arguments)}}var ld=ad,ud=!1,cd=null,dd={onError:function(e){ud=!0,cd=e}};function hd(e,t,n,r,i,s,a,o,l){ud=!1,cd=null,ld.apply(dd,arguments)}function pd(){if(ud){var e=cd;return ud=!1,cd=null,e}throw new Error("clearCaughtError was called but no error was captured. This error is likely caused by a bug in React. Please file an issue.")}var fd=null;fd=new Set;var md=!1,gd=!1,vd="function"==typeof WeakSet?WeakSet:Set,yd=null,_d=null,xd=null;function bd(e){hd(null,function(){throw e}),pd()}var Sd=function(e,t){if(t.props=e.memoizedProps,t.state=e.memoizedState,2&e.mode)try{Hu(),t.componentWillUnmount()}finally{Vu(e)}else t.componentWillUnmount()};function Td(e,t){try{Ld(Wo,e)}catch(n){bd(n),cf(e,t,n)}}function wd(e,t,n){try{Sd(e,n)}catch(n){bd(n),cf(e,t,n)}}function Md(e,t){try{Bd(e)}catch(n){bd(n),cf(e,t,n)}}function Ed(e,t){var n=e.ref;if(null!==n)if("function"==typeof n){var r;try{if(2&e.mode)try{Hu(),r=n(null)}finally{Vu(e)}else r=n(null)}catch(n){bd(n),cf(e,t,n)}"function"==typeof r&&l("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",H(e))}else n.current=null}function Ad(e,t,n){try{n()}catch(n){bd(n),cf(e,t,n)}}var Cd=!1;function Rd(e,t){Me(e.containerInfo),yd=t,function(){for(;null!==yd;){var e=yd,t=e.child;0!==(e.subtreeFlags&oe)&&null!==t?(vh(t,e),yd=t):Nd()}}();var n=Cd;return Cd=!1,n}function Nd(){for(;null!==yd;){var e=yd;is(e);try{Pd(e)}catch(t){bd(t),cf(e,e.return,t)}rs();var t=e.sibling;if(null!==t)return vh(t,e.return),void(yd=t);yd=e.return}}function Pd(e){var t=e.alternate;if(0!==(e.flags&$)){switch(is(e),e.tag){case 0:case m:case _:break;case 1:if(null!==t){var n=t.memoizedProps,r=t.memoizedState,i=e.stateNode;e.type!==e.elementType||vc||(i.props!==e.memoizedProps&&l("Expected %s props to match memoized props before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",H(e)||"instance"),i.state!==e.memoizedState&&l("Expected %s state to match memoized state before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",H(e)||"instance"));var s=i.getSnapshotBeforeUpdate(e.elementType===e.type?n:xs(e.type,n),r),a=fd;void 0!==s||a.has(e.type)||(a.add(e.type),l("%s.getSnapshotBeforeUpdate(): A snapshot value (or null) must be returned. You have returned undefined.",H(e))),i.__reactInternalSnapshotBeforeUpdate=s}break;case 3:if(Oe){var o=e.stateNode;mt(o.containerInfo)}break;case 5:case 6:case 4:case x:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}rs()}}function Id(e,t,n){var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var s=i.next,a=s;do{if((a.tag&e)===e){var o=a.destroy;a.destroy=void 0,void 0!==o&&((e&jo)!==Vo?Ni(t):(e&Wo)!==Vo&&Ui(t),Ad(t,n,o),(e&jo)!==Vo?Pi():(e&Wo)!==Vo&&Di())}a=a.next}while(a!==s)}}function Ld(e,t){var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next,s=i;do{if((s.tag&e)===e){(e&jo)!==Vo?Ci(t):(e&Wo)!==Vo&&Ii(t);var a=s.create;s.destroy=a(),(e&jo)!==Vo?Ri():(e&Wo)!==Vo&&Li();var o=s.destroy;if(void 0!==o&&"function"!=typeof o){var u=void 0;l("%s must not return anything besides a function, which is used for clean-up.%s",u=0!==(s.tag&Wo)?"useLayoutEffect":0!==(s.tag&Ho)?"useInsertionEffect":"useEffect",null===o?" You returned null. If your effect does not require clean up, return undefined (or nothing).":"function"==typeof o.then?"\n\nIt looks like you wrote "+u+"(async () => ...) or returned a Promise. Instead, write the async function inside your effect and call it immediately:\n\n"+u+"(() => {\n  async function fetchData() {\n    // You can await here\n    const response = await MyAPI.getData(someId);\n    // ...\n  }\n  fetchData();\n}, [someId]); // Or [] if effect doesn't need props or state\n\nLearn more about data fetching with Hooks: https://reactjs.org/link/hooks-data-fetching":" You returned: "+o)}}s=s.next}while(s!==i)}}function Ud(e,t){if(4&t.flags&&t.tag===g){var n=t.stateNode.passiveEffectDuration,r=t.memoizedProps,i=r.id,s=r.onPostCommit,a=Fu(),o=null===t.alternate?"mount":"update";Du()&&(o="nested-update"),"function"==typeof s&&s(i,o,n,a);var l=t.return;e:for(;null!==l;){switch(l.tag){case 3:l.stateNode.passiveEffectDuration+=n;break e;case g:l.stateNode.passiveEffectDuration+=n;break e}l=l.return}}}function Dd(e,t,n,r){if(0!==(n.flags&ue))switch(n.tag){case 0:case m:case _:if(!gd)if(2&n.mode)try{Hu(),Ld(Wo|Go,n)}finally{Vu(n)}else Ld(Wo|Go,n);break;case 1:var i=n.stateNode;if(4&n.flags&&!gd)if(null===t)if(n.type!==n.elementType||vc||(i.props!==n.memoizedProps&&l("Expected %s props to match memoized props before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",H(n)||"instance"),i.state!==n.memoizedState&&l("Expected %s state to match memoized state before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",H(n)||"instance")),2&n.mode)try{Hu(),i.componentDidMount()}finally{Vu(n)}else i.componentDidMount();else{var s=n.elementType===n.type?t.memoizedProps:xs(n.type,t.memoizedProps),a=t.memoizedState;if(n.type!==n.elementType||vc||(i.props!==n.memoizedProps&&l("Expected %s props to match memoized props before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",H(n)||"instance"),i.state!==n.memoizedState&&l("Expected %s state to match memoized state before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",H(n)||"instance")),2&n.mode)try{Hu(),i.componentDidUpdate(s,a,i.__reactInternalSnapshotBeforeUpdate)}finally{Vu(n)}else i.componentDidUpdate(s,a,i.__reactInternalSnapshotBeforeUpdate)}var o=n.updateQueue;null!==o&&(n.type!==n.elementType||vc||(i.props!==n.memoizedProps&&l("Expected %s props to match memoized props before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",H(n)||"instance"),i.state!==n.memoizedState&&l("Expected %s state to match memoized state before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",H(n)||"instance")),ea(0,o,i));break;case 3:var u=n.updateQueue;if(null!==u){var c=null;if(null!==n.child)switch(n.child.tag){case 5:c=Se(n.child.stateNode);break;case 1:c=n.child.stateNode}ea(0,u,c)}break;case 5:var d=n.stateNode;if(null===t&&4&n.flags){var h=n.type,p=n.memoizedProps;it(d,h,p,n)}break;case 6:case 4:break;case g:var f=n.memoizedProps,y=f.onCommit,b=f.onRender,M=n.stateNode.effectDuration,E=Fu(),A=null===t?"mount":"update";Du()&&(A="nested-update"),"function"==typeof b&&b(n.memoizedProps.id,A,n.actualDuration,n.treeBaseDuration,n.actualStartTime,E),"function"==typeof y&&y(n.memoizedProps.id,A,M,E),R=n,Sp.push(R),_p||(_p=!0,wf(pi,function(){return af(),null}));var C=n.return;e:for(;null!==C;){switch(C.tag){case 3:C.stateNode.effectDuration+=M;break e;case g:C.stateNode.effectDuration+=M;break e}C=C.return}break;case v:!function(e,t){if(!ze)return;var n=t.memoizedState;if(null===n){var r=t.alternate;if(null!==r){var i=r.memoizedState;if(null!==i){var s=i.dehydrated;null!==s&&jt(s)}}}}(0,n);break;case S:case x:case 21:case T:case w:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}var R;gd||n.flags&X&&Bd(n)}function Fd(e){switch(e.tag){case 0:case m:case _:if(2&e.mode)try{Hu(),Td(e,e.return)}finally{Vu(e)}else Td(e,e.return);break;case 1:var t=e.stateNode;"function"==typeof t.componentDidMount&&function(e,t,n){try{n.componentDidMount()}catch(n){bd(n),cf(e,t,n)}}(e,e.return,t),Md(e,e.return);break;case 5:Md(e,e.return)}}function Bd(e){var t=e.ref;if(null!==t){var n,r=e.stateNode;if(5===e.tag)n=Se(r);else n=r;if("function"==typeof t){var i;if(2&e.mode)try{Hu(),i=t(n)}finally{Vu(e)}else i=t(n);"function"==typeof i&&l("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",H(e))}else t.hasOwnProperty("current")||l("Unexpected ref object provided for %s. Use either a ref-setter function or React.createRef().",H(e)),t.current=n}}function Od(e,t,n){switch(function(e){if(yi&&"function"==typeof yi.onCommitFiberUnmount)try{yi.onCommitFiberUnmount(vi,e)}catch(e){xi||(xi=!0,l("React instrumentation encountered an error: %s",e))}}(t),t.tag){case 0:case m:case y:case _:var r=t.updateQueue;if(null!==r){var i=r.lastEffect;if(null!==i){var s=i.next,a=s;do{var o=a,u=o.destroy,c=o.tag;void 0!==u&&((c&Ho)!==Vo?Ad(t,n,u):(c&Wo)!==Vo&&(Ui(t),2&t.mode?(Hu(),Ad(t,n,u),Vu(t)):Ad(t,n,u),Di())),a=a.next}while(a!==s)}}return;case 1:Ed(t,n);var d=t.stateNode;return void("function"==typeof d.componentWillUnmount&&wd(t,n,d));case 5:return void Ed(t,n);case 4:return void(Oe?qd(e,t,n):ke&&function(e){if(!ke)return;var t=e.stateNode,n=t.containerInfo,r=vt(n);xt(n,r)}(t));case b:case 21:return}}function kd(e,t,n){for(var r=t;;)if(Od(e,r,n),null===r.child||Oe&&4===r.tag){if(r===t)return;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}else r.child.return=r,r=r.child}function zd(e){var t=e.alternate;if(null!==t&&(e.alternate=null,zd(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag){var n=e.stateNode;null!==n&&We(n)}e.stateNode=null,e._debugOwner=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Vd(e){return 5===e.tag||3===e.tag||4===e.tag}function Gd(e){var t=e;e:for(;;){for(;null===t.sibling;){if(null===t.return||Vd(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;5!==t.tag&&6!==t.tag&&t.tag!==b;){if(2&t.flags)continue e;if(null===t.child||4===t.tag)continue e;t.child.return=t,t=t.child}if(!(2&t.flags))return t.stateNode}}function Hd(e){if(Oe){var t=function(e){for(var t=e.return;null!==t;){if(Vd(t))return t;t=t.return}throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.")}(e);switch(t.tag){case 5:var n=t.stateNode;32&t.flags&&(ct(n),t.flags&=-33),jd(e,Gd(e),n);break;case 3:case 4:var r=t.stateNode.containerInfo;Wd(e,Gd(e),r);break;default:throw new Error("Invalid host parent fiber. This error is likely caused by a bug in React. Please file an issue.")}}}function Wd(e,t,n){var r=e.tag;if(5===r||6===r){var i=e.stateNode;t?ot(n,i,t):nt(n,i)}else if(4===r);else{var s=e.child;if(null!==s){Wd(s,t,n);for(var a=s.sibling;null!==a;)Wd(a,t,n),a=a.sibling}}}function jd(e,t,n){var r=e.tag;if(5===r||6===r){var i=e.stateNode;t?at(n,i,t):tt(n,i)}else if(4===r);else{var s=e.child;if(null!==s){jd(s,t,n);for(var a=s.sibling;null!==a;)jd(a,t,n),a=a.sibling}}}function qd(e,t,n){for(var r,i,s=t,a=!1;;){if(!a){var o=s.return;e:for(;;){if(null===o)throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");var l=o.stateNode;switch(o.tag){case 5:r=l,i=!1;break e;case 3:case 4:r=l.containerInfo,i=!0;break e}o=o.return}a=!0}if(5===s.tag||6===s.tag)kd(e,s,n),i?ut(r,s.stateNode):lt(r,s.stateNode);else if(s.tag===b)i?Xt(r,s.stateNode):qt(r,s.stateNode);else if(4===s.tag){if(null!==s.child){r=s.stateNode.containerInfo,i=!0,s.child.return=s,s=s.child;continue}}else if(Od(e,s,n),null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)return;for(;null===s.sibling;){if(null===s.return||s.return===t)return;4===(s=s.return).tag&&(a=!1)}s.sibling.return=s.return,s=s.sibling}}function Xd(e,t,n){var r,i;Oe?qd(e,t,n):kd(e,t,n),null!==(i=(r=t).alternate)&&(i.return=null),r.return=null}function $d(e,t){if(Oe){switch(t.tag){case 0:case m:case y:case _:if(Id(Ho|Go,t,t.return),Ld(Ho|Go,t),2&t.mode)try{Hu(),Id(Wo|Go,t,t.return)}finally{Vu(t)}else Id(Wo|Go,t,t.return);return;case 1:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps,i=null!==e?e.memoizedProps:r,s=t.type,a=t.updateQueue;t.updateQueue=null,null!==a&&st(n,a,s,i,r,t)}return;case 6:if(null===t.stateNode)throw new Error("This should have a text node initialized. This error is likely caused by a bug in React. Please file an issue.");var o=t.stateNode,l=t.memoizedProps,u=null!==e?e.memoizedProps:l;return void rt(o,u,l);case 3:if(ze)if(null!==e)if(e.memoizedState.isDehydrated){var c=t.stateNode;Wt(c.containerInfo)}return;case g:return;case v:return Yd(t),void Kd(t);case S:return void Kd(t);case x:return}throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}switch(t.tag){case 0:case m:case y:case _:if(Id(Ho|Go,t,t.return),Ld(Ho|Go,t),2&t.mode)try{Hu(),Id(Wo|Go,t,t.return)}finally{Vu(t)}else Id(Wo|Go,t,t.return);return;case g:return;case v:return Yd(t),void Kd(t);case S:return void Kd(t);case 3:if(ze)if(null!==e)if(e.memoizedState.isDehydrated){var d=t.stateNode;Wt(d.containerInfo)}break;case T:case w:return}!function(e){if(ke){switch(e.tag){case 1:case 5:case 6:return;case 3:case 4:var t=e.stateNode,n=t.containerInfo,r=t.pendingChildren;return void xt(n,r)}throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}}(t)}function Yd(e){e.memoizedState}function Kd(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new vd),t.forEach(function(t){var r=ff.bind(null,e,t);if(!n.has(t)){if(n.add(t),bi){if(null===_d||null===xd)throw Error("Expected finished root and lanes to be set. This is a bug in React.");Sf(xd,_d)}t.then(r,r)}})}}function Qd(e,t,n){_d=n,xd=e,yd=t,function(e,t){for(;null!==yd;){var n=yd,r=n.deletions;if(null!==r)for(var i=0;i<r.length;i++){var s=r[i];try{Xd(e,s,n)}catch(e){bd(e),cf(s,n,e)}}var a=n.child;0!==(n.subtreeFlags&le)&&null!==a?(vh(a,n),yd=a):Zd(e,t)}}(e,n),_d=null,xd=null}function Zd(e,t){for(;null!==yd;){var n=yd;is(n);try{Jd(n,e,t)}catch(e){bd(e),cf(n,n.return,e)}rs();var r=n.sibling;if(null!==r)return vh(r,n.return),void(yd=r);yd=n.return}}function Jd(e,t,n){var r=e.flags;if(32&r&&function(e){Oe&&ct(e.stateNode)}(e),r&X){var i=e.alternate;null!==i&&function(e){var t=e.ref;if(null!==t)if("function"==typeof t)if(2&e.mode)try{Hu(),t(null)}finally{Vu(e)}else t(null);else t.current=null}(i)}if(r&Q)switch(e.tag){case v:if(null!==e.memoizedState){var s=e.alternate;null!==s&&null!==s.memoizedState||(cp=ci())}break;case T:var a=null!==e.memoizedState,o=e.alternate,l=null!==o&&null!==o.memoizedState,u=e;if(Oe&&function(e,t){var n=null;if(Oe)for(var r=e;;){if(5===r.tag){if(null===n){n=r;var i=r.stateNode;t?dt(i):pt(r.stateNode,r.memoizedProps)}}else if(6===r.tag){if(null===n){var s=r.stateNode;t?ht(s):ft(s,r.memoizedProps)}}else if((r.tag!==T&&r.tag!==w||null===r.memoizedState||r===e)&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===e)return;for(;null===r.sibling;){if(null===r.return||r.return===e)return;n===r&&(n=null),r=r.return}n===r&&(n=null),r.sibling.return=r.return,r=r.sibling}}(u,a),a&&!l&&1&u.mode){yd=u;for(var c=u.child;null!==c;)yd=c,rh(c),c=c.sibling}}switch(4102&r){case 2:Hd(e),e.flags&=-3;break;case 6:Hd(e),e.flags&=-3,$d(e.alternate,e);break;case K:e.flags&=-4097;break;case 4100:e.flags&=-4097,$d(e.alternate,e);break;case 4:$d(e.alternate,e)}}function eh(e,t,n){_d=n,xd=t,yd=e,th(e,t,n),_d=null,xd=null}function th(e,t,n){for(var r=!!(1&e.mode);null!==yd;){var i=yd,s=i.child;if(i.tag===T&&r){var a=null!==i.memoizedState||md;if(a){nh(e,t,n);continue}var o=i.alternate,l=null!==o&&null!==o.memoizedState,u=md,c=gd;md=a,(gd=l||gd)&&!c&&(yd=i,sh(i));for(var d=s;null!==d;)yd=d,th(d,t,n),d=d.sibling;yd=i,md=u,gd=c,nh(e,t,n)}else 0!==(i.subtreeFlags&ue)&&null!==s?(vh(s,i),yd=s):nh(e,t,n)}}function nh(e,t,n){for(;null!==yd;){var r=yd;if(0!==(r.flags&ue)){var i=r.alternate;is(r);try{Dd(0,i,r)}catch(e){bd(e),cf(r,r.return,e)}rs()}if(r===e)return void(yd=null);var s=r.sibling;if(null!==s)return vh(s,r.return),void(yd=s);yd=r.return}}function rh(e){for(;null!==yd;){var t=yd,n=t.child;switch(t.tag){case 0:case m:case y:case _:if(2&t.mode)try{Hu(),Id(Wo,t,t.return)}finally{Vu(t)}else Id(Wo,t,t.return);break;case 1:Ed(t,t.return);var r=t.stateNode;"function"==typeof r.componentWillUnmount&&wd(t,t.return,r);break;case 5:Ed(t,t.return);break;case T:if(null!==t.memoizedState){ih(e);continue}}null!==n?(n.return=t,yd=n):ih(e)}}function ih(e){for(;null!==yd;){var t=yd;if(t===e)return void(yd=null);var n=t.sibling;if(null!==n)return n.return=t.return,void(yd=n);yd=t.return}}function sh(e){for(;null!==yd;){var t=yd,n=t.child;if(t.tag===T)if(null!==t.memoizedState){ah(e);continue}null!==n?(n.return=t,yd=n):ah(e)}}function ah(e){for(;null!==yd;){var t=yd;is(t);try{Fd(t)}catch(e){bd(e),cf(t,t.return,e)}if(rs(),t===e)return void(yd=null);var n=t.sibling;if(null!==n)return n.return=t.return,void(yd=n);yd=t.return}}function oh(e,t){yd=t,function(e,t){for(;null!==yd;){var n=yd,r=n.child;0!==(n.subtreeFlags&ce)&&null!==r?(vh(r,n),yd=r):lh(e,t)}}(t,e)}function lh(e,t){for(;null!==yd;){var n=yd;if(0!==(n.flags&Y)){is(n);try{uh(t,n)}catch(e){bd(e),cf(n,n.return,e)}rs()}if(n===e)return void(yd=null);var r=n.sibling;if(null!==r)return vh(r,n.return),void(yd=r);yd=n.return}}function uh(e,t){switch(t.tag){case 0:case m:case _:if(2&t.mode){Wu();try{Ld(jo|Go,t)}finally{Gu(t)}}else Ld(jo|Go,t)}}function ch(e){yd=e,function(){for(;null!==yd;){var e=yd,t=e.child;if(0!==(yd.flags&W)){var n=e.deletions;if(null!==n){for(var r=0;r<n.length;r++){var i=n[r];yd=i,ph(i,e)}var s=e.alternate;if(null!==s){var a=s.child;if(null!==a){s.child=null;do{var o=a.sibling;a.sibling=null,a=o}while(null!==a)}}yd=e}}0!==(e.subtreeFlags&ce)&&null!==t?(vh(t,e),yd=t):dh()}}()}function dh(){for(;null!==yd;){var e=yd;0!==(e.flags&Y)&&(is(e),hh(e),rs());var t=e.sibling;if(null!==t)return vh(t,e.return),void(yd=t);yd=e.return}}function hh(e){switch(e.tag){case 0:case m:case _:2&e.mode?(Wu(),Id(jo|Go,e,e.return),Gu(e)):Id(jo|Go,e,e.return)}}function ph(e,t){for(;null!==yd;){var n=yd;is(n),mh(n,t),rs();var r=n.child;null!==r?(vh(r,n),yd=r):fh(e)}}function fh(e){for(;null!==yd;){var t=yd,n=t.sibling,r=t.return;if(zd(t),t===e)return void(yd=null);if(null!==n)return vh(n,r),void(yd=n);yd=r}}function mh(e,t){switch(e.tag){case 0:case m:case _:2&e.mode?(Wu(),Id(jo,e,t),Gu(e)):Id(jo,e,t)}}var gh=!1;function vh(e,t){gh||e.return===t||(gh=!0,l("Internal React error: Return pointer is inconsistent with parent.")),e.return=t}function yh(e){switch(e.tag){case 0:case m:case _:try{Ld(Wo|Go,e)}catch(t){bd(t),cf(e,e.return,t)}break;case 1:var t=e.stateNode;try{t.componentDidMount()}catch(t){bd(t),cf(e,e.return,t)}}}function _h(e){switch(e.tag){case 0:case m:case _:try{Ld(jo|Go,e)}catch(t){bd(t),cf(e,e.return,t)}}}function xh(e){switch(e.tag){case 0:case m:case _:try{Id(Wo|Go,e,e.return)}catch(t){bd(t),cf(e,e.return,t)}break;case 1:var t=e.stateNode;"function"==typeof t.componentWillUnmount&&wd(e,e.return,t)}}function bh(e){switch(e.tag){case 0:case m:case _:try{Id(jo|Go,e,e.return)}catch(t){bd(t),cf(e,e.return,t)}}}var Sh=0,Th=1,wh=2,Mh=3,Eh=4;if("function"==typeof Symbol&&Symbol.for){var Ah=Symbol.for;Sh=Ah("selector.component"),Th=Ah("selector.has_pseudo_class"),wh=Ah("selector.role"),Mh=Ah("selector.test_id"),Eh=Ah("selector.text")}function Ch(e){var t=Ve(e);if(null!=t){if("string"!=typeof t.memoizedProps["data-testname"])throw new Error("Invalid host root specified. Should be either a React container or a node with a testname attribute.");return t}var n=$e(e);if(null===n)throw new Error("Could not find React container within specified host subtree.");return n.stateNode.current}function Rh(e,t){switch(t.$$typeof){case Sh:if(e.type===t.value)return!0;break;case Th:return function(e,t){var n=[e,0],r=0;for(;r<n.length;){var i=n[r++],s=n[r++],a=t[s];if(5!==i.tag||!Qe(i)){for(;null!=a&&Rh(i,a);)a=t[++s];if(s===t.length)return!0;for(var o=i.child;null!==o;)n.push(o,s),o=o.sibling}}return!1}(e,t.value);case wh:if(5===e.tag){var n=e.stateNode;if(Ze(n,t.value))return!0}break;case Eh:if(5===e.tag||6===e.tag){var r=Ke(e);if(null!==r&&r.indexOf(t.value)>=0)return!0}break;case Mh:if(5===e.tag){var i=e.memoizedProps["data-testname"];if("string"==typeof i&&i.toLowerCase()===t.value.toLowerCase())return!0}break;default:throw new Error("Invalid selector type specified.")}return!1}function Nh(e){switch(e.$$typeof){case Sh:return"<"+(V(e.value)||"Unknown")+">";case Th:return":has("+(Nh(e)||"")+")";case wh:return'[role="'+e.value+'"]';case Eh:return'"'+e.value+'"';case Mh:return'[data-testname="'+e.value+'"]';default:throw new Error("Invalid selector type specified.")}}function Ph(e,t){for(var n=[],r=[e,0],i=0;i<r.length;){var s=r[i++],a=r[i++],o=t[a];if(5!==s.tag||!Qe(s)){for(;null!=o&&Rh(s,o);)o=t[++a];if(a===t.length)n.push(s);else for(var l=s.child;null!==l;)r.push(l,a),l=l.sibling}}return n}function Ih(e,t){if(!Xe)throw new Error("Test selector API is not supported by this renderer.");for(var n=Ph(Ch(e),t),r=[],i=Array.from(n),s=0;s<i.length;){var a=i[s++];if(5===a.tag){if(Qe(a))continue;r.push(a.stateNode)}else for(var o=a.child;null!==o;)i.push(o),o=o.sibling}return r}var Lh=[];var Uh=s.ReactCurrentActQueue;function Dh(){var e="undefined"!=typeof IS_REACT_ACT_ENVIRONMENT?IS_REACT_ACT_ENVIRONMENT:void 0;return e||null===Uh.current||l("The current testing environment is not configured to support act(...)"),e}var Fh=Math.ceil,Bh=s.ReactCurrentDispatcher,Oh=s.ReactCurrentOwner,kh=s.ReactCurrentBatchConfig,zh=s.ReactCurrentActQueue,Vh=0,Gh=2,Hh=4,Wh=0,jh=1,qh=2,Xh=3,$h=4,Yh=5,Kh=6,Qh=Vh,Zh=null,Jh=null,ep=0,tp=0,np=Pn(0),rp=Wh,ip=null,sp=0,ap=0,op=0,lp=null,up=null,cp=0,dp=500,hp=1/0,pp=500;function fp(){hp=ci()+pp}function mp(){return hp}var gp=!1,vp=null,yp=null,_p=!1,xp=null,bp=0,Sp=[],Tp=50,wp=0,Mp=null,Ep=50,Ap=0,Cp=Ar,Rp=0;function Np(){return Zh}function Pp(){return(Qh&(Gh|Hh))!==Vh?ci():Cp!==Ar?Cp:Cp=ci()}function Ip(e){var t;if(!(1&e.mode))return 1;if((Qh&Gh)!==Vh&&0!==ep)return kr(ep);if(null!==Yi.transition){if(null!==kh.transition){var n=kh.transition;n._updatedFibers||(n._updatedFibers=new Set),n._updatedFibers.add(e)}return 0===Rp&&(t=Cr,!((Cr<<=1)&tr)&&(Cr=64),Rp=t),Rp}var r=ni();return 0!==r?r:He()}function Up(e){var t;return 1&e.mode?(t=Rr,!((Rr<<=1)&fr)&&(Rr=mr),t):1}function Dp(e,t,n){!function(){if(wp>Tp)throw wp=0,Mp=null,new Error("Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.");Ap>Ep&&(Ap=0,l("Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render."))}();var r=Fp(e,t);return null===r?null:($r(r,t,n),0!==(Qh&Gh)&&r===Zh?function(e){if(ts&&!lu)switch(e.tag){case 0:case m:case _:var t=Jh&&H(Jh)||"Unknown",n=t;if(!xf.has(n))xf.add(n),l("Cannot update a component (`%s`) while rendering a different component (`%s`). To locate the bad setState() call inside `%s`, follow the stack trace as described in https://reactjs.org/link/setstate-in-render",H(e)||"Unknown",t,t);break;case 1:bf||(l("Cannot update during an existing state transition (such as within `render`). Render methods should be a pure function of props and state."),bf=!0)}}(e):(bi&&Qr(r,e,t),function(e){if(1&e.mode){if(!Dh())return}else{if(t="undefined"!=typeof IS_REACT_ACT_ENVIRONMENT?IS_REACT_ACT_ENVIRONMENT:void 0,n="undefined"!=typeof jest,!Be||!n||!1===t)return;if(Qh!==Vh)return;if(0!==e.tag&&e.tag!==m&&e.tag!==_)return}var t,n;if(null===zh.current){var r=es;try{is(e),l("An update to %s inside a test was not wrapped in act(...).\n\nWhen testing, code that causes React state updates should be wrapped into act(...):\n\nact(() => {\n  /* fire events that update state */\n});\n/* assert on the output */\n\nThis ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act",H(e))}finally{r?is(e):rs()}}}(e),r===Zh&&((Qh&Gh)===Vh&&(ap=Wr(ap,t)),rp===$h&&Gp(r,ep)),Op(r,n),1!==t||Qh!==Vh||1&e.mode||zh.isBatchingLegacy||(fp(),qi())),r)}function Fp(e,t){e.lanes=Wr(e.lanes,t);var n=e.alternate;null!==n&&(n.lanes=Wr(n.lanes,t)),null===n&&4098&e.flags&&_f(e);for(var r=e,i=e.return;null!==i;)i.childLanes=Wr(i.childLanes,t),null!==(n=i.alternate)?n.childLanes=Wr(n.childLanes,t):4098&i.flags&&_f(e),r=i,i=i.return;return 3===r.tag?r.stateNode:null}function Bp(e,t){return null!==Zh&&!!(1&e.mode)&&(Qh&Gh)===Vh}function Op(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.pendingLanes,r=e.suspendedLanes,i=e.pingedLanes,s=e.expirationTimes,a=n;a>0;){var o=zr(a),l=1<<o,u=s[o];u===Ar?0!==(l&r)&&0===(l&i)||(s[o]=Ir(l,t)):u<=t&&(e.expiredLanes|=l),a&=~l}}(e,t);var r=Pr(e,e===Zh?ep:0);if(0===r)return null!==n&&Mf(n),e.callbackNode=null,void(e.callbackPriority=0);var i=Or(r),s=e.callbackPriority;if(s!==i||null!==zh.current&&n!==Tf){var a,o;if(null!=n&&Mf(n),1===i)0===e.tag?(null!==zh.isBatchingLegacy&&(zh.didScheduleLegacyUpdate=!0),o=Hp.bind(null,e),Hi=!0,ji(o)):ji(Hp.bind(null,e)),je?null!==zh.current?zh.current.push(Xi):qe(function(){Qh===Vh&&Xi()}):wf(di,Xi),a=null;else{var u;switch(si(r)){case 1:u=di;break;case 4:u=hi;break;case Jr:u=pi;break;case ei:u=fi;break;default:u=pi}a=wf(u,kp.bind(null,e))}e.callbackPriority=i,e.callbackNode=a}else null==n&&1!==s&&l("Expected scheduled callback to exist. This error is likely caused by a bug in React. Please file an issue.")}function kp(e,t){if(Lu=!1,Uu=!1,Cp=Ar,Rp=0,(Qh&(Gh|Hh))!==Vh)throw new Error("Should not already be working.");var n=e.callbackNode;if(af()&&e.callbackNode!==n)return null;var r=Pr(e,e===Zh?ep:0);if(0===r)return null;var i=!Fr(0,r)&&!function(e,t){return 0!==(t&e.expiredLanes)}(e,r)&&!t,s=i?function(e,t){var n=Qh;Qh|=Gh;var r=Yp();if(Zh!==e||ep!==t){if(bi){var i=e.memoizedUpdaters;i.size>0&&(Sf(e,ep),i.clear()),Zr(e,t)}fp(),Xp(e,t)}Oi(t);for(;;)try{tf();break}catch(t){$p(e,t)}return As(),Kp(r),Qh=n,null!==Jh?(null!==_i&&"function"==typeof _i.markRenderYielded&&_i.markRenderYielded(),Wh):(ki(),Zh=null,ep=0,rp)}(e,r):Jp(e,r);if(s!==Wh){if(s===qh){var a=Lr(e);0!==a&&(r=a,s=zp(e,a))}if(s===jh){var o=ip;throw Xp(e,0),Gp(e,r),Op(e,ci()),o}if(s===Kh)Gp(e,r);else{var l=!Fr(0,r),u=e.current.alternate;if(l&&!function(e){var t=e;for(;;){if(t.flags&Z){var n=t.updateQueue;if(null!==n){var r=n.stores;if(null!==r)for(var i=0;i<r.length;i++){var s=r[i],a=s.getSnapshot,o=s.value;try{if(!Vi(a(),o))return!1}catch(e){return!1}}}}var l=t.child;if(t.subtreeFlags&Z&&null!==l)l.return=t,t=l;else{if(t===e)return!0;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(u)){if((s=Jp(e,r))===qh){var c=Lr(e);0!==c&&(r=c,s=zp(e,c))}if(s===jh){var d=ip;throw Xp(e,0),Gp(e,r),Op(e,ci()),d}}e.finishedWork=u,e.finishedLanes=r,function(e,t,n){switch(t){case Wh:case jh:throw new Error("Root did not complete. This is a bug in React.");case qh:sf(e,up);break;case Xh:if(Gp(e,n),Dr(n)&&!Ef()){var r=cp+dp-ci();if(r>10){if(0!==Pr(e,0))break;var i=e.suspendedLanes;if(!Hr(i,n)){Pp(),Yr(e,i);break}e.timeoutHandle=Le(sf.bind(null,e,up),r);break}}sf(e,up);break;case $h:if(Gp(e,n),function(e){return(e&tr)===e}(n))break;if(!Ef()){var s=function(e,t){for(var n=e.eventTimes,r=Ar;t>0;){var i=zr(t),s=1<<i,a=n[i];a>r&&(r=a),t&=~s}return r}(e,n),a=s,o=ci()-a,l=((u=o)<120?120:u<480?480:u<1080?1080:u<1920?1920:u<3e3?3e3:u<4320?4320:1960*Fh(u/1960))-o;if(l>10){e.timeoutHandle=Le(sf.bind(null,e,up),l);break}}sf(e,up);break;case Yh:sf(e,up);break;default:throw new Error("Unknown root exit status.")}var u}(e,s,r)}}return Op(e,ci()),e.callbackNode===n?kp.bind(null,e):null}function zp(e,t){var n=lp;$i(e)&&(Xp(e,t).flags|=q,cn(e.containerInfo));var r=Jp(e,t);if(r!==qh){var i=up;up=n,null!==i&&Vp(i)}return r}function Vp(e){null===up?up=e:up.push.apply(up,e)}function Gp(e,t){t=jr(t,op),function(e,t){e.suspendedLanes|=t,e.pingedLanes&=~t;for(var n=e.expirationTimes,r=t;r>0;){var i=zr(r),s=1<<i;n[i]=Ar,r&=~s}}(e,t=jr(t,ap))}function Hp(e){if(Lu=Uu,Uu=!1,(Qh&(Gh|Hh))!==Vh)throw new Error("Should not already be working.");af();var t=Pr(e,0);if(!Gr(t,1))return Op(e,ci()),null;var n=Jp(e,t);if(0!==e.tag&&n===qh){var r=Lr(e);0!==r&&(t=r,n=zp(e,r))}if(n===jh){var i=ip;throw Xp(e,0),Gp(e,t),Op(e,ci()),i}if(n===Kh)throw new Error("Root did not complete. This is a bug in React.");var s=e.current.alternate;return e.finishedWork=s,e.finishedLanes=t,sf(e,up),Op(e,ci()),null}function Wp(e){null!==xp&&0===xp.tag&&(Qh&(Gh|Hh))===Vh&&af();var t=Qh;Qh|=1;var n=kh.transition,r=ni();try{return kh.transition=null,ri(1),e?e():void 0}finally{ri(r),kh.transition=n,((Qh=t)&(Gh|Hh))===Vh&&Xi()}}function jp(e,t){Ln(np,tp,e),tp=Wr(tp,t)}function qp(e){tp=np.current,In(np,e)}function Xp(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==De&&(e.timeoutHandle=De,Ue(n)),null!==Jh)for(var r=Jh.return;null!==r;){r.alternate;id(0,r),r=r.return}Zh=e;var i=jf(e.current,null);return Jh=i,ep=tp=t,rp=Wh,ip=null,sp=0,ap=0,op=0,lp=null,up=null,function(){if(null!==Fs){for(var e=0;e<Fs.length;e++){var t=Fs[e],n=t.interleaved;if(null!==n){t.interleaved=null;var r=n.next,i=t.pending;if(null!==i){var s=i.next;i.next=r,n.next=s}t.pending=n}}Fs=null}}(),as.discardPendingWarnings(),i}function $p(e,t){for(;;){var n=Jh;try{if(As(),yl(),rs(),Oh.current=null,null===n||null===n.return)return rp=jh,ip=t,void(Jh=null);2&n.mode&&zu(n,!0),Ai(),null!==t&&"object"==typeof t&&"function"==typeof t.then?Bi(n,t,ep):Fi(n,t,ep),ic(e,n.return,n,t,ep),rf(n)}catch(e){t=e,Jh===n&&null!==n?(n=n.return,Jh=n):n=Jh;continue}return}}function Yp(){var e=Bh.current;return Bh.current=yu,null===e?yu:e}function Kp(e){Bh.current=e}function Qp(e){sp=Wr(e,sp)}function Zp(){rp!==Wh&&rp!==Xh&&rp!==qh||(rp=$h),null!==Zh&&(Ur(sp)||Ur(ap))&&Gp(Zh,ep)}function Jp(e,t){var n=Qh;Qh|=Gh;var r=Yp();if(Zh!==e||ep!==t){if(bi){var i=e.memoizedUpdaters;i.size>0&&(Sf(e,ep),i.clear()),Zr(e,t)}Xp(e,t)}for(Oi(t);;)try{ef();break}catch(t){$p(e,t)}if(As(),Qh=n,Kp(r),null!==Jh)throw new Error("Cannot commit an incomplete root. This error is likely caused by a bug in React. Please file an issue.");return ki(),Zh=null,ep=0,rp}function ef(){for(;null!==Jh;)nf(Jh)}function tf(){for(;null!==Jh&&!li();)nf(Jh)}function nf(e){var t,n=e.alternate;is(e),2&e.mode?(Ou(e),t=vf(n,e,tp),zu(e,!0)):t=vf(n,e,tp),rs(),e.memoizedProps=e.pendingProps,null===t?rf(e):Jh=t,Oh.current=null}function rf(e){var t=e;do{var n=t.alternate,r=t.return;if(0===(t.flags&J)){is(t);var i=void 0;if(2&t.mode?(Ou(t),i=dc(n,t,tp),zu(t,!1)):i=dc(n,t,tp),rs(),null!==i)return void(Jh=i)}else{var s=rd(0,t);if(null!==s)return s.flags&=32767,void(Jh=s);if(2&t.mode){zu(t,!1);for(var a=t.actualDuration,o=t.child;null!==o;)a+=o.actualDuration,o=o.sibling;t.actualDuration=a}if(null===r)return rp=Kh,void(Jh=null);r.flags|=J,r.subtreeFlags=0,r.deletions=null}var l=t.sibling;if(null!==l)return void(Jh=l);Jh=t=r}while(null!==t);rp===Wh&&(rp=Yh)}function sf(e,t){var n=ni(),r=kh.transition;try{kh.transition=null,ri(1),function(e,t,n){do{af()}while(null!==xp);if(function(){as.flushLegacyContextWarning(),as.flushPendingUnsafeLifecycleWarnings()}(),(Qh&(Gh|Hh))!==Vh)throw new Error("Should not already be working.");var r=e.finishedWork,i=e.finishedLanes;if(function(e){null!==_i&&"function"==typeof _i.markCommitStarted&&_i.markCommitStarted(e)}(i),null===r)return Mi(),null;0===i&&l("root.finishedLanes should not be empty during a commit. This is a bug in React.");if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw new Error("Cannot commit the same tree as before. This error is likely caused by a bug in React. Please file an issue.");e.callbackNode=null,e.callbackPriority=0;var s=Wr(r.lanes,r.childLanes);(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t;for(var r=e.entanglements,i=e.eventTimes,s=e.expirationTimes,a=n;a>0;){var o=zr(a),l=1<<o;r[o]=0,i[o]=Ar,s[o]=Ar,a&=~l}})(e,s),e===Zh&&(Zh=null,Jh=null,ep=0);0===(r.subtreeFlags&ce)&&0===(r.flags&ce)||_p||(_p=!0,wf(pi,function(){return af(),null}));var a=!!(15990&r.subtreeFlags),o=!!(15990&r.flags);if(a||o){var u=kh.transition;kh.transition=null;var c=ni();ri(1);var d=Qh;Qh|=Hh,Oh.current=null,Rd(e,r),Bu(),Qd(e,r,i),Ee(e.containerInfo),e.current=r,function(e){null!==_i&&"function"==typeof _i.markLayoutEffectsStarted&&_i.markLayoutEffectsStarted(e)}(i),eh(r,e,i),null!==_i&&"function"==typeof _i.markLayoutEffectsStopped&&_i.markLayoutEffectsStopped(),ui(),Qh=d,ri(c),kh.transition=u}else e.current=r,Bu();var h=_p;_p&&(_p=!1,xp=e,bp=i);s=e.pendingLanes,0===s&&(yp=null);h||mf(e.current,!1);(function(e,t){if(yi&&"function"==typeof yi.onCommitFiberRoot)try{var n,r=(e.current.flags&j)===j;switch(t){case 1:n=di;break;case 4:n=hi;break;case Jr:n=pi;break;case ei:n=fi;break;default:n=pi}yi.onCommitFiberRoot(vi,e,n,r)}catch(e){xi||(xi=!0,l("React instrumentation encountered an error: %s",e))}})(r.stateNode,n),bi&&e.memoizedUpdaters.clear();if(function(){Xe&&Lh.forEach(function(e){return e()})}(),Op(e,ci()),null!==t)for(var p=e.onRecoverableError,f=0;f<t.length;f++){p(t[f])}if(gp){gp=!1;var m=vp;throw vp=null,m}Gr(bp,1)&&0!==e.tag&&af();s=e.pendingLanes,Gr(s,1)?(Uu=!0,e===Mp?wp++:(wp=0,Mp=e)):wp=0;Xi(),Mi()}(e,t,n)}finally{kh.transition=r,ri(n)}return null}function af(){if(null!==xp){var e=si(bp),t=(s=e,0===(i=Jr)||i>s?i:s),n=kh.transition,r=ni();try{return kh.transition=null,ri(t),function(){if(null===xp)return!1;var e=xp,t=bp;if(xp=null,bp=0,(Qh&(Gh|Hh))!==Vh)throw new Error("Cannot flush passive effects while already rendering.");!function(e){null!==_i&&"function"==typeof _i.markPassiveEffectsStarted&&_i.markPassiveEffectsStarted(e)}(t);var n=Qh;Qh|=Hh,ch(e.current),oh(e,e.current);var r=Sp;Sp=[];for(var i=0;i<r.length;i++){Ud(0,r[i])}null!==_i&&"function"==typeof _i.markPassiveEffectsStopped&&_i.markPassiveEffectsStopped(),mf(e.current,!0),Qh=n,Xi(),Ap=null===xp?0:Ap+1,function(e){if(yi&&"function"==typeof yi.onPostCommitFiberRoot)try{yi.onPostCommitFiberRoot(vi,e)}catch(e){xi||(xi=!0,l("React instrumentation encountered an error: %s",e))}}(e);var s=e.current.stateNode;return s.effectDuration=0,s.passiveEffectDuration=0,!0}()}finally{ri(r),kh.transition=n}}var i,s;return!1}function of(e){return null!==yp&&yp.has(e)}var lf=function(e){gp||(gp=!0,vp=e)};function uf(e,t,n){qs(e,Ju(e,qu(n,t),1));var r=Pp(),i=Fp(e,1);null!==i&&($r(i,1,r),Op(i,r))}function cf(e,t,n){if(3!==e.tag){var r=null;for(r=t;null!==r;){if(3===r.tag)return void uf(r,e,n);if(1===r.tag){var i=r.type,s=r.stateNode;if("function"==typeof i.getDerivedStateFromError||"function"==typeof s.componentDidCatch&&!of(s)){qs(r,ec(r,qu(n,e),1));var a=Pp(),o=Fp(r,1);return void(null!==o&&($r(o,1,a),Op(o,a)))}}r=r.return}l("Internal React error: Attempted to capture a commit phase error inside a detached tree. This indicates a bug in React. Likely causes include deleting the same fiber more than once, committing an already-finished tree, or an inconsistent return pointer.\n\nError message:\n\n%s",n)}else uf(e,e,n)}function df(e,t,n){var r=e.pingCache;null!==r&&r.delete(t);var i=Pp();Yr(e,n),function(e){0!==e.tag&&Dh()&&null===zh.current&&l("A suspended resource finished loading inside a test, but the event was not wrapped in act(...).\n\nWhen testing, code that resolves suspended data should be wrapped into act(...):\n\nact(() => {\n  /* finish loading suspended data */\n});\n/* assert on the output */\n\nThis ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act")}(e),Zh===e&&Hr(ep,n)&&(rp===$h||rp===Xh&&Dr(ep)&&ci()-cp<dp?Xp(e,0):op=Wr(op,n)),Op(e,i)}function hf(e,t){0===t&&(t=Up(e));var n=Pp(),r=Fp(e,t);null!==r&&($r(r,t,n),Op(r,n))}function pf(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),hf(e,n)}function ff(e,t){var n,r=0;switch(e.tag){case v:n=e.stateNode;var i=e.memoizedState;null!==i&&(r=i.retryLane);break;case S:n=e.stateNode;break;default:throw new Error("Pinged unknown suspense boundary type. This is probably a bug in React.")}null!==n&&n.delete(t),hf(e,r)}function mf(e,t){is(e),gf(e,se,xh),t&&gf(e,ae,bh),gf(e,se,yh),t&&gf(e,ae,_h),rs()}function gf(e,t,n){for(var r=e,i=null;null!==r;){var s=r.subtreeFlags&t;r!==i&&null!==r.child&&0!==s?r=r.child:(0!==(r.flags&t)&&n(r),r=null!==r.sibling?r.sibling:i=r.return)}}var vf,yf=null;function _f(e){if((Qh&Gh)===Vh&&1&e.mode){var t=e.tag;if(2===t||3===t||1===t||0===t||t===m||t===y||t===_){var n=H(e)||"ReactComponent";if(null!==yf){if(yf.has(n))return;yf.add(n)}else yf=new Set([n]);var r=es;try{is(e),l("Can't perform a React state update on a component that hasn't mounted yet. This indicates that you have a side-effect in your render function that asynchronously later calls tries to update the component. Move this work to useEffect instead.")}finally{r?is(e):rs()}}}}vf=function(e,t,n){var r=Jf(null,t);try{return nd(e,t,n)}catch(s){if(null!==s&&"object"==typeof s&&"function"==typeof s.then)throw s;if(As(),yl(),id(0,t),Jf(t,r),2&t.mode&&Ou(t),hd(null,nd,null,e,t,n),ud){var i=pd();"object"==typeof i&&null!==i&&i._suppressLogging&&"object"==typeof s&&null!==s&&!s._suppressLogging&&(s._suppressLogging=!0)}throw s}};var xf,bf=!1;function Sf(e,t){bi&&e.memoizedUpdaters.forEach(function(n){Qr(e,n,t)})}xf=new Set;var Tf={};function wf(e,t){var n=zh.current;return null!==n?(n.push(t),Tf):ai(e,t)}function Mf(e){if(e!==Tf)return oi(e)}function Ef(){return null!==zh.current}var Af=null,Cf=null,Rf=function(e){Af=e};function Nf(e){if(null===Af)return e;var t=Af(e);return void 0===t?e:t.current}function Pf(e){return Nf(e)}function If(e){if(null===Af)return e;var t=Af(e);if(void 0===t){if(null!=e&&"function"==typeof e.render){var n=Nf(e.render);if(e.render!==n){var r={$$typeof:I,render:n};return void 0!==e.displayName&&(r.displayName=e.displayName),r}}return e}return t.current}function Lf(e,t){if(null===Af)return!1;var n=e.elementType,r=t.type,i=!1,s="object"==typeof r&&null!==r?r.$$typeof:null;switch(e.tag){case 1:"function"==typeof r&&(i=!0);break;case 0:("function"==typeof r||s===F)&&(i=!0);break;case m:(s===I||s===F)&&(i=!0);break;case y:case _:(s===D||s===F)&&(i=!0);break;default:return!1}if(i){var a=Af(n);if(void 0!==a&&a===Af(r))return!0}return!1}function Uf(e){null!==Af&&"function"==typeof WeakSet&&(null===Cf&&(Cf=new WeakSet),Cf.add(e))}var Df=function(e,t){if(null!==Af){var n=t.staleFamilies,r=t.updatedFamilies;af(),Wp(function(){Bf(e.current,r,n)})}},Ff=function(e,t){e.context===Un&&(af(),Wp(function(){sm(t,e,null,null)}))};function Bf(e,t,n){var r=e.alternate,i=e.child,s=e.sibling,a=e.tag,o=e.type,l=null;switch(a){case 0:case _:case 1:l=o;break;case m:l=o.render}if(null===Af)throw new Error("Expected resolveFamily to be set during hot reload.");var u=!1,c=!1;if(null!==l){var d=Af(l);void 0!==d&&(n.has(d)?c=!0:t.has(d)&&(1===a?c=!0:u=!0))}null!==Cf&&(Cf.has(e)||null!==r&&Cf.has(r))&&(c=!0),c&&(e._debugNeedsRemount=!0),(c||u)&&Dp(e,1,Ar),null===i||c||Bf(i,t,n),null!==s&&Bf(s,t,n)}var Of,kf=function(e,t){var n=new Set,r=new Set(t.map(function(e){return e.current}));return zf(e.current,r,n),n};function zf(e,t,n){var r=e.child,i=e.sibling,s=e.tag,a=e.type,o=null;switch(s){case 0:case _:case 1:o=a;break;case m:o=a.render}var l=!1;null!==o&&t.has(o)&&(l=!0),l?function(e,t){var n=function(e,t){var n=e,r=!1;for(;;){if(5===n.tag)r=!0,t.add(n.stateNode);else if(null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)return r;for(;null===n.sibling;){if(null===n.return||n.return===e)return r;n=n.return}n.sibling.return=n.return,n=n.sibling}return!1}(e,t);if(n)return;var r=e;for(;;){switch(r.tag){case 5:return void t.add(r.stateNode);case 4:case 3:return void t.add(r.stateNode.containerInfo)}if(null===r.return)throw new Error("Expected to reach root first.");r=r.return}}(e,n):null!==r&&zf(r,t,n),null!==i&&zf(i,t,n)}Of=!1;try{var Vf=Object.preventExtensions({});new Map([[Vf,null]]),new Set([Vf])}catch(e){Of=!0}function Gf(e,t,n,r){this.tag=e,this.key=n,this.elementType=null,this.type=null,this.stateNode=null,this.return=null,this.child=null,this.sibling=null,this.index=0,this.ref=null,this.pendingProps=t,this.memoizedProps=null,this.updateQueue=null,this.memoizedState=null,this.dependencies=null,this.mode=r,this.flags=0,this.subtreeFlags=0,this.deletions=null,this.lanes=0,this.childLanes=0,this.alternate=null,this.actualDuration=Number.NaN,this.actualStartTime=Number.NaN,this.selfBaseDuration=Number.NaN,this.treeBaseDuration=Number.NaN,this.actualDuration=0,this.actualStartTime=-1,this.selfBaseDuration=0,this.treeBaseDuration=0,this._debugSource=null,this._debugOwner=null,this._debugNeedsRemount=!1,this._debugHookTypes=null,Of||"function"!=typeof Object.preventExtensions||Object.preventExtensions(this)}var Hf=function(e,t,n,r){return new Gf(e,t,n,r)};function Wf(e){var t=e.prototype;return!(!t||!t.isReactComponent)}function jf(e,t){var n=e.alternate;null===n?((n=Hf(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n._debugSource=e._debugSource,n._debugOwner=e._debugOwner,n._debugHookTypes=e._debugHookTypes,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null,n.actualDuration=0,n.actualStartTime=-1),n.flags=e.flags&de,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue;var r=e.dependencies;switch(n.dependencies=null===r?null:{lanes:r.lanes,firstContext:r.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.selfBaseDuration=e.selfBaseDuration,n.treeBaseDuration=e.treeBaseDuration,n._debugNeedsRemount=e._debugNeedsRemount,n.tag){case 2:case 0:case _:n.type=Nf(e.type);break;case 1:n.type=Pf(e.type);break;case m:n.type=If(e.type)}return n}function qf(e,t){e.flags&=14680066;var n=e.alternate;if(null===n)e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null,e.selfBaseDuration=0,e.treeBaseDuration=0;else{e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type;var r=n.dependencies;e.dependencies=null===r?null:{lanes:r.lanes,firstContext:r.firstContext},e.selfBaseDuration=n.selfBaseDuration,e.treeBaseDuration=n.treeBaseDuration}return e}function Xf(e,t,n,r,i,s){var a=2,o=e;if("function"==typeof e)Wf(e)?(a=1,o=Pf(o)):o=Nf(o);else if("string"==typeof e)a=5;else e:switch(e){case A:return Yf(n.children,i,s,t);case C:a=8,1&(i|=8)&&(i|=Kn);break;case R:return function(e,t,n,r){"string"!=typeof e.id&&l('Profiler must specify an "id" of type `string` as a prop. Received the type `%s` instead.',typeof e.id);var i=Hf(g,e,r,2|t);return i.elementType=R,i.lanes=n,i.stateNode={effectDuration:0,passiveEffectDuration:0},i}(n,i,s,t);case L:return function(e,t,n,r){var i=Hf(v,e,r,t);return i.elementType=L,i.lanes=n,i}(n,i,s,t);case U:return function(e,t,n,r){var i=Hf(S,e,r,t);return i.elementType=U,i.lanes=n,i}(n,i,s,t);case B:return Kf(n,i,s,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case N:a=f;break e;case P:a=9;break e;case I:a=m,o=If(o);break e;case D:a=y;break e;case F:a=16,o=null;break e}var u="";(void 0===e||"object"==typeof e&&null!==e&&0===Object.keys(e).length)&&(u+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var c=r?H(r):null;throw c&&(u+="\n\nCheck the render method of `"+c+"`."),new Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: "+(null==e?e:typeof e)+"."+u)}var d=Hf(a,n,t,i);return d.elementType=e,d.type=o,d.lanes=s,d._debugOwner=r,d}function $f(e,t,n){var r;r=e._owner;var i=Xf(e.type,e.key,e.props,r,t,n);return i._debugSource=e._source,i._debugOwner=e._owner,i}function Yf(e,t,n,r){var i=Hf(7,e,r,t);return i.lanes=n,i}function Kf(e,t,n,r){var i=Hf(T,e,r,t);i.elementType=B,i.lanes=n;return i.stateNode={},i}function Qf(e,t,n){var r=Hf(6,e,null,t);return r.lanes=n,r}function Zf(e,t,n){var r=null!==e.children?e.children:[],i=Hf(4,r,e.key,t);return i.lanes=n,i.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},i}function Jf(e,t){return null===e&&(e=Hf(2,null,null,0)),e.tag=t.tag,e.key=t.key,e.elementType=t.elementType,e.type=t.type,e.stateNode=t.stateNode,e.return=t.return,e.child=t.child,e.sibling=t.sibling,e.index=t.index,e.ref=t.ref,e.pendingProps=t.pendingProps,e.memoizedProps=t.memoizedProps,e.updateQueue=t.updateQueue,e.memoizedState=t.memoizedState,e.dependencies=t.dependencies,e.mode=t.mode,e.flags=t.flags,e.subtreeFlags=t.subtreeFlags,e.deletions=t.deletions,e.lanes=t.lanes,e.childLanes=t.childLanes,e.alternate=t.alternate,e.actualDuration=t.actualDuration,e.actualStartTime=t.actualStartTime,e.selfBaseDuration=t.selfBaseDuration,e.treeBaseDuration=t.treeBaseDuration,e._debugSource=t._debugSource,e._debugOwner=t._debugOwner,e._debugNeedsRemount=t._debugNeedsRemount,e._debugHookTypes=t._debugHookTypes,e}function em(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.pendingChildren=null,this.current=null,this.pingCache=null,this.finishedWork=null,this.timeoutHandle=De,this.context=null,this.pendingContext=null,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Xr(0),this.expirationTimes=Xr(Ar),this.pendingLanes=0,this.suspendedLanes=0,this.pingedLanes=0,this.expiredLanes=0,this.mutableReadLanes=0,this.finishedLanes=0,this.entangledLanes=0,this.entanglements=Xr(0),this.identifierPrefix=r,this.onRecoverableError=i,ze&&(this.mutableSourceEagerHydrationData=null),this.effectDuration=0,this.passiveEffectDuration=0,this.memoizedUpdaters=new Set;for(var s=this.pendingUpdatersLaneMap=[],a=0;a<31;a++)s.push(new Set);switch(t){case 1:this._debugRootType=n?"hydrateRoot()":"createRoot()";break;case 0:this._debugRootType=n?"hydrate()":"render()"}}function tm(e,t,n,r,i,s,a,o,l,u){var c=new em(e,t,n,o,l),d=function(e,t){var n;return 1===e?(n=1,!0===t&&(n|=8,n|=Kn)):n=0,bi&&(n|=2),Hf(3,null,null,n)}(t,s);c.current=d,d.stateNode=c;var h={element:r,isDehydrated:n,cache:null,transitions:null};return d.memoizedState=h,Hs(d),c}var nm,rm;function im(e){if(!e)return Un;var t=d(e),n=Yn(t);if(1===t.tag){var r=t.type;if(Gn(r))return qn(t,r,n)}return n}function sm(e,t,n,r){!function(e,t){if(yi&&"function"==typeof yi.onScheduleFiberRoot)try{yi.onScheduleFiberRoot(vi,e,t)}catch(e){xi||(xi=!0,l("React instrumentation encountered an error: %s",e))}}(t,e);var i=t.current,s=Pp(),a=Ip(i);!function(e){null!==_i&&"function"==typeof _i.markRenderScheduled&&_i.markRenderScheduled(e)}(a);var o=im(n);null===t.context?t.context=o:t.pendingContext=o,ts&&null!==es&&!nm&&(nm=!0,l("Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate.\n\nCheck the render method of %s.",H(es)||"Unknown"));var u=js(s,a);u.payload={element:e},null!==(r=void 0===r?null:r)&&("function"!=typeof r&&l("render(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",r),u.callback=r),qs(i,u);var c=Dp(i,a,s);return null!==c&&Xs(c,i,a),a}function am(e,t){var n,r,i=e.memoizedState;null!==i&&null!==i.dehydrated&&(i.retryLane=(n=i.retryLane,r=t,0!==n&&n<r?n:r))}function om(e,t){am(e,t);var n=e.alternate;n&&am(n,t)}nm=!1,rm={};var lm=function(e){return null};function um(e){return lm(e)}var cm=function(e){return!1};function dm(e){return cm(e)}var hm,pm,fm,mm,gm,vm,ym,_m,xm,bm=function(e,t,n){var r=t[n],i=be(e)?e.slice():c({},e);return n+1===t.length?(be(i)?i.splice(r,1):delete i[r],i):(i[r]=bm(e[r],t,n+1),i)},Sm=function(e,t){return bm(e,t,0)},Tm=function(e,t,n,r){var i=t[r],s=be(e)?e.slice():c({},e);r+1===t.length?(s[n[r]]=s[i],be(s)?s.splice(i,1):delete s[i]):s[i]=Tm(e[i],t,n,r+1);return s},wm=function(e,t,n){if(t.length===n.length){for(var r=0;r<n.length-1;r++)if(t[r]!==n[r])return void o("copyWithRename() expects paths to be the same except for the deepest key");return Tm(e,t,n,0)}o("copyWithRename() expects paths of the same length")},Mm=function(e,t,n,r){if(n>=t.length)return r;var i=t[n],s=be(e)?e.slice():c({},e);return s[i]=Mm(e[i],t,n+1,r),s},Em=function(e,t,n){return Mm(e,t,0,n)},Am=function(e,t){for(var n=e.memoizedState;null!==n&&t>0;)n=n.next,t--;return n};function Cm(e){var t=ge(e);return null===t?null:t.stateNode}function Rm(e){return null}function Nm(){return es}return hm=function(e,t,n,r){var i=Am(e,t);if(null!==i){var s=Em(i.memoizedState,n,r);i.memoizedState=s,i.baseState=s,e.memoizedProps=c({},e.memoizedProps),Dp(e,1,Ar)}},pm=function(e,t,n){var r=Am(e,t);if(null!==r){var i=Sm(r.memoizedState,n);r.memoizedState=i,r.baseState=i,e.memoizedProps=c({},e.memoizedProps),Dp(e,1,Ar)}},fm=function(e,t,n,r){var i=Am(e,t);if(null!==i){var s=wm(i.memoizedState,n,r);i.memoizedState=s,i.baseState=s,e.memoizedProps=c({},e.memoizedProps),Dp(e,1,Ar)}},mm=function(e,t,n){e.pendingProps=Em(e.memoizedProps,t,n),e.alternate&&(e.alternate.pendingProps=e.pendingProps),Dp(e,1,Ar)},gm=function(e,t){e.pendingProps=Sm(e.memoizedProps,t),e.alternate&&(e.alternate.pendingProps=e.pendingProps),Dp(e,1,Ar)},vm=function(e,t,n){e.pendingProps=wm(e.memoizedProps,t,n),e.alternate&&(e.alternate.pendingProps=e.pendingProps),Dp(e,1,Ar)},ym=function(e){Dp(e,1,Ar)},_m=function(e){lm=e},xm=function(e){cm=e},n.attemptContinuousHydration=function(e){if(e.tag===v){var t=Pp(),n=br;Dp(e,n,t),om(e,n)}},n.attemptHydrationAtCurrentPriority=function(e){if(e.tag===v){var t=Pp(),n=Ip(e);Dp(e,n,t),om(e,n)}},n.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if($i(t)){var n=function(e){return Nr(e.pendingLanes)}(t);!function(e,t){0!==t&&(Kr(e,Wr(t,1)),Op(e,ci()),(Qh&(Gh|Hh))===Vh&&(fp(),Xi()))}(t,n)}break;case v:var r=Pp();Wp(function(){return Dp(e,1,r)});om(e,1)}},n.batchedUpdates=function(e,t){var n=Qh;Qh|=1;try{return e(t)}finally{(Qh=n)!==Vh||zh.isBatchingLegacy||(fp(),qi())}},n.createComponentSelector=function(e){return{$$typeof:Sh,value:e}},n.createContainer=function(e,t,n,r,i,s,a,o){return tm(e,t,!1,null,0,r,0,s,a)},n.createHasPseudoClassSelector=function(e){return{$$typeof:Th,value:e}},n.createHydrationContainer=function(e,t,n,r,i,s,a,o,l,u){var c=tm(n,r,!0,e,0,s,0,o,l);c.context=im(null);var d=c.current,h=Pp(),p=Ip(d),f=js(h,p);return f.callback=null!=t?t:null,qs(d,f),function(e,t,n){e.current.lanes=t,$r(e,t,n),Op(e,n)}(c,p,h),c},n.createPortal=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return function(e){if(ys(e))l("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",vs(e)),_s(e)}(r),{$$typeof:E,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}},n.createRoleSelector=function(e){return{$$typeof:wh,value:e}},n.createTestNameSelector=function(e){return{$$typeof:Mh,value:e}},n.createTextSelector=function(e){return{$$typeof:Eh,value:e}},n.deferredUpdates=function(e){var t=ni(),n=kh.transition;try{return kh.transition=null,ri(Jr),e()}finally{ri(t),kh.transition=n}},n.discreteUpdates=function(e,t,n,r,i){var s=ni(),a=kh.transition;try{return kh.transition=null,ri(1),e(t,n,r,i)}finally{ri(s),kh.transition=a,Qh===Vh&&fp()}},n.findAllNodes=Ih,n.findBoundingRects=function(e,t){if(!Xe)throw new Error("Test selector API is not supported by this renderer.");for(var n=Ih(e,t),r=[],i=0;i<n.length;i++)r.push(Ye(n[i]));for(var s=r.length-1;s>0;s--)for(var a=r[s],o=a.x,l=o+a.width,u=a.y,c=u+a.height,d=s-1;d>=0;d--)if(s!==d){var h=r[d],p=h.x,f=p+h.width,m=h.y,g=m+h.height;if(o>=p&&u>=m&&l<=f&&c<=g){r.splice(s,1);break}if(!(o!==p||a.width!==h.width||g<u||m>c)){m>u&&(h.height+=m-u,h.y=u),g<c&&(h.height=c-m),r.splice(s,1);break}if(!(u!==m||a.height!==h.height||f<o||p>l)){p>o&&(h.width+=p-o,h.x=o),f<l&&(h.width=l-p),r.splice(s,1);break}}return r},n.findHostInstance=function(e){var t=d(e);if(void 0===t){if("function"==typeof e.render)throw new Error("Unable to find node on an unmounted component.");var n=Object.keys(e).join(",");throw new Error("Argument appears to not be a ReactComponent. Keys: "+n)}var r=ge(t);return null===r?null:r.stateNode},n.findHostInstanceWithNoPortals=function(e){var t=ye(e);return null===t?null:t.stateNode},n.findHostInstanceWithWarning=function(e,t){var n=d(e);if(void 0===n){if("function"==typeof e.render)throw new Error("Unable to find node on an unmounted component.");var r=Object.keys(e).join(",");throw new Error("Argument appears to not be a ReactComponent. Keys: "+r)}var i=ge(n);if(null===i)return null;if(8&i.mode){var s=H(n)||"Component";if(!rm[s]){rm[s]=!0;var a=es;try{is(i),8&n.mode?l("%s is deprecated in StrictMode. %s was passed an instance of %s which is inside StrictMode. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",t,t,s):l("%s is deprecated in StrictMode. %s was passed an instance of %s which renders StrictMode children. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",t,t,s)}finally{a?is(a):rs()}}}return i.stateNode},n.flushControlled=function(e){var t=Qh;Qh|=1;var n=kh.transition,r=ni();try{kh.transition=null,ri(1),e()}finally{ri(r),kh.transition=n,(Qh=t)===Vh&&(fp(),Xi())}},n.flushPassiveEffects=af,n.flushSync=Wp,n.focusWithin=function(e,t){if(!Xe)throw new Error("Test selector API is not supported by this renderer.");for(var n=Ph(Ch(e),t),r=Array.from(n),i=0;i<r.length;){var s=r[i++];if(!Qe(s)){if(5===s.tag){var a=s.stateNode;if(Je(a))return!0}for(var o=s.child;null!==o;)r.push(o),o=o.sibling}}return!1},n.getCurrentUpdatePriority=ni,n.getFindAllNodesFailureDescription=function(e,t){if(!Xe)throw new Error("Test selector API is not supported by this renderer.");for(var n=0,r=[],i=[Ch(e),0],s=0;s<i.length;){var a=i[s++],o=i[s++],l=t[o];if((5!==a.tag||!Qe(a))&&(Rh(a,l)&&(r.push(Nh(l)),++o>n&&(n=o)),o<t.length))for(var u=a.child;null!==u;)i.push(u,o),u=u.sibling}if(n<t.length){for(var c=[],d=n;d<t.length;d++)c.push(Nh(t[d]));return"findAllNodes was able to match part of the selector:\n  "+r.join(" > ")+"\n\nNo matching component was found for:\n  "+c.join(" > ")}return null},n.getPublicRootInstance=function(e){var t=e.current;return t.child?5===t.child.tag?Se(t.child.stateNode):t.child.stateNode:null},n.injectIntoDevTools=function(e){var t=e.findFiberByHostInstance,n=s.ReactCurrentDispatcher;return function(e){if("undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled)return!0;if(!t.supportsFiber)return l("The installed version of React DevTools is too old and will not work with the current version of React. Please update React DevTools. https://reactjs.org/link/react-devtools"),!0;try{e=c({},e,{getLaneLabelMap:wi,injectProfilingHooks:Ti}),vi=t.inject(e),yi=t}catch(e){l("React instrumentation encountered an error: %s.",e)}return!!t.checkDCE}({bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:hm,overrideHookStateDeletePath:pm,overrideHookStateRenamePath:fm,overrideProps:mm,overridePropsDeletePath:gm,overridePropsRenamePath:vm,setErrorHandler:_m,setSuspenseHandler:xm,scheduleUpdate:ym,currentDispatcherRef:n,findHostInstanceByFiber:Cm,findFiberByHostInstance:t||Rm,findHostInstancesForRefresh:kf,scheduleRefresh:Df,scheduleRoot:Ff,setRefreshHandler:Rf,getCurrentFiber:Nm,reconcilerVersion:"18.0.0-fc46dba67-20220329"})},n.isAlreadyRendering=function(){return(Qh&(Gh|Hh))!==Vh},n.observeVisibleRects=function(e,t,n,r){if(!Xe)throw new Error("Test selector API is not supported by this renderer.");var i=Ih(e,t),s=et(i,n,r),a=s.disconnect,o=s.observe,l=s.unobserve,u=function(){var n=Ih(e,t);i.forEach(function(e){n.indexOf(e)<0&&l(e)}),n.forEach(function(e){i.indexOf(e)<0&&o(e)})};return Lh.push(u),{disconnect:function(){var e=Lh.indexOf(u);e>=0&&Lh.splice(e,1),a()}}},n.registerMutableSourceForHydration=function(e,t){var n=(0,t._getVersion)(t._source);null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},n.runWithPriority=function(e,t){var n=ti;try{return ti=e,t()}finally{ti=n}},n.shouldError=um,n.shouldSuspend=dm,n.updateContainer=sm,n})),Bp.exports}var kp=c((Fp||(Fp=1,"production"===process.env.NODE_ENV?wp.exports=Up():wp.exports=Op()),wp.exports)),zp=Lp();const Vp={},Gp=e=>{Object.assign(Vp,e)};var Hp,Wp;const jp=e=>"colorSpace"in e||"outputColorSpace"in e,qp=()=>{var e;return null!=(e=Vp.ColorManagement)?e:null},Xp=e=>e&&e.isOrthographicCamera,$p="undefined"!=typeof window&&(null!=(Hp=window.document)&&Hp.createElement||"ReactNative"===(null==(Wp=window.navigator)?void 0:Wp.product))?e.useLayoutEffect:e.useEffect;function Yp(t){const n=e.useRef(t);return $p(()=>{n.current=t},[t]),n}function Kp({set:e}){return $p(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Qp extends e.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}Qp.getDerivedStateFromError=()=>({error:!0});const Zp="__default",Jp=new Map,ef=e=>e&&!!e.memoized&&!!e.changes;function tf(e){var t;const n="undefined"!=typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const nf=e=>{var t;return null==(t=e.__r3f)?void 0:t.root.getState()};function rf(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const sf={obj:e=>e===Object(e)&&!sf.arr(e)&&"function"!=typeof e,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,boo:e=>"boolean"==typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:r="reference",strict:i=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(sf.str(e)||sf.num(e)||sf.boo(e))return e===t;const s=sf.obj(e);if(s&&"reference"===r)return e===t;const a=sf.arr(e);if(a&&"reference"===n)return e===t;if((a||s)&&e===t)return!0;let o;for(o in e)if(!(o in t))return!1;if(s&&"shallow"===n&&"shallow"===r){for(o in i?t:e)if(!sf.equ(e[o],t[o],{strict:i,objects:"reference"}))return!1}else for(o in i?t:e)if(e[o]!==t[o])return!1;if(sf.und(o)){if(a&&0===e.length&&0===t.length)return!0;if(s&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function af(e,t){return e.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function of(e,t){let n=e;if(t.includes("-")){const r=t.split("-"),i=r.pop();return n=r.reduce((e,t)=>e[t],e),{target:n,key:i}}return{target:n,key:t}}const lf=/-\d+$/;function uf(e,t,n){if(sf.str(n)){if(lf.test(n)){const t=n.replace(lf,""),{target:r,key:i}=of(e,t);Array.isArray(r[i])||(r[i]=[])}const{target:r,key:i}=of(e,n);t.__r3f.previousAttach=r[i],r[i]=t}else t.__r3f.previousAttach=n(e,t)}function cf(e,t,n){var r,i;if(sf.str(n)){const{target:r,key:i}=of(e,n),s=t.__r3f.previousAttach;void 0===s?delete r[i]:r[i]=s}else null==(r=t.__r3f)||null==r.previousAttach||r.previousAttach(e,t);null==(i=t.__r3f)||delete i.previousAttach}function df(e,{children:t,key:n,ref:r,...i},{children:s,key:a,ref:o,...l}={},u=!1){const c=e.__r3f,d=Object.entries(i),h=[];if(u){const e=Object.keys(l);for(let t=0;t<e.length;t++)i.hasOwnProperty(e[t])||d.unshift([e[t],Zp+"remove"])}d.forEach(([t,n])=>{var r;if(null!=(r=e.__r3f)&&r.primitive&&"object"===t)return;if(sf.equ(n,l[t]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(t))return h.push([t,n,!0,[]]);let s=[];t.includes("-")&&(s=t.split("-")),h.push([t,n,!1,s]);for(const e in i){const n=i[e];e.startsWith(`${t}-`)&&h.push([e,n,!1,e.split("-")])}});const p={...i};return null!=c&&c.memoizedProps&&null!=c&&c.memoizedProps.args&&(p.args=c.memoizedProps.args),null!=c&&c.memoizedProps&&null!=c&&c.memoizedProps.attach&&(p.attach=c.memoizedProps.attach),{memoized:p,changes:h}}const hf="undefined"!=typeof process&&"production"!==process.env.NODE_ENV;function pf(e,t){var n;const r=e.__r3f,i=null==r?void 0:r.root,s=null==i||null==i.getState?void 0:i.getState(),{memoized:a,changes:o}=ef(t)?t:df(e,t),l=null==r?void 0:r.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let t=0;t<o.length;t++){let[n,i,a,l]=o[t];if(jp(e)){const e=3001,t="srgb",r="srgb-linear";"encoding"===n?(n="colorSpace",i=i===e?t:r):"outputEncoding"===n&&(n="outputColorSpace",i=i===e?t:r)}let d=e,h=d[n];if(l.length&&(h=l.reduce((e,t)=>e[t],e),!h||!h.set)){const[t,...r]=l.reverse();d=r.reverse().reduce((e,t)=>e[t],e),n=t}if(i===Zp+"remove")if(d.constructor){let e=Jp.get(d.constructor);e||(e=new d.constructor,Jp.set(d.constructor,e)),i=e[n]}else i=0;if(a&&r)i?r.handlers[n]=i:delete r.handlers[n],r.eventCount=Object.keys(r.handlers).length;else if(h&&h.set&&(h.copy||h instanceof cr)){if(Array.isArray(i))h.fromArray?h.fromArray(i):h.set(...i);else if(h.copy&&i&&i.constructor&&(hf?h.constructor.name===i.constructor.name:h.constructor===i.constructor))h.copy(i);else if(void 0!==i){var u;const e=null==(u=h)?void 0:u.isColor;!e&&h.setScalar?h.setScalar(i):h instanceof cr&&i instanceof cr?h.mask=i.mask:h.set(i),!qp()&&s&&!s.linear&&e&&h.convertSRGBToLinear()}}else{var c;if(d[n]=i,null!=(c=d[n])&&c.isTexture&&d[n].format===_e&&d[n].type===se&&s){const e=d[n];jp(e)&&jp(s.gl)?e.colorSpace=s.gl.outputColorSpace:e.encoding=s.gl.outputEncoding}}ff(e)}if(r&&r.parent&&e.raycast&&l!==r.eventCount){const t=rf(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),r.eventCount&&t.interaction.push(e)}return!(1===o.length&&"onUpdate"===o[0][0])&&o.length&&null!=(n=e.__r3f)&&n.parent&&mf(e),e}function ff(e){var t,n;const r=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();r&&0===r.internal.frames&&r.invalidate()}function mf(e){null==e.onUpdate||e.onUpdate(e)}function gf(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function vf(e,t,n,r){const i=n.get(t);i&&(n.delete(t),0===n.size&&(e.delete(r),i.target.releasePointerCapture(r)))}function yf(e){function t(e){return e.filter(e=>["Move","Over","Enter","Out","Leave"].some(t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))}function n(t){const{internal:n}=e.getState();for(const e of n.hovered.values())if(!t.length||!t.find(t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId)){const r=e.eventObject.__r3f,i=null==r?void 0:r.handlers;if(n.hovered.delete(gf(e)),null!=r&&r.eventCount){const n={...e,intersections:t};null==i.onPointerOut||i.onPointerOut(n),null==i.onPointerLeave||i.onPointerLeave(n)}}}function r(e,t){for(let n=0;n<t.length;n++){const r=t[n].__r3f;null==r||null==r.handlers.onPointerMissed||r.handlers.onPointerMissed(e)}}return{handlePointer:function(i){switch(i){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return t=>{const{internal:r}=e.getState();"pointerId"in t&&r.capturedMap.has(t.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(t.pointerId)&&(r.capturedMap.delete(t.pointerId),n([]))})}}return function(s){const{onPointerMissed:a,internal:o}=e.getState();o.lastEvent.current=s;const l="onPointerMove"===i,u="onClick"===i||"onContextMenu"===i||"onDoubleClick"===i,c=function(t,n){const r=e.getState(),i=new Set,s=[],a=n?n(r.internal.interaction):r.internal.interaction;for(let e=0;e<a.length;e++){const t=nf(a[e]);t&&(t.raycaster.camera=void 0)}r.previousRoot||null==r.events.compute||r.events.compute(t,r);let o=a.flatMap(function(e){const n=nf(e);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(t,n,null==(r=n.previousRoot)?void 0:r.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]):[];var r}).sort((e,t)=>{const n=nf(e.object),r=nf(t.object);return n&&r&&r.events.priority-n.events.priority||e.distance-t.distance}).filter(e=>{const t=gf(e);return!i.has(t)&&(i.add(t),!0)});r.events.filter&&(o=r.events.filter(o,r));for(const e of o){let t=e.object;for(;t;){var l;null!=(l=t.__r3f)&&l.eventCount&&s.push({...e,eventObject:t}),t=t.parent}}if("pointerId"in t&&r.internal.capturedMap.has(t.pointerId))for(let e of r.internal.capturedMap.get(t.pointerId).values())i.has(gf(e.intersection))||s.push(e.intersection);return s}(s,l?t:void 0),d=u?function(t){const{internal:n}=e.getState(),r=t.offsetX-n.initialClick[0],i=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+i*i))}(s):0;"onPointerDown"===i&&(o.initialClick=[s.offsetX,s.offsetY],o.initialHits=c.map(e=>e.eventObject)),u&&!c.length&&d<=2&&(r(s,o.interaction),a&&a(s)),l&&n(c),function(t,r,i,s){const a=e.getState();if(t.length){const e={stopped:!1};for(const o of t){const l=nf(o.object)||a,{raycaster:u,pointer:c,camera:d,internal:h}=l,p=new Tn(c.x,c.y,0).unproject(d),f=e=>{var t,n;return null!=(t=null==(n=h.capturedMap.get(e))?void 0:n.has(o.eventObject))&&t},m=e=>{const t={intersection:o,target:r.target};h.capturedMap.has(e)?h.capturedMap.get(e).set(o.eventObject,t):h.capturedMap.set(e,new Map([[o.eventObject,t]])),r.target.setPointerCapture(e)},g=e=>{const t=h.capturedMap.get(e);t&&vf(h.capturedMap,o.eventObject,t,e)};let v={};for(let e in r){let t=r[e];"function"!=typeof t&&(v[e]=t)}let y={...o,...v,pointer:c,intersections:t,stopped:e.stopped,delta:i,unprojectedPoint:p,ray:u.ray,camera:d,stopPropagation(){const i="pointerId"in r&&h.capturedMap.get(r.pointerId);(!i||i.has(o.eventObject))&&(y.stopped=e.stopped=!0,h.hovered.size&&Array.from(h.hovered.values()).find(e=>e.eventObject===o.eventObject))&&n([...t.slice(0,t.indexOf(o)),o])},target:{hasPointerCapture:f,setPointerCapture:m,releasePointerCapture:g},currentTarget:{hasPointerCapture:f,setPointerCapture:m,releasePointerCapture:g},nativeEvent:r};if(s(y),!0===e.stopped)break}}}(c,s,d,function(e){const t=e.eventObject,n=t.__r3f,a=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(l){if(a.onPointerOver||a.onPointerEnter||a.onPointerOut||a.onPointerLeave){const t=gf(e),n=o.hovered.get(t);n?n.stopped&&e.stopPropagation():(o.hovered.set(t,e),null==a.onPointerOver||a.onPointerOver(e),null==a.onPointerEnter||a.onPointerEnter(e))}null==a.onPointerMove||a.onPointerMove(e)}else{const n=a[i];n?u&&!o.initialHits.includes(t)||(r(s,o.interaction.filter(e=>!o.initialHits.includes(e))),n(e)):u&&o.initialHits.includes(t)&&r(s,o.interaction.filter(e=>!o.initialHits.includes(e)))}})}}}}const _f=e=>!(null==e||!e.render),xf=e.createContext(null),bf=(t,s)=>{const a=function(e){const t="function"==typeof e?yp(e):e,s=(e=t.getState,s=Object.is)=>{const[,a]=n(e=>e+1,0),o=t.getState(),l=r(o),u=r(e),c=r(s),d=r(!1),h=r();let p;void 0===h.current&&(h.current=e(o));let f=!1;(l.current!==o||u.current!==e||c.current!==s||d.current)&&(p=e(o),f=!s(h.current,p)),_p(()=>{f&&(h.current=p),l.current=o,u.current=e,c.current=s,d.current=!1});const m=r(o);_p(()=>{const e=()=>{try{const e=t.getState(),n=u.current(e);c.current(h.current,n)||(l.current=e,h.current=n,a())}catch(e){d.current=!0,a()}},n=t.subscribe(e);return t.getState()!==m.current&&e(),n},[]);const g=f?p:h.current;return i(g),g};return Object.assign(s,t),s[Symbol.iterator]=function(){const e=[s,t];return{next(){const t=e.length<=0;return{value:e.shift(),done:t}}}},s}((n,r)=>{const i=new Tn,a=new Tn,o=new Tn;function l(e=r().camera,t=a,n=r().size){const{width:s,height:l,top:u,left:c}=n,d=s/l;t.isVector3?o.copy(t):o.set(...t);const h=e.getWorldPosition(i).distanceTo(o);if(Xp(e))return{width:s/e.zoom,height:l/e.zoom,top:u,left:c,factor:1,distance:h,aspect:d};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*h,r=n*(s/l);return{width:r,height:n,top:u,left:c,factor:s/r,distance:h,aspect:d}}}let u;const c=e=>n(t=>({performance:{...t.performance,current:e}})),d=new Xt,h={set:n,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(e=1)=>t(r(),e),advance:(e,t)=>s(e,t,r()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Nu,pointer:d,mouse:d,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const e=r();u&&clearTimeout(u),e.performance.current!==e.performance.min&&c(e.performance.min),u=setTimeout(()=>c(r().performance.max),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:e=>n(t=>({...t,events:{...t.events,...e}})),setSize:(e,t,i,s,o)=>{const u=r().camera,c={width:e,height:t,top:s||0,left:o||0,updateStyle:i};n(e=>({size:c,viewport:{...e.viewport,...l(u,a,c)}}))},setDpr:e=>n(t=>{const n=tf(e);return{viewport:{...t.viewport,dpr:n,initialDpr:t.viewport.initialDpr||n}}}),setFrameloop:(e="always")=>{const t=r().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),n(()=>({frameloop:e}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:e.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(e,t,n)=>{const i=r().internal;return i.priority=i.priority+(t>0?1:0),i.subscribers.push({ref:e,priority:t,store:n}),i.subscribers=i.subscribers.sort((e,t)=>e.priority-t.priority),()=>{const n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter(t=>t.ref!==e))}}}};return h}),o=a.getState();let l=o.size,u=o.viewport.dpr,c=o.camera;return a.subscribe(()=>{const{camera:e,size:t,viewport:n,gl:r,set:i}=a.getState();if(t.width!==l.width||t.height!==l.height||n.dpr!==u){var s;l=t,u=n.dpr,function(e,t){e.manual||(Xp(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}(e,t),r.setPixelRatio(n.dpr);const i=null!=(s=t.updateStyle)?s:"undefined"!=typeof HTMLCanvasElement&&r.domElement instanceof HTMLCanvasElement;r.setSize(t.width,t.height,i)}e!==c&&(c=e,i(t=>({viewport:{...t.viewport,...t.viewport.getCurrentViewport(e)}})))}),a.subscribe(e=>t(e)),a};let Sf,Tf,wf,Mf=new Set,Ef=new Set,Af=new Set;function Cf(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function Rf(e,t){switch(e){case"before":return Cf(Mf,t);case"after":return Cf(Ef,t);case"tail":return Cf(Af,t)}}function Nf(e,t,n){let r=t.clock.getDelta();for("never"===t.frameloop&&"number"==typeof e&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Tf=t.internal.subscribers,Sf=0;Sf<Tf.length;Sf++)wf=Tf[Sf],wf.ref.current(wf.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function Pf(){const t=e.useContext(xf);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function If(e=e=>e,t){return Pf()(e,t)}function Lf(e,t=0){const n=Pf(),r=n.getState().internal.subscribe,i=Yp(e);return $p(()=>r(i,t,n),[t,r,n]),null}const Uf=new WeakMap;function Df(e,t){return function(n,...r){let i=Uf.get(n);return i||(i=new n,Uf.set(n,i)),e&&e(i),Promise.all(r.map(e=>new Promise((n,r)=>i.load(e,e=>{e.scene&&Object.assign(e,function(e){const t={nodes:{},materials:{}};return e&&e.traverse(e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)}),t}(e.scene)),n(e)},t,t=>r(new Error(`Could not load ${e}: ${null==t?void 0:t.message}`))))))}}function Ff(e,t,n,r){const i=Array.isArray(t)?t:[t],s=((e,t,n)=>Sp(e,t,!1,n))(Df(n,r),[e,...i],{equal:sf.equ});return Array.isArray(t)?s:s[0]}Ff.preload=function(e,t,n){const r=Array.isArray(t)?t:[t];return((e,t,n)=>{Sp(e,t,!0,n)})(Df(n),[e,...r])},Ff.clear=function(e,t){return(e=>{if(void 0===e||0===e.length)xp.splice(0,xp.length);else{const t=xp.find(t=>bp(e,t.keys,t.equal));t&&t.remove()}})([e,...Array.isArray(t)?t:[t]])};const Bf=new Map,{invalidate:Of,advance:kf}=function(e){let t,n,r,i=!1,s=!1;function a(o){n=requestAnimationFrame(a),i=!0,t=0,Rf("before",o),s=!0;for(const n of e.values()){var l;r=n.store.getState(),!r.internal.active||!("always"===r.frameloop||r.internal.frames>0)||null!=(l=r.gl.xr)&&l.isPresenting||(t+=Nf(o,r))}if(s=!1,Rf("after",o),0===t)return Rf("tail",o),i=!1,cancelAnimationFrame(n)}return{loop:a,invalidate:function t(n,r=1){var o;if(!n)return e.forEach(e=>t(e.store.getState(),r));null!=(o=n.gl.xr)&&o.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=r>1?Math.min(60,n.internal.frames+r):s?2:1,i||(i=!0,requestAnimationFrame(a)))},advance:function(t,n=!0,r,i){if(n&&Rf("before",t),r)Nf(t,r,i);else for(const n of e.values())Nf(t,n.store.getState());n&&Rf("after",t)}}}(Bf),{reconciler:zf,applyProps:Vf}=function(e,t){function n(e,{args:t=[],attach:n,...r},i){let s,a=`${e[0].toUpperCase()}${e.slice(1)}`;if("primitive"===e){if(void 0===r.object)throw new Error("R3F: Primitives without 'object' are invalid!");s=af(r.object,{type:e,root:i,attach:n,primitive:!0})}else{const r=Vp[a];if(!r)throw new Error(`R3F: ${a} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(t))throw new Error("R3F: The args prop must be an array!");s=af(new r(...t),{type:e,root:i,attach:n,memoizedProps:{args:t}})}return void 0===s.__r3f.attach&&(s.isBufferGeometry?s.__r3f.attach="geometry":s.isMaterial&&(s.__r3f.attach="material")),"inject"!==a&&pf(s,r),s}function r(e,t){let n=!1;var r,i;t&&(null!=(r=t.__r3f)&&r.attach?uf(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),n=!0),n||null==(i=e.__r3f)||i.objects.push(t),t.__r3f||af(t,{}),t.__r3f.parent=e,mf(t),ff(t))}function i(e,t,n){let r=!1;if(t){var i,s;if(null!=(i=t.__r3f)&&i.attach)uf(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"}),e.dispatchEvent({type:"childadded",child:t});const i=e.children.filter(e=>e!==t),s=i.indexOf(n);e.children=[...i.slice(0,s),t,...i.slice(s)],r=!0}r||null==(s=e.__r3f)||s.objects.push(t),t.__r3f||af(t,{}),t.__r3f.parent=e,mf(t),ff(t)}}function s(e,t,n=!1){e&&[...e].forEach(e=>a(t,e,n))}function a(e,t,n){if(t){var r,i,a;if(t.__r3f&&(t.__r3f.parent=null),null!=(r=e.__r3f)&&r.objects&&(e.__r3f.objects=e.__r3f.objects.filter(e=>e!==t)),null!=(i=t.__r3f)&&i.attach)cf(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var o;e.remove(t),null!=(o=t.__r3f)&&o.root&&function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(e=>e!==t),n.initialHits=n.initialHits.filter(e=>e!==t),n.hovered.forEach((e,r)=>{e.eventObject!==t&&e.object!==t||n.hovered.delete(r)}),n.capturedMap.forEach((e,r)=>{vf(n.capturedMap,t,e,r)})}(rf(t),t)}const u=null==(a=t.__r3f)?void 0:a.primitive,c=!u&&(void 0===n?null!==t.dispose:n);var l;if(!u)s(null==(l=t.__r3f)?void 0:l.objects,t,c),s(t.children,t,c);if(delete t.__r3f,c&&t.dispose&&"Scene"!==t.type){const e=()=>{try{t.dispose()}catch(e){}};"undefined"==typeof IS_REACT_ACT_ENVIRONMENT?zp.unstable_scheduleCallback(zp.unstable_IdlePriority,e):e()}ff(e)}}const o=()=>{},l=kp({createInstance:n,removeChild:a,appendChild:r,appendInitialChild:r,insertBefore:i,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(e,t)=>{if(!t)return;const n=e.getState().scene;n.__r3f&&(n.__r3f.root=e,r(n,t))},removeChildFromContainer:(e,t)=>{t&&a(e.getState().scene,t)},insertInContainerBefore:(e,t,n)=>{if(!t||!n)return;const r=e.getState().scene;r.__r3f&&i(r,t,n)},getRootHostContext:()=>null,getChildHostContext:e=>e,finalizeInitialChildren(e){var t;const n=null!=(t=null==e?void 0:e.__r3f)?t:{};return Boolean(n.handlers)},prepareUpdate(e,t,n,r){var i;if((null!=(i=null==e?void 0:e.__r3f)?i:{}).primitive&&r.object&&r.object!==e)return[!0];{const{args:t=[],children:i,...s}=r,{args:a=[],children:o,...l}=n;if(!Array.isArray(t))throw new Error("R3F: the args prop must be an array!");if(t.some((e,t)=>e!==a[t]))return[!0];const u=df(e,s,l,!0);return u.changes.length?[!1,u]:null}},commitUpdate(e,[t,i],s,o,l,u){t?function(e,t,i,s){var o;const l=null==(o=e.__r3f)?void 0:o.parent;if(!l)return;const u=n(t,i,e.__r3f.root);if(e.children){for(const t of e.children)t.__r3f&&r(u,t);e.children=e.children.filter(e=>!e.__r3f)}e.__r3f.objects.forEach(e=>r(u,e)),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||a(l,e),u.parent&&(u.__r3f.autoRemovedBeforeAppend=!0),r(l,u),u.raycast&&u.__r3f.eventCount&&rf(u).getState().internal.interaction.push(u);[s,s.alternate].forEach(e=>{null!==e&&(e.stateNode=u,e.ref&&("function"==typeof e.ref?e.ref(u):e.ref.current=u))})}(e,s,l,u):pf(e,i)},commitMount(e,t,n,r){var i;const s=null!=(i=e.__r3f)?i:{};e.raycast&&s.handlers&&s.eventCount&&rf(e).getState().internal.interaction.push(e)},getPublicInstance:e=>e,prepareForCommit:()=>null,preparePortalMount:e=>af(e.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(e){var t;const{attach:n,parent:r}=null!=(t=e.__r3f)?t:{};n&&r&&cf(r,e,n),e.isObject3D&&(e.visible=!1),ff(e)},unhideInstance(e,t){var n;const{attach:r,parent:i}=null!=(n=e.__r3f)?n:{};r&&i&&uf(i,e,r),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),ff(e)},createTextInstance:o,hideTextInstance:o,unhideTextInstance:o,getCurrentEventPriority:()=>t?t():vp.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:"undefined"!=typeof performance&&sf.fun(performance.now)?performance.now:sf.fun(Date.now)?Date.now:()=>0,scheduleTimeout:sf.fun(setTimeout)?setTimeout:void 0,cancelTimeout:sf.fun(clearTimeout)?clearTimeout:void 0});return{reconciler:l,applyProps:pf}}(0,function(){var e;const t="undefined"!=typeof self&&self||"undefined"!=typeof window&&window;if(!t)return vp.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return vp.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return vp.ContinuousEventPriority;default:return vp.DefaultEventPriority}}),Gf={objects:"shallow",strict:!1},Hf=(e,t)=>{const n="function"==typeof e?e(t):e;return _f(n)?n:new up({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Wf(e){const t=Bf.get(e),n=null==t?void 0:t.fiber,r=null==t?void 0:t.store,i="function"==typeof reportError?reportError:console.error,s=r||bf(Of,kf),a=n||zf.createContainer(s,vp.ConcurrentRoot,null,!1,null,"",i,null);let o;t||Bf.set(e,{fiber:a,store:s});let l,c=!1;return{configure(t={}){let{gl:n,size:r,scene:i,events:a,onCreated:u,shadows:d=!1,linear:h=!1,flat:p=!1,legacy:f=!1,orthographic:m=!1,frameloop:g="always",dpr:v=[1,2],performance:y,raycaster:_,camera:x,onPointerMissed:b}=t,S=s.getState(),T=S.gl;S.gl||S.set({gl:T=Hf(n,e)});let w=S.raycaster;w||S.set({raycaster:w=new tc});const{params:M,...E}=_||{};if(sf.equ(E,w,Gf)||Vf(w,{...E}),sf.equ(M,w.params,Gf)||Vf(w,{params:{...w.params,...M}}),!S.camera||S.camera===l&&!sf.equ(l,x,Gf)){l=x;const e=x instanceof Di,t=e?x:m?new cu(0,0,0,0,.1,1e3):new ki(75,0,.1,1e3);e||(t.position.z=5,x&&(Vf(t,x),("aspect"in x||"left"in x||"right"in x||"bottom"in x||"top"in x)&&(t.manual=!0,t.updateProjectionMatrix())),S.camera||null!=x&&x.rotation||t.lookAt(0,0,0)),S.set({camera:t}),w.camera=t}if(!S.scene){let e;null!=i&&i.isScene?e=i:(e=new Yi,i&&Vf(e,i)),S.set({scene:af(e)})}if(!S.xr){var A;const e=(e,t)=>{const n=s.getState();"never"!==n.frameloop&&kf(e,!0,n,t)},t=()=>{const t=s.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||Of(t)},n={connect(){const e=s.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){const e=s.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"==typeof(null==(A=T.xr)?void 0:A.addEventListener)&&n.connect(),S.set({xr:n})}if(T.shadowMap){const e=T.shadowMap.enabled,t=T.shadowMap.type;if(T.shadowMap.enabled=!!d,sf.boo(d))T.shadowMap.type=2;else if(sf.str(d)){var C;const e={basic:0,percentage:1,soft:2,variance:3};T.shadowMap.type=null!=(C=e[d])?C:2}else sf.obj(d)&&Object.assign(T.shadowMap,d);e===T.shadowMap.enabled&&t===T.shadowMap.type||(T.shadowMap.needsUpdate=!0)}const R=qp();if(R&&("enabled"in R?R.enabled=!f:"legacyMode"in R&&(R.legacyMode=f)),!c){Vf(T,{outputEncoding:h?3e3:3001,toneMapping:p?0:4})}S.legacy!==f&&S.set(()=>({legacy:f})),S.linear!==h&&S.set(()=>({linear:h})),S.flat!==p&&S.set(()=>({flat:p})),!n||sf.fun(n)||_f(n)||sf.equ(n,T,Gf)||Vf(T,n),a&&!S.events.handlers&&S.set({events:a(s)});const N=function(e,t){const n="undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement;if(t){const{width:e,height:r,top:i,left:s,updateStyle:a=n}=t;return{width:e,height:r,top:i,left:s,updateStyle:a}}if("undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:t,height:r,top:i,left:s}=e.parentElement.getBoundingClientRect();return{width:t,height:r,top:i,left:s,updateStyle:n}}return"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0,updateStyle:n}:{width:0,height:0,top:0,left:0}}(e,r);return sf.equ(N,S.size,Gf)||S.setSize(N.width,N.height,N.updateStyle,N.top,N.left),v&&S.viewport.dpr!==tf(v)&&S.setDpr(v),S.frameloop!==g&&S.setFrameloop(g),S.onPointerMissed||S.set({onPointerMissed:b}),y&&!sf.equ(y,S.performance,Gf)&&S.set(e=>({performance:{...e.performance,...y}})),o=u,c=!0,this},render(t){return c||this.configure(),zf.updateContainer(u(jf,{store:s,children:t,onCreated:o,rootElement:e}),a,null,()=>{}),s},unmount(){qf(e)}}}function jf({store:e,children:t,onCreated:n,rootElement:r}){return $p(()=>{const t=e.getState();t.set(e=>({internal:{...e.internal,active:!0}})),n&&n(t),e.getState().events.connected||null==t.events.connect||t.events.connect(r)},[]),u(xf.Provider,{value:e,children:t})}function qf(e,t){const n=Bf.get(e),r=null==n?void 0:n.fiber;if(r){const i=null==n?void 0:n.store.getState();i&&(i.internal.active=!1),zf.updateContainer(null,r,null,()=>{i&&setTimeout(()=>{try{var n,r,s,a;null==i.events.disconnect||i.events.disconnect(),null==(n=i.gl)||null==(r=n.renderLists)||null==r.dispose||r.dispose(),null==(s=i.gl)||null==s.forceContextLoss||s.forceContextLoss(),null!=(a=i.gl)&&a.xr&&i.xr.disconnect(),function(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const t in e)null==t.dispose||t.dispose(),delete e[t]}(i),Bf.delete(e),t&&t(e)}catch(e){}},500)})}}zf.injectIntoDevTools({bundleType:"production"===process.env.NODE_ENV?0:1,rendererPackageName:"@react-three/fiber",version:e.version});const Xf={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function $f(e){const{handlePointer:t}=yf(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(Xf).reduce((e,n)=>({...e,[n]:t(n)}),{}),update:()=>{var t;const{events:n,internal:r}=e.getState();null!=(t=r.lastEvent)&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var n;const{set:r,events:i}=e.getState();null==i.disconnect||i.disconnect(),r(e=>({events:{...e.events,connected:t}})),Object.entries(null!=(n=i.handlers)?n:[]).forEach(([e,n])=>{const[r,i]=Xf[e];t.addEventListener(r,n,{passive:i})})},disconnect:()=>{const{set:t,events:n}=e.getState();var r;n.connected&&(Object.entries(null!=(r=n.handlers)?r:[]).forEach(([e,t])=>{if(n&&n.connected instanceof HTMLElement){const[r]=Xf[e];n.connected.removeEventListener(r,t)}}),t(e=>({events:{...e.events,connected:void 0}})))}}}function Yf(e,t){let n;return(...r)=>{window.clearTimeout(n),n=window.setTimeout(()=>e(...r),t)}}function Kf({debounce:e,scroll:t,polyfill:n,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const a=n||("undefined"==typeof window?class{}:window.ResizeObserver);if(!a)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[u,c]=o({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),d=r({element:null,scrollContainers:null,resizeObserver:null,lastBounds:u,orientationHandler:null}),h=e?"number"==typeof e?e:e.scroll:null,p=e?"number"==typeof e?e:e.resize:null,f=r(!1);s(()=>(f.current=!0,()=>{f.current=!1}));const[m,g,v]=l(()=>{const e=()=>{if(!d.current.element)return;const{left:e,top:t,width:n,height:r,bottom:s,right:a,x:o,y:l}=d.current.element.getBoundingClientRect(),u={left:e,top:t,width:n,height:r,bottom:s,right:a,x:o,y:l};d.current.element instanceof HTMLElement&&i&&(u.height=d.current.element.offsetHeight,u.width=d.current.element.offsetWidth),Object.freeze(u),f.current&&!Jf(d.current.lastBounds,u)&&c(d.current.lastBounds=u)};return[e,p?Yf(e,p):e,h?Yf(e,h):e]},[c,i,h,p]);function y(){d.current.scrollContainers&&(d.current.scrollContainers.forEach(e=>e.removeEventListener("scroll",v,!0)),d.current.scrollContainers=null),d.current.resizeObserver&&(d.current.resizeObserver.disconnect(),d.current.resizeObserver=null),d.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",d.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",d.current.orientationHandler))}function _(){d.current.element&&(d.current.resizeObserver=new a(v),d.current.resizeObserver.observe(d.current.element),t&&d.current.scrollContainers&&d.current.scrollContainers.forEach(e=>e.addEventListener("scroll",v,{capture:!0,passive:!0})),d.current.orientationHandler=()=>{v()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",d.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",d.current.orientationHandler))}return function(e,t){s(()=>{if(t){const t=e;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",t,!0)}}},[e,t])}(v,!!t),function(e){s(()=>{const t=e;return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}},[e])}(g),s(()=>{y(),_()},[t,v,g]),s(()=>y,[]),[e=>{!e||e===d.current.element||(y(),d.current.element=e,d.current.scrollContainers=Qf(e),_())},u,m]}function Qf(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:r,overflowY:i}=window.getComputedStyle(e);return[n,r,i].some(e=>"auto"===e||"scroll"===e)&&t.push(e),[...t,...Qf(e.parentElement)]}const Zf=["x","y","top","bottom","left","right","width","height"],Jf=(e,t)=>Zf.every(n=>e[n]===t[n]);var em,tm,nm=Object.defineProperty,rm=Object.defineProperties,im=Object.getOwnPropertyDescriptors,sm=Object.getOwnPropertySymbols,am=Object.prototype.hasOwnProperty,om=Object.prototype.propertyIsEnumerable,lm=(e,t,n)=>t in e?nm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,um=(e,t)=>{for(var n in t||(t={}))am.call(t,n)&&lm(e,n,t[n]);if(sm)for(var n of sm(t))om.call(t,n)&&lm(e,n,t[n]);return e};function cm(e,t,n){if(!e)return;if(!0===n(e))return e;let r=t?e.return:e.child;for(;r;){const e=cm(r,t,n);if(e)return e;r=t?null:r.sibling}}function dm(e){try{return Object.defineProperties(e,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch(t){return e}}"undefined"==typeof window||!(null==(em=window.document)?void 0:em.createElement)&&"ReactNative"!==(null==(tm=window.navigator)?void 0:tm.product)?e.useEffect:e.useLayoutEffect;const hm=console.error;console.error=function(){const e=[...arguments].join("");if(!(null==e?void 0:e.startsWith("Warning:"))||!e.includes("useContext"))return hm.apply(this,arguments);console.error=hm};const pm=dm(e.createContext(null));class fm extends e.Component{render(){return e.createElement(pm.Provider,{value:this._reactInternals},this.props.children)}}function mm(){const t=function(){const t=e.useContext(pm);if(null===t)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const n=e.useId();return e.useMemo(()=>{for(const e of[t,null==t?void 0:t.alternate]){if(!e)continue;const t=cm(e,!1,e=>{let t=e.memoizedState;for(;t;){if(t.memoizedState===n)return!0;t=t.next}});if(t)return t}},[t,n])}(),[n]=e.useState(()=>new Map);n.clear();let r=t;for(;r;){if(r.type&&"object"==typeof r.type){const t=void 0===r.type._context&&r.type.Provider===r.type?r.type:r.type._context;t&&t!==pm&&!n.has(t)&&n.set(t,e.useContext(dm(t)))}r=r.return}return n}function gm(){const t=mm();return e.useMemo(()=>Array.from(t.keys()).reduce((n,r)=>i=>{return e.createElement(n,null,e.createElement(r.Provider,(s=um({},i),a={value:t.get(r)},rm(s,im(a)))));var s,a},t=>e.createElement(fm,um({},t))),[t])}const vm=e.forwardRef(function({children:t,fallback:n,resize:r,style:i,gl:s,events:a=$f,eventSource:o,eventPrefix:l,shadows:c,linear:d,flat:h,legacy:p,orthographic:f,frameloop:m,dpr:g,performance:v,raycaster:y,camera:_,scene:x,onPointerMissed:b,onCreated:S,...T},w){e.useMemo(()=>Gp(dp),[]);const M=gm(),[E,A]=Kf({scroll:!0,debounce:{scroll:50,resize:0},...r}),C=e.useRef(null),R=e.useRef(null);e.useImperativeHandle(w,()=>C.current);const N=Yp(b),[P,I]=e.useState(!1),[L,U]=e.useState(!1);if(P)throw P;if(L)throw L;const D=e.useRef(null);$p(()=>{const n=C.current;A.width>0&&A.height>0&&n&&(D.current||(D.current=Wf(n)),D.current.configure({gl:s,events:a,shadows:c,linear:d,flat:h,legacy:p,orthographic:f,frameloop:m,dpr:g,performance:v,raycaster:y,camera:_,scene:x,size:A,onPointerMissed:(...e)=>null==N.current?void 0:N.current(...e),onCreated:e=>{var t;null==e.events.connect||e.events.connect(o?(t=o)&&t.hasOwnProperty("current")?o.current:o:R.current),l&&e.setEvents({compute:(e,t)=>{const n=e[l+"X"],r=e[l+"Y"];t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==S||S(e)}}),D.current.render(u(M,{children:u(Qp,{set:U,children:u(e.Suspense,{fallback:u(Kp,{set:I}),children:null!=t?t:null})})})))}),e.useEffect(()=>{const e=C.current;if(e)return()=>qf(e)},[]);return u("div",{ref:R,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:o?"none":"auto",...i},...T,children:u("div",{ref:E,style:{width:"100%",height:"100%"},children:u("canvas",{ref:C,style:{display:"block"},children:n})})})}),ym=e.forwardRef(function(e,t){return u(fm,{children:u(vm,{...e,ref:t})})}),_m=e=>e===Object(e)&&!Array.isArray(e)&&"function"!=typeof e;function xm(e,t){const n=If(e=>e.gl),r=Ff(Kl,_m(e)?Object.values(e):e);a(()=>{null==t||t(r)},[t]),s(()=>{if("initTexture"in n){let e=[];Array.isArray(r)?e=r:r instanceof gn?e=[r]:_m(r)&&(e=Object.values(r)),e.forEach(e=>{e instanceof gn&&n.initTexture(e)})}},[n,r]);const i=l(()=>{if(_m(e)){const t={};let n=0;for(const i in e)t[i]=r[n++];return t}return r},[e,r]);return i}function bm(e,t,n=1){const r=If(e=>e.viewport),i=t*(r.aspect>e/t?r.width/e:r.height/t);return[e*(r.aspect>e/t?r.width/e:r.height/t)*n,i*n,1]}xm.preload=e=>Ff.preload(Kl,e),xm.clear=e=>Ff.clear(Kl,e);const Sm=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class Tm{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=!0===e.object.isSkinnedMesh,this.refreshUniforms=Sm,this.renderId=0}firstInitialization(e){return!1===this.renderObjects.has(e)&&(this.getRenderObjectData(e),!0)}getRenderObjectData(e){let t=this.renderObjects.get(e);if(void 0===t){const{geometry:n,material:r,object:i}=e;if(t={material:this.getMaterialData(r),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:i.matrixWorld.clone()},i.center&&(t.center=i.center.clone()),i.morphTargetInfluences&&(t.morphTargetInfluences=i.morphTargetInfluences.slice()),null!==e.bundle&&(t.version=e.bundle.version),t.material.transmission>0){const{width:n,height:r}=e.context;t.bufferWidth=n,t.bufferHeight=r}this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const r=e[n];t[n]={version:r.version}}return t}containsNode(e){const t=e.material;for(const e in t)if(t[e]&&t[e].isNode)return!0;return null!==e.renderer.nodes.modelViewMatrix||null!==e.renderer.nodes.modelNormalViewMatrix}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const r=e[n];null!=r&&("object"==typeof r&&void 0!==r.clone?!0===r.isTexture?t[n]={id:r.id,version:r.version}:t[n]=r.clone():t[n]=r)}return t}equals(e){const{object:t,material:n,geometry:r}=e,i=this.getRenderObjectData(e);if(!0!==i.worldMatrix.equals(t.matrixWorld))return i.worldMatrix.copy(t.matrixWorld),!1;const s=i.material;for(const e in s){const t=s[e],r=n[e];if(void 0!==t.equals){if(!1===t.equals(r))return t.copy(r),!1}else if(!0===r.isTexture){if(t.id!==r.id||t.version!==r.version)return t.id=r.id,t.version=r.version,!1}else if(t!==r)return s[e]=r,!1}if(s.transmission>0){const{width:t,height:n}=e.context;if(i.bufferWidth!==t||i.bufferHeight!==n)return i.bufferWidth=t,i.bufferHeight=n,!1}const a=i.geometry,o=r.attributes,l=a.attributes,u=Object.keys(l),c=Object.keys(o);if(a.id!==r.id)return a.id=r.id,!1;if(u.length!==c.length)return i.geometry.attributes=this.getAttributesData(o),!1;for(const e of u){const t=l[e],n=o[e];if(void 0===n)return delete l[e],!1;if(t.version!==n.version)return t.version=n.version,!1}const d=r.index,h=a.indexVersion,p=d?d.version:null;if(h!==p)return a.indexVersion=p,!1;if(a.drawRange.start!==r.drawRange.start||a.drawRange.count!==r.drawRange.count)return a.drawRange.start=r.drawRange.start,a.drawRange.count=r.drawRange.count,!1;if(i.morphTargetInfluences){let e=!1;for(let n=0;n<i.morphTargetInfluences.length;n++)i.morphTargetInfluences[n]!==t.morphTargetInfluences[n]&&(e=!0);if(e)return!0}return i.center&&!1===i.center.equals(t.center)?(i.center.copy(t.center),!0):(null!==e.bundle&&(i.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const r=!0===e.object.static,i=null!==e.bundle&&!0===e.bundle.static&&this.getRenderObjectData(e).version===e.bundle.version;if(r||i)return!1;return!0!==this.equals(e)}}function wm(e,t=0){let n=3735928559^t,r=1103547991^t;if(e instanceof Array)for(let t,i=0;i<e.length;i++)t=e[i],n=Math.imul(n^t,2654435761),r=Math.imul(r^t,1597334677);else for(let t,i=0;i<e.length;i++)t=e.charCodeAt(i),n=Math.imul(n^t,2654435761),r=Math.imul(r^t,1597334677);return n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(r^r>>>13,3266489909),r=Math.imul(r^r>>>16,2246822507),r^=Math.imul(n^n>>>13,3266489909),4294967296*(2097151&r)+(n>>>0)}const Mm=e=>wm(e),Em=e=>wm(e),Am=(...e)=>wm(e);function Cm(e,t=!1){const n=[];!0===e.isNode&&(n.push(e.id),e=e.getSelf());for(const{property:r,childNode:i}of Rm(e))n.push(wm(r.slice(0,-4)),i.getCacheKey(t));return wm(n)}function*Rm(e,t=!1){for(const n in e){if(!0===n.startsWith("_"))continue;const r=e[n];if(!0===Array.isArray(r))for(let e=0;e<r.length;e++){const i=r[e];i&&(!0===i.isNode||t&&"function"==typeof i.toJSON)&&(yield{property:n,index:e,childNode:i})}else if(r&&!0===r.isNode)yield{property:n,childNode:r};else if("object"==typeof r)for(const e in r){const i=r[e];i&&(!0===i.isNode||t&&"function"==typeof i.toJSON)&&(yield{property:n,index:e,childNode:i})}}}const Nm=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),Pm=new WeakMap;function Im(e){return Nm.get(e)}function Lm(e){if(/[iu]?vec\d/.test(e))return e.startsWith("ivec")?Int32Array:e.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(e))return Float32Array;if(/float/.test(e))return Float32Array;if(/uint/.test(e))return Uint32Array;if(/int/.test(e))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${e}`)}function Um(e){return/float|int|uint/.test(e)?1:/vec2/.test(e)?2:/vec3/.test(e)?3:/vec4/.test(e)||/mat2/.test(e)?4:/mat3/.test(e)?9:/mat4/.test(e)?16:void 0}function Dm(e){if(null==e)return null;const t=typeof e;return!0===e.isNode?"node":"number"===t?"float":"boolean"===t?"bool":"string"===t?"string":"function"===t?"shader":!0===e.isVector2?"vec2":!0===e.isVector3?"vec3":!0===e.isVector4?"vec4":!0===e.isMatrix2?"mat2":!0===e.isMatrix3?"mat3":!0===e.isMatrix4?"mat4":!0===e.isColor?"color":e instanceof ArrayBuffer?"ArrayBuffer":null}function Fm(e,...t){const n=e?e.slice(-4):void 0;return 1===t.length&&("vec2"===n?t=[t[0],t[0]]:"vec3"===n?t=[t[0],t[0],t[0]]:"vec4"===n&&(t=[t[0],t[0],t[0],t[0]])),"color"===e?new jr(...t):"vec2"===n?new Xt(...t):"vec3"===n?new Tn(...t):"vec4"===n?new vn(...t):"mat2"===n?new ic(...t):"mat3"===n?new $t(...t):"mat4"===n?new Jn(...t):"bool"===e?t[0]||!1:"float"===e||"int"===e||"uint"===e?t[0]||0:"string"===e?t[0]||"":"ArrayBuffer"===e?km(t[0]):null}function Bm(e){let t=Pm.get(e);return void 0===t&&(t={},Pm.set(e,t)),t}function Om(e){let t="";const n=new Uint8Array(e);for(let e=0;e<n.length;e++)t+=String.fromCharCode(n[e]);return btoa(t)}function km(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0)).buffer}const zm={VERTEX:"vertex",FRAGMENT:"fragment"},Vm={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Gm={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},Hm=["fragment","vertex"],Wm=["setup","analyze","generate"],jm=[...Hm,"compute"],qm=["x","y","z","w"];let Xm=0;class $m extends Dt{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=Vm.NONE,this.updateBeforeType=Vm.NONE,this.updateAfterType=Vm.NONE,this.uuid=qt.generateUUID(),this.version=0,this.global=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:Xm++})}set needsUpdate(e){!0===e&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,Vm.FRAME)}onRenderUpdate(e){return this.onUpdate(e,Vm.RENDER)}onObjectUpdate(e){return this.onUpdate(e,Vm.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of Rm(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return!0!==(e=e||this.version!==this._cacheKeyVersion)&&null!==this._cacheKey||(this._cacheKey=Am(Cm(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const e of this.getChildren())t["node"+n++]=e;return t.outputNode||null}analyze(e){if(1===e.increaseUsage(this)){const t=e.getNodeProperties(this);for(const n of Object.values(t))n&&!0===n.isNode&&n.build(e)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&!0===n.isNode)return n.build(e,t)}updateBefore(){}updateAfter(){}update(){}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);e.addNode(this),e.addChain(this);let r=null;const i=e.getBuildStage();if("setup"===i){this.updateReference(e);const t=e.getNodeProperties(this);if(!0!==t.initialized){t.initialized=!0;const n=this.setup(e),r=n&&!0===n.isNode;for(const n of Object.values(t))n&&!0===n.isNode&&n.build(e);r&&n.build(e),t.outputNode=n}}else if("analyze"===i)this.analyze(e);else if("generate"===i){if(1===this.generate.length){const n=this.getNodeType(e),i=e.getDataFromNode(this);r=i.snippet,void 0===r?(r=this.generate(e)||"",i.snippet=r):void 0!==i.flowCodes&&void 0!==e.context.nodeBlock&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),r=e.format(r,n,t)}else r=this.generate(e,t)||""}return e.removeChain(this),e.addSequentialNode(this),r}getSerializeChildren(){return Rm(this)}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:r,index:i,childNode:s}of t)void 0!==i?(void 0===n[r]&&(n[r]=Number.isInteger(i)?[]:{}),n[r][i]=s.toJSON(e.meta).uuid):n[r]=s.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(void 0!==e.inputNodes){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const r=[];for(const i of e.inputNodes[n])r.push(t[i]);this[n]=r}else if("object"==typeof e.inputNodes[n]){const r={};for(const i in e.inputNodes[n]){const s=e.inputNodes[n][i];r[i]=t[s]}this[n]=r}else{const r=e.inputNodes[n];this[n]=t[r]}}}toJSON(e){const{uuid:t,type:n}=this,r=void 0===e||"string"==typeof e;r&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];function s(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(void 0===i&&(i={uuid:t,type:n,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},!0!==r&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta),r){const t=s(e.textures),n=s(e.images),r=s(e.nodes);t.length>0&&(i.textures=t),n.length>0&&(i.images=n),r.length>0&&(i.nodes=r)}return i}}class Ym extends $m{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){return`${this.node.build(e)}[ ${this.indexNode.build(e,"uint")} ]`}}class Km extends $m{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const r of this.convertTo.split("|"))null!==n&&e.getTypeLength(t)!==e.getTypeLength(r)||(n=r);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,r=this.getNodeType(e),i=n.build(e,r);return e.format(i,r,t)}}class Qm extends $m{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if("generate"===e.getBuildStage()){const n=e.getVectorType(this.getNodeType(e,t)),r=e.getDataFromNode(this);if(void 0!==r.propertyName)return e.format(r.propertyName,n,t);if("void"!==n&&"void"!==t&&this.hasDependencies(e)){const i=super.build(e,n),s=e.getVarFromNode(this,null,n),a=e.getPropertyName(s);return e.addLineFlowCode(`${a} = ${i}`,this),r.snippet=i,r.propertyName=a,e.format(r.propertyName,n,t)}}return super.build(e,t)}}class Zm extends Qm{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return null!==this.nodeType?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),r=this.nodes,i=e.getComponentType(n),s=[];for(const t of r){let n=t.build(e);const r=e.getComponentType(t.getNodeType(e));r!==i&&(n=e.format(n,r,i)),s.push(n)}const a=`${e.getType(n)}( ${s.join(", ")} )`;return e.format(a,n,t)}}const Jm=qm.join("");class eg extends $m{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(qm.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const n=this.node,r=e.getTypeLength(n.getNodeType(e));let i=null;if(r>1){let s=null;this.getVectorLength()>=r&&(s=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const a=n.build(e,s);i=this.components.length===r&&this.components===Jm.slice(0,this.components.length)?e.format(a,s,t):e.format(`${a}.${this.components}`,this.getNodeType(e),t)}else i=n.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class tg extends Qm{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:r}=this,i=this.getNodeType(e),s=e.getComponentType(r.getNodeType(e)),a=e.getTypeFromLength(n.length,s),o=r.build(e,a),l=t.build(e,i),u=e.getTypeLength(i),c=[];for(let e=0;e<u;e++){const t=qm[e];t===n[0]?(c.push(o),e+=n.length-1):c.push(l+"."+t)}return`${e.getType(i)}( ${c.join(", ")} )`}}class ng extends Qm{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,r=this.getNodeType(e),i=n.build(e),s=e.getVarFromNode(this),a=e.getPropertyName(s);e.addLineFlowCode(a+" = "+i,this);const o=e.getTypeLength(r),l=[];let u=0;for(let e=0;e<o;e++){const n=qm[e];n===t[u]?(l.push("1.0 - "+a+"."+n),u++):l.push(a+"."+n)}return`${e.getType(r)}( ${l.join(", ")} )`}}class rg extends $m{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return null===this.nodeType?Dm(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=Dm(this.value),e.nodeType=this.nodeType,"ArrayBuffer"===e.valueType&&(e.value=Om(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?Fm(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){}}const ig=/float|u?int/;class sg extends rg{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return ig.test(n)&&ig.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class ag extends $m{static get type(){return"MemberNode"}constructor(e,t){super(),this.node=e,this.property=t,this.isMemberNode=!0}getNodeType(e){return this.node.getMemberType(e,this.property)}generate(e){return this.node.build(e)+"."+this.property}}let og=null;const lg=new Map;function ug(e,t){if(!lg.has(e)){if("function"!=typeof t)throw new Error(`Node element ${e} is not a function`);lg.set(e,t)}}const cg=e=>e.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),dg=e=>cg(e).split("").sort().join(""),hg={setup(e,t){const n=t.shift();return e(Bg(n),...t)},get(e,t,n){if("string"==typeof t&&void 0===e[t]){if(!0!==e.isStackNode&&"assign"===t)return(...e)=>(og.assign(n,...e),n);if(lg.has(t)){const r=lg.get(t);return e.isStackNode?(...e)=>n.add(r(...e)):(...e)=>r(n,...e)}if("self"===t)return e;if(t.endsWith("Assign")&&lg.has(t.slice(0,t.length-6))){const r=lg.get(t.slice(0,t.length-6));return e.isStackNode?(...e)=>n.assign(e[0],r(...e)):(...e)=>n.assign(r(n,...e))}if(!0===/^[xyzwrgbastpq]{1,4}$/.test(t))return t=cg(t),Fg(new eg(n,t));if(!0===/^set[XYZWRGBASTPQ]{1,4}$/.test(t))return t=dg(t.slice(3).toLowerCase()),n=>Fg(new tg(e,t,n));if(!0===/^flip[XYZWRGBASTPQ]{1,4}$/.test(t))return t=dg(t.slice(4).toLowerCase()),()=>Fg(new ng(Fg(e),t));if("width"===t||"height"===t||"depth"===t)return"width"===t?t="x":"height"===t?t="y":"depth"===t&&(t="z"),Fg(new eg(e,t));if(!0===/^\d+$/.test(t))return Fg(new Ym(n,new sg(Number(t),"uint")));if(!0===/^get$/.test(t))return e=>Fg(new ag(n,e))}return Reflect.get(e,t,n)},set:(e,t,n,r)=>"string"!=typeof t||void 0!==e[t]||!0!==/^[xyzwrgbastpq]{1,4}$/.test(t)&&"width"!==t&&"height"!==t&&"depth"!==t&&!0!==/^\d+$/.test(t)?Reflect.set(e,t,n,r):(r[t].assign(n),!0)},pg=new WeakMap,fg=new WeakMap,mg=function(e,t=null){for(const n in e)e[n]=Fg(e[n],t);return e},gg=function(e,t=null){const n=e.length;for(let r=0;r<n;r++)e[r]=Fg(e[r],t);return e},vg=function(e,t=null,n=null,r=null){const i=e=>Fg(null!==r?Object.assign(e,r):e);return null===t?(...t)=>i(new e(...Og(t))):null!==n?(n=Fg(n),(...r)=>i(new e(t,...Og(r),n))):(...n)=>i(new e(t,...Og(n)))},yg=function(e,...t){return Fg(new e(...Og(t)))};class _g extends $m{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,inputNodes:n}=this,r=e.getNodeProperties(t);if(r.onceOutput)return r.onceOutput;let i=null;if(t.layout){let r=fg.get(e.constructor);void 0===r&&(r=new WeakMap,fg.set(e.constructor,r));let s=r.get(t);void 0===s&&(s=Fg(e.buildFunctionNode(t)),r.set(t,s)),e.addInclude(s),i=Fg(s.call(n))}else{const r=t.jsFunc,s=null!==n||r.length>1?r(n||[],e):r(e);i=Fg(s)}return t.once&&(r.onceOutput=i),i}getOutputNode(e){const t=e.getNodeProperties(this);return null===t.outputNode&&(t.outputNode=this.setupOutput(e)),t.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){return this.getOutputNode(e).build(e,t)}}class xg extends $m{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return Bg(e),Fg(new _g(this,e))}setup(){return this.call()}}const bg=[!1,!0],Sg=[0,1,2,3],Tg=[-1,-2],wg=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],Mg=new Map;for(const e of bg)Mg.set(e,new sg(e));const Eg=new Map;for(const e of Sg)Eg.set(e,new sg(e,"uint"));const Ag=new Map([...Eg].map(e=>new sg(e.value,"int")));for(const e of Tg)Ag.set(e,new sg(e,"int"));const Cg=new Map([...Ag].map(e=>new sg(e.value)));for(const e of wg)Cg.set(e,new sg(e));for(const e of wg)Cg.set(-e,new sg(-e));const Rg={bool:Mg,uint:Eg,ints:Ag,float:Cg},Ng=new Map([...Mg,...Cg]),Pg=(e,t)=>Ng.has(e)?Ng.get(e):!0===e.isNode?e:new sg(e,t),Ig=function(e,t=null){return(...n)=>{if((0===n.length||!["bool","float","int","uint"].includes(e)&&n.every(e=>"object"!=typeof e))&&(n=[Fm(e,...n)]),1===n.length&&null!==t&&t.has(n[0]))return Fg(t.get(n[0]));if(1===n.length){const t=Pg(n[0],e);return(e=>{try{return e.getNodeType()}catch(e){return}})(t)===e?Fg(t):Fg(new Km(t,e))}const r=n.map(e=>Pg(e));return Fg(new Zm(r,e))}},Lg=e=>"object"==typeof e&&null!==e?e.value:e,Ug=e=>null!=e?e.nodeType||e.convertTo||("string"==typeof e?e:null):null;function Dg(e,t){return new Proxy(new xg(e,t),hg)}const Fg=(e,t=null)=>function(e,t=null){const n=Dm(e);if("node"===n){let t=pg.get(e);return void 0===t&&(t=new Proxy(e,hg),pg.set(e,t),pg.set(t,t)),t}return null===t&&("float"===n||"boolean"===n)||n&&"shader"!==n&&"string"!==n?Fg(Pg(e,t)):"shader"===n?Vg(e):e}(e,t),Bg=(e,t=null)=>new mg(e,t),Og=(e,t=null)=>new gg(e,t),kg=(...e)=>new vg(...e),zg=(...e)=>new yg(...e),Vg=(e,t)=>{const n=new Dg(e,t),r=(...e)=>{let t;return Bg(e),t=e[0]&&e[0].isNode?[...e]:e[0],n.call(t)};return r.shaderNode=n,r.setLayout=e=>(n.setLayout(e),r),r.once=()=>(n.once=!0,r),r};ug("toGlobal",e=>(e.global=!0,e));const Gg=e=>{og=e},Hg=()=>og,Wg=(...e)=>og.If(...e);function jg(e){return og&&og.add(e),e}ug("append",jg);const qg=new Ig("color"),Xg=new Ig("float",Rg.float),$g=new Ig("int",Rg.ints),Yg=new Ig("uint",Rg.uint),Kg=new Ig("bool",Rg.bool),Qg=new Ig("vec2"),Zg=new Ig("ivec2"),Jg=new Ig("uvec2"),ev=new Ig("bvec2"),tv=new Ig("vec3"),nv=new Ig("ivec3"),rv=new Ig("uvec3"),iv=new Ig("bvec3"),sv=new Ig("vec4"),av=new Ig("ivec4"),ov=new Ig("uvec4"),lv=new Ig("bvec4"),uv=new Ig("mat2"),cv=new Ig("mat3"),dv=new Ig("mat4");ug("toColor",qg),ug("toFloat",Xg),ug("toInt",$g),ug("toUint",Yg),ug("toBool",Kg),ug("toVec2",Qg),ug("toIVec2",Zg),ug("toUVec2",Jg),ug("toBVec2",ev),ug("toVec3",tv),ug("toIVec3",nv),ug("toUVec3",rv),ug("toBVec3",iv),ug("toVec4",sv),ug("toIVec4",av),ug("toUVec4",ov),ug("toBVec4",lv),ug("toMat2",uv),ug("toMat3",cv),ug("toMat4",dv);const hv=kg(Ym),pv=(e,t)=>Fg(new Km(Fg(e),t));ug("element",hv),ug("convert",pv);class fv extends Qm{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getNodeType(e){return null===this.nodeType&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const mv=(...e)=>{let t;if(1===e.length){const n=e[0];t=new fv(null,n.length,n)}else{const n=e[0],r=e[1];t=new fv(n,r)}return Fg(t)};ug("toArray",(e,t)=>mv(Array(t).fill(e)));class gv extends $m{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const vv=e=>new gv(e),yv=(e,t=0)=>new gv(e,!0,t),_v=yv("frame"),xv=yv("render"),bv=vv("object");class Sv extends rg{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=bv}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const n=this.getSelf();return e=e.bind(n),super.onUpdate(t=>{const r=e(t,n);void 0!==r&&(this.value=r)},t)}generate(e,t){const n=this.getNodeType(e),r=this.getUniformHash(e);let i=e.getNodeFromHash(r);void 0===i&&(e.setHashNode(this,r),i=this);const s=i.getInputType(e),a=e.getUniformFromNode(i,s,e.shaderStage,this.name||e.context.label),o=e.getPropertyName(a);return void 0!==e.context.label&&delete e.context.label,e.format(o,n,t)}}const Tv=(e,t)=>{const n=Ug(t||e),r=e&&!0===e.isNode?e.node&&e.node.value||e.value:e;return Fg(new Sv(r,n))};class wv extends $m{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return!0===this.varying?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Mv=(e,t)=>Fg(new wv(e,t)),Ev=(e,t)=>Fg(new wv(e,t,!0)),Av=zg(wv,"vec4","DiffuseColor"),Cv=zg(wv,"vec3","EmissiveColor"),Rv=zg(wv,"float","Roughness"),Nv=zg(wv,"float","Metalness"),Pv=zg(wv,"float","Clearcoat"),Iv=zg(wv,"float","ClearcoatRoughness"),Lv=zg(wv,"vec3","Sheen"),Uv=zg(wv,"float","SheenRoughness"),Dv=zg(wv,"float","Iridescence"),Fv=zg(wv,"float","IridescenceIOR"),Bv=zg(wv,"float","IridescenceThickness"),Ov=zg(wv,"float","AlphaT"),kv=zg(wv,"float","Anisotropy"),zv=zg(wv,"vec3","AnisotropyT"),Vv=zg(wv,"vec3","AnisotropyB"),Gv=zg(wv,"color","SpecularColor"),Hv=zg(wv,"float","SpecularF90"),Wv=zg(wv,"float","Shininess"),jv=zg(wv,"vec4","Output"),qv=zg(wv,"float","dashSize"),Xv=zg(wv,"float","gapSize"),$v=zg(wv,"float","pointWidth"),Yv=zg(wv,"float","IOR"),Kv=zg(wv,"float","Transmission"),Qv=zg(wv,"float","Thickness"),Zv=zg(wv,"float","AttenuationDistance"),Jv=zg(wv,"color","AttenuationColor"),ey=zg(wv,"float","Dispersion");class ty extends Qm{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return"void"!==t?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(!1===e.isAvailable("swizzleAssign")&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return qm.join("").slice(0,n)!==t.components}return!1}generate(e,t){const{targetNode:n,sourceNode:r}=this,i=this.needsSplitAssign(e),s=n.getNodeType(e),a=n.context({assign:!0}).build(e),o=r.build(e,s),l=r.getNodeType(e),u=e.getDataFromNode(this);let c;if(!0===u.initialized)"void"!==t&&(c=a);else if(i){const r=e.getVarFromNode(this,null,s),i=e.getPropertyName(r);e.addLineFlowCode(`${i} = ${o}`,this);const l=n.node.context({assign:!0}).build(e);for(let t=0;t<n.components.length;t++){const r=n.components[t];e.addLineFlowCode(`${l}.${r} = ${i}[ ${t} ]`,this)}"void"!==t&&(c=a)}else c=`${a} = ${o}`,"void"!==t&&"void"!==l||(e.addLineFlowCode(c,this),"void"!==t&&(c=a));return u.initialized=!0,e.format(c,s,t)}}const ny=kg(ty);ug("assign",ny);class ry extends Qm{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],n=this.functionNode,r=n.getInputs(e),i=this.parameters,s=(t,n)=>{const r=n.type;let i;return i="pointer"===r?"&"+t.build(e):t.build(e,r),i};if(Array.isArray(i))for(let e=0;e<i.length;e++)t.push(s(i[e],r[e]));else for(const e of r){const n=i[e.name];if(void 0===n)throw new Error(`FunctionCallNode: Input '${e.name}' not found in FunctionNode.`);t.push(s(n,e))}return`${n.build(e,"property")}( ${t.join(", ")} )`}}const iy=(e,...t)=>(t=t.length>1||t[0]&&!0===t[0].isNode?Og(t):Bg(t[0]),Fg(new ry(Fg(e),t)));ug("call",iy);class sy extends Qm{static get type(){return"OperatorNode"}constructor(e,t,n,...r){if(super(),r.length>0){let i=new sy(e,t,n);for(let t=0;t<r.length-1;t++)i=new sy(e,i,r[t]);t=i,n=r[r.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getNodeType(e,t){const n=this.op,r=this.aNode,i=this.bNode,s=r.getNodeType(e),a=void 0!==i?i.getNodeType(e):null;if("void"===s||"void"===a)return"void";if("%"===n)return s;if("~"===n||"&"===n||"|"===n||"^"===n||">>"===n||"<<"===n)return e.getIntegerType(s);if("!"===n||"=="===n||"&&"===n||"||"===n||"^^"===n)return"bool";if("<"===n||">"===n||"<="===n||">="===n){const n=t?e.getTypeLength(t):Math.max(e.getTypeLength(s),e.getTypeLength(a));return n>1?`bvec${n}`:"bool"}if(e.isMatrix(s)){if("float"===a)return s;if(e.isVector(a))return e.getVectorFromMatrix(s);if(e.isMatrix(a))return s}else if(e.isMatrix(a)){if("float"===s)return a;if(e.isVector(s))return e.getVectorFromMatrix(a)}return e.getTypeLength(a)>e.getTypeLength(s)?a:s}generate(e,t){const n=this.op,r=this.aNode,i=this.bNode,s=this.getNodeType(e,t);let a=null,o=null;"void"!==s?(a=r.getNodeType(e),o=void 0!==i?i.getNodeType(e):null,"<"===n||">"===n||"<="===n||">="===n||"=="===n?e.isVector(a)?o=a:a!==o&&(a=o="float"):">>"===n||"<<"===n?(a=s,o=e.changeComponentType(o,"uint")):e.isMatrix(a)?"float"===o?o="float":e.isVector(o)?o=e.getVectorFromMatrix(a):e.isMatrix(o)||(a=o=s):a=e.isMatrix(o)?"float"===a?"float":e.isVector(a)?e.getVectorFromMatrix(o):o=s:o=s):a=o=s;const l=r.build(e,a),u=void 0!==i?i.build(e,o):null,c=e.getTypeLength(t),d=e.getFunctionOperator(n);return"void"!==t?"<"===n&&c>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThan",t)}( ${l}, ${u} )`,s,t):e.format(`( ${l} < ${u} )`,s,t):"<="===n&&c>1?e.useComparisonMethod?e.format(`${e.getMethod("lessThanEqual",t)}( ${l}, ${u} )`,s,t):e.format(`( ${l} <= ${u} )`,s,t):">"===n&&c>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThan",t)}( ${l}, ${u} )`,s,t):e.format(`( ${l} > ${u} )`,s,t):">="===n&&c>1?e.useComparisonMethod?e.format(`${e.getMethod("greaterThanEqual",t)}( ${l}, ${u} )`,s,t):e.format(`( ${l} >= ${u} )`,s,t):"!"===n||"~"===n?e.format(`(${n}${l})`,a,t):d?e.format(`${d}( ${l}, ${u} )`,s,t):e.isMatrix(a)&&"float"===o?e.format(`( ${u} ${n} ${l} )`,s,t):"float"===a&&e.isMatrix(o)?e.format(`${l} ${n} ${u}`,s,t):e.format(`( ${l} ${n} ${u} )`,s,t):"void"!==a?d?e.format(`${d}( ${l}, ${u} )`,s,t):e.isMatrix(a)&&"float"===o?e.format(`${u} ${n} ${l}`,s,t):e.format(`${l} ${n} ${u}`,s,t):void 0}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const ay=kg(sy,"+"),oy=kg(sy,"-"),ly=kg(sy,"*"),uy=kg(sy,"/"),cy=kg(sy,"%"),dy=kg(sy,"=="),hy=kg(sy,"!="),py=kg(sy,"<"),fy=kg(sy,">"),my=kg(sy,"<="),gy=kg(sy,">="),vy=kg(sy,"&&"),yy=kg(sy,"||"),_y=kg(sy,"!"),xy=kg(sy,"^^"),by=kg(sy,"&"),Sy=kg(sy,"~"),Ty=kg(sy,"|"),wy=kg(sy,"^"),My=kg(sy,"<<"),Ey=kg(sy,">>");ug("add",ay),ug("sub",oy),ug("mul",ly),ug("div",uy),ug("modInt",cy),ug("equal",dy),ug("notEqual",hy),ug("lessThan",py),ug("greaterThan",fy),ug("lessThanEqual",my),ug("greaterThanEqual",gy),ug("and",vy),ug("or",yy),ug("not",_y),ug("xor",xy),ug("bitAnd",by),ug("bitNot",Sy),ug("bitOr",Ty),ug("bitXor",wy),ug("shiftLeft",My),ug("shiftRight",Ey);const Ay=(...e)=>cy(...e);ug("remainder",Ay);class Cy extends Qm{static get type(){return"MathNode"}constructor(e,t,n=null,r=null){super(),this.method=e,this.aNode=t,this.bNode=n,this.cNode=r,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,r=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),s=e.isMatrix(n)?0:e.getTypeLength(n),a=e.isMatrix(r)?0:e.getTypeLength(r);return i>s&&i>a?t:s>a?n:a>i?r:t}getNodeType(e){const t=this.method;return t===Cy.LENGTH||t===Cy.DISTANCE||t===Cy.DOT?"float":t===Cy.CROSS?"vec3":t===Cy.ALL?"bool":t===Cy.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):t===Cy.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,t){let n=this.method;const r=this.getNodeType(e),i=this.getInputType(e),s=this.aNode,a=this.bNode,o=this.cNode,l=e.renderer.coordinateSystem;if(n===Cy.TRANSFORM_DIRECTION){let n=s,r=a;e.isMatrix(n.getNodeType(e))?r=sv(tv(r),0):n=sv(tv(n),0);const i=ly(n,r).xyz;return jy(i).build(e,t)}if(n===Cy.NEGATE)return e.format("( - "+s.build(e,i)+" )",r,t);if(n===Cy.ONE_MINUS)return oy(1,s).build(e,t);if(n===Cy.RECIPROCAL)return uy(1,s).build(e,t);if(n===Cy.DIFFERENCE)return Jy(oy(s,a)).build(e,t);{const u=[];return n===Cy.CROSS||n===Cy.MOD?u.push(s.build(e,r),a.build(e,r)):l===Lt&&n===Cy.STEP?u.push(s.build(e,1===e.getTypeLength(s.getNodeType(e))?"float":i),a.build(e,i)):l===Lt&&(n===Cy.MIN||n===Cy.MAX)||n===Cy.MOD?u.push(s.build(e,i),a.build(e,1===e.getTypeLength(a.getNodeType(e))?"float":i)):n===Cy.REFRACT?u.push(s.build(e,i),a.build(e,i),o.build(e,"float")):n===Cy.MIX?u.push(s.build(e,i),a.build(e,i),o.build(e,1===e.getTypeLength(o.getNodeType(e))?"float":i)):(l===Ut&&n===Cy.ATAN&&null!==a&&(n="atan2"),u.push(s.build(e,i)),null!==a&&u.push(a.build(e,i)),null!==o&&u.push(o.build(e,i))),e.format(`${e.getMethod(n,r)}( ${u.join(", ")} )`,r,t)}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}Cy.ALL="all",Cy.ANY="any",Cy.RADIANS="radians",Cy.DEGREES="degrees",Cy.EXP="exp",Cy.EXP2="exp2",Cy.LOG="log",Cy.LOG2="log2",Cy.SQRT="sqrt",Cy.INVERSE_SQRT="inversesqrt",Cy.FLOOR="floor",Cy.CEIL="ceil",Cy.NORMALIZE="normalize",Cy.FRACT="fract",Cy.SIN="sin",Cy.COS="cos",Cy.TAN="tan",Cy.ASIN="asin",Cy.ACOS="acos",Cy.ATAN="atan",Cy.ABS="abs",Cy.SIGN="sign",Cy.LENGTH="length",Cy.NEGATE="negate",Cy.ONE_MINUS="oneMinus",Cy.DFDX="dFdx",Cy.DFDY="dFdy",Cy.ROUND="round",Cy.RECIPROCAL="reciprocal",Cy.TRUNC="trunc",Cy.FWIDTH="fwidth",Cy.TRANSPOSE="transpose",Cy.BITCAST="bitcast",Cy.EQUALS="equals",Cy.MIN="min",Cy.MAX="max",Cy.MOD="mod",Cy.STEP="step",Cy.REFLECT="reflect",Cy.DISTANCE="distance",Cy.DIFFERENCE="difference",Cy.DOT="dot",Cy.CROSS="cross",Cy.POW="pow",Cy.TRANSFORM_DIRECTION="transformDirection",Cy.MIX="mix",Cy.CLAMP="clamp",Cy.REFRACT="refract",Cy.SMOOTHSTEP="smoothstep",Cy.FACEFORWARD="faceforward";const Ry=Xg(1e-6),Ny=Xg(1e6),Py=Xg(Math.PI),Iy=Xg(2*Math.PI),Ly=kg(Cy,Cy.ALL),Uy=kg(Cy,Cy.ANY),Dy=kg(Cy,Cy.RADIANS),Fy=kg(Cy,Cy.DEGREES),By=kg(Cy,Cy.EXP),Oy=kg(Cy,Cy.EXP2),ky=kg(Cy,Cy.LOG),zy=kg(Cy,Cy.LOG2),Vy=kg(Cy,Cy.SQRT),Gy=kg(Cy,Cy.INVERSE_SQRT),Hy=kg(Cy,Cy.FLOOR),Wy=kg(Cy,Cy.CEIL),jy=kg(Cy,Cy.NORMALIZE),qy=kg(Cy,Cy.FRACT),Xy=kg(Cy,Cy.SIN),$y=kg(Cy,Cy.COS),Yy=kg(Cy,Cy.TAN),Ky=kg(Cy,Cy.ASIN),Qy=kg(Cy,Cy.ACOS),Zy=kg(Cy,Cy.ATAN),Jy=kg(Cy,Cy.ABS),e_=kg(Cy,Cy.SIGN),t_=kg(Cy,Cy.LENGTH),n_=kg(Cy,Cy.NEGATE),r_=kg(Cy,Cy.ONE_MINUS),i_=kg(Cy,Cy.DFDX),s_=kg(Cy,Cy.DFDY),a_=kg(Cy,Cy.ROUND),o_=kg(Cy,Cy.RECIPROCAL),l_=kg(Cy,Cy.TRUNC),u_=kg(Cy,Cy.FWIDTH),c_=kg(Cy,Cy.TRANSPOSE),d_=kg(Cy,Cy.BITCAST),h_=kg(Cy,Cy.EQUALS),p_=kg(Cy,Cy.MIN),f_=kg(Cy,Cy.MAX),m_=kg(Cy,Cy.MOD),g_=kg(Cy,Cy.STEP),v_=kg(Cy,Cy.REFLECT),y_=kg(Cy,Cy.DISTANCE),__=kg(Cy,Cy.DIFFERENCE),x_=kg(Cy,Cy.DOT),b_=kg(Cy,Cy.CROSS),S_=kg(Cy,Cy.POW),T_=kg(Cy,Cy.POW,2),w_=kg(Cy,Cy.POW,3),M_=kg(Cy,Cy.POW,4),E_=kg(Cy,Cy.TRANSFORM_DIRECTION),A_=e=>ly(e_(e),S_(Jy(e),1/3)),C_=e=>x_(e,e),R_=kg(Cy,Cy.MIX),N_=(e,t=0,n=1)=>Fg(new Cy(Cy.CLAMP,Fg(e),Fg(t),Fg(n))),P_=e=>N_(e),I_=kg(Cy,Cy.REFRACT),L_=kg(Cy,Cy.SMOOTHSTEP),U_=kg(Cy,Cy.FACEFORWARD),D_=Vg(([e])=>{const t=x_(e.xy,Qg(12.9898,78.233)),n=m_(t,Py);return qy(Xy(n).mul(43758.5453))}),F_=(e,t,n)=>R_(t,n,e),B_=(e,t,n)=>L_(t,n,e),O_=(e,t)=>Zy(e,t),k_=U_,z_=Gy;ug("all",Ly),ug("any",Uy),ug("equals",h_),ug("radians",Dy),ug("degrees",Fy),ug("exp",By),ug("exp2",Oy),ug("log",ky),ug("log2",zy),ug("sqrt",Vy),ug("inverseSqrt",Gy),ug("floor",Hy),ug("ceil",Wy),ug("normalize",jy),ug("fract",qy),ug("sin",Xy),ug("cos",$y),ug("tan",Yy),ug("asin",Ky),ug("acos",Qy),ug("atan",Zy),ug("abs",Jy),ug("sign",e_),ug("length",t_),ug("lengthSq",C_),ug("negate",n_),ug("oneMinus",r_),ug("dFdx",i_),ug("dFdy",s_),ug("round",a_),ug("reciprocal",o_),ug("trunc",l_),ug("fwidth",u_),ug("atan2",O_),ug("min",p_),ug("max",f_),ug("mod",m_),ug("step",g_),ug("reflect",v_),ug("distance",y_),ug("dot",x_),ug("cross",b_),ug("pow",S_),ug("pow2",T_),ug("pow3",w_),ug("pow4",M_),ug("transformDirection",E_),ug("mix",F_),ug("clamp",N_),ug("refract",I_),ug("smoothstep",B_),ug("faceForward",U_),ug("difference",__),ug("saturate",P_),ug("cbrt",A_),ug("transpose",c_),ug("rand",D_);class V_ extends $m{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(void 0===t)return this.setup(e),this.getNodeType(e);const r=t.getNodeType(e);if(null!==n){const t=n.getNodeType(e);if(e.getTypeLength(t)>e.getTypeLength(r))return t}return r}setup(e){const t=this.condNode.cache(),n=this.ifNode.cache(),r=this.elseNode?this.elseNode.cache():null,i=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=i,null!==r&&(e.getDataFromNode(r).parentNodeBlock=i);const s=e.getNodeProperties(this);s.condNode=t,s.ifNode=n.context({nodeBlock:n}),s.elseNode=r?r.context({nodeBlock:r}):null}generate(e,t){const n=this.getNodeType(e),r=e.getDataFromNode(this);if(void 0!==r.nodeProperty)return r.nodeProperty;const{condNode:i,ifNode:s,elseNode:a}=e.getNodeProperties(this),o="void"!==t,l=o?Mv(n).build(e):"";r.nodeProperty=l;const u=i.build(e,"bool");e.addFlowCode(`\n${e.tab}if ( ${u} ) {\n\n`).addFlowTab();let c=s.build(e,n);if(c&&(c=o?l+" = "+c+";":"return "+c+";"),e.removeFlowTab().addFlowCode(e.tab+"\t"+c+"\n\n"+e.tab+"}"),null!==a){e.addFlowCode(" else {\n\n").addFlowTab();let t=a.build(e,n);t&&(t=o?l+" = "+t+";":"return "+t+";"),e.removeFlowTab().addFlowCode(e.tab+"\t"+t+"\n\n"+e.tab+"}\n\n")}else e.addFlowCode("\n\n");return e.format(l,n,t)}}const G_=kg(V_);ug("select",G_);const H_=(...e)=>G_(...e);ug("cond",H_);class W_ extends $m{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value});const n=this.node.build(e);return e.setContext(t),n}generate(e,t){const n=e.getContext();e.setContext({...e.context,...this.value});const r=this.node.build(e,t);return e.setContext(n),r}}const j_=kg(W_),q_=(e,t)=>j_(e,{label:t});ug("context",j_),ug("label",q_);class X_ extends $m{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n}getHash(e){return this.name||super.getHash(e)}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:n,readOnly:r}=this,{renderer:i}=e,s=!0===i.backend.isWebGPUBackend;let a=!1,o=!1;r&&(a=e.isDeterministic(t),o=s?r:a);const l=e.getVectorType(this.getNodeType(e)),u=t.build(e,l),c=e.getVarFromNode(this,n,l,void 0,o),d=e.getPropertyName(c);let h=d;if(o)if(s)h=a?`const ${d}`:`let ${d}`;else{const n=e.getArrayCount(t);h=`const ${e.getVar(c.type,d,n)}`}return e.addLineFlowCode(`${h} = ${u}`,this),d}}const $_=kg(X_),Y_=(e,t=null)=>$_(e,t).append(),K_=(e,t=null)=>$_(e,t,!0).append();ug("toVar",Y_),ug("toConst",K_);const Q_=e=>$_(e);ug("temp",Q_);class Z_ extends $m{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(void 0===n){const r=this.name,i=this.getNodeType(e);t.varying=n=e.getVaryingFromNode(this,r,i),t.node=this.node}return n.needsInterpolation||(n.needsInterpolation="fragment"===e.shaderStage),n}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){const t=e.getNodeProperties(this),n=this.setupVarying(e),r="fragment"===e.shaderStage&&!0===t.reassignPosition&&e.context.needsPositionReassign;if(void 0===t.propertyName||r){const i=this.getNodeType(e),s=e.getPropertyName(n,zm.VERTEX);e.flowNodeFromShaderStage(zm.VERTEX,this.node,i,s),t.propertyName=s,r?t.reassignPosition=!1:void 0===t.reassignPosition&&e.context.isPositionNodeInput&&(t.reassignPosition=!0)}return e.getPropertyName(n)}}const J_=kg(Z_),ex=e=>J_(e);ug("toVarying",J_),ug("toVertexStage",ex),ug("varying",(...e)=>J_(...e)),ug("vertexStage",(...e)=>J_(...e));const tx=Vg(([e])=>{const t=e.mul(.9478672986).add(.0521327014).pow(2.4),n=e.mul(.0773993808),r=e.lessThanEqual(.04045);return R_(t,n,r)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),nx=Vg(([e])=>{const t=e.pow(.41666).mul(1.055).sub(.055),n=e.mul(12.92),r=e.lessThanEqual(.0031308);return R_(t,n,r)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),rx="WorkingColorSpace",ix="OutputColorSpace";class sx extends Qm{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===rx?on.workingColorSpace:t===ix?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),r=this.resolveColorSpace(e,this.target);let i=t;return!1!==on.enabled&&n!==r&&n&&r?(on.getTransfer(n)===_t&&(i=sv(tx(i.rgb),i.a)),on.getPrimaries(n)!==on.getPrimaries(r)&&(i=sv(cv(on._getMatrix(new $t,n,r)).mul(i.rgb),i.a)),on.getTransfer(r)===_t&&(i=sv(nx(i.rgb),i.a)),i):i}}const ax=e=>Fg(new sx(Fg(e),rx,ix)),ox=e=>Fg(new sx(Fg(e),ix,rx)),lx=(e,t)=>Fg(new sx(Fg(e),rx,t)),ux=(e,t)=>Fg(new sx(Fg(e),t,rx));ug("toOutputColorSpace",ax),ug("toWorkingColorSpace",ox),ug("workingToColorSpace",lx),ug("colorSpaceToWorking",ux);let cx=class extends Ym{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}};class dx extends $m{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=Vm.OBJECT}setGroup(e){return this.group=e,this}element(e){return Fg(new cx(this,Fg(e)))}setNodeType(e){const t=Tv(null,e).getSelf();null!==this.group&&t.setGroup(this.group),this.node=t}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let e=1;e<t.length;e++)n=n[t[e]];return n}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}class hx extends dx{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(xv)}updateReference(e){return this.reference=null!==this.renderer?this.renderer:e.renderer,this.reference}}const px=(e,t,n=null)=>Fg(new hx(e,t,n));class fx extends Qm{static get type(){return"ToneMappingNode"}constructor(e,t=gx,n=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return Am(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,n=this.toneMapping;if(0===n)return t;let r=null;const i=e.renderer.library.getToneMappingFunction(n);return r=null!==i?sv(i(t.rgb,this.exposureNode),t.a):t,r}}const mx=(e,t,n)=>Fg(new fx(e,Fg(t),Fg(n))),gx=px("toneMappingExposure","float");ug("toneMapping",(e,t,n)=>mx(t,n,e));class vx extends rg{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,r=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=r,this.usage=Nt,this.instanced=!1,this.attribute=null,this.global=!0,e&&!0===e.isBufferAttribute&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(0===this.bufferStride&&0===this.bufferOffset){let t=e.globalCache.getData(this.value);return void 0===t&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return null===this.bufferType&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(null!==this.attribute)return;const t=this.getNodeType(e),n=this.value,r=e.getTypeLength(t),i=this.bufferStride||r,s=this.bufferOffset,a=!0===n.isInterleavedBuffer?n:new Ki(n,i),o=new Zi(a,r,s);a.setUsage(this.usage),this.attribute=o,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),r=e.getPropertyName(n);let i=null;if("vertex"===e.shaderStage||"compute"===e.shaderStage)this.name=r,i=r;else{i=J_(this).build(e,t)}return i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&!0===this.attribute.isBufferAttribute&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const yx=(e,t=null,n=0,r=0)=>Fg(new vx(e,t,n,r)),_x=(e,t=null,n=0,r=0)=>yx(e,t,n,r).setUsage(Pt),xx=(e,t=null,n=0,r=0)=>yx(e,t,n,r).setInstanced(!0),bx=(e,t=null,n=0,r=0)=>_x(e,t,n,r).setInstanced(!0);ug("toAttribute",e=>yx(e.value));class Sx extends $m{static get type(){return"ComputeNode"}constructor(e,t,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=Vm.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let n=t[0];for(let e=1;e<t.length;e++)n*=t[e];this.dispatchCount=Math.ceil(e/n)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:t}=e;if("compute"===t){const t=this.computeNode.build(e,"void");""!==t&&e.addLineFlowCode(t,this)}}}const Tx=(e,t,n)=>Fg(new Sx(Fg(e),t,n));ug("compute",Tx);class wx extends $m{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const r=this.node.getNodeType(e);return e.setCache(t),r}build(e,...t){const n=e.getCache(),r=e.getCacheFromNode(this,this.parent);e.setCache(r);const i=this.node.build(e,...t);return e.setCache(n),i}}const Mx=(e,t)=>Fg(new wx(Fg(e),t));ug("cache",Mx);class Ex extends $m{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return""!==t&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const Ax=kg(Ex);ug("bypass",Ax);class Cx extends $m{static get type(){return"RemapNode"}constructor(e,t,n,r=Xg(0),i=Xg(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=r,this.outHighNode=i,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:r,outHighNode:i,doClamp:s}=this;let a=e.sub(t).div(n.sub(t));return!0===s&&(a=a.clamp()),a.mul(i.sub(r)).add(r)}}const Rx=kg(Cx,null,null,{doClamp:!1}),Nx=kg(Cx);ug("remap",Rx),ug("remapClamp",Nx);class Px extends $m{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),r=this.snippet;if("void"!==n)return e.format(`( ${r} )`,n,t);e.addLineFlowCode(r,this)}}const Ix=kg(Px),Lx=e=>(e?G_(e,Ix("discard")):Ix("discard")).append();ug("discard",Lx);class Ux extends Qm{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const n=(null!==this.toneMapping?this.toneMapping:e.toneMapping)||0,r=(null!==this.outputColorSpace?this.outputColorSpace:e.outputColorSpace)||mt;return 0!==n&&(t=t.toneMapping(n)),r!==mt&&r!==on.workingColorSpace&&(t=t.workingToColorSpace(r)),t}}const Dx=(e,t=null,n=null)=>Fg(new Ux(Fg(e),t,n));ug("renderOutput",Dx);class Fx extends $m{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(null===t){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const r=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(r)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(!0===e.hasGeometryAttribute(t)){const r=e.geometry.getAttribute(t),i=e.getTypeFromAttribute(r),s=e.getAttribute(t,i);if("vertex"===e.shaderStage)return e.format(s.name,i,n);return J_(this).build(e,n)}return e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Bx=(e,t)=>Fg(new Fx(e,t)),Ox=(e=0)=>Bx("uv"+(e>0?e:""),"vec2");class kx extends $m{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),r=null===this.levelNode?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${r} )`,this.getNodeType(e),t)}}const zx=kg(kx);class Vx extends Sv{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=Vm.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&void 0!==n.width){const{width:e,height:t}=n;this.value=Math.log2(Math.max(e,t))}}}const Gx=kg(Vx);class Hx extends Sv{static get type(){return"TextureNode"}constructor(e,t=null,n=null,r=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=r,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Vm.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(null===t)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return!0===this.value.isDepthTexture?"float":this.value.type===ce?"uvec4":this.value.type===ue?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Ox(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return null===this._matrixUniform&&(this._matrixUniform=Tv(this.value.matrix)),this._matrixUniform.mul(tv(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?Vm.RENDER:Vm.NONE,this}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.image instanceof ImageBitmap&&!0===n.flipY||!0===n.isRenderTargetTexture||!0===n.isFramebufferTexture||!0===n.isDepthTexture)&&(t=this.sampler?t.flipY():t.setY($g(zx(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||!0!==n.isTexture)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let r=this.uvNode;null!==r&&!0!==e.context.forceUVContext||!e.context.getUV||(r=e.context.getUV(this)),r||(r=this.getDefaultUV()),!0===this.updateMatrix&&(r=this.getTransformedUV(r)),r=this.setupUV(e,r);let i=this.levelNode;null===i&&e.context.getTextureLevel&&(i=e.context.getTextureLevel(this)),t.uvNode=r,t.levelNode=i,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,!0===this.sampler?"vec2":"ivec2")}generateSnippet(e,t,n,r,i,s,a,o){const l=this.value;let u;return u=r?e.generateTextureLevel(l,t,n,r,s):i?e.generateTextureBias(l,t,n,i,s):o?e.generateTextureGrad(l,t,n,o,s):a?e.generateTextureCompare(l,t,n,a,s):!1===this.sampler?e.generateTextureLoad(l,t,n,s):e.generateTexture(l,t,n,s),u}generate(e,t){const n=this.value,r=e.getNodeProperties(this),i=super.generate(e,"property");if("sampler"===t)return i+"_sampler";if(e.isReference(t))return i;{const s=e.getDataFromNode(this);let a=s.propertyName;if(void 0===a){const{uvNode:t,levelNode:n,biasNode:o,compareNode:l,depthNode:u,gradNode:c}=r,d=this.generateUV(e,t),h=n?n.build(e,"float"):null,p=o?o.build(e,"float"):null,f=u?u.build(e,"int"):null,m=l?l.build(e,"float"):null,g=c?[c[0].build(e,"vec2"),c[1].build(e,"vec2")]:null,v=e.getVarFromNode(this);a=e.getPropertyName(v);const y=this.generateSnippet(e,i,d,h,p,f,m,g);e.addLineFlowCode(`${a} = ${y}`,this),s.snippet=y,s.propertyName=a}let o=a;const l=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(o=ux(Ix(o,l),n.colorSpace).setup(e).build(e,l)),e.format(o,l,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return this.sample(e)}sample(e){const t=this.clone();return t.uvNode=Fg(e),t.referenceNode=this.getSelf(),Fg(t)}blur(e){const t=this.clone();return t.biasNode=Fg(e).mul(Gx(t)),t.referenceNode=this.getSelf(),Fg(t)}level(e){const t=this.clone();return t.levelNode=Fg(e),t.referenceNode=this.getSelf(),Fg(t)}size(e){return zx(this,e)}bias(e){const t=this.clone();return t.biasNode=Fg(e),t.referenceNode=this.getSelf(),Fg(t)}compare(e){const t=this.clone();return t.compareNode=Fg(e),t.referenceNode=this.getSelf(),Fg(t)}grad(e,t){const n=this.clone();return n.gradNode=[Fg(e),Fg(t)],n.referenceNode=this.getSelf(),Fg(n)}depth(e){const t=this.clone();return t.depthNode=Fg(e),t.referenceNode=this.getSelf(),Fg(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;null!==t&&(t.value=e.matrix),!0===e.matrixAutoUpdate&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}const Wx=kg(Hx),jx=(...e)=>Wx(...e).setSampler(!1);class qx extends Sv{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const Xx=(e,t,n)=>Fg(new qx(e,t,n));class $x extends Ym{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),r=this.node.getPaddedType();return e.format(t,r,n)}}class Yx extends qx{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=null===t?Dm(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=Vm.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return"mat2"===e?t="mat2":!0===/mat/.test(e)?t="mat4":"i"===e.charAt(0)?t="ivec4":"u"===e.charAt(0)&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if("float"===n||"int"===n||"uint"===n)for(let n=0;n<e.length;n++){t[4*n]=e[n]}else if("color"===n)for(let n=0;n<e.length;n++){const r=4*n,i=e[n];t[r]=i.r,t[r+1]=i.g,t[r+2]=i.b||0}else if("mat2"===n)for(let n=0;n<e.length;n++){const r=4*n,i=e[n];t[r]=i.elements[0],t[r+1]=i.elements[1],t[r+2]=i.elements[2],t[r+3]=i.elements[3]}else if("mat3"===n)for(let n=0;n<e.length;n++){const r=16*n,i=e[n];t[r]=i.elements[0],t[r+1]=i.elements[1],t[r+2]=i.elements[2],t[r+4]=i.elements[3],t[r+5]=i.elements[4],t[r+6]=i.elements[5],t[r+8]=i.elements[6],t[r+9]=i.elements[7],t[r+10]=i.elements[8],t[r+15]=1}else if("mat4"===n)for(let n=0;n<e.length;n++){const r=16*n,i=e[n];for(let e=0;e<i.elements.length;e++)t[r+e]=i.elements[e]}else for(let n=0;n<e.length;n++){const r=4*n,i=e[n];t[r]=i.x,t[r+1]=i.y,t[r+2]=i.z||0,t[r+3]=i.w||0}}setup(e){const t=this.array.length,n=this.elementType;let r=Float32Array;const i=this.paddedType,s=e.getTypeLength(i);return"i"===n.charAt(0)&&(r=Int32Array),"u"===n.charAt(0)&&(r=Uint32Array),this.value=new r(t*s),this.bufferCount=t,this.bufferType=i,super.setup(e)}element(e){return Fg(new $x(this,Fg(e)))}}const Kx=(e,t)=>Fg(new Yx(e,t)),Qx=Tv(0,"uint").setGroup(yv("cameraIndex")).toVarying("v_cameraIndex"),Zx=Tv("float").label("cameraNear").setGroup(xv).onRenderUpdate(({camera:e})=>e.near),Jx=Tv("float").label("cameraFar").setGroup(xv).onRenderUpdate(({camera:e})=>e.far),eb=Vg(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){const n=[];for(const t of e.cameras)n.push(t.projectionMatrix);t=Kx(n).setGroup(xv).label("cameraProjectionMatrices").element(Qx).toVar("cameraProjectionMatrix")}else t=Tv("mat4").label("cameraProjectionMatrix").setGroup(xv).onRenderUpdate(({camera:e})=>e.projectionMatrix);return t}).once()(),tb=Tv("mat4").label("cameraProjectionMatrixInverse").setGroup(xv).onRenderUpdate(({camera:e})=>e.projectionMatrixInverse),nb=Vg(({camera:e})=>{let t;if(e.isArrayCamera&&e.cameras.length>0){const n=[];for(const t of e.cameras)n.push(t.matrixWorldInverse);t=Kx(n).setGroup(xv).label("cameraViewMatrices").element(Qx).toVar("cameraViewMatrix")}else t=Tv("mat4").label("cameraViewMatrix").setGroup(xv).onRenderUpdate(({camera:e})=>e.matrixWorldInverse);return t}).once()(),rb=Tv("mat4").label("cameraWorldMatrix").setGroup(xv).onRenderUpdate(({camera:e})=>e.matrixWorld),ib=Tv("mat3").label("cameraNormalMatrix").setGroup(xv).onRenderUpdate(({camera:e})=>e.normalMatrix),sb=Tv(new Tn).label("cameraPosition").setGroup(xv).onRenderUpdate(({camera:e},t)=>t.value.setFromMatrixPosition(e.matrixWorld)),ab=new Wn;class ob extends $m{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=Vm.OBJECT,this._uniformNode=new Sv(null)}getNodeType(){const e=this.scope;return e===ob.WORLD_MATRIX?"mat4":e===ob.POSITION||e===ob.VIEW_POSITION||e===ob.DIRECTION||e===ob.SCALE?"vec3":e===ob.RADIUS?"float":void 0}update(e){const t=this.object3d,n=this._uniformNode,r=this.scope;if(r===ob.WORLD_MATRIX)n.value=t.matrixWorld;else if(r===ob.POSITION)n.value=n.value||new Tn,n.value.setFromMatrixPosition(t.matrixWorld);else if(r===ob.SCALE)n.value=n.value||new Tn,n.value.setFromMatrixScale(t.matrixWorld);else if(r===ob.DIRECTION)n.value=n.value||new Tn,t.getWorldDirection(n.value);else if(r===ob.VIEW_POSITION){const r=e.camera;n.value=n.value||new Tn,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(r.matrixWorldInverse)}else if(r===ob.RADIUS){const r=e.object.geometry;null===r.boundingSphere&&r.computeBoundingSphere(),ab.copy(r.boundingSphere).applyMatrix4(t.matrixWorld),n.value=ab.radius}}generate(e){const t=this.scope;return t===ob.WORLD_MATRIX?this._uniformNode.nodeType="mat4":t===ob.POSITION||t===ob.VIEW_POSITION||t===ob.DIRECTION||t===ob.SCALE?this._uniformNode.nodeType="vec3":t===ob.RADIUS&&(this._uniformNode.nodeType="float"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}ob.WORLD_MATRIX="worldMatrix",ob.POSITION="position",ob.SCALE="scale",ob.VIEW_POSITION="viewPosition",ob.DIRECTION="direction",ob.RADIUS="radius";const lb=kg(ob,ob.DIRECTION),ub=kg(ob,ob.WORLD_MATRIX),cb=kg(ob,ob.POSITION),db=kg(ob,ob.SCALE),hb=kg(ob,ob.VIEW_POSITION),pb=kg(ob,ob.RADIUS);class fb extends ob{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const mb=zg(fb,fb.DIRECTION),gb=zg(fb,fb.WORLD_MATRIX),vb=zg(fb,fb.POSITION),yb=zg(fb,fb.SCALE),_b=zg(fb,fb.VIEW_POSITION),xb=zg(fb,fb.RADIUS),bb=Tv(new $t).onObjectUpdate(({object:e},t)=>t.value.getNormalMatrix(e.matrixWorld)),Sb=Tv(new Jn).onObjectUpdate(({object:e},t)=>t.value.copy(e.matrixWorld).invert()),Tb=Vg(e=>e.renderer.nodes.modelViewMatrix||wb).once()().toVar("modelViewMatrix"),wb=nb.mul(gb),Mb=Vg(e=>(e.context.isHighPrecisionModelViewMatrix=!0,Tv("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),Eb=Vg(e=>{const t=e.context.isHighPrecisionModelViewMatrix;return Tv("mat3").onObjectUpdate(({object:e,camera:n})=>(!0!==t&&e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),Ab=Bx("position","vec3"),Cb=Ab.toVarying("positionLocal"),Rb=Ab.toVarying("positionPrevious"),Nb=gb.mul(Cb).xyz.toVarying("v_positionWorld").context({needsPositionReassign:!0}),Pb=Cb.transformDirection(gb).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection").context({needsPositionReassign:!0}),Ib=Vg(e=>e.context.setupPositionView(),"vec3").once()().toVarying("v_positionView").context({needsPositionReassign:!0}),Lb=Ib.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class Ub extends $m{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:n}=e;return t.coordinateSystem===Lt&&1===n.side?"false":e.getFrontFacing()}}const Db=zg(Ub),Fb=Xg(Db).mul(2).sub(1),Bb=Bx("normal","vec3"),Ob=Vg(e=>!1===e.geometry.hasAttribute("normal")?tv(0,1,0):Bb,"vec3").once()().toVar("normalLocal"),kb=Ib.dFdx().cross(Ib.dFdy()).normalize().toVar("normalFlat"),zb=Vg(e=>{let t;return t=!0===e.material.flatShading?kb:J_(qb(Ob),"v_normalView").normalize(),t},"vec3").once()().toVar("normalView"),Vb=J_(zb.transformDirection(nb),"v_normalWorld").normalize().toVar("normalWorld"),Gb=Vg(e=>e.context.setupNormal().context({getUV:null}),"vec3").once()().mul(Fb).toVar("transformedNormalView"),Hb=Gb.transformDirection(nb).toVar("transformedNormalWorld"),Wb=Vg(e=>e.context.setupClearcoatNormal().context({getUV:null}),"vec3").once()().mul(Fb).toVar("transformedClearcoatNormalView"),jb=Vg(([e,t=gb])=>{const n=cv(t),r=e.div(tv(n[0].dot(n[0]),n[1].dot(n[1]),n[2].dot(n[2])));return n.mul(r).xyz}),qb=Vg(([e],t)=>{const n=t.renderer.nodes.modelNormalViewMatrix;if(null!==n)return n.transformDirection(e);const r=bb.mul(e);return nb.transformDirection(r)}),Xb=new ur,$b=new Jn,Yb=Tv(0).onReference(({material:e})=>e).onObjectUpdate(({material:e})=>e.refractionRatio),Kb=Tv(1).onReference(({material:e})=>e).onObjectUpdate(function({material:e,scene:t}){return e.envMap?e.envMapIntensity:t.environmentIntensity}),Qb=Tv(new Jn).onReference(function(e){return e.material}).onObjectUpdate(function({material:e,scene:t}){const n=null!==t.environment&&null===e.envMap?t.environmentRotation:e.envMapRotation;return n?(Xb.copy(n),$b.makeRotationFromEuler(Xb)):$b.identity(),$b}),Zb=Lb.negate().reflect(Gb),Jb=Lb.negate().refract(Gb,Yb),eS=Zb.transformDirection(nb).toVar("reflectVector"),tS=Jb.transformDirection(nb).toVar("reflectVector");class nS extends Hx{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,r=null){super(e,t,n,r),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===j?eS:e.mapping===q?tS:tv(0,0,0)}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return e.renderer.coordinateSystem!==Ut&&n.isRenderTargetTexture||(t=tv(t.x.negate(),t.yz)),Qb.mul(t)}generateUV(e,t){return t.build(e,"vec3")}}const rS=kg(nS);class iS extends Ym{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),r=this.getNodeType();return e.format(t,n,r)}}class sS extends $m{static get type(){return"ReferenceNode"}constructor(e,t,n=null,r=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=r,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=Vm.OBJECT}element(e){return Fg(new iS(this,Fg(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;t=null!==this.count?Xx(null,e,this.count):Array.isArray(this.getValueFromReference())?Kx(null,e):"texture"===e?Wx(null):"cubeTexture"===e?rS(null):Tv(null,e),null!==this.group&&t.setGroup(this.group),null!==this.name&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return null===this.node&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let e=1;e<t.length;e++)n=n[t[e]];return n}updateReference(e){return this.reference=null!==this.object?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){null===this.node&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const aS=(e,t,n)=>Fg(new sS(e,t,n)),oS=(e,t,n,r)=>Fg(new sS(e,t,r,n));class lS extends sS{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=null!==this.material?this.material:e.material,this.reference}}const uS=(e,t,n=null)=>Fg(new lS(e,t,n)),cS=Vg(e=>(!1===e.geometry.hasAttribute("tangent")&&e.geometry.computeTangents(),Bx("tangent","vec4")))(),dS=cS.xyz.toVar("tangentLocal"),hS=Tb.mul(sv(dS,0)).xyz.toVarying("v_tangentView").normalize().toVar("tangentView"),pS=hS.transformDirection(nb).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),fS=hS.toVar("transformedTangentView"),mS=fS.transformDirection(nb).normalize().toVar("transformedTangentWorld"),gS=e=>e.mul(cS.w).xyz,vS=J_(gS(Bb.cross(cS)),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),yS=J_(gS(Ob.cross(dS)),"v_bitangentLocal").normalize().toVar("bitangentLocal"),_S=J_(gS(zb.cross(hS)),"v_bitangentView").normalize().toVar("bitangentView"),xS=J_(gS(Vb.cross(pS)),"v_bitangentWorld").normalize().toVar("bitangentWorld"),bS=gS(Gb.cross(fS)).normalize().toVar("transformedBitangentView"),SS=bS.transformDirection(nb).normalize().toVar("transformedBitangentWorld"),TS=cv(hS,_S,zb),wS=Lb.mul(TS),MS=(()=>{let e=Vv.cross(Lb);return e=e.cross(Vv).normalize(),e=R_(e,Gb,kv.mul(Rv.oneMinus()).oneMinus().pow2().pow2()).normalize(),e})(),ES=Vg(e=>{const{eye_pos:t,surf_norm:n,mapN:r,uv:i}=e,s=t.dFdx(),a=t.dFdy(),o=i.dFdx(),l=i.dFdy(),u=n,c=a.cross(u),d=u.cross(s),h=c.mul(o.x).add(d.mul(l.x)),p=c.mul(o.y).add(d.mul(l.y)),f=h.dot(h).max(p.dot(p)),m=Fb.mul(f.inverseSqrt());return ay(h.mul(r.x,m),p.mul(r.y,m),u.mul(r.z)).normalize()});class AS extends Qm{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=0}setup(e){const{normalMapType:t,scaleNode:n}=this;let r=this.node.mul(2).sub(1);null!==n&&(r=tv(r.xy.mul(n),r.z));let i=null;if(1===t)i=qb(r);else if(0===t){i=!0===e.hasGeometryAttribute("tangent")?TS.mul(r).normalize():ES({eye_pos:Ib,surf_norm:zb,mapN:r,uv:Ox()})}return i}}const CS=kg(AS),RS=Vg(({textureNode:e,bumpScale:t})=>{const n=t=>e.cache().context({getUV:e=>t(e.uvNode||Ox()),forceUVContext:!0}),r=Xg(n(e=>e));return Qg(Xg(n(e=>e.add(e.dFdx()))).sub(r),Xg(n(e=>e.add(e.dFdy()))).sub(r)).mul(t)}),NS=Vg(e=>{const{surf_pos:t,surf_norm:n,dHdxy:r}=e,i=t.dFdx().normalize(),s=n,a=t.dFdy().normalize().cross(s),o=s.cross(i),l=i.dot(a).mul(Fb),u=l.sign().mul(r.x.mul(a).add(r.y.mul(o)));return l.abs().mul(n).sub(u).normalize()});class PS extends Qm{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=null!==this.scaleNode?this.scaleNode:1,t=RS({textureNode:this.textureNode,bumpScale:e});return NS({surf_pos:Ib,surf_norm:zb,dHdxy:t})}}const IS=kg(PS),LS=new Map;class US extends $m{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=LS.get(e);return void 0===n&&(n=uS(e,t),LS.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache("map"===e?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let r=null;if(n===US.COLOR){const e=void 0!==t.color?this.getColor(n):tv();r=t.map&&!0===t.map.isTexture?e.mul(this.getTexture("map")):e}else if(n===US.OPACITY){const e=this.getFloat(n);r=t.alphaMap&&!0===t.alphaMap.isTexture?e.mul(this.getTexture("alpha")):e}else if(n===US.SPECULAR_STRENGTH)r=t.specularMap&&!0===t.specularMap.isTexture?this.getTexture("specular").r:Xg(1);else if(n===US.SPECULAR_INTENSITY){const e=this.getFloat(n);r=t.specularIntensityMap&&!0===t.specularIntensityMap.isTexture?e.mul(this.getTexture(n).a):e}else if(n===US.SPECULAR_COLOR){const e=this.getColor(n);r=t.specularColorMap&&!0===t.specularColorMap.isTexture?e.mul(this.getTexture(n).rgb):e}else if(n===US.ROUGHNESS){const e=this.getFloat(n);r=t.roughnessMap&&!0===t.roughnessMap.isTexture?e.mul(this.getTexture(n).g):e}else if(n===US.METALNESS){const e=this.getFloat(n);r=t.metalnessMap&&!0===t.metalnessMap.isTexture?e.mul(this.getTexture(n).b):e}else if(n===US.EMISSIVE){const e=this.getFloat("emissiveIntensity"),i=this.getColor(n).mul(e);r=t.emissiveMap&&!0===t.emissiveMap.isTexture?i.mul(this.getTexture(n)):i}else if(n===US.NORMAL)t.normalMap?(r=CS(this.getTexture("normal"),this.getCache("normalScale","vec2")),r.normalMapType=t.normalMapType):r=t.bumpMap?IS(this.getTexture("bump").r,this.getFloat("bumpScale")):zb;else if(n===US.CLEARCOAT){const e=this.getFloat(n);r=t.clearcoatMap&&!0===t.clearcoatMap.isTexture?e.mul(this.getTexture(n).r):e}else if(n===US.CLEARCOAT_ROUGHNESS){const e=this.getFloat(n);r=t.clearcoatRoughnessMap&&!0===t.clearcoatRoughnessMap.isTexture?e.mul(this.getTexture(n).r):e}else if(n===US.CLEARCOAT_NORMAL)r=t.clearcoatNormalMap?CS(this.getTexture(n),this.getCache(n+"Scale","vec2")):zb;else if(n===US.SHEEN){const e=this.getColor("sheenColor").mul(this.getFloat("sheen"));r=t.sheenColorMap&&!0===t.sheenColorMap.isTexture?e.mul(this.getTexture("sheenColor").rgb):e}else if(n===US.SHEEN_ROUGHNESS){const e=this.getFloat(n);r=t.sheenRoughnessMap&&!0===t.sheenRoughnessMap.isTexture?e.mul(this.getTexture(n).a):e,r=r.clamp(.07,1)}else if(n===US.ANISOTROPY)if(t.anisotropyMap&&!0===t.anisotropyMap.isTexture){const e=this.getTexture(n);r=uv(yT.x,yT.y,yT.y.negate(),yT.x).mul(e.rg.mul(2).sub(Qg(1)).normalize().mul(e.b))}else r=yT;else if(n===US.IRIDESCENCE_THICKNESS){const e=aS("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const i=aS("0","float",t.iridescenceThicknessRange);r=e.sub(i).mul(this.getTexture(n).g).add(i)}else r=e}else if(n===US.TRANSMISSION){const e=this.getFloat(n);r=t.transmissionMap?e.mul(this.getTexture(n).r):e}else if(n===US.THICKNESS){const e=this.getFloat(n);r=t.thicknessMap?e.mul(this.getTexture(n).g):e}else if(n===US.IOR)r=this.getFloat(n);else if(n===US.LIGHT_MAP)r=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===US.AO)r=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const t=this.getNodeType(e);r=this.getCache(n,t)}return r}}US.ALPHA_TEST="alphaTest",US.COLOR="color",US.OPACITY="opacity",US.SHININESS="shininess",US.SPECULAR="specular",US.SPECULAR_STRENGTH="specularStrength",US.SPECULAR_INTENSITY="specularIntensity",US.SPECULAR_COLOR="specularColor",US.REFLECTIVITY="reflectivity",US.ROUGHNESS="roughness",US.METALNESS="metalness",US.NORMAL="normal",US.CLEARCOAT="clearcoat",US.CLEARCOAT_ROUGHNESS="clearcoatRoughness",US.CLEARCOAT_NORMAL="clearcoatNormal",US.EMISSIVE="emissive",US.ROTATION="rotation",US.SHEEN="sheen",US.SHEEN_ROUGHNESS="sheenRoughness",US.ANISOTROPY="anisotropy",US.IRIDESCENCE="iridescence",US.IRIDESCENCE_IOR="iridescenceIOR",US.IRIDESCENCE_THICKNESS="iridescenceThickness",US.IOR="ior",US.TRANSMISSION="transmission",US.THICKNESS="thickness",US.ATTENUATION_DISTANCE="attenuationDistance",US.ATTENUATION_COLOR="attenuationColor",US.LINE_SCALE="scale",US.LINE_DASH_SIZE="dashSize",US.LINE_GAP_SIZE="gapSize",US.LINE_WIDTH="linewidth",US.LINE_DASH_OFFSET="dashOffset",US.POINT_SIZE="size",US.DISPERSION="dispersion",US.LIGHT_MAP="light",US.AO="ao";const DS=zg(US,US.ALPHA_TEST),FS=zg(US,US.COLOR),BS=zg(US,US.SHININESS),OS=zg(US,US.EMISSIVE),kS=zg(US,US.OPACITY),zS=zg(US,US.SPECULAR),VS=zg(US,US.SPECULAR_INTENSITY),GS=zg(US,US.SPECULAR_COLOR),HS=zg(US,US.SPECULAR_STRENGTH),WS=zg(US,US.REFLECTIVITY),jS=zg(US,US.ROUGHNESS),qS=zg(US,US.METALNESS),XS=zg(US,US.NORMAL),$S=zg(US,US.CLEARCOAT),YS=zg(US,US.CLEARCOAT_ROUGHNESS),KS=zg(US,US.CLEARCOAT_NORMAL),QS=zg(US,US.ROTATION),ZS=zg(US,US.SHEEN),JS=zg(US,US.SHEEN_ROUGHNESS),eT=zg(US,US.ANISOTROPY),tT=zg(US,US.IRIDESCENCE),nT=zg(US,US.IRIDESCENCE_IOR),rT=zg(US,US.IRIDESCENCE_THICKNESS),iT=zg(US,US.TRANSMISSION),sT=zg(US,US.THICKNESS),aT=zg(US,US.IOR),oT=zg(US,US.ATTENUATION_DISTANCE),lT=zg(US,US.ATTENUATION_COLOR),uT=zg(US,US.LINE_SCALE),cT=zg(US,US.LINE_DASH_SIZE),dT=zg(US,US.LINE_GAP_SIZE),hT=zg(US,US.LINE_WIDTH),pT=zg(US,US.LINE_DASH_OFFSET),fT=zg(US,US.POINT_SIZE),mT=zg(US,US.DISPERSION),gT=zg(US,US.LIGHT_MAP),vT=zg(US,US.AO),yT=Tv(new Xt).onReference(function(e){return e.material}).onRenderUpdate(function({material:e}){this.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation))}),_T=Vg(e=>e.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class xT extends $m{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let r,i;if(n===xT.VERTEX)r=e.getVertexIndex();else if(n===xT.INSTANCE)r=e.getInstanceIndex();else if(n===xT.DRAW)r=e.getDrawIndex();else if(n===xT.INVOCATION_LOCAL)r=e.getInvocationLocalIndex();else if(n===xT.INVOCATION_SUBGROUP)r=e.getInvocationSubgroupIndex();else{if(n!==xT.SUBGROUP)throw new Error("THREE.IndexNode: Unknown scope: "+n);r=e.getSubgroupIndex()}if("vertex"===e.shaderStage||"compute"===e.shaderStage)i=r;else{i=J_(this).build(e,t)}return i}}xT.VERTEX="vertex",xT.INSTANCE="instance",xT.SUBGROUP="subgroup",xT.INVOCATION_LOCAL="invocationLocal",xT.INVOCATION_SUBGROUP="invocationSubgroup",xT.DRAW="draw";const bT=zg(xT,xT.VERTEX),ST=zg(xT,xT.INSTANCE),TT=zg(xT,xT.SUBGROUP),wT=zg(xT,xT.INVOCATION_SUBGROUP),MT=zg(xT,xT.INVOCATION_LOCAL),ET=zg(xT,xT.DRAW);class AT extends $m{static get type(){return"InstanceNode"}constructor(e,t,n){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Vm.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{count:t,instanceMatrix:n,instanceColor:r}=this;let{instanceMatrixNode:i,instanceColorNode:s}=this;if(null===i){if(t<=1e3)i=Xx(n.array,"mat4",Math.max(t,1)).element(ST);else{const e=new Ju(n.array,16,1);this.buffer=e;const t=n.usage===Pt?bx:xx,r=[t(e,"vec4",16,0),t(e,"vec4",16,4),t(e,"vec4",16,8),t(e,"vec4",16,12)];i=dv(...r)}this.instanceMatrixNode=i}if(r&&null===s){const e=new Ls(r.array,3),t=r.usage===Pt?bx:xx;this.bufferColor=e,s=tv(t(e,"vec3",3,0)),this.instanceColorNode=s}const a=i.mul(Cb).xyz;if(Cb.assign(a),e.hasGeometryAttribute("normal")){const e=jb(Ob,i);Ob.assign(e)}null!==this.instanceColorNode&&Ev("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==Pt&&null!==this.buffer&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==Pt&&null!==this.bufferColor&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}const CT=kg(AT);class RT extends AT{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:r}=e;super(t,n,r),this.instancedMesh=e}}const NT=kg(RT);class PT extends $m{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){null===this.batchingIdNode&&(null===e.getDrawIndex()?this.batchingIdNode=ST:this.batchingIdNode=ET);const t=Vg(([e])=>{const t=$g(zx(jx(this.batchMesh._indirectTexture),0)),n=$g(e).modInt(t),r=$g(e).div(t);return jx(this.batchMesh._indirectTexture,Zg(n,r)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]}),n=t($g(this.batchingIdNode)),r=this.batchMesh._matricesTexture,i=zx(jx(r),0),s=Xg(n).mul(4).toInt().toVar(),a=s.modInt(i),o=s.div($g(i)),l=dv(jx(r,Zg(a,o)),jx(r,Zg(a.add(1),o)),jx(r,Zg(a.add(2),o)),jx(r,Zg(a.add(3),o))),u=this.batchMesh._colorsTexture;if(null!==u){const e=Vg(([e])=>{const t=zx(jx(u),0).x,n=e,r=n.modInt(t),i=n.div(t);return jx(u,Zg(r,i)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]}),t=e(n);Ev("vec3","vBatchColor").assign(t)}const c=cv(l);Cb.assign(l.mul(Cb));const d=Ob.div(tv(c[0].dot(c[0]),c[1].dot(c[1]),c[2].dot(c[2]))),h=c.mul(d).xyz;Ob.assign(h),e.hasGeometryAttribute("tangent")&&dS.mulAssign(c)}}const IT=kg(PT),LT=new WeakMap;class UT extends $m{static get type(){return"SkinningNode"}constructor(e,t=!1){let n,r,i;super("void"),this.skinnedMesh=e,this.useReference=t,this.updateType=Vm.OBJECT,this.skinIndexNode=Bx("skinIndex","uvec4"),this.skinWeightNode=Bx("skinWeight","vec4"),t?(n=aS("bindMatrix","mat4"),r=aS("bindMatrixInverse","mat4"),i=oS("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(n=Tv(e.bindMatrix,"mat4"),r=Tv(e.bindMatrixInverse,"mat4"),i=Xx(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=n,this.bindMatrixInverseNode=r,this.boneMatricesNode=i,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=Cb){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:s}=this,a=e.element(n.x),o=e.element(n.y),l=e.element(n.z),u=e.element(n.w),c=i.mul(t),d=ay(a.mul(r.x).mul(c),o.mul(r.y).mul(c),l.mul(r.z).mul(c),u.mul(r.w).mul(c));return s.mul(d).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=Ob){const{skinIndexNode:n,skinWeightNode:r,bindMatrixNode:i,bindMatrixInverseNode:s}=this,a=e.element(n.x),o=e.element(n.y),l=e.element(n.z),u=e.element(n.w);let c=ay(r.x.mul(a),r.y.mul(o),r.z.mul(l),r.w.mul(u));return c=s.mul(c).mul(i),c.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return null===this.previousBoneMatricesNode&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=oS("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,Rb)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||!0===Bm(e.object).useVelocity}setup(e){this.needsPreviousBoneMatrices(e)&&Rb.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(Cb.assign(t),e.hasGeometryAttribute("normal")){const t=this.getSkinnedNormal();Ob.assign(t),e.hasGeometryAttribute("tangent")&&dS.assign(t)}}generate(e,t){if("void"!==t)return Cb.build(e,t)}update(e){const t=(this.useReference?e.object:this.skinnedMesh).skeleton;LT.get(t)!==e.frameId&&(LT.set(t,e.frameId),null!==this.previousBoneMatricesNode&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const DT=e=>Fg(new UT(e,!0));class FT extends $m{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode("i".charCodeAt(0)+e)}getProperties(e){const t=e.getNodeProperties(this);if(void 0!==t.stackNode)return t;const n={};for(let e=0,t=this.params.length-1;e<t;e++){const t=this.params[e],r=!0!==t.isNode&&t.name||this.getVarName(e),i=!0!==t.isNode&&t.type||"int";n[r]=Ix(r,i)}const r=e.addStack();return t.returnsNode=this.params[this.params.length-1](n,r,e),t.stackNode=r,e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),n=this.params,r=t.stackNode;for(let t=0,r=n.length-1;t<r;t++){const r=n[t];let i=null,s=null,a=null,o=null,l=null,u=null;r.isNode?(o="int",a=this.getVarName(t),i="0",s=r.build(e,o),l="<"):(o=r.type||"int",a=r.name||this.getVarName(t),i=r.start,s=r.end,l=r.condition,u=r.update,"number"==typeof i?i=e.generateConst(o,i):i&&i.isNode&&(i=i.build(e,o)),"number"==typeof s?s=e.generateConst(o,s):s&&s.isNode&&(s=s.build(e,o)),void 0!==i&&void 0===s?(i+=" - 1",s="0",l=">="):void 0!==s&&void 0===i&&(i="0",l="<"),void 0===l&&(l=Number(i)>Number(s)?">=":"<"));const c={start:i,end:s,condition:l},d=c.start,h=c.end;let p="",f="",m="";u||(u="int"===o||"uint"===o?l.includes("<")?"++":"--":l.includes("<")?"+= 1.":"-= 1."),p+=e.getVar(o,a)+" = "+d,f+=a+" "+l+" "+h,m+=a+" "+u;const g=`for ( ${p}; ${f}; ${m} )`;e.addFlowCode((0===t?"\n":"")+e.tab+g+" {\n\n").addFlowTab()}const i=r.build(e,"void"),s=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode("\n"+e.tab+i);for(let t=0,n=this.params.length-1;t<n;t++)e.addFlowCode((0===t?"":e.tab)+"}\n\n").removeFlowTab();return e.addFlowTab(),s}}const BT=(...e)=>Fg(new FT(Og(e,"int"))).append(),OT=()=>Ix("break").append(),kT=new WeakMap,zT=new vn,VT=Vg(({bufferMap:e,influence:t,stride:n,width:r,depth:i,offset:s})=>{const a=$g(bT).mul(n).add(s),o=a.div(r),l=a.sub(o.mul(r));return jx(e,Zg(l,o)).depth(i).mul(t)});class GT extends $m{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Tv(1),this.updateType=Vm.OBJECT}setup(e){const{geometry:t}=e,n=void 0!==t.morphAttributes.position,r=t.hasAttribute("normal")&&void 0!==t.morphAttributes.normal,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,s=void 0!==i?i.length:0,{texture:a,stride:o,size:l}=function(e){const t=void 0!==e.morphAttributes.position,n=void 0!==e.morphAttributes.normal,r=void 0!==e.morphAttributes.color,i=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,s=void 0!==i?i.length:0;let a=kT.get(e);if(void 0===a||a.count!==s){void 0!==a&&a.texture.dispose();const o=e.morphAttributes.position||[],l=e.morphAttributes.normal||[],u=e.morphAttributes.color||[];let c=0;!0===t&&(c=1),!0===n&&(c=2),!0===r&&(c=3);let d=e.attributes.position.count*c,h=1;const p=4096;d>p&&(h=Math.ceil(d/p),d=p);const f=new Float32Array(d*h*4*s),m=new xn(f,d,h,s);m.type=de,m.needsUpdate=!0;const g=4*c;for(let y=0;y<s;y++){const _=o[y],x=l[y],b=u[y],S=d*h*4*y;for(let T=0;T<_.count;T++){const w=T*g;!0===t&&(zT.fromBufferAttribute(_,T),f[S+w+0]=zT.x,f[S+w+1]=zT.y,f[S+w+2]=zT.z,f[S+w+3]=0),!0===n&&(zT.fromBufferAttribute(x,T),f[S+w+4]=zT.x,f[S+w+5]=zT.y,f[S+w+6]=zT.z,f[S+w+7]=0),!0===r&&(zT.fromBufferAttribute(b,T),f[S+w+8]=zT.x,f[S+w+9]=zT.y,f[S+w+10]=zT.z,f[S+w+11]=4===b.itemSize?zT.w:1)}}function v(){m.dispose(),kT.delete(e),e.removeEventListener("dispose",v)}a={count:s,texture:m,stride:c,size:new Xt(d,h)},kT.set(e,a),e.addEventListener("dispose",v)}return a}(t);!0===n&&Cb.mulAssign(this.morphBaseInfluence),!0===r&&Ob.mulAssign(this.morphBaseInfluence);const u=$g(l.width);BT(s,({i:e})=>{const t=Xg(0).toVar();this.mesh.count>1&&null!==this.mesh.morphTexture&&void 0!==this.mesh.morphTexture?t.assign(jx(this.mesh.morphTexture,Zg($g(e).add(1),$g(ST))).r):t.assign(aS("morphTargetInfluences","float").element(e).toVar()),!0===n&&Cb.addAssign(VT({bufferMap:a,influence:t,stride:o,width:u,depth:e,offset:$g(0)})),!0===r&&Ob.addAssign(VT({bufferMap:a,influence:t,stride:o,width:u,depth:e,offset:$g(1)}))})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((e,t)=>e+t,0)}}const HT=kg(GT);class WT extends $m{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class jT extends WT{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class qT extends W_{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,r=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=r,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n={directDiffuse:tv().toVar("directDiffuse"),directSpecular:tv().toVar("directSpecular"),indirectDiffuse:tv().toVar("indirectDiffuse"),indirectSpecular:tv().toVar("indirectSpecular")};return{radiance:tv().toVar("radiance"),irradiance:tv().toVar("irradiance"),iblIrradiance:tv().toVar("iblIrradiance"),ambientOcclusion:Xg(1).toVar("ambientOcclusion"),reflectedLight:n,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const XT=kg(qT);class $T extends WT{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let YT,KT;class QT extends $m{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===QT.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=Vm.NONE;return this.scope!==QT.SIZE&&this.scope!==QT.VIEWPORT||(e=Vm.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===QT.VIEWPORT?null!==t?KT.copy(t.viewport):(e.getViewport(KT),KT.multiplyScalar(e.getPixelRatio())):null!==t?(YT.width=t.width,YT.height=t.height):e.getDrawingBufferSize(YT)}setup(){const e=this.scope;let t=null;return t=e===QT.SIZE?Tv(YT||(YT=new Xt)):e===QT.VIEWPORT?Tv(KT||(KT=new vn)):Qg(ew.div(JT)),t}generate(e){if(this.scope===QT.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(JT).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}}QT.COORDINATE="coordinate",QT.VIEWPORT="viewport",QT.SIZE="size",QT.UV="uv";const ZT=zg(QT,QT.UV),JT=zg(QT,QT.SIZE),ew=zg(QT,QT.COORDINATE),tw=zg(QT,QT.VIEWPORT),nw=tw.zw,rw=ew.sub(tw.xy),iw=rw.div(nw),sw=Vg(()=>JT,"vec2").once()(),aw=Vg(()=>ZT,"vec2").once()(),ow=Vg(()=>ZT.flipY(),"vec2").once()(),lw=new Xt;class uw extends Hx{static get type(){return"ViewportTextureNode"}constructor(e=ZT,t=null,n=null){null===n&&((n=new Da).minFilter=ie),super(n,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=Vm.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(lw);const n=this.value;n.image.width===lw.width&&n.image.height===lw.height||(n.image.width=lw.width,n.image.height=lw.height,n.needsUpdate=!0);const r=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(n),n.generateMipmaps=r}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const cw=kg(uw),dw=kg(uw,null,null,{generateMipmaps:!0});let hw=null;class pw extends uw{static get type(){return"ViewportDepthTextureNode"}constructor(e=ZT,t=null){null===hw&&(hw=new Oa),super(e,t,hw)}}const fw=kg(pw);class mw extends $m{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===mw.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let r=null;if(t===mw.DEPTH_BASE)null!==n&&(r=xw().assign(n));else if(t===mw.DEPTH)r=e.isPerspectiveCamera?vw(Ib.z,Zx,Jx):gw(Ib.z,Zx,Jx);else if(t===mw.LINEAR_DEPTH)if(null!==n)if(e.isPerspectiveCamera){const e=yw(n,Zx,Jx);r=gw(e,Zx,Jx)}else r=n;else r=gw(Ib.z,Zx,Jx);return r}}mw.DEPTH_BASE="depthBase",mw.DEPTH="depth",mw.LINEAR_DEPTH="linearDepth";const gw=(e,t,n)=>e.add(t).div(t.sub(n)),vw=(e,t,n)=>t.add(e).mul(n).div(n.sub(t).mul(e)),yw=(e,t,n)=>t.mul(n).div(n.sub(t).mul(e).sub(n)),_w=(e,t,n)=>{t=t.max(1e-6).toVar();const r=zy(e.negate().div(t)),i=zy(n.div(t));return r.div(i)},xw=kg(mw,mw.DEPTH_BASE),bw=zg(mw,mw.DEPTH),Sw=kg(mw,mw.LINEAR_DEPTH),Tw=Sw(fw());bw.assign=e=>xw(e);const ww=kg(class extends $m{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}});class Mw extends $m{static get type(){return"ClippingNode"}constructor(e=Mw.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:r}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===Mw.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,r):this.scope===Mw.HARDWARE?this.setupHardwareClipping(r,e):this.setupDefault(n,r)}setupAlphaToCoverage(e,t){return Vg(()=>{const n=Xg().toVar("distanceToPlane"),r=Xg().toVar("distanceToGradient"),i=Xg(1).toVar("clipOpacity"),s=t.length;if(!1===this.hardwareClipping&&s>0){const e=Kx(t);BT(s,({i:t})=>{const s=e.element(t);n.assign(Ib.dot(s.xyz).negate().add(s.w)),r.assign(n.fwidth().div(2)),i.mulAssign(L_(r.negate(),r,n))})}const a=e.length;if(a>0){const t=Kx(e),s=Xg(1).toVar("intersectionClipOpacity");BT(a,({i:e})=>{const i=t.element(e);n.assign(Ib.dot(i.xyz).negate().add(i.w)),r.assign(n.fwidth().div(2)),s.mulAssign(L_(r.negate(),r,n).oneMinus())}),i.mulAssign(s.oneMinus())}Av.a.mulAssign(i),Av.a.equal(0).discard()})()}setupDefault(e,t){return Vg(()=>{const n=t.length;if(!1===this.hardwareClipping&&n>0){const e=Kx(t);BT(n,({i:t})=>{const n=e.element(t);Ib.dot(n.xyz).greaterThan(n.w).discard()})}const r=e.length;if(r>0){const t=Kx(e),n=Kg(!0).toVar("clipped");BT(r,({i:e})=>{const r=t.element(e);n.assign(Ib.dot(r.xyz).greaterThan(r.w).and(n))}),n.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),Vg(()=>{const r=Kx(e),i=ww(t.getClipDistance());BT(n,({i:e})=>{const t=r.element(e),n=Ib.dot(t.xyz).sub(t.w).negate();i.element(e).assign(n)})})()}}Mw.ALPHA_TO_COVERAGE="alphaToCoverage",Mw.DEFAULT="default",Mw.HARDWARE="hardware";const Ew=Vg(([e])=>qy(ly(1e4,Xy(ly(17,e.x).add(ly(.1,e.y)))).mul(ay(.1,Jy(Xy(ly(13,e.y).add(e.x))))))),Aw=Vg(([e])=>Ew(Qg(Ew(e.xy),e.z))),Cw=Vg(([e])=>{const t=f_(t_(i_(e.xyz)),t_(s_(e.xyz))),n=Xg(1).div(Xg(.05).mul(t)).toVar("pixScale"),r=Qg(Oy(Hy(zy(n))),Oy(Wy(zy(n)))),i=Qg(Aw(Hy(r.x.mul(e.xyz))),Aw(Hy(r.y.mul(e.xyz)))),s=qy(zy(n)),a=ay(ly(s.oneMinus(),i.x),ly(s,i.y)),o=p_(s,s.oneMinus()),l=tv(a.mul(a).div(ly(2,o).mul(oy(1,o))),a.sub(ly(.5,o)).div(oy(1,o)),oy(1,oy(1,a).mul(oy(1,a)).div(ly(2,o).mul(oy(1,o))))),u=a.lessThan(o.oneMinus()).select(a.lessThan(o).select(l.x,l.y),l.z);return N_(u,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class Rw extends $r{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+Cm(this)}build(e){this.setup(e)}setupObserver(e){return new Tm(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();e.addStack();const r=this.vertexNode||this.setupVertex(e);let i;e.stack.outputNode=r,this.setupHardwareClipping(e),null!==this.geometryNode&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();const s=this.setupClipping(e);if(!0!==this.depthWrite&&!0!==this.depthTest||(null!==n?!0===n.depthBuffer&&this.setupDepth(e):!0===t.depth&&this.setupDepth(e)),null===this.fragmentNode){this.setupDiffuseColor(e),this.setupVariants(e);const r=this.setupLighting(e);null!==s&&e.stack.add(s);const a=sv(r,Av.a).max(0);if(i=this.setupOutput(e,a),jv.assign(i),null!==this.outputNode&&(i=this.outputNode),null!==n){const e=t.getMRT(),n=this.mrtNode;null!==e?(i=e,null!==n&&(i=e.merge(n))):null!==n&&(i=n)}}else{let t=this.fragmentNode;!0!==t.isOutputStructNode&&(t=sv(t)),i=this.setupOutput(e,t)}e.stack.outputNode=i,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(null===e.clippingContext)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let r=null;if(t.length>0||n.length>0){const t=e.renderer.samples;this.alphaToCoverage&&t>1?r=Fg(new Mw(Mw.ALPHA_TO_COVERAGE)):e.stack.add(Fg(new Mw))}return r}setupHardwareClipping(e){if(this.hardwareClipping=!1,null===e.clippingContext)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(Fg(new Mw(Mw.HARDWARE))),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let r=this.depthNode;if(null===r){const e=t.getMRT();e&&e.has("depth")?r=e.get("depth"):!0===t.logarithmicDepthBuffer&&(r=n.isPerspectiveCamera?_w(Ib.z,Zx,Jx):gw(Ib.z,Zx,Jx))}null!==r&&bw.assign(r).append()}setupPositionView(){return Tb.mul(Cb).xyz}setupModelViewProjection(){return eb.mul(Ib)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),_T}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&HT(t).append(),!0===t.isSkinnedMesh&&DT(t).append(),this.displacementMap){const e=uS("displacementMap","texture"),t=uS("displacementScale","float"),n=uS("displacementBias","float");Cb.addAssign(Ob.normalize().mul(e.x.mul(t).add(n)))}return t.isBatchedMesh&&IT(t).append(),t.isInstancedMesh&&t.instanceMatrix&&!0===t.instanceMatrix.isInstancedBufferAttribute&&NT(t).append(),null!==this.positionNode&&Cb.assign(this.positionNode.context({isPositionNodeInput:!0})),Cb}setupDiffuseColor({object:e,geometry:t}){let n=this.colorNode?sv(this.colorNode):FS;if(!0===this.vertexColors&&t.hasAttribute("color")&&(n=sv(n.xyz.mul(Bx("color","vec3")),n.a)),e.instanceColor){n=Ev("vec3","vInstanceColor").mul(n)}if(e.isBatchedMesh&&e._colorsTexture){n=Ev("vec3","vBatchColor").mul(n)}Av.assign(n);const r=this.opacityNode?Xg(this.opacityNode):kS;if(Av.a.assign(Av.a.mul(r)),null!==this.alphaTestNode||this.alphaTest>0){const e=null!==this.alphaTestNode?Xg(this.alphaTestNode):DS;Av.a.lessThanEqual(e).discard()}!0===this.alphaHash&&Av.a.lessThan(Cw(Cb)).discard(),!1===this.transparent&&1===this.blending&&!1===this.alphaToCoverage&&Av.a.assign(1)}setupVariants(){}setupOutgoingLight(){return!0===this.lights?tv(0):Av.rgb}setupNormal(){return this.normalNode?tv(this.normalNode):XS}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?uS("envMap","cubeTexture"):uS("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new $T(gT)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const r=this.setupLightMap(e);if(r&&r.isLightingNode&&t.push(r),null!==this.aoNode||e.material.aoMap){const e=null!==this.aoNode?this.aoNode:vT;t.push(new jT(e))}let i=this.lightsNode||e.lightsNode;return t.length>0&&(i=e.renderer.lighting.createNode([...i.getLights(),...t])),i}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:r,emissiveNode:i}=this,s=!0===this.lights||null!==this.lightsNode?this.setupLights(e):null;let a=this.setupOutgoingLight(e);if(s&&s.getScope().hasLights){const t=this.setupLightingModel(e)||null;a=XT(s,t,n,r)}else null!==n&&(a=tv(null!==r?R_(a,n,r):n));return(i&&!0===i.isNode||t.emissive&&!0===t.emissive.isColor)&&(Cv.assign(tv(i||OS)),a=a.add(Cv)),a}setupFog(e,t){const n=e.fogNode;return n&&(jv.assign(t),t=sv(n)),t}setupOutput(e,t){return!0===this.fog&&(t=this.setupFog(e,t)),t}setDefaultValues(e){for(const t in e){const n=e[t];void 0===this[t]&&(this[t]=n,n&&n.clone&&(this[t]=n.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const e in t)void 0===Object.getOwnPropertyDescriptor(this.constructor.prototype,e)&&void 0!==t[e].get&&Object.defineProperty(this.constructor.prototype,e,t[e])}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{},nodes:{}});const n=$r.prototype.toJSON.call(this,e),r=Rm(this);n.inputNodes={};for(const{property:t,childNode:i}of r)n.inputNodes[t]=i.toJSON(e).uuid;function i(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(t){const t=i(e.textures),r=i(e.images),s=i(e.nodes);t.length>0&&(n.textures=t),r.length>0&&(n.images=r),s.length>0&&(n.nodes=s)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.shadowPositionNode=e.shadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const Nw=new pa;class Pw extends Rw{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(Nw),this.setValues(e)}}const Iw=new bl;class Lw extends Rw{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(Iw),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?Xg(this.offsetNode):pT,t=this.dashScaleNode?Xg(this.dashScaleNode):uT,n=this.dashSizeNode?Xg(this.dashSizeNode):cT,r=this.gapSizeNode?Xg(this.gapSizeNode):dT;qv.assign(n),Xv.assign(r);const i=J_(Bx("lineDistance").mul(t));(e?i.add(e):i).mod(qv.add(Xv)).greaterThan(qv).discard()}}let Uw=null;class Dw extends uw{static get type(){return"ViewportSharedTextureNode"}constructor(e=ZT,t=null){null===Uw&&(Uw=new Da),super(e,t,Uw)}updateReference(){return this}}const Fw=kg(Dw),Bw=e=>Fg(e).mul(.5).add(.5),Ow=new gl;class kw extends Rw{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Ow),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?Xg(this.opacityNode):kS;Av.assign(ux(sv(Bw(Gb),e),gt))}}class zw extends Qm{static get type(){return"EquirectUVNode"}constructor(e=Pb){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan(e.x).mul(1/(2*Math.PI)).add(.5),n=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Qg(t,n)}}const Vw=kg(zw);class Gw extends Hi{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,r=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i=new Ri(5,5,5),s=Vw(Pb),a=new Rw;a.colorNode=Wx(t,s,0),a.side=1,a.blending=0;const o=new Ai(i,a),l=new Yi;l.add(o),t.minFilter===ie&&(t.minFilter=ne);const u=new Vi(1,10,this),c=e.getMRT();return e.setMRT(null),u.update(e,l),e.setMRT(c),t.minFilter=n,t.currentGenerateMipmaps=r,o.geometry.dispose(),o.material.dispose(),this}}const Hw=new WeakMap;class Ww extends Qm{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=rS();const t=new Gi;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=Vm.RENDER}updateBefore(e){const{renderer:t,material:n}=e,r=this.envNode;if(r.isTextureNode||r.isMaterialReferenceNode){const e=r.isTextureNode?r.value:n[r.property];if(e&&e.isTexture){const n=e.mapping;if(n===X||n===$){if(Hw.has(e)){const t=Hw.get(e);qw(t,e.mapping),this._cubeTexture=t}else{const n=e.image;if(function(e){return null!=e&&e.height>0}(n)){const r=new Gw(n.height);r.fromEquirectangularTexture(t,e),qw(r.texture,e.mapping),this._cubeTexture=r.texture,Hw.set(e,r.texture),e.addEventListener("dispose",jw)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function jw(e){const t=e.target;t.removeEventListener("dispose",jw);const n=Hw.get(t);void 0!==n&&(Hw.delete(t),n.dispose())}function qw(e,t){t===X?e.mapping=j:t===$&&(e.mapping=q)}const Xw=kg(Ww);class $w extends WT{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=Xw(this.envNode)}}class Yw extends WT{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=Xg(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class Kw{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class Qw extends Kw{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,r=e.irradianceLightMap;n.indirectDiffuse.assign(sv(0)),r?n.indirectDiffuse.addAssign(r):n.indirectDiffuse.addAssign(sv(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(Av.rgb)}finish(e){const{material:t,context:n}=e,r=n.outgoingLight,i=e.context.environment;if(i)switch(t.combine){case 0:r.rgb.assign(R_(r.rgb,r.rgb.mul(i.rgb),HS.mul(WS)));break;case 1:r.rgb.assign(R_(r.rgb,i.rgb,HS.mul(WS)));break;case 2:r.rgb.addAssign(i.rgb.mul(HS.mul(WS)))}}}const Zw=new Yr;class Jw extends Rw{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Zw),this.setValues(e)}setupNormal(){return zb}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new $w(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new Yw(gT)),t}setupOutgoingLight(){return Av.rgb}setupLightingModel(){return new Qw}}const eM=Vg(({f0:e,f90:t,dotVH:n})=>{const r=n.mul(-5.55473).sub(6.98316).mul(n).exp2();return e.mul(r.oneMinus()).add(t.mul(r))}),tM=Vg(e=>e.diffuseColor.mul(1/Math.PI)),nM=Vg(({dotNH:e})=>Wv.mul(Xg(.5)).add(1).mul(Xg(1/Math.PI)).mul(e.pow(Wv))),rM=Vg(({lightDirection:e})=>{const t=e.add(Lb).normalize(),n=Gb.dot(t).clamp(),r=Lb.dot(t).clamp(),i=eM({f0:Gv,f90:1,dotVH:r}),s=Xg(.25),a=nM({dotNH:n});return i.mul(s).mul(a)});class iM extends Qw{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const r=Gb.dot(e).clamp().mul(t);n.directDiffuse.addAssign(r.mul(tM({diffuseColor:Av.rgb}))),!0===this.specular&&n.directSpecular.addAssign(r.mul(rM({lightDirection:e})).mul(HS))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(tM({diffuseColor:Av}))),r.indirectDiffuse.mulAssign(t)}}const sM=new vl;class aM extends Rw{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(sM),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new $w(t):null}setupLightingModel(){return new iM(!1)}}const oM=new fl;class lM extends Rw{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(oM),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new $w(t):null}setupLightingModel(){return new iM}setupVariants(){const e=(this.shininessNode?Xg(this.shininessNode):BS).max(1e-4);Wv.assign(e);const t=this.specularNode||zS;Gv.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const uM=Vg(e=>{if(!1===e.geometry.hasAttribute("normal"))return Xg(0);const t=zb.dFdx().abs().max(zb.dFdy().abs());return t.x.max(t.y).max(t.z)}),cM=Vg(e=>{const{roughness:t}=e,n=uM();let r=t.max(.0525);return r=r.add(n),r=r.min(1),r}),dM=Vg(({alpha:e,dotNL:t,dotNV:n})=>{const r=e.pow2(),i=t.mul(r.add(r.oneMinus().mul(n.pow2())).sqrt()),s=n.mul(r.add(r.oneMinus().mul(t.pow2())).sqrt());return uy(.5,i.add(s).max(Ry))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),hM=Vg(({alphaT:e,alphaB:t,dotTV:n,dotBV:r,dotTL:i,dotBL:s,dotNV:a,dotNL:o})=>{const l=o.mul(tv(e.mul(n),t.mul(r),a).length()),u=a.mul(tv(e.mul(i),t.mul(s),o).length());return uy(.5,l.add(u)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),pM=Vg(({alpha:e,dotNH:t})=>{const n=e.pow2(),r=t.pow2().mul(n.oneMinus()).oneMinus();return n.div(r.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),fM=Xg(1/Math.PI),mM=Vg(({alphaT:e,alphaB:t,dotNH:n,dotTH:r,dotBH:i})=>{const s=e.mul(t),a=tv(t.mul(r),e.mul(i),s.mul(n)),o=a.dot(a),l=s.div(o);return fM.mul(s.mul(l.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),gM=Vg(e=>{const{lightDirection:t,f0:n,f90:r,roughness:i,f:s,USE_IRIDESCENCE:a,USE_ANISOTROPY:o}=e,l=e.normalView||Gb,u=i.pow2(),c=t.add(Lb).normalize(),d=l.dot(t).clamp(),h=l.dot(Lb).clamp(),p=l.dot(c).clamp(),f=Lb.dot(c).clamp();let m,g,v=eM({f0:n,f90:r,dotVH:f});if(Lg(a)&&(v=Dv.mix(v,s)),Lg(o)){const e=zv.dot(t),n=zv.dot(Lb),r=zv.dot(c),i=Vv.dot(t),s=Vv.dot(Lb),a=Vv.dot(c);m=hM({alphaT:Ov,alphaB:u,dotTV:n,dotBV:s,dotTL:e,dotBL:i,dotNV:h,dotNL:d}),g=mM({alphaT:Ov,alphaB:u,dotNH:p,dotTH:r,dotBH:a})}else m=dM({alpha:u,dotNL:d,dotNV:h}),g=pM({alpha:u,dotNH:p});return v.mul(m).mul(g)}),vM=Vg(({roughness:e,dotNV:t})=>{const n=sv(-1,-.0275,-.572,.022),r=sv(1,.0425,1.04,-.04),i=e.mul(n).add(r),s=i.x.mul(i.x).min(t.mul(-9.28).exp2()).mul(i.x).add(i.y);return Qg(-1.04,1.04).mul(s).add(i.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),yM=Vg(e=>{const{dotNV:t,specularColor:n,specularF90:r,roughness:i}=e,s=vM({dotNV:t,roughness:i});return n.mul(s.x).add(r.mul(s.y))}),_M=Vg(({f:e,f90:t,dotVH:n})=>{const r=n.oneMinus().saturate(),i=r.mul(r),s=r.mul(i,i).clamp(0,.9999);return e.sub(tv(t).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),xM=Vg(({roughness:e,dotNH:t})=>{const n=e.pow2(),r=Xg(1).div(n),i=t.pow2().oneMinus().max(.0078125);return Xg(2).add(r).mul(i.pow(r.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),bM=Vg(({dotNV:e,dotNL:t})=>Xg(1).div(Xg(4).mul(t.add(e).sub(t.mul(e))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),SM=Vg(({lightDirection:e})=>{const t=e.add(Lb).normalize(),n=Gb.dot(e).clamp(),r=Gb.dot(Lb).clamp(),i=Gb.dot(t).clamp(),s=xM({roughness:Uv,dotNH:i}),a=bM({dotNV:r,dotNL:n});return Lv.mul(s).mul(a)}),TM=Vg(({N:e,V:t,roughness:n})=>{const r=e.dot(t).saturate(),i=Qg(n,r.oneMinus().sqrt());return i.assign(i.mul(.984375).add(.0078125)),i}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),wM=Vg(({f:e})=>{const t=e.length();return f_(t.mul(t).add(e.z).div(t.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),MM=Vg(({v1:e,v2:t})=>{const n=e.dot(t),r=n.abs().toVar(),i=r.mul(.0145206).add(.4965155).mul(r).add(.8543985).toVar(),s=r.add(4.1616724).mul(r).add(3.417594).toVar(),a=i.div(s),o=n.greaterThan(0).select(a,f_(n.mul(n).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(a));return e.cross(t).mul(o)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),EM=Vg(({N:e,V:t,P:n,mInv:r,p0:i,p1:s,p2:a,p3:o})=>{const l=s.sub(i).toVar(),u=o.sub(i).toVar(),c=l.cross(u),d=tv().toVar();return Wg(c.dot(n.sub(i)).greaterThanEqual(0),()=>{const l=t.sub(e.mul(t.dot(e))).normalize(),u=e.cross(l).negate(),c=r.mul(cv(l,u,e).transpose()).toVar(),h=c.mul(i.sub(n)).normalize().toVar(),p=c.mul(s.sub(n)).normalize().toVar(),f=c.mul(a.sub(n)).normalize().toVar(),m=c.mul(o.sub(n)).normalize().toVar(),g=tv(0).toVar();g.addAssign(MM({v1:h,v2:p})),g.addAssign(MM({v1:p,v2:f})),g.addAssign(MM({v1:f,v2:m})),g.addAssign(MM({v1:m,v2:h})),d.assign(tv(wM({f:g})))}),d}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),AM=1/6,CM=e=>ly(AM,ly(e,ly(e,e.negate().add(3)).sub(3)).add(1)),RM=e=>ly(AM,ly(e,ly(e,ly(3,e).sub(6))).add(4)),NM=e=>ly(AM,ly(e,ly(e,ly(-3,e).add(3)).add(3)).add(1)),PM=e=>ly(AM,S_(e,3)),IM=e=>CM(e).add(RM(e)),LM=e=>NM(e).add(PM(e)),UM=e=>ay(-1,RM(e).div(CM(e).add(RM(e)))),DM=e=>ay(1,PM(e).div(NM(e).add(PM(e)))),FM=(e,t,n)=>{const r=e.uvNode,i=ly(r,t.zw).add(.5),s=Hy(i),a=qy(i),o=IM(a.x),l=LM(a.x),u=UM(a.x),c=DM(a.x),d=UM(a.y),h=DM(a.y),p=Qg(s.x.add(u),s.y.add(d)).sub(.5).mul(t.xy),f=Qg(s.x.add(c),s.y.add(d)).sub(.5).mul(t.xy),m=Qg(s.x.add(u),s.y.add(h)).sub(.5).mul(t.xy),g=Qg(s.x.add(c),s.y.add(h)).sub(.5).mul(t.xy),v=IM(a.y).mul(ay(o.mul(e.sample(p).level(n)),l.mul(e.sample(f).level(n)))),y=LM(a.y).mul(ay(o.mul(e.sample(m).level(n)),l.mul(e.sample(g).level(n))));return v.add(y)},BM=Vg(([e,t=Xg(3)])=>{const n=Qg(e.size($g(t))),r=Qg(e.size($g(t.add(1)))),i=uy(1,n),s=uy(1,r),a=FM(e,sv(i,n),Hy(t)),o=FM(e,sv(s,r),Wy(t));return qy(t).mix(a,o)}),OM=Vg(([e,t,n,r,i])=>{const s=tv(I_(t.negate(),jy(e),uy(1,r))),a=tv(t_(i[0].xyz),t_(i[1].xyz),t_(i[2].xyz));return jy(s).mul(n.mul(a))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),kM=Vg(([e,t])=>e.mul(N_(t.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),zM=dw(),VM=dw(),GM=Vg(([e,t,n],{material:r})=>{const i=(1===r.side?zM:VM).sample(e),s=zy(JT.x).mul(kM(t,n));return BM(i,s)}),HM=Vg(([e,t,n])=>(Wg(n.notEqual(0),()=>{const r=ky(t).negate().div(n);return By(r.negate().mul(e))}),tv(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),WM=Vg(([e,t,n,r,i,s,a,o,l,u,c,d,h,p,f])=>{let m,g;if(f){m=sv().toVar(),g=tv().toVar();const i=c.sub(1).mul(f.mul(.025)),s=tv(c.sub(i),c,c.add(i));BT({start:0,end:3},({i:i})=>{const c=s.element(i),f=OM(e,t,d,c,o),v=a.add(f),y=u.mul(l.mul(sv(v,1))),_=Qg(y.xy.div(y.w)).toVar();_.addAssign(1),_.divAssign(2),_.assign(Qg(_.x,_.y.oneMinus()));const x=GM(_,n,c);m.element(i).assign(x.element(i)),m.a.addAssign(x.a),g.element(i).assign(r.element(i).mul(HM(t_(f),h,p).element(i)))}),m.a.divAssign(3)}else{const i=OM(e,t,d,c,o),s=a.add(i),f=u.mul(l.mul(sv(s,1))),v=Qg(f.xy.div(f.w)).toVar();v.addAssign(1),v.divAssign(2),v.assign(Qg(v.x,v.y.oneMinus())),m=GM(v,n,c),g=r.mul(HM(t_(i),h,p))}const v=g.rgb.mul(m.rgb),y=e.dot(t).clamp(),_=tv(yM({dotNV:y,specularColor:i,specularF90:s,roughness:n})),x=g.r.add(g.g,g.b).div(3);return sv(_.oneMinus().mul(v),m.a.oneMinus().mul(x).oneMinus())}),jM=cv(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),qM=(e,t)=>e.sub(t).div(e.add(t)).pow2(),XM=Vg(({outsideIOR:e,eta2:t,cosTheta1:n,thinFilmThickness:r,baseF0:i})=>{const s=R_(e,t,L_(0,.03,r)),a=e.div(s).pow2().mul(n.pow2().oneMinus()).oneMinus();Wg(a.lessThan(0),()=>tv(1));const o=a.sqrt(),l=qM(s,e),u=eM({f0:l,f90:1,dotVH:n}),c=u.oneMinus(),d=s.lessThan(e).select(Math.PI,0),h=Xg(Math.PI).sub(d),p=(e=>{const t=e.sqrt();return tv(1).add(t).div(tv(1).sub(t))})(i.clamp(0,.9999)),f=qM(p,s.toVec3()),m=eM({f0:f,f90:1,dotVH:o}),g=tv(p.x.lessThan(s).select(Math.PI,0),p.y.lessThan(s).select(Math.PI,0),p.z.lessThan(s).select(Math.PI,0)),v=s.mul(r,o,2),y=tv(h).add(g),_=u.mul(m).clamp(1e-5,.9999),x=_.sqrt(),b=c.pow2().mul(m).div(tv(1).sub(_)),S=u.add(b).toVar(),T=b.sub(c).toVar();return BT({start:1,end:2,condition:"<=",name:"m"},({m:e})=>{T.mulAssign(x);const t=((e,t)=>{const n=e.mul(2*Math.PI*1e-9),r=tv(54856e-17,44201e-17,52481e-17),i=tv(1681e3,1795300,2208400),s=tv(43278e5,93046e5,66121e5),a=Xg(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(n.mul(2239900).add(t.x).cos()).mul(n.pow2().mul(-45282e5).exp());let o=r.mul(s.mul(2*Math.PI).sqrt()).mul(i.mul(n).add(t).cos()).mul(n.pow2().negate().mul(s).exp());return o=tv(o.x.add(a),o.y,o.z).div(1.0685e-7),jM.mul(o)})(Xg(e).mul(v),Xg(e).mul(y)).mul(2);S.addAssign(T.mul(t))}),S.max(tv(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),$M=Vg(({normal:e,viewDir:t,roughness:n})=>{const r=e.dot(t).saturate(),i=n.pow2(),s=G_(n.lessThan(.25),Xg(-339.2).mul(i).add(Xg(161.4).mul(n)).sub(25.9),Xg(-8.48).mul(i).add(Xg(14.3).mul(n)).sub(9.95)),a=G_(n.lessThan(.25),Xg(44).mul(i).sub(Xg(23.7).mul(n)).add(3.26),Xg(1.97).mul(i).sub(Xg(3.27).mul(n)).add(.72));return G_(n.lessThan(.25),0,Xg(.1).mul(n).sub(.025)).add(s.mul(r).add(a).exp()).mul(1/Math.PI).saturate()}),YM=tv(.04),KM=Xg(1);class QM extends Kw{constructor(e=!1,t=!1,n=!1,r=!1,i=!1,s=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=r,this.transmission=i,this.dispersion=s,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(!0===this.clearcoat&&(this.clearcoatRadiance=tv().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=tv().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=tv().toVar("clearcoatSpecularIndirect")),!0===this.sheen&&(this.sheenSpecularDirect=tv().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=tv().toVar("sheenSpecularIndirect")),!0===this.iridescence){const e=Gb.dot(Lb).clamp();this.iridescenceFresnel=XM({outsideIOR:Xg(1),eta2:Fv,cosTheta1:e,thinFilmThickness:Bv,baseF0:Gv}),this.iridescenceF0=_M({f:this.iridescenceFresnel,f90:1,dotVH:e})}if(!0===this.transmission){const t=Nb,n=sb.sub(Nb).normalize(),r=Hb,i=e.context;i.backdrop=WM(r,n,Rv,Av,Gv,Hv,t,gb,nb,eb,Yv,Qv,Jv,Zv,this.dispersion?ey:null),i.backdropAlpha=Kv,Av.a.mulAssign(R_(1,i.backdrop.a,Kv))}super.start(e)}computeMultiscattering(e,t,n){const r=Gb.dot(Lb).clamp(),i=vM({roughness:Rv,dotNV:r}),s=(this.iridescenceF0?Dv.mix(Gv,this.iridescenceF0):Gv).mul(i.x).add(n.mul(i.y)),a=i.x.add(i.y).oneMinus(),o=Gv.add(Gv.oneMinus().mul(.047619)),l=s.mul(o).div(a.mul(o).oneMinus());e.addAssign(s),t.addAssign(l.mul(a))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const r=Gb.dot(e).clamp().mul(t);if(!0===this.sheen&&this.sheenSpecularDirect.addAssign(r.mul(SM({lightDirection:e}))),!0===this.clearcoat){const n=Wb.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(n.mul(gM({lightDirection:e,f0:YM,f90:KM,roughness:Iv,normalView:Wb})))}n.directDiffuse.addAssign(r.mul(tM({diffuseColor:Av.rgb}))),n.directSpecular.addAssign(r.mul(gM({lightDirection:e,f0:Gv,f90:1,roughness:Rv,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:r,reflectedLight:i,ltc_1:s,ltc_2:a}){const o=t.add(n).sub(r),l=t.sub(n).sub(r),u=t.sub(n).add(r),c=t.add(n).add(r),d=Gb,h=Lb,p=Ib.toVar(),f=TM({N:d,V:h,roughness:Rv}),m=s.sample(f).toVar(),g=a.sample(f).toVar(),v=cv(tv(m.x,0,m.y),tv(0,1,0),tv(m.z,0,m.w)).toVar(),y=Gv.mul(g.x).add(Gv.oneMinus().mul(g.y)).toVar();i.directSpecular.addAssign(e.mul(y).mul(EM({N:d,V:h,P:p,mInv:v,p0:o,p1:l,p2:u,p3:c}))),i.directDiffuse.addAssign(e.mul(Av).mul(EM({N:d,V:h,P:p,mInv:cv(1,0,0,0,1,0,0,0,1),p0:o,p1:l,p2:u,p3:c})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(t.mul(tM({diffuseColor:Av})))}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:r}=e.context;if(!0===this.sheen&&this.sheenSpecularIndirect.addAssign(n.mul(Lv,$M({normal:Gb,viewDir:Lb,roughness:Uv}))),!0===this.clearcoat){const e=Wb.dot(Lb).clamp(),t=yM({dotNV:e,specularColor:YM,specularF90:KM,roughness:Iv});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(t))}const i=tv().toVar("singleScattering"),s=tv().toVar("multiScattering"),a=n.mul(1/Math.PI);this.computeMultiscattering(i,s,Hv);const o=i.add(s),l=Av.mul(o.r.max(o.g).max(o.b).oneMinus());r.indirectSpecular.addAssign(t.mul(i)),r.indirectSpecular.addAssign(s.mul(a)),r.indirectDiffuse.addAssign(l.mul(a))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,r=Gb.dot(Lb).clamp().add(t),i=Rv.mul(-16).oneMinus().negate().exp2(),s=t.sub(r.pow(i).oneMinus()).clamp();!0===this.clearcoat&&this.clearcoatSpecularIndirect.mulAssign(t),!0===this.sheen&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(s)}finish({context:e}){const{outgoingLight:t}=e;if(!0===this.clearcoat){const e=Wb.dot(Lb).clamp(),n=eM({dotVH:e,f0:YM,f90:KM}),r=t.mul(Pv.mul(n).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Pv));t.assign(r)}if(!0===this.sheen){const e=Lv.r.max(Lv.g).max(Lv.b).mul(.157).oneMinus(),n=t.mul(e).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(n)}}}const ZM=Xg(1),JM=Xg(-2),eE=Xg(.8),tE=Xg(-1),nE=Xg(.4),rE=Xg(2),iE=Xg(.305),sE=Xg(3),aE=Xg(.21),oE=Xg(4),lE=Xg(4),uE=Xg(16),cE=Vg(([e])=>{const t=tv(Jy(e)).toVar(),n=Xg(-1).toVar();return Wg(t.x.greaterThan(t.z),()=>{Wg(t.x.greaterThan(t.y),()=>{n.assign(G_(e.x.greaterThan(0),0,3))}).Else(()=>{n.assign(G_(e.y.greaterThan(0),1,4))})}).Else(()=>{Wg(t.z.greaterThan(t.y),()=>{n.assign(G_(e.z.greaterThan(0),2,5))}).Else(()=>{n.assign(G_(e.y.greaterThan(0),1,4))})}),n}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),dE=Vg(([e,t])=>{const n=Qg().toVar();return Wg(t.equal(0),()=>{n.assign(Qg(e.z,e.y).div(Jy(e.x)))}).ElseIf(t.equal(1),()=>{n.assign(Qg(e.x.negate(),e.z.negate()).div(Jy(e.y)))}).ElseIf(t.equal(2),()=>{n.assign(Qg(e.x.negate(),e.y).div(Jy(e.z)))}).ElseIf(t.equal(3),()=>{n.assign(Qg(e.z.negate(),e.y).div(Jy(e.x)))}).ElseIf(t.equal(4),()=>{n.assign(Qg(e.x.negate(),e.z).div(Jy(e.y)))}).Else(()=>{n.assign(Qg(e.x,e.y).div(Jy(e.z)))}),ly(.5,n.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),hE=Vg(([e])=>{const t=Xg(0).toVar();return Wg(e.greaterThanEqual(eE),()=>{t.assign(ZM.sub(e).mul(tE.sub(JM)).div(ZM.sub(eE)).add(JM))}).ElseIf(e.greaterThanEqual(nE),()=>{t.assign(eE.sub(e).mul(rE.sub(tE)).div(eE.sub(nE)).add(tE))}).ElseIf(e.greaterThanEqual(iE),()=>{t.assign(nE.sub(e).mul(sE.sub(rE)).div(nE.sub(iE)).add(rE))}).ElseIf(e.greaterThanEqual(aE),()=>{t.assign(iE.sub(e).mul(oE.sub(sE)).div(iE.sub(aE)).add(sE))}).Else(()=>{t.assign(Xg(-2).mul(zy(ly(1.16,e))))}),t}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),pE=Vg(([e,t])=>{const n=e.toVar();n.assign(ly(2,n).sub(1));const r=tv(n,1).toVar();return Wg(t.equal(0),()=>{r.assign(r.zyx)}).ElseIf(t.equal(1),()=>{r.assign(r.xzy),r.xz.mulAssign(-1)}).ElseIf(t.equal(2),()=>{r.x.mulAssign(-1)}).ElseIf(t.equal(3),()=>{r.assign(r.zyx),r.xz.mulAssign(-1)}).ElseIf(t.equal(4),()=>{r.assign(r.xzy),r.xy.mulAssign(-1)}).ElseIf(t.equal(5),()=>{r.z.mulAssign(-1)}),r}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),fE=Vg(([e,t,n,r,i,s])=>{const a=Xg(n),o=tv(t),l=N_(hE(a),JM,s),u=qy(l),c=Hy(l),d=tv(mE(e,o,c,r,i,s)).toVar();return Wg(u.notEqual(0),()=>{const t=tv(mE(e,o,c.add(1),r,i,s)).toVar();d.assign(R_(d,t,u))}),d}),mE=Vg(([e,t,n,r,i,s])=>{const a=Xg(n).toVar(),o=tv(t),l=Xg(cE(o)).toVar(),u=Xg(f_(lE.sub(a),0)).toVar();a.assign(f_(a,lE));const c=Xg(Oy(a)).toVar(),d=Qg(dE(o,l).mul(c.sub(2)).add(1)).toVar();return Wg(l.greaterThan(2),()=>{d.y.addAssign(c),l.subAssign(3)}),d.x.addAssign(l.mul(c)),d.x.addAssign(u.mul(ly(3,uE))),d.y.addAssign(ly(4,Oy(s).sub(c))),d.x.mulAssign(r),d.y.mulAssign(i),e.sample(d).grad(Qg(),Qg())}),gE=Vg(({envMap:e,mipInt:t,outputDirection:n,theta:r,axis:i,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:o})=>{const l=$y(r),u=n.mul(l).add(i.cross(n).mul(Xy(r))).add(i.mul(i.dot(n).mul(l.oneMinus())));return mE(e,u,t,s,a,o)}),vE=Vg(({n:e,latitudinal:t,poleAxis:n,outputDirection:r,weights:i,samples:s,dTheta:a,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:d})=>{const h=tv(G_(t,n,b_(n,r))).toVar();Wg(Ly(h.equals(tv(0))),()=>{h.assign(tv(r.z,0,r.x.negate()))}),h.assign(jy(h));const p=tv().toVar();return p.addAssign(i.element(0).mul(gE({theta:0,axis:h,outputDirection:r,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:d}))),BT({start:$g(1),end:e},({i:e})=>{Wg(e.greaterThanEqual(s),()=>{OT()});const t=Xg(a.mul(Xg(e))).toVar();p.addAssign(i.element(e).mul(gE({theta:t.mul(-1),axis:h,outputDirection:r,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:d}))),p.addAssign(i.element(e).mul(gE({theta:t,axis:h,outputDirection:r,mipInt:o,envMap:l,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:d})))}),sv(p,1)}),yE=[.125,.215,.35,.446,.526,.582],_E=20,xE=new cu(-1,1,1,-1,0,1),bE=new ki(90,1),SE=new jr;let TE=null,wE=0,ME=0;const EE=(1+Math.sqrt(5))/2,AE=1/EE,CE=[new Tn(-EE,AE,0),new Tn(EE,AE,0),new Tn(-AE,0,EE),new Tn(AE,0,EE),new Tn(0,EE,-AE),new Tn(0,EE,AE),new Tn(-1,1,-1),new Tn(1,1,-1),new Tn(-1,1,1),new Tn(1,1,1)],RE=new Tn,NE=new WeakMap,PE=[3,1,5,0,4,2],IE=pE(Ox(),Bx("faceIndex")).normalize(),LE=tv(IE.x,IE.y,IE.z);class UE{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,r=100,i={}){const{size:s=256,position:a=RE,renderTarget:o=null}=i;if(this._setSize(s),!1===this._hasInitialized){const s=o||this._allocateTargets();return i.renderTarget=s,this.fromSceneAsync(e,t,n,r,i),s}TE=this._renderer.getRenderTarget(),wE=this._renderer.getActiveCubeFace(),ME=this._renderer.getActiveMipmapLevel();const l=o||this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,n,r,l,a),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}async fromSceneAsync(e,t=0,n=.1,r=100,i={}){return!1===this._hasInitialized&&await this._renderer.init(),this.fromScene(e,t,n,r,i)}fromEquirectangular(e,t=null){if(!1===this._hasInitialized){this._setSizeFromTexture(e);const n=t||this._allocateTargets();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return!1===this._hasInitialized&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(!1===this._hasInitialized){this._setSizeFromTexture(e);const n=t||this._allocateTargets();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return!1===this._hasInitialized&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=OE(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=kE(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose(),null!==this._backgroundBox&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===j||e.mapping===q?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(TE,wE,ME),e.scissorTest=!1,FE(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),TE=this._renderer.getRenderTarget(),wE=this._renderer.getActiveCubeFace(),ME=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:ne,minFilter:ne,generateMipmaps:!1,type:he,format:_e,colorSpace:vt},r=DE(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=DE(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=function(e){const t=[],n=[],r=[],i=[];let s=e;const a=e-4+1+yE.length;for(let o=0;o<a;o++){const a=Math.pow(2,s);n.push(a);let l=1/a;o>e-4?l=yE[o-e+4-1]:0===o&&(l=0),r.push(l);const u=1/(a-2),c=-u,d=1+u,h=[c,c,d,c,d,d,c,c,d,d,c,d],p=6,f=6,m=3,g=2,v=1,y=new Float32Array(m*f*p),_=new Float32Array(g*f*p),x=new Float32Array(v*f*p);for(let e=0;e<p;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0],i=PE[e];y.set(r,m*f*i),_.set(h,g*f*i);const s=[i,i,i,i,i,i];x.set(s,v*f*i)}const b=new mi;b.setAttribute("position",new ri(y,m)),b.setAttribute("uv",new ri(_,g)),b.setAttribute("faceIndex",new ri(x,v)),t.push(b),i.push(new Ai(b,null)),s>4&&s--}return{lodPlanes:t,sizeLods:n,sigmas:r,lodMeshes:i}}(r)),this._blurMaterial=function(e,t,n){const r=Kx(new Array(_E).fill(0)),i=Tv(new Tn(0,1,0)),s=Tv(0),a=Xg(_E),o=Tv(0),l=Tv(1),u=Wx(null),c=Tv(0),d=Xg(1/t),h=Xg(1/n),p=Xg(e),f={n:a,latitudinal:o,weights:r,poleAxis:i,outputDirection:LE,dTheta:s,samples:l,envMap:u,mipInt:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:p},m=BE("blur");return m.fragmentNode=vE({...f,latitudinal:o.equal(1)}),NE.set(m,f),m}(r,e,t)}return r}async _compileMaterial(e){const t=new Ai(this._lodPlanes[0],e);await this._renderer.compile(t,xE)}_sceneToCubeUV(e,t,n,r,i){const s=bE;s.near=t,s.far=n;const a=[1,1,1,1,-1,1],o=[1,-1,1,-1,1,-1],l=this._renderer,u=l.autoClear;l.getClearColor(SE),l.autoClear=!1;let c=this._backgroundBox;if(null===c){const e=new Yr({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1});c=new Ai(new Ri,e)}let d=!1;const h=e.background;h?h.isColor&&(c.material.color.copy(h),e.background=null,d=!0):(c.material.color.copy(SE),d=!0),l.setRenderTarget(r),l.clear(),d&&l.render(c,s);for(let t=0;t<6;t++){const n=t%3;0===n?(s.up.set(0,a[t],0),s.position.set(i.x,i.y,i.z),s.lookAt(i.x+o[t],i.y,i.z)):1===n?(s.up.set(0,0,a[t]),s.position.set(i.x,i.y,i.z),s.lookAt(i.x,i.y+o[t],i.z)):(s.up.set(0,a[t],0),s.position.set(i.x,i.y,i.z),s.lookAt(i.x,i.y,i.z+o[t]));const u=this._cubeSize;FE(r,n*u,t>2?u:0,u,u),l.render(e,s)}l.autoClear=u,e.background=h}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===j||e.mapping===q;r?null===this._cubemapMaterial&&(this._cubemapMaterial=OE(e)):null===this._equirectMaterial&&(this._equirectMaterial=kE(e));const i=r?this._cubemapMaterial:this._equirectMaterial;i.fragmentNode.value=e;const s=this._lodMeshes[0];s.material=i;const a=this._cubeSize;FE(t,0,0,3*a,2*a),n.setRenderTarget(t),n.render(s,xE)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let t=1;t<r;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),i=CE[(r-t-1)%CE.length];this._blur(e,t-1,t,n,i)}t.autoClear=n}_blur(e,t,n,r,i){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,n,r,"latitudinal",i),this._halfBlur(s,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,s,a){const o=this._renderer,l=this._blurMaterial,u=this._lodMeshes[r];u.material=l;const c=NE.get(l),d=this._sizeLods[n]-1,h=isFinite(i)?Math.PI/(2*d):2*Math.PI/39,p=i/h,f=isFinite(i)?1+Math.floor(3*p):_E,m=[];let g=0;for(let e=0;e<_E;++e){const t=e/p,n=Math.exp(-t*t/2);m.push(n),0===e?g+=n:e<f&&(g+=2*n)}for(let e=0;e<m.length;e++)m[e]=m[e]/g;e.texture.frame=(e.texture.frame||0)+1,c.envMap.value=e.texture,c.samples.value=f,c.weights.array=m,c.latitudinal.value="latitudinal"===s?1:0,a&&(c.poleAxis.value=a);const{_lodMax:v}=this;c.dTheta.value=h,c.mipInt.value=v-n;const y=this._sizeLods[r];FE(t,3*y*(r>v-4?r-v+4:0),4*(this._cubeSize-y),3*y,2*y),o.setRenderTarget(t),o.render(u,xE)}}function DE(e,t,n){const r=new yn(e,t,n);return r.texture.mapping=Y,r.texture.name="PMREM.cubeUv",r.texture.isPMREMTexture=!0,r.scissorTest=!0,r}function FE(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function BE(e){const t=new Rw;return t.depthTest=!1,t.depthWrite=!1,t.blending=0,t.name=`PMREM_${e}`,t}function OE(e){const t=BE("cubemap");return t.fragmentNode=rS(e,LE),t}function kE(e){const t=BE("equirect");return t.fragmentNode=Wx(e,Vw(LE),0),t}const zE=new WeakMap;function VE(e,t,n){const r=function(e){let t=zE.get(e);void 0===t&&(t=new WeakMap,zE.set(e,t));return t}(t);let i=r.get(e);if((void 0!==i?i.pmremVersion:-1)!==e.pmremVersion){const t=e.image;if(e.isCubeTexture){if(!function(e){if(null==e)return!1;let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(t))return null;i=n.fromCubemap(e,i)}else{if(!function(e){return null!=e&&e.height>0}(t))return null;i=n.fromEquirectangular(e,i)}i.pmremVersion=e.pmremVersion,r.set(e,i)}return i.texture}class GE extends Qm{static get type(){return"PMREMNode"}constructor(e,t=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const r=new gn;r.isRenderTargetTexture=!0,this._texture=Wx(r),this._width=Tv(0),this._height=Tv(0),this._maxMip=Tv(0),this.updateBeforeType=Vm.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=function(e){const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,r=this._value;n!==r.pmremVersion&&(t=!0===r.isPMREMTexture?r:VE(r,e.renderer,this._generator),null!==t&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){null===this._generator&&(this._generator=new UE(e.renderer)),this.updateBefore(e);let t=this.uvNode;null===t&&e.context.getUV&&(t=e.context.getUV(this)),t=Qb.mul(tv(t.x,t.y.negate(),t.z));let n=this.levelNode;return null===n&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),fE(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),null!==this._generator&&this._generator.dispose()}}const HE=kg(GE),WE=new WeakMap;class jE extends WT{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const e=n.isTextureNode?n.value:t[n.property];let r=WE.get(e);void 0===r&&(r=HE(e),WE.set(e,r)),n=r}const r=!0===t.useAnisotropy||t.anisotropy>0?MS:Gb,i=n.context(qE(Rv,r)).mul(Kb),s=n.context(XE(Hb)).mul(Math.PI).mul(Kb),a=Mx(i),o=Mx(s);e.context.radiance.addAssign(a),e.context.iblIrradiance.addAssign(o);const l=e.context.lightingModel.clearcoatRadiance;if(l){const e=n.context(qE(Iv,Wb)).mul(Kb),t=Mx(e);l.addAssign(t)}}}const qE=(e,t)=>{let n=null;return{getUV:()=>(null===n&&(n=Lb.negate().reflect(t),n=e.mul(e).mix(n,t).normalize(),n=n.transformDirection(nb)),n),getTextureLevel:()=>e}},XE=e=>({getUV:()=>e,getTextureLevel:()=>Xg(1)}),$E=new hl;class YE extends Rw{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues($E),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return null===t&&e.environmentNode&&(t=e.environmentNode),t?new jE(t):null}setupLightingModel(){return new QM}setupSpecular(){const e=R_(tv(.04),Av.rgb,Nv);Gv.assign(e),Hv.assign(1)}setupVariants(){const e=this.metalnessNode?Xg(this.metalnessNode):qS;Nv.assign(e);let t=this.roughnessNode?Xg(this.roughnessNode):jS;t=cM({roughness:t}),Rv.assign(t),this.setupSpecular(),Av.assign(sv(Av.rgb.mul(e.oneMinus()),Av.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const KE=new pl;class QE extends YE{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(KE),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||null!==this.clearcoatNode}get useIridescence(){return this.iridescence>0||null!==this.iridescenceNode}get useSheen(){return this.sheen>0||null!==this.sheenNode}get useAnisotropy(){return this.anisotropy>0||null!==this.anisotropyNode}get useTransmission(){return this.transmission>0||null!==this.transmissionNode}get useDispersion(){return this.dispersion>0||null!==this.dispersionNode}setupSpecular(){const e=this.iorNode?Xg(this.iorNode):aT;Yv.assign(e),Gv.assign(R_(p_(T_(Yv.sub(1).div(Yv.add(1))).mul(GS),tv(1)).mul(VS),Av.rgb,Nv)),Hv.assign(R_(VS,1,Nv))}setupLightingModel(){return new QM(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const e=this.clearcoatNode?Xg(this.clearcoatNode):$S,t=this.clearcoatRoughnessNode?Xg(this.clearcoatRoughnessNode):YS;Pv.assign(e),Iv.assign(cM({roughness:t}))}if(this.useSheen){const e=this.sheenNode?tv(this.sheenNode):ZS,t=this.sheenRoughnessNode?Xg(this.sheenRoughnessNode):JS;Lv.assign(e),Uv.assign(t)}if(this.useIridescence){const e=this.iridescenceNode?Xg(this.iridescenceNode):tT,t=this.iridescenceIORNode?Xg(this.iridescenceIORNode):nT,n=this.iridescenceThicknessNode?Xg(this.iridescenceThicknessNode):rT;Dv.assign(e),Fv.assign(t),Bv.assign(n)}if(this.useAnisotropy){const e=(this.anisotropyNode?Qg(this.anisotropyNode):eT).toVar();kv.assign(e.length()),Wg(kv.equal(0),()=>{e.assign(Qg(1,0))}).Else(()=>{e.divAssign(Qg(kv)),kv.assign(kv.saturate())}),Ov.assign(kv.pow2().mix(Rv.pow2(),1)),zv.assign(TS[0].mul(e.x).add(TS[1].mul(e.y))),Vv.assign(TS[1].mul(e.x).sub(TS[0].mul(e.y)))}if(this.useTransmission){const e=this.transmissionNode?Xg(this.transmissionNode):iT,t=this.thicknessNode?Xg(this.thicknessNode):sT,n=this.attenuationDistanceNode?Xg(this.attenuationDistanceNode):oT,r=this.attenuationColorNode?tv(this.attenuationColorNode):lT;if(Kv.assign(e),Qv.assign(t),Zv.assign(n),Jv.assign(r),this.useDispersion){const e=this.dispersionNode?Xg(this.dispersionNode):mT;ey.assign(e)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?tv(this.clearcoatNormalNode):KS}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const ZE=Vg(({normal:e,lightDirection:t,builder:n})=>{const r=e.dot(t),i=Qg(r.mul(.5).add(.5),0);if(n.material.gradientMap){const e=uS("gradientMap","texture").context({getUV:()=>i});return tv(e.r)}{const e=i.fwidth().mul(.5);return R_(tv(.7),tv(1),L_(Xg(.7).sub(e.x),Xg(.7).add(e.x),i.x))}});class JE extends Kw{direct({lightDirection:e,lightColor:t,reflectedLight:n},r){const i=ZE({normal:Bb,lightDirection:e,builder:r}).mul(t);n.directDiffuse.addAssign(i.mul(tM({diffuseColor:Av.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:r}=e.context;r.indirectDiffuse.addAssign(n.mul(tM({diffuseColor:Av}))),r.indirectDiffuse.mulAssign(t)}}const eA=new ml;class tA extends Rw{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(eA),this.setValues(e)}setupLightingModel(){return new JE}}class nA extends Qm{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=tv(Lb.z,0,Lb.x.negate()).normalize(),t=Lb.cross(e);return Qg(e.dot(Gb),t.dot(Gb)).mul(.495).add(.5)}}const rA=zg(nA),iA=new xl;class sA extends Rw{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(iA),this.setValues(e)}setupVariants(e){const t=rA;let n;n=e.material.matcap?uS("matcap","texture").context({getUV:()=>t}):tv(R_(.2,.8,t.y)),Av.rgb.mulAssign(n.rgb)}}class aA extends Qm{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if("vec2"===this.getNodeType(e)){const e=t.cos(),r=t.sin();return uv(e,r,r.negate(),e).mul(n)}{const e=t,r=dv(sv(1,0,0,0),sv(0,$y(e.x),Xy(e.x).negate(),0),sv(0,Xy(e.x),$y(e.x),0),sv(0,0,0,1)),i=dv(sv($y(e.y),0,Xy(e.y),0),sv(0,1,0,0),sv(Xy(e.y).negate(),0,$y(e.y),0),sv(0,0,0,1)),s=dv(sv($y(e.z),Xy(e.z).negate(),0,0),sv(Xy(e.z),$y(e.z),0,0),sv(0,0,1,0),sv(0,0,0,1));return r.mul(i).mul(s).mul(sv(n,1)).xyz}}}const oA=kg(aA),lA=new Ji;class uA extends Rw{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(lA),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,r=this.sizeAttenuation,{positionNode:i,rotationNode:s,scaleNode:a}=this,o=Tb.mul(tv(i||0));let l=Qg(gb[0].xyz.length(),gb[1].xyz.length());if(null!==a&&(l=l.mul(Qg(a))),!1===r)if(n.isPerspectiveCamera)l=l.mul(o.z.negate());else{const e=Xg(2).div(eb.element(1).element(1));l=l.mul(e.mul(2))}let u=Ab.xy;if(t.center&&!0===t.center.isVector2){const e=((e,t,n)=>Fg(new dx(e,t,n)))("center","vec2",t);u=u.sub(e.sub(.5))}u=u.mul(l);const c=Xg(s||QS),d=oA(u,c);return sv(o.xy.add(d),o.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const cA=new Aa;class dA extends uA{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(cA),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return Tb.mul(tv(e||Cb)).xyz}setupVertex(e){const t=super.setupVertex(e);if(!0!==e.material.isNodeMaterial)return t;const{rotationNode:n,scaleNode:r,sizeNode:i}=this,s=Ab.xy.toVar(),a=tw.z.div(tw.w);if(n&&n.isNode){const e=Xg(n);s.assign(oA(s,e))}let o=null!==i?Qg(i):fT;return!0===this.sizeAttenuation&&(o=o.mul(o.div(Ib.z.negate()))),r&&r.isNode&&(o=o.mul(Qg(r))),s.mulAssign(o.mul(2)),s.assign(s.div(tw.z)),s.y.assign(s.y.mul(a)),s.assign(s.mul(t.w)),t.addAssign(sv(s,0,0)),t}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}class hA extends Kw{constructor(){super(),this.shadowNode=Xg(1).toVar("shadowMask")}direct({shadowMask:e}){this.shadowNode.mulAssign(e)}finish(e){Av.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(Av.rgb)}}const pA=new cl;class fA extends Rw{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(pA),this.setValues(e)}setupLightingModel(){return new hA}}Mv("vec3"),Mv("vec3"),Mv("vec3");class mA{constructor(e,t){this.nodes=e,this.info=t,this._context=self,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),!0===this.info.autoReset&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,null!==this._animationLoop&&this._animationLoop(t,n)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class gA{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),void 0===t)return;return t.get(e[e.length-1])}set(e,t){let n=this.weakMap;for(let t=0;t<e.length-1;t++){const r=e[t];!1===n.has(r)&&n.set(r,new WeakMap),n=n.get(r)}return n.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),void 0===t)return!1;return t.delete(e[e.length-1])}}let vA=0;class yA{constructor(e,t,n,r,i,s,a,o,l,u){this.id=vA++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=r,this.material=i,this.scene=s,this.camera=a,this.lightsNode=o,this.context=l,this.geometry=r.geometry,this.version=i.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=u,this.clippingContextCacheKey=null!==u?u.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return null!==this.clippingContext&&this.clippingContext.cacheKey!==this.clippingContextCacheKey&&(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return!0===this.material.hardwareClipping?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null}getAttributes(){if(null!==this.attributes)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],r=new Set;for(const i of e){const e=i.node&&i.node.attribute?i.node.attribute:t.getAttribute(i.name);if(void 0===e)continue;n.push(e);const s=e.isInterleavedBufferAttribute?e.data:e;r.add(s)}return this.attributes=n,this.vertexBuffers=Array.from(r.values()),n}getVertexBuffers(){return null===this.vertexBuffers&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:r,drawRange:i}=this,s=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),a=this.getIndex(),o=null!==a,l=n.isInstancedBufferGeometry?n.instanceCount:e.count>1?e.count:1;if(0===l)return null;if(s.instanceCount=l,!0===e.isBatchedMesh)return s;let u=1;!0!==t.wireframe||e.isPoints||e.isLineSegments||e.isLine||e.isLineLoop||(u=2);let c=i.start*u,d=(i.start+i.count)*u;null!==r&&(c=Math.max(c,r.start*u),d=Math.min(d,(r.start+r.count)*u));const h=n.attributes.position;let p=1/0;o?p=a.count:null!=h&&(p=h.count),c=Math.max(c,0),d=Math.min(d,p);const f=d-c;return f<0||f===1/0?null:(s.vertexCount=f,s.firstVertex=c,s)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const r=e.attributes[n];t+=n+",",r.data&&(t+=r.data.stride+","),r.offset&&(t+=r.offset+","),r.itemSize&&(t+=r.itemSize+","),r.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const r=e.morphAttributes[n];t+="morph-"+n+",";for(let e=0,n=r.length;e<n;e++){t+=r[e].id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t}=this;let n=t.customProgramCacheKey();for(const e of function(e){const t=Object.keys(e);let n=Object.getPrototypeOf(e);for(;n;){const e=Object.getOwnPropertyDescriptors(n);for(const n in e)if(void 0!==e[n]){const r=e[n];r&&"function"==typeof r.get&&t.push(n)}n=Object.getPrototypeOf(n)}return t}(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(e))continue;const r=t[e];let i;if(null!==r){const e=typeof r;"number"===e?i=0!==r?"1":"0":"object"===e?(i="{",r.isTexture&&(i+=r.mapping),i+="}"):i=String(r)}else i=String(r);n+=i+","}return n+=this.clippingContextCacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",null!==e._colorsTexture&&(n+=e._colorsTexture.uuid+",")),e.count>1&&(n+=e.uuid+","),n+=e.receiveShadow+",",Mm(n)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return!0!==this.material.isShadowPassMaterial&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=Am(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=Am(e,1)),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const _A=[];class xA{constructor(e,t,n,r,i,s){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=r,this.bindings=i,this.info=s,this.chainMaps={}}get(e,t,n,r,i,s,a,o){const l=this.getChainMap(o);_A[0]=e,_A[1]=t,_A[2]=s,_A[3]=i;let u=l.get(_A);return void 0===u?(u=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,r,i,s,a,o),l.set(_A,u)):(u.updateClipping(a),u.needsGeometryUpdate&&u.setGeometry(e.geometry),(u.version!==t.version||u.needsUpdate)&&(u.initialCacheKey!==u.getCacheKey()?(u.dispose(),u=this.get(e,t,n,r,i,s,a,o)):u.version=t.version)),_A.length=0,u}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new gA)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,r,i,s,a,o,l,u,c){const d=this.getChainMap(c),h=new yA(e,t,n,r,i,s,a,o,l,u);return h.onDispose=()=>{this.pipelines.delete(h),this.bindings.delete(h),this.nodes.delete(h),d.delete(h.getChainArray())},h}}class bA{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return void 0===t&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const SA=1,TA=2,wA=3,MA=4,EA=16;class AA extends bA{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return void 0!==t&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(void 0===n.version)t===SA?this.backend.createAttribute(e):t===TA?this.backend.createIndexAttribute(e):t===wA?this.backend.createStorageAttribute(e):t===MA&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const t=this._getBufferAttribute(e);(n.version<t.version||t.usage===Pt)&&(this.backend.updateAttribute(e),n.version=t.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function CA(e){return null!==e.index?e.index.version:e.attributes.position.version}function RA(e){const t=[],n=e.index,r=e.attributes.position;if(null!==n){const e=n.array;for(let n=0,r=e.length;n<r;n+=3){const r=e[n+0],i=e[n+1],s=e[n+2];t.push(r,i,i,s,s,r)}}else{for(let e=0,n=r.array.length/3-1;e<n;e+=3){const n=e+0,r=e+1,i=e+2;t.push(n,r,r,i,i,n)}}const i=new(Kt(t)?si:ii)(t,1);return i.version=CA(e),i}class NA extends bA{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&!0===this.get(t).initialized}updateForRender(e){!1===this.has(e)&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry;this.get(t).initialized=!0,this.info.memory.geometries++;const n=()=>{this.info.memory.geometries--;const r=t.index,i=e.getAttributes();null!==r&&this.attributes.delete(r);for(const e of i)this.attributes.delete(e);const s=this.wireframes.get(t);void 0!==s&&this.attributes.delete(s),t.removeEventListener("dispose",n)};t.addEventListener("dispose",n)}updateAttributes(e){const t=e.getAttributes();for(const e of t)e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute?this.updateAttribute(e,wA):this.updateAttribute(e,SA);const n=this.getIndex(e);null!==n&&this.updateAttribute(n,TA);const r=e.geometry.indirect;null!==r&&this.updateAttribute(r,MA)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?void 0===this.attributeCall.get(e)?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:n}=e;let r=t.index;if(!0===n.wireframe){const e=this.wireframes;let n=e.get(t);void 0===n?(n=RA(t),e.set(t,n)):n.version!==CA(t)&&(this.attributes.delete(n),n=RA(t),e.set(t,n)),r=n}return r}}class PA{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine&&(this.render.lines+=n*(t-1))}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class IA{constructor(e){this.cacheKey=e,this.usedTimes=0}}class LA extends IA{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class UA extends IA{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let DA=0;class FA{constructor(e,t,n,r=null,i=null){this.id=DA++,this.code=e,this.stage=t,this.name=n,this.transforms=r,this.attributes=i,this.usedTimes=0}}class BA extends bA{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,r=this.get(e);if(this._needsComputeUpdate(e)){const i=r.pipeline;i&&(i.usedTimes--,i.computeProgram.usedTimes--);const s=this.nodes.getForCompute(e);let a=this.programs.compute.get(s.computeShader);void 0===a&&(i&&0===i.computeProgram.usedTimes&&this._releaseProgram(i.computeProgram),a=new FA(s.computeShader,"compute",e.name,s.transforms,s.nodeAttributes),this.programs.compute.set(s.computeShader,a),n.createProgram(a));const o=this._getComputeCacheKey(e,a);let l=this.caches.get(o);void 0===l&&(i&&0===i.usedTimes&&this._releasePipeline(i),l=this._getComputePipeline(e,a,o,t)),l.usedTimes++,a.usedTimes++,r.version=e.version,r.pipeline=l}return r.pipeline}getForRender(e,t=null){const{backend:n}=this,r=this.get(e);if(this._needsRenderUpdate(e)){const i=r.pipeline;i&&(i.usedTimes--,i.vertexProgram.usedTimes--,i.fragmentProgram.usedTimes--);const s=e.getNodeBuilderState(),a=e.material?e.material.name:"";let o=this.programs.vertex.get(s.vertexShader);void 0===o&&(i&&0===i.vertexProgram.usedTimes&&this._releaseProgram(i.vertexProgram),o=new FA(s.vertexShader,"vertex",a),this.programs.vertex.set(s.vertexShader,o),n.createProgram(o));let l=this.programs.fragment.get(s.fragmentShader);void 0===l&&(i&&0===i.fragmentProgram.usedTimes&&this._releaseProgram(i.fragmentProgram),l=new FA(s.fragmentShader,"fragment",a),this.programs.fragment.set(s.fragmentShader,l),n.createProgram(l));const u=this._getRenderCacheKey(e,o,l);let c=this.caches.get(u);void 0===c?(i&&0===i.usedTimes&&this._releasePipeline(i),c=this._getRenderPipeline(e,o,l,u,t)):e.pipeline=c,c.usedTimes++,o.usedTimes++,l.usedTimes++,r.pipeline=c}return r.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,0===t.usedTimes&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,0===t.computeProgram.usedTimes&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,0===t.vertexProgram.usedTimes&&this._releaseProgram(t.vertexProgram),0===t.fragmentProgram.usedTimes&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,r){n=n||this._getComputeCacheKey(e,t);let i=this.caches.get(n);return void 0===i&&(i=new UA(n,t),this.caches.set(n,i),this.backend.createComputePipeline(i,r)),i}_getRenderPipeline(e,t,n,r,i){r=r||this._getRenderCacheKey(e,t,n);let s=this.caches.get(r);return void 0===s&&(s=new LA(r,t,n),this.caches.set(r,s),e.pipeline=s,this.backend.createRenderPipeline(e,i)),s}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return void 0===t.pipeline||t.version!==e.version}_needsRenderUpdate(e){return void 0===this.get(e).pipeline||this.backend.needsRenderUpdate(e)}}class OA extends bA{constructor(e,t,n,r,i,s){super(),this.backend=e,this.textures=n,this.pipelines=i,this.attributes=r,this.nodes=t,this.info=s,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const e of t){const n=this.get(e);void 0===n.bindGroup&&(this._init(e),this.backend.createBindings(e,t,0),n.bindGroup=e)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const e of t){const n=this.get(e);void 0===n.bindGroup&&(this._init(e),this.backend.createBindings(e,t,0),n.bindGroup=e)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const e=t.attribute,n=e.isIndirectStorageBufferAttribute?MA:wA;this.attributes.update(e,n)}}_update(e,t){const{backend:n}=this;let r=!1,i=!0,s=0,a=0;for(const t of e.bindings){if(t.isNodeUniformsGroup){if(!1===this.nodes.updateGroup(t))continue}if(t.isStorageBuffer){const e=t.attribute,n=e.isIndirectStorageBufferAttribute?MA:wA;this.attributes.update(e,n)}if(t.isUniformBuffer){t.update()&&n.updateBinding(t)}else if(t.isSampler)t.update();else if(t.isSampledTexture){const e=this.textures.get(t.texture);t.needsBindingsUpdate(e.generation)&&(r=!0);const o=t.update(),l=t.texture;o&&this.textures.updateTexture(l);const u=n.get(l);if(void 0!==u.externalTexture||e.isDefaultTexture?i=!1:(s=10*s+l.id,a+=l.version),!0===n.isWebGPUBackend&&void 0===u.texture&&void 0===u.externalTexture&&(this.textures.updateTexture(l),r=!0),!0===l.isStorageTexture){const e=this.get(l);!0===t.store?e.needsMipmap=!0:this.textures.needsMipmaps(l)&&!0===e.needsMipmap&&(this.backend.generateMipmaps(l),e.needsMipmap=!1)}}}!0===r&&this.backend.updateBindings(e,t,i?s:0,a)}}function kA(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function zA(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function VA(e){return(e.transmission>0||e.transmissionNode)&&2===e.side&&!1===e.forceSinglePass}class GA{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,r,i,s,a){let o=this.renderItems[this.renderItemsIndex];return void 0===o?(o={id:e.id,object:e,geometry:t,material:n,groupOrder:r,renderOrder:e.renderOrder,z:i,group:s,clippingContext:a},this.renderItems[this.renderItemsIndex]=o):(o.id=e.id,o.object=e,o.geometry=t,o.material=n,o.groupOrder=r,o.renderOrder=e.renderOrder,o.z=i,o.group=s,o.clippingContext=a),this.renderItemsIndex++,o}push(e,t,n,r,i,s,a){const o=this.getNextRenderItem(e,t,n,r,i,s,a);!0===e.occlusionTest&&this.occlusionQueryCount++,!0===n.transparent||n.transmission>0?(VA(n)&&this.transparentDoublePass.push(o),this.transparent.push(o)):this.opaque.push(o)}unshift(e,t,n,r,i,s,a){const o=this.getNextRenderItem(e,t,n,r,i,s,a);!0===n.transparent||n.transmission>0?(VA(n)&&this.transparentDoublePass.unshift(o),this.transparent.unshift(o)):this.opaque.unshift(o)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||kA),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||zA),this.transparent.length>1&&this.transparent.sort(t||zA)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const t=this.renderItems[e];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.groupOrder=null,t.renderOrder=null,t.z=null,t.group=null,t.clippingContext=null}}}const HA=[];class WA{constructor(e){this.lighting=e,this.lists=new gA}get(e,t){const n=this.lists;HA[0]=e,HA[1]=t;let r=n.get(HA);return void 0===r&&(r=new GA(this.lighting,e,t),n.set(HA,r)),HA.length=0,r}dispose(){this.lists=new gA}}let jA=0;class qA{constructor(){this.id=jA++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new vn,this.scissor=!1,this.scissorValue=new vn,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return XA(this)}}function XA(e){const{textures:t,activeCubeFace:n}=e,r=[n];for(const e of t)r.push(e.id);return Em(r)}const $A=[],YA=new Yi,KA=new Di;class QA{constructor(){this.chainMaps={}}get(e,t,n=null){let r;if($A[0]=e,$A[1]=t,null===n)r="default";else{const e=n.texture.format;r=`${n.textures.length}:${e}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const i=this._getChainMap(r);let s=i.get($A);return void 0===s&&(s=new qA,i.set($A,s)),$A.length=0,null!==n&&(s.sampleCount=0===n.samples?1:n.samples),s}getForClear(e=null){return this.get(YA,KA,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new gA)}dispose(){this.chainMaps={}}}const ZA=new Tn;class JA extends bA{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){const n=this.get(e),r=0===e.samples?1:e.samples,i=n.depthTextureMips||(n.depthTextureMips={}),s=e.textures,a=this.getSize(s[0]),o=a.width>>t,l=a.height>>t;let u=e.depthTexture||i[t];const c=!0===e.depthBuffer||!0===e.stencilBuffer;let d=!1;void 0===u&&c&&(u=new Oa,u.format=e.stencilBuffer?Te:Se,u.type=e.stencilBuffer?me:ce,u.image.width=o,u.image.height=l,i[t]=u),n.width===a.width&&a.height===n.height||(d=!0,u&&(u.needsUpdate=!0,u.image.width=o,u.image.height=l)),n.width=a.width,n.height=a.height,n.textures=s,n.depthTexture=u||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==r&&(d=!0,u&&(u.needsUpdate=!0),n.sampleCount=r);const h={sampleCount:r};if(!0!==e.isXRRenderTarget){for(let e=0;e<s.length;e++){const t=s[e];d&&(t.needsUpdate=!0),this.updateTexture(t,h)}u&&this.updateTexture(u,h)}if(!0!==n.initialized){n.initialized=!0;const t=()=>{e.removeEventListener("dispose",t);for(let e=0;e<s.length;e++)this._destroyTexture(s[e]);u&&this._destroyTexture(u),this.delete(e)};e.addEventListener("dispose",t)}}updateTexture(e,t={}){const n=this.get(e);if(!0===n.initialized&&n.version===e.version)return;const r=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,i=this.backend;if(r&&!0===n.initialized&&(i.destroySampler(e),i.destroyTexture(e)),e.isFramebufferTexture){const t=this.renderer.getRenderTarget();e.type=t?t.texture.type:se}const{width:s,height:a,depth:o}=this.getSize(e);if(t.width=s,t.height=a,t.depth=o,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,s,a):1,r||!0===e.isStorageTexture)i.createSampler(e),i.createTexture(e,t),n.generation=e.version;else{if(!0!==n.initialized&&i.createSampler(e),e.version>0){const r=e.image;if(void 0===r);else if(!1===r.complete);else{if(e.images){const n=[];for(const t of e.images)n.push(t);t.images=n}else t.image=r;void 0!==n.isDefaultTexture&&!0!==n.isDefaultTexture||(i.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),!0===e.source.dataReady&&i.updateTexture(e,t),t.needsMipmaps&&0===e.mipmaps.length&&i.generateMipmaps(e)}}else i.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version}if(!0!==n.initialized){n.initialized=!0,n.generation=e.version,this.info.memory.textures++;const t=()=>{e.removeEventListener("dispose",t),this._destroyTexture(e),this.info.memory.textures--};e.addEventListener("dispose",t)}n.version=e.version}getSize(e,t=ZA){let n=e.images?e.images[0]:e.image;return n?(void 0!==n.image&&(n=n.image),t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let r;return r=e.isCompressedTexture?e.mipmaps?e.mipmaps.length:1:Math.floor(Math.log2(Math.max(t,n)))+1,r}needsMipmaps(e){return this.isEnvironmentTexture(e)||!0===e.isCompressedTexture||e.generateMipmaps}isEnvironmentTexture(e){const t=e.mapping;return t===X||t===$||t===j||t===q}_destroyTexture(e){this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e)}}class eC extends jr{constructor(e,t,n,r=1){super(e,t,n),this.a=r}set(e,t,n,r=1){return this.a=r,super.set(e,t,n)}copy(e){return void 0!==e.a&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class tC extends wv{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}class nC extends $m{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.outputNode?this.outputNode.getMemberType(e,t):"void"}add(e){return this.nodes.push(e),this}If(e,t){const n=new Dg(t);return this._currentCond=G_(e,n),this.add(this._currentCond)}ElseIf(e,t){const n=new Dg(t),r=G_(e,n);return this._currentCond.elseNode=r,this._currentCond=r,this}Else(e){return this._currentCond.elseNode=new Dg(e),this}build(e,...t){const n=Hg();Gg(this);for(const t of this.nodes)t.build(e,"void");return Gg(n),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}else(...e){return this.Else(...e)}elseif(...e){return this.ElseIf(...e)}}const rC=kg(nC);class iC extends $m{static get type(){return"StructTypeNode"}constructor(e,t=null){var n;super("struct"),this.membersLayout=(n=e,Object.entries(n).map(([e,t])=>"string"==typeof t?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})),this.name=t,this.isStructLayoutNode=!0}getLength(){let e=0;for(const t of this.membersLayout)e+=Um(t.type);return e}getMemberType(e,t){const n=this.membersLayout.find(e=>e.name===t);return n?n.type:"void"}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.addInclude(this)}generate(e){return this.getNodeType(e)}}class sC extends $m{static get type(){return"StructNode"}constructor(e,t){super("vec3"),this.structLayoutNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structLayoutNode.getNodeType(e)}getMemberType(e,t){return this.structLayoutNode.getMemberType(e,t)}generate(e){const t=e.getVarFromNode(this),n=t.type,r=e.getPropertyName(t);return e.addLineFlowCode(`${r} = ${e.generateStruct(n,this.structLayoutNode.membersLayout,this.values)}`,this),t.name}}class aC extends $m{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(e){const t=e.getNodeProperties(this);if(void 0===t.membersLayout){const n=this.members,r=[];for(let t=0;t<n.length;t++){const i="m"+t,s=n[t].getNodeType(e);r.push({name:i,type:s,index:t})}t.membersLayout=r,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}return t.structType.name}generate(e){const t=e.getOutputStructName(),n=this.members,r=""!==t?t+".":"";for(let t=0;t<n.length;t++){const i=n[t].build(e);e.addLineFlowCode(`${r}m${t} = ${i}`,this)}return t}}const oC=kg(aC);function lC(e,t){for(let n=0;n<e.length;n++)if(e[n].name===t)return n;return-1}class uC extends aC{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return void 0!==this.outputNodes[e]}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes};return cC(t)}setup(e){const t=this.outputNodes,n=[],r=e.renderer.getRenderTarget().textures;for(const e in t){n[lC(r,e)]=sv(t[e])}return this.members=n,super.setup(e)}}const cC=kg(uC),dC=Vg(([e])=>{const t=e.toUint().mul(747796405).add(2891336453),n=t.shiftRight(t.shiftRight(28).add(4)).bitXor(t).mul(277803737);return n.shiftRight(22).bitXor(n).toFloat().mul(1/2**32)}),hC=(e,t)=>S_(ly(4,e.mul(oy(1,e))),t),pC=Vg(([e])=>e.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),fC=Vg(([e])=>tv(pC(e.z.add(pC(e.y.mul(1)))),pC(e.z.add(pC(e.x.mul(1)))),pC(e.y.add(pC(e.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),mC=Vg(([e,t,n])=>{const r=tv(e).toVar(),i=Xg(1.4).toVar(),s=Xg(0).toVar(),a=tv(r).toVar();return BT({start:Xg(0),end:Xg(3),type:"float",condition:"<="},()=>{const e=tv(fC(a.mul(2))).toVar();r.addAssign(e.add(n.mul(Xg(.1).mul(t)))),a.mulAssign(1.8),i.mulAssign(1.5),r.mulAssign(1.2);const o=Xg(pC(r.z.add(pC(r.x.add(pC(r.y)))))).toVar();s.addAssign(o.div(i)),a.addAssign(.14)}),s}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class gC extends $m{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFnCall=null,this.global=!0}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){const t=this.parametersNodes;let n=this._candidateFnCall;if(null===n){let r=null,i=-1;for(const n of this.functionNodes){const s=n.shaderNode.layout;if(null===s)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const a=s.inputs;if(t.length===a.length){let s=0;for(let n=0;n<t.length;n++){const r=t[n],i=a[n];r.getNodeType(e)===i.type?s++:s=0}s>i&&(r=n,i=s)}}this._candidateFnCall=n=r(...t)}return n}}const vC=kg(gC),yC=e=>(...t)=>vC(e,...t),_C=Tv(0).setGroup(xv).onRenderUpdate(e=>e.time),xC=Tv(0).setGroup(xv).onRenderUpdate(e=>e.deltaTime),bC=Tv(0,"uint").setGroup(xv).onRenderUpdate(e=>e.frameId),SC=Vg(([e,t,n=Qg(.5)])=>oA(e.sub(n),t).add(n)),TC=Vg(([e,t,n=Qg(.5)])=>{const r=e.sub(n),i=r.dot(r),s=i.mul(i).mul(t);return e.add(r.mul(s))}),wC=Vg(({position:e=null,horizontal:t=!0,vertical:n=!1})=>{let r;null!==e?(r=gb.toVar(),r[3][0]=e.x,r[3][1]=e.y,r[3][2]=e.z):r=gb;const i=nb.mul(r);return Lg(t)&&(i[0][0]=gb[0].length(),i[0][1]=0,i[0][2]=0),Lg(n)&&(i[1][0]=0,i[1][1]=gb[1].length(),i[1][2]=0),i[2][0]=0,i[2][1]=0,i[2][2]=1,eb.mul(i).mul(Cb)}),MC=Vg(([e=null])=>{const t=Sw();return Sw(fw(e)).sub(t).lessThan(0).select(ZT,e)});class EC extends $m{static get type(){return"SpriteSheetUVNode"}constructor(e,t=Ox(),n=Xg(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=n}setup(){const{frameNode:e,uvNode:t,countNode:n}=this,{width:r,height:i}=n,s=e.mod(r.mul(i)).floor(),a=s.mod(r),o=i.sub(s.add(1).div(r).ceil()),l=n.reciprocal(),u=Qg(a,o);return t.add(u).mul(l)}}const AC=kg(EC);class CC extends $m{static get type(){return"TriplanarTexturesNode"}constructor(e,t=null,n=null,r=Xg(1),i=Cb,s=Ob){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=n,this.scaleNode=r,this.positionNode=i,this.normalNode=s}setup(){const{textureXNode:e,textureYNode:t,textureZNode:n,scaleNode:r,positionNode:i,normalNode:s}=this;let a=s.abs().normalize();a=a.div(a.dot(tv(1)));const o=i.yz.mul(r),l=i.zx.mul(r),u=i.xy.mul(r),c=e.value,d=null!==t?t.value:c,h=null!==n?n.value:c,p=Wx(c,o).mul(a.x),f=Wx(d,l).mul(a.y),m=Wx(h,u).mul(a.z);return ay(p,f,m)}}const RC=kg(CC),NC=new js,PC=new Tn,IC=new Tn,LC=new Tn,UC=new Jn,DC=new Tn(0,0,-1),FC=new vn,BC=new Tn,OC=new Tn,kC=new vn,zC=new Xt,VC=new yn,GC=ZT.flipX();VC.depthTexture=new Oa(1,1);let HC=!1;class WC extends Hx{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||VC.texture,GC),this._reflectorBaseNode=e.reflector||new jC(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(null===this._depthNode){if(!0!==this._reflectorBaseNode.depth)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=Fg(new WC({defaultTexture:VC.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){const e=new this.constructor(this.reflectorNode);return e._reflectorBaseNode=this._reflectorBaseNode,e}}class jC extends $m{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();const{target:n=new Er,resolution:r=1,generateMipmaps:i=!1,bounces:s=!0,depth:a=!1}=t;this.textureNode=e,this.target=n,this.resolution=r,this.generateMipmaps=i,this.bounces=s,this.depth=a,this.updateBeforeType=s?Vm.RENDER:Vm.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new WeakMap,this.forceUpdate=!1}_updateResolution(e,t){const n=this.resolution;t.getDrawingBufferSize(zC),e.setSize(Math.round(zC.width*n),Math.round(zC.height*n))}setup(e){return this._updateResolution(VC,e.renderer),super.setup(e)}getVirtualCamera(e){let t=this.virtualCameras.get(e);return void 0===t&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return void 0===t&&(t=new yn(0,0,{type:he}),!0===this.generateMipmaps&&(t.texture.minFilter=1008,t.texture.generateMipmaps=!0),!0===this.depth&&(t.depthTexture=new Oa),this.renderTargets.set(e,t)),t}updateBefore(e){if(!1===this.bounces&&HC)return!1;HC=!0;const{scene:t,camera:n,renderer:r,material:i}=e,{target:s}=this,a=this.getVirtualCamera(n),o=this.getRenderTarget(a);r.getDrawingBufferSize(zC),this._updateResolution(o,r),IC.setFromMatrixPosition(s.matrixWorld),LC.setFromMatrixPosition(n.matrixWorld),UC.extractRotation(s.matrixWorld),PC.set(0,0,1),PC.applyMatrix4(UC),BC.subVectors(IC,LC);if(!0===BC.dot(PC)>0&&!1===this.forceUpdate)return;BC.reflect(PC).negate(),BC.add(IC),UC.extractRotation(n.matrixWorld),DC.set(0,0,-1),DC.applyMatrix4(UC),DC.add(LC),OC.subVectors(IC,DC),OC.reflect(PC).negate(),OC.add(IC),a.coordinateSystem=n.coordinateSystem,a.position.copy(BC),a.up.set(0,1,0),a.up.applyMatrix4(UC),a.up.reflect(PC),a.lookAt(OC),a.near=n.near,a.far=n.far,a.updateMatrixWorld(),a.projectionMatrix.copy(n.projectionMatrix),NC.setFromNormalAndCoplanarPoint(PC,IC),NC.applyMatrix4(a.matrixWorldInverse),FC.set(NC.normal.x,NC.normal.y,NC.normal.z,NC.constant);const l=a.projectionMatrix;kC.x=(Math.sign(FC.x)+l.elements[8])/l.elements[0],kC.y=(Math.sign(FC.y)+l.elements[9])/l.elements[5],kC.z=-1,kC.w=(1+l.elements[10])/l.elements[14],FC.multiplyScalar(1/FC.dot(kC));l.elements[2]=FC.x,l.elements[6]=FC.y,l.elements[10]=r.coordinateSystem===Ut?FC.z-0:FC.z+1-0,l.elements[14]=FC.w,this.textureNode.value=o.texture,!0===this.depth&&(this.textureNode.getDepthNode().value=o.depthTexture),i.visible=!1;const u=r.getRenderTarget(),c=r.getMRT(),d=r.autoClear;r.setMRT(null),r.setRenderTarget(o),r.autoClear=!0,r.render(t,a),r.setMRT(c),r.setRenderTarget(u),r.autoClear=d,i.visible=!0,HC=!1,this.forceUpdate=!1}}const qC=new cu(-1,1,1,-1,0,1);class XC extends mi{constructor(e=!1){super();const t=!1===e?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new oi([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new oi(t,2))}}const $C=new XC;class YC extends Ai{constructor(e=null){super($C,e),this.camera=qC,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,qC)}render(e){e.render(this,qC)}}const KC=new Xt;class QC extends Hx{static get type(){return"RTTNode"}constructor(e,t=null,n=null,r={type:he}){const i=new yn(t,n,r);super(i.texture,Ox()),this.node=e,this.width=t,this.height=n,this.pixelRatio=1,this.renderTarget=i,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new YC(new Rw),this.updateBeforeType=Vm.RENDER}get autoSize(){return null===this.width}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const n=e*this.pixelRatio,r=t*this.pixelRatio;this.renderTarget.setSize(n,r),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(!1===this.textureNeedsUpdate&&!1===this.autoUpdate)return;if(this.textureNeedsUpdate=!1,!0===this.autoSize){this.pixelRatio=e.getPixelRatio();const t=e.getSize(KC);this.setSize(t.width,t.height)}this._quadMesh.material.fragmentNode=this._rttNode;const t=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(t)}clone(){const e=new Hx(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const ZC=(e,...t)=>Fg(new QC(Fg(e),...t)),JC=Vg(([e,t,n],r)=>{let i;r.renderer.coordinateSystem===Ut?(e=Qg(e.x,e.y.oneMinus()).mul(2).sub(1),i=sv(tv(e,t),1)):i=sv(tv(e.x,e.y.oneMinus(),t).mul(2).sub(1),1);const s=sv(n.mul(i));return s.xyz.div(s.w)}),eR=Vg(([e,t])=>{const n=t.mul(sv(e,1)),r=n.xy.div(n.w).mul(.5).add(.5).toVar();return Qg(r.x,r.y.oneMinus())}),tR=Vg(([e,t,n])=>{const r=zx(jx(t)),i=Zg(e.mul(r)).toVar(),s=jx(t,i).toVar(),a=jx(t,i.sub(Zg(2,0))).toVar(),o=jx(t,i.sub(Zg(1,0))).toVar(),l=jx(t,i.add(Zg(1,0))).toVar(),u=jx(t,i.add(Zg(2,0))).toVar(),c=jx(t,i.add(Zg(0,2))).toVar(),d=jx(t,i.add(Zg(0,1))).toVar(),h=jx(t,i.sub(Zg(0,1))).toVar(),p=jx(t,i.sub(Zg(0,2))).toVar(),f=Jy(oy(Xg(2).mul(o).sub(a),s)).toVar(),m=Jy(oy(Xg(2).mul(l).sub(u),s)).toVar(),g=Jy(oy(Xg(2).mul(d).sub(c),s)).toVar(),v=Jy(oy(Xg(2).mul(h).sub(p),s)).toVar(),y=JC(e,s,n).toVar(),_=f.lessThan(m).select(y.sub(JC(e.sub(Qg(Xg(1).div(r.x),0)),o,n)),y.negate().add(JC(e.add(Qg(Xg(1).div(r.x),0)),l,n))),x=g.lessThan(v).select(y.sub(JC(e.add(Qg(0,Xg(1).div(r.y))),d,n)),y.negate().add(JC(e.sub(Qg(0,Xg(1).div(r.y))),h,n)));return jy(b_(_,x))});class nR extends Ls{constructor(e,t,n=Float32Array){super(ArrayBuffer.isView(e)?e:new n(e*t),t),this.isStorageInstancedBufferAttribute=!0}}class rR extends ri{constructor(e,t,n=Float32Array){super(ArrayBuffer.isView(e)?e:new n(e*t),t),this.isStorageBufferAttribute=!0}}class iR extends Ym{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const n=this.storageBufferNode.structTypeNode;return n?n.getMemberType(e,t):"void"}setup(e){return!1===e.isAvailable("storageBuffer")&&!0===this.node.isPBO&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let n;const r=e.context.assign;if(n=!1===e.isAvailable("storageBuffer")?!0!==this.node.isPBO||!0===r||!this.node.value.isInstancedBufferAttribute&&"compute"===e.shaderStage?this.node.build(e):e.generatePBO(this):super.generate(e),!0!==r){const r=this.getNodeType(e);n=e.format(n,r,t)}return n}}const sR=kg(iR);class aR extends qx{static get type(){return"StorageBufferNode"}constructor(e,t=null,n=0){let r,i=null;t&&t.isStruct?(r="struct",i=t.layout):null===t&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(r=Im(e.itemSize),n=e.count):r=t,super(e,r,n),this.isStorageBufferNode=!0,this.structTypeNode=i,this.access=Gm.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,!0!==e.isStorageBufferAttribute&&!0!==e.isStorageInstancedBufferAttribute&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(0===this.bufferCount){let t=e.globalCache.getData(this.value);return void 0===t&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return sR(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(Gm.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return null===this._attribute&&(this._attribute=yx(this.value),this._varying=J_(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(null!==this.structTypeNode)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}generate(e){if(null!==this.structTypeNode&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:n}=this.getAttributeData(),r=n.build(e);return e.registerTransform(r,t),r}}const oR=(e,t=null,n=0)=>Fg(new aR(e,t,n));class lR extends Fx{static get type(){return"VertexColorNode"}constructor(e=0){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e);let n;return n=!0===e.hasGeometryAttribute(t)?super.generate(e):e.generateConst(this.nodeType,new vn(1,1,1,1)),n}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}class uR extends $m{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const cR=zg(uR),dR=new ur,hR=new Jn;class pR extends $m{static get type(){return"SceneNode"}constructor(e=pR.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=null!==this.scene?this.scene:e.scene;let r;return t===pR.BACKGROUND_BLURRINESS?r=aS("backgroundBlurriness","float",n):t===pR.BACKGROUND_INTENSITY?r=aS("backgroundIntensity","float",n):t===pR.BACKGROUND_ROTATION&&(r=Tv("mat4").label("backgroundRotation").setGroup(xv).onRenderUpdate(()=>{const e=n.background;return null!==e&&e.isTexture&&e.mapping!==W?(dR.copy(n.backgroundRotation),dR.x*=-1,dR.y*=-1,dR.z*=-1,hR.makeRotationFromEuler(dR)):hR.identity(),hR})),r}}pR.BACKGROUND_BLURRINESS="backgroundBlurriness",pR.BACKGROUND_INTENSITY="backgroundIntensity",pR.BACKGROUND_ROTATION="backgroundRotation";const fR=zg(pR,pR.BACKGROUND_BLURRINESS),mR=zg(pR,pR.BACKGROUND_INTENSITY),gR=zg(pR,pR.BACKGROUND_ROTATION);class vR extends Hx{static get type(){return"StorageTextureNode"}constructor(e,t,n=null){super(e,t),this.storeNode=n,this.isStorageTextureNode=!0,this.access=Gm.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e);e.getNodeProperties(this).storeNode=this.storeNode}setAccess(e){return this.access=e,this}generate(e,t){let n;return n=null!==this.storeNode?this.generateStore(e):super.generate(e,t),n}toReadWrite(){return this.setAccess(Gm.READ_WRITE)}toReadOnly(){return this.setAccess(Gm.READ_ONLY)}toWriteOnly(){return this.setAccess(Gm.WRITE_ONLY)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:n,storeNode:r}=t,i=super.generate(e,"property"),s=n.build(e,"uvec2"),a=r.build(e,"vec4"),o=e.generateTextureStore(e,i,s,a);e.addLineFlowCode(o,this)}}const yR=kg(vR),_R=Vg(({texture:e,uv:t})=>{const n=1e-4,r=tv().toVar();return Wg(t.x.lessThan(n),()=>{r.assign(tv(1,0,0))}).ElseIf(t.y.lessThan(n),()=>{r.assign(tv(0,1,0))}).ElseIf(t.z.lessThan(n),()=>{r.assign(tv(0,0,1))}).ElseIf(t.x.greaterThan(.9999),()=>{r.assign(tv(-1,0,0))}).ElseIf(t.y.greaterThan(.9999),()=>{r.assign(tv(0,-1,0))}).ElseIf(t.z.greaterThan(.9999),()=>{r.assign(tv(0,0,-1))}).Else(()=>{const n=.01,i=e.sample(t.add(tv(-.01,0,0))).r.sub(e.sample(t.add(tv(n,0,0))).r),s=e.sample(t.add(tv(0,-.01,0))).r.sub(e.sample(t.add(tv(0,n,0))).r),a=e.sample(t.add(tv(0,0,-.01))).r.sub(e.sample(t.add(tv(0,0,n))).r);r.assign(tv(i,s,a))}),r.normalize()});class xR extends Hx{static get type(){return"Texture3DNode"}constructor(e,t=null,n=null){super(e,t,n),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return tv(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return!e.isFlipY()||!0!==n.isRenderTargetTexture&&!0!==n.isFramebufferTexture||(t=this.sampler?t.flipY():t.setY($g(zx(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,"vec3")}normal(e){return _R({texture:this,uv:e})}}const bR=kg(xR);class SR extends sS{static get type(){return"UserDataNode"}constructor(e,t,n=null){super(e,t,n),this.userData=n}updateReference(e){return this.reference=null!==this.userData?this.userData:e.object.userData,this.reference}}const TR=new WeakMap;class wR extends Qm{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=Vm.OBJECT,this.updateAfterType=Vm.OBJECT,this.previousModelWorldMatrix=Tv(new Jn),this.previousProjectionMatrix=Tv(new Jn).setGroup(xv),this.previousCameraViewMatrix=Tv(new Jn)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:n}){const r=ER(n);this.previousModelWorldMatrix.value.copy(r);const i=MR(t);i.frameId!==e&&(i.frameId=e,void 0===i.previousProjectionMatrix?(i.previousProjectionMatrix=new Jn,i.previousCameraViewMatrix=new Jn,i.currentProjectionMatrix=new Jn,i.currentCameraViewMatrix=new Jn,i.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),i.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(i.previousProjectionMatrix.copy(i.currentProjectionMatrix),i.previousCameraViewMatrix.copy(i.currentCameraViewMatrix)),i.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),i.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(i.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(i.previousCameraViewMatrix))}updateAfter({object:e}){ER(e).copy(e.matrixWorld)}setup(){const e=null===this.projectionMatrix?eb:Tv(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),n=e.mul(Tb).mul(Cb),r=this.previousProjectionMatrix.mul(t).mul(Rb),i=n.xy.div(n.w),s=r.xy.div(r.w);return oy(i,s)}}function MR(e){let t=TR.get(e);return void 0===t&&(t={},TR.set(e,t)),t}function ER(e,t=0){const n=MR(e);let r=n[t];return void 0===r&&(n[t]=r=new Jn),r}const AR=zg(wR),CR=Vg(([e,t])=>p_(1,e.oneMinus().div(t)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),RR=Vg(([e,t])=>p_(e.div(t.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),NR=Vg(([e,t])=>e.oneMinus().mul(t.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),PR=Vg(([e,t])=>R_(e.mul(2).mul(t),e.oneMinus().mul(2).mul(t.oneMinus()).oneMinus(),g_(.5,e))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),IR=Vg(([e,t])=>{const n=t.a.add(e.a.mul(t.a.oneMinus()));return sv(t.rgb.mul(t.a).add(e.rgb.mul(e.a).mul(t.a.oneMinus())).div(n),n)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),LR=Vg(([e])=>BR(e.rgb)),UR=Vg(([e,t=Xg(1)])=>t.mix(BR(e.rgb),e.rgb)),DR=Vg(([e,t=Xg(1)])=>{const n=ay(e.r,e.g,e.b).div(3),r=e.r.max(e.g.max(e.b)),i=r.sub(n).mul(t).mul(-3);return R_(e.rgb,r,i)}),FR=Vg(([e,t=Xg(1)])=>{const n=tv(.57735,.57735,.57735),r=t.cos();return tv(e.rgb.mul(r).add(n.cross(e.rgb).mul(t.sin()).add(n.mul(x_(n,e.rgb).mul(r.oneMinus())))))}),BR=(e,t=tv(on.getLuminanceCoefficients(new Tn)))=>x_(e,t),OR=Vg(([e,t=tv(1),n=tv(0),r=tv(1),i=Xg(1),s=tv(on.getLuminanceCoefficients(new Tn,vt))])=>{const a=e.rgb.dot(tv(s)),o=f_(e.rgb.mul(t).add(n),0).toVar(),l=o.pow(r).toVar();return Wg(o.r.greaterThan(0),()=>{o.r.assign(l.r)}),Wg(o.g.greaterThan(0),()=>{o.g.assign(l.g)}),Wg(o.b.greaterThan(0),()=>{o.b.assign(l.b)}),o.assign(a.add(o.sub(a).mul(i))),sv(o.rgb,e.a)});class kR extends Qm{static get type(){return"PosterizeNode"}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const zR=kg(kR),VR=new Xt;class GR extends Hx{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class HR extends GR{static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class WR extends Qm{static get type(){return"PassNode"}constructor(e,t,n,r={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=r,this._pixelRatio=1,this._width=1,this._height=1;const i=new Oa;i.isRenderTargetTexture=!0,i.name="depth";const s=new yn(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:he,...r});s.texture.name="output",s.depthTexture=i,this.renderTarget=s,this._textures={output:s.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Tv(0),this._cameraFar=Tv(0),this._mrt=null,this._layers=null,this._resolution=1,this.isPassNode=!0,this.updateBeforeType=Vm.FRAME}setResolution(e){return this._resolution=e,this}getResolution(){return this._resolution}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let t=this._textures[e];if(void 0===t){t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)}return t}getPreviousTexture(e){let t=this._previousTextures[e];return void 0===t&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(void 0!==t){const n=this._textures[e],r=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[r]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return void 0===t&&(t=Fg(new HR(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return void 0===t&&(void 0===this._textureNodes[e]&&this.getTextureNode(e),t=Fg(new HR(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(void 0===t){const n=this._cameraNear,r=this._cameraFar;this._viewZNodes[e]=t=yw(this.getTextureNode(e),n,r)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(void 0===t){const n=this._cameraNear,r=this._cameraFar,i=this.getViewZNode(e);this._linearDepthNodes[e]=t=gw(i,n,r)}return t}setup({renderer:e}){return this.renderTarget.samples=void 0===this.options.samples?e.samples:this.options.samples,!0===e.backend.isWebGLBackend&&(this.renderTarget.samples=0),this.renderTarget.texture.type=e.getColorBufferType(),this.scope===WR.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let r,i;const s=t.getOutputRenderTarget();s&&!0===s.isXRRenderTarget?(i=1,r=t.xr.getCamera(),t.xr.updateCamera(r),VR.set(s.width,s.height)):(r=this.camera,i=t.getPixelRatio(),t.getSize(VR)),this._pixelRatio=i,this.setSize(VR.width,VR.height);const a=t.getRenderTarget(),o=t.getMRT(),l=r.layers.mask;this._cameraNear.value=r.near,this._cameraFar.value=r.far,null!==this._layers&&(r.layers.mask=this._layers.mask);for(const e in this._previousTextures)this.toggleTexture(e);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(n,r),t.setRenderTarget(a),t.setMRT(o),r.layers.mask=l}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio*this._resolution,r=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}WR.COLOR="color",WR.DEPTH="depth";class jR extends WR{static get type(){return"ToonOutlinePassNode"}constructor(e,t,n,r,i){super(WR.COLOR,e,t),this.colorNode=n,this.thicknessNode=r,this.alphaNode=i,this._materialCache=new WeakMap}updateBefore(e){const{renderer:t}=e,n=t.getRenderObjectFunction();t.setRenderObjectFunction((e,n,r,i,s,a,o,l)=>{if((s.isMeshToonMaterial||s.isMeshToonNodeMaterial)&&!1===s.wireframe){const u=this._getOutlineMaterial(s);t.renderObject(e,n,r,i,u,a,o,l)}t.renderObject(e,n,r,i,s,a,o,l)}),super.updateBefore(e),t.setRenderObjectFunction(n)}_createMaterial(){const e=new Rw;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=1;const t=Ob.negate(),n=eb.mul(Tb),r=Xg(1),i=n.mul(sv(Cb,1)),s=n.mul(sv(Cb.add(t),1)),a=jy(i.sub(s));return e.vertexNode=i.add(a.mul(this.thicknessNode).mul(i.w).mul(r)),e.colorNode=sv(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return void 0===t&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const qR=Vg(([e,t])=>e.mul(t).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),XR=Vg(([e,t])=>(e=e.mul(t)).div(e.add(1)).clamp()).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),$R=Vg(([e,t])=>{const n=(e=(e=e.mul(t)).sub(.004).max(0)).mul(e.mul(6.2).add(.5)),r=e.mul(e.mul(6.2).add(1.7)).add(.06);return n.div(r).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),YR=Vg(([e])=>{const t=e.mul(e.add(.0245786)).sub(90537e-9),n=e.mul(e.add(.432951).mul(.983729)).add(.238081);return t.div(n)}),KR=Vg(([e,t])=>{const n=cv(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),r=cv(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return e=e.mul(t).div(.6),e=n.mul(e),e=YR(e),(e=r.mul(e)).clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),QR=cv(tv(1.6605,-.1246,-.0182),tv(-.5876,1.1329,-.1006),tv(-.0728,-.0083,1.1187)),ZR=cv(tv(.6274,.0691,.0164),tv(.3293,.9195,.088),tv(.0433,.0113,.8956)),JR=Vg(([e])=>{const t=tv(e).toVar(),n=tv(t.mul(t)).toVar(),r=tv(n.mul(n)).toVar();return Xg(15.5).mul(r.mul(n)).sub(ly(40.14,r.mul(t))).add(ly(31.96,r).sub(ly(6.868,n.mul(t))).add(ly(.4298,n).add(ly(.1191,t).sub(.00232))))}),eN=Vg(([e,t])=>{const n=tv(e).toVar(),r=cv(tv(.856627153315983,.137318972929847,.11189821299995),tv(.0951212405381588,.761241990602591,.0767994186031903),tv(.0482516061458583,.101439036467562,.811302368396859)),i=cv(tv(1.1271005818144368,-.1413297634984383,-.14132976349843826),tv(-.11060664309660323,1.157823702216272,-.11060664309660294),tv(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=Xg(-12.47393),a=Xg(4.026069);return n.mulAssign(t),n.assign(ZR.mul(n)),n.assign(r.mul(n)),n.assign(f_(n,1e-10)),n.assign(zy(n)),n.assign(n.sub(s).div(a.sub(s))),n.assign(N_(n,0,1)),n.assign(JR(n)),n.assign(i.mul(n)),n.assign(S_(f_(tv(0),n),tv(2.2))),n.assign(QR.mul(n)),n.assign(N_(n,0,1)),n}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),tN=Vg(([e,t])=>{const n=Xg(.76),r=Xg(.15);e=e.mul(t);const i=p_(e.r,p_(e.g,e.b)),s=G_(i.lessThan(.08),i.sub(ly(6.25,i.mul(i))),.04);e.subAssign(s);const a=f_(e.r,f_(e.g,e.b));Wg(a.lessThan(n),()=>e);const o=oy(1,n),l=oy(1,o.mul(o).div(a.add(o.sub(n))));e.mulAssign(l.div(a));const u=oy(1,uy(1,r.mul(a.sub(l)).add(1)));return R_(e,tv(l),u)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class nN extends $m{static get type(){return"CodeNode"}constructor(e="",t=[],n=""){super("code"),this.isCodeNode=!0,this.code=e,this.includes=t,this.language=n}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const n of t)n.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const rN=kg(nN);class iN extends nN{static get type(){return"FunctionNode"}constructor(e="",t=[],n=""){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return void 0===n&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),r=n.name,i=n.type,s=e.getCodeFromNode(this,i);""!==r&&(s.name=r);const a=e.getPropertyName(s),o=this.getNodeFunction(e).getCode(a);return s.code=o+"\n","property"===t?a:e.format(`${a}()`,i,t)}}const sN=(e,t=[],n="")=>{for(let e=0;e<t.length;e++){const n=t[e];"function"==typeof n&&(t[e]=n.functionNode)}const r=Fg(new iN(e,t,n)),i=(...e)=>r.call(...e);return i.functionNode=r,i};class aN extends $m{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outputType=null,this.events=new Dt,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return null!==this.outputType}set value(e){this._value!==e&&(this._cache&&"URL"===this.inputType&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&null===this._cache&&"URL"===this.inputType&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&null!==e.value&&void 0!==e.value&&(("URL"===this.inputType||"String"===this.inputType)&&"string"==typeof e.value||"Number"===this.inputType&&"number"==typeof e.value||"Vector2"===this.inputType&&e.value.isVector2||"Vector3"===this.inputType&&e.value.isVector3||"Vector4"===this.inputType&&e.value.isVector4||"Color"===this.inputType&&e.value.isColor||"Matrix3"===this.inputType&&e.value.isMatrix3||"Matrix4"===this.inputType&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:Xg()}serialize(e){super.serialize(e),null!==this.value?"ArrayBuffer"===this.inputType?e.value=Om(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;null!==e.value&&(t="ArrayBuffer"===e.inputType?km(e.value):"Texture"===e.inputType?e.meta.textures[e.value]:e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const oN=kg(aN);class lN extends Map{get(e,t=null,...n){if(this.has(e))return super.get(e);if(null!==t){const r=t(...n);return this.set(e,r),r}}}class uN{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const cN=new lN;class dN extends $m{static get type(){return"ScriptableNode"}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new lN,this._output=oN(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const n=this._outputs;return void 0===n[e]?n[e]=oN(t):n[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const n=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),n[e]=t,n[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),n[e]=t,n[e].events.addEventListener("refresh",this.onRefresh)):void 0===n[e]?(n[e]=oN(t),n[e].events.addEventListener("refresh",this.onRefresh)):n[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const n=this.getObject()[e];if("function"==typeof n)return n(...t)}async callAsync(e,...t){const n=this.getObject()[e];if("function"==typeof n)return"AsyncFunction"===n.constructor.name?await n(...t):n(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){null!==e?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),null!==this._object)return this._object;const e=new uN(this),t=cN.get("THREE"),n=cN.get("TSL"),r=this.getMethod(),i=[e,this._local,cN,()=>this.refresh(),(e,t)=>this.setOutput(e,t),t,n];this._object=r(...i);const s=this._object.layout;if(s&&(!1===s.cache&&this._local.clear(),this._output.outputType=s.outputType||null,Array.isArray(s.elements)))for(const e of s.elements){const t=e.id||e.name;e.inputType&&(void 0===this.getParameter(t)&&this.setParameter(t,null),this.getParameter(t).inputType=e.inputType),e.outputType&&(void 0===this.getOutput(t)&&this.setOutput(t,null),this.getOutput(t).outputType=e.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const e in this.parameters){let t=this.parameters[e];t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:Xg()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),null!==this._method)return this._method;const e=["layout","init","main","dispose"].join(", "),t="\nreturn { ...output, "+e+" };",n="var "+e+"; var output = {};\n"+this.codeNode.code+t;return this._method=new Function(...["parameters","local","global","refresh","setOutput","THREE","TSL"],n),this._method}dispose(){null!==this._method&&(this._object&&"function"==typeof this._object.dispose&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){const t=[Mm(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(const n in this.parameters)t.push(this.parameters[n].getCacheKey(e));return Em(t)}set needsUpdate(e){!0===e&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return null===this.codeNode||(!0===this._needsOutputUpdate&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value),this}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const hN=kg(dN);function pN(e){let t;const n=e.context.getViewZ;return void 0!==n&&(t=n(this)),(t||Ib.z).negate()}const fN=Vg(([e,t],n)=>{const r=pN(n);return L_(e,t,r)}),mN=Vg(([e],t)=>{const n=pN(t);return e.mul(e,n,n).negate().exp().oneMinus()}),gN=Vg(([e,t])=>sv(t.toFloat().mix(jv.rgb,e.toVec3()),jv.a));let vN=null,yN=null;class _N extends $m{static get type(){return"RangeNode"}constructor(e=Xg(),t=Xg()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=e.getTypeLength(Dm(this.minNode.value)),n=e.getTypeLength(Dm(this.maxNode.value));return t>n?t:n}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){const t=e.object;let n=null;if(t.count>1){const r=this.minNode.value,i=this.maxNode.value,s=e.getTypeLength(Dm(r)),a=e.getTypeLength(Dm(i));vN=vN||new vn,yN=yN||new vn,vN.setScalar(0),yN.setScalar(0),1===s?vN.setScalar(r):r.isColor?vN.set(r.r,r.g,r.b,1):vN.set(r.x,r.y,r.z||0,r.w||0),1===a?yN.setScalar(i):i.isColor?yN.set(i.r,i.g,i.b,1):yN.set(i.x,i.y,i.z||0,i.w||0);const o=4,l=o*t.count,u=new Float32Array(l);for(let e=0;e<l;e++){const t=e%o,n=vN.getComponent(t),r=yN.getComponent(t);u[e]=qt.lerp(n,r,Math.random())}const c=this.getNodeType(e);if(t.count<=4096)n=Xx(u,"vec4",t.count).element(ST).convert(c);else{const t=new Ls(u,4);e.geometry.setAttribute("__range"+this.id,t),n=xx(t).convert(c)}}else n=Xg(0);return n}}const xN=kg(_N);class bN extends $m{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){const n=this.getBuiltinName(e),r=this.getNodeType(e);return"compute"===e.shaderStage?e.format(n,r,t):e.generateConst(r)}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const SN=(e,t)=>Fg(new bN(e,t)),TN=SN("numWorkgroups","uvec3"),wN=SN("workgroupId","uvec3"),MN=SN("globalId","uvec3"),EN=SN("localId","uvec3"),AN=SN("subgroupSize","uint");const CN=kg(class extends $m{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;!0===n.backend.isWebGLBackend?e.addFlowCode(`\t// ${t}Barrier \n`):e.addLineFlowCode(`${t}Barrier()`,this)}});class RN extends Ym{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let n;const r=e.context.assign;if(n=super.generate(e),!0!==r){const r=this.getNodeType(e);n=e.format(n,r,t)}return n}}class NN extends $m{constructor(e,t,n=0){super(t),this.bufferType=t,this.bufferCount=n,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e}label(e){return this.name=e,this}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return Fg(new RN(this,e))}generate(e){return e.getScopedArray(this.name||`${this.scope}Array_${this.id}`,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}class PN extends Qm{static get type(){return"AtomicFunctionNode"}constructor(e,t,n,r=null){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n,this.storeNode=r}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=this.method,n=this.getNodeType(e),r=this.getInputType(e),i=this.pointerNode,s=this.valueNode,a=[];a.push(`&${i.build(e,r)}`),null!==s&&a.push(s.build(e,r));const o=`${e.getMethod(t,n)}( ${a.join(", ")} )`;if(null!==this.storeNode){const t=this.storeNode.build(e,r);e.addLineFlowCode(`${t} = ${o}`,this)}else e.addLineFlowCode(o,this)}}PN.ATOMIC_LOAD="atomicLoad",PN.ATOMIC_STORE="atomicStore",PN.ATOMIC_ADD="atomicAdd",PN.ATOMIC_SUB="atomicSub",PN.ATOMIC_MAX="atomicMax",PN.ATOMIC_MIN="atomicMin",PN.ATOMIC_AND="atomicAnd",PN.ATOMIC_OR="atomicOr",PN.ATOMIC_XOR="atomicXor";const IN=kg(PN),LN=(e,t,n,r=null)=>{const i=IN(e,t,n,r);return i.append(),i};let UN;function DN(e){UN=UN||new WeakMap;let t=UN.get(e);return void 0===t&&UN.set(e,t={}),t}function FN(e){const t=DN(e);return t.shadowMatrix||(t.shadowMatrix=Tv("mat4").setGroup(xv).onRenderUpdate(()=>(!0!==e.castShadow&&e.shadow.updateMatrices(e),e.shadow.matrix)))}function BN(e,t=Nb){const n=FN(e).mul(t);return n.xyz.div(n.w)}function ON(e){const t=DN(e);return t.position||(t.position=Tv(new Tn).setGroup(xv).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(e.matrixWorld)))}function kN(e){const t=DN(e);return t.targetPosition||(t.targetPosition=Tv(new Tn).setGroup(xv).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(e.target.matrixWorld)))}function zN(e){const t=DN(e);return t.viewPosition||(t.viewPosition=Tv(new Tn).setGroup(xv).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new Tn,n.value.setFromMatrixPosition(e.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)}))}const VN=e=>nb.transformDirection(ON(e).sub(kN(e))),GN=(e,t)=>{for(const n of t)if(n.isAnalyticLightNode&&n.light.id===e)return n;return null},HN=new WeakMap;class WN extends $m{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=tv().toVar("totalDiffuse"),this.totalSpecularNode=tv().toVar("totalSpecular"),this.outgoingLightNode=tv().toVar("outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=[],t=this._lights;for(let n=0;n<t.length;n++)e.push(t[n].id);return Em(e)}getHash(e){if(null===this._lightNodesHash){null===this._lightNodes&&this.setupLightsNode(e);const t=[];for(const e of this._lightNodes)t.push(e.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getDataFromNode(this);for(const n of t.nodes)n.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,r=(e=>e.sort((e,t)=>e.id-t.id))(this._lights),i=e.renderer.library;for(const e of r)if(e.isNode)t.push(Fg(e));else{let r=null;if(null!==n&&(r=GN(e.id,n)),null===r){const n=i.getLightNodeClass(e.constructor);if(null===n)continue;let r=null;HN.has(e)?r=HN.get(e):(r=Fg(new n(e)),HN.set(e,r)),t.push(r)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:r,reflectedLight:i}=e.context;r.direct({...n,lightNode:t,reflectedLight:i},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:r,reflectedLight:i}=e.context;r.directRectArea({...n,lightNode:t,reflectedLight:i},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return null===this._lightNodes&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const r=e.context,i=r.lightingModel,s=e.getDataFromNode(this);if(i){const{totalDiffuseNode:t,totalSpecularNode:a}=this;r.outgoingLight=n;const o=e.addStack();s.nodes=o.nodes,i.start(e);const{backdrop:l,backdropAlpha:u}=r,{directDiffuse:c,directSpecular:d,indirectDiffuse:h,indirectSpecular:p}=r.reflectedLight;let f=c.add(h);null!==l&&(f=tv(null!==u?u.mix(f,l):l),r.material.transparent=!0),t.assign(f),a.assign(d.add(p)),n.assign(t.add(a)),i.finish(e),n=n.bypass(e.removeStack())}else s.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}class jN extends $m{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=Vm.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){qN.assign(t.shadowPositionNode||e.shadowPositionWorld||Nb)}dispose(){this.updateBeforeType=Vm.NONE}}const qN=Mv("vec3","shadowPositionWorld");function XN(e,t={}){return t.toneMapping=e.toneMapping,t.toneMappingExposure=e.toneMappingExposure,t.outputColorSpace=e.outputColorSpace,t.renderTarget=e.getRenderTarget(),t.activeCubeFace=e.getActiveCubeFace(),t.activeMipmapLevel=e.getActiveMipmapLevel(),t.renderObjectFunction=e.getRenderObjectFunction(),t.pixelRatio=e.getPixelRatio(),t.mrt=e.getMRT(),t.clearColor=e.getClearColor(t.clearColor||new jr),t.clearAlpha=e.getClearAlpha(),t.autoClear=e.autoClear,t.scissorTest=e.getScissorTest(),t}function $N(e,t){return t=XN(e,t),e.setMRT(null),e.setRenderObjectFunction(null),e.setClearColor(0,1),e.autoClear=!0,t}function YN(e,t){e.toneMapping=t.toneMapping,e.toneMappingExposure=t.toneMappingExposure,e.outputColorSpace=t.outputColorSpace,e.setRenderTarget(t.renderTarget,t.activeCubeFace,t.activeMipmapLevel),e.setRenderObjectFunction(t.renderObjectFunction),e.setPixelRatio(t.pixelRatio),e.setMRT(t.mrt),e.setClearColor(t.clearColor,t.clearAlpha),e.autoClear=t.autoClear,e.setScissorTest(t.scissorTest)}function KN(e,t={}){return t.background=e.background,t.backgroundNode=e.backgroundNode,t.overrideMaterial=e.overrideMaterial,t}function QN(e,t){return t=KN(e,t),e.background=null,e.backgroundNode=null,e.overrideMaterial=null,t}function ZN(e,t){e.background=t.background,e.backgroundNode=t.backgroundNode,e.overrideMaterial=t.overrideMaterial}function JN(e,t,n){return n=QN(t,n=$N(e,n))}function eP(e,t,n){YN(e,n),ZN(t,n)}var tP=Object.freeze({__proto__:null,resetRendererAndSceneState:JN,resetRendererState:$N,resetSceneState:QN,restoreRendererAndSceneState:eP,restoreRendererState:YN,restoreSceneState:ZN,saveRendererAndSceneState:function(e,t,n={}){return n=KN(t,n=XN(e,n))},saveRendererState:XN,saveSceneState:KN});const nP=new WeakMap,rP=Vg(([e,t,n])=>{let r=Nb.sub(e).length();return r=r.sub(t).div(n.sub(t)),r=r.saturate(),r}),iP=e=>{let t=nP.get(e);if(void 0===t){const n=e.isPointLight?(e=>{const t=e.shadow.camera,n=aS("near","float",t).setGroup(xv),r=aS("far","float",t).setGroup(xv),i=cb(e);return rP(i,n,r)})(e):null;t=new Rw,t.colorNode=sv(0,0,0,1),t.depthNode=n,t.isShadowPassMaterial=!0,t.name="ShadowMaterial",t.fog=!1,nP.set(e,t)}return t},sP=Vg(({depthTexture:e,shadowCoord:t})=>Wx(e,t.xy).compare(t.z)),aP=Vg(({depthTexture:e,shadowCoord:t,shadow:n})=>{const r=(t,n)=>Wx(e,t).compare(n),i=aS("mapSize","vec2",n).setGroup(xv),s=aS("radius","float",n).setGroup(xv),a=Qg(1).div(i),o=a.x.negate().mul(s),l=a.y.negate().mul(s),u=a.x.mul(s),c=a.y.mul(s),d=o.div(2),h=l.div(2),p=u.div(2),f=c.div(2);return ay(r(t.xy.add(Qg(o,l)),t.z),r(t.xy.add(Qg(0,l)),t.z),r(t.xy.add(Qg(u,l)),t.z),r(t.xy.add(Qg(d,h)),t.z),r(t.xy.add(Qg(0,h)),t.z),r(t.xy.add(Qg(p,h)),t.z),r(t.xy.add(Qg(o,0)),t.z),r(t.xy.add(Qg(d,0)),t.z),r(t.xy,t.z),r(t.xy.add(Qg(p,0)),t.z),r(t.xy.add(Qg(u,0)),t.z),r(t.xy.add(Qg(d,f)),t.z),r(t.xy.add(Qg(0,f)),t.z),r(t.xy.add(Qg(p,f)),t.z),r(t.xy.add(Qg(o,c)),t.z),r(t.xy.add(Qg(0,c)),t.z),r(t.xy.add(Qg(u,c)),t.z)).mul(1/17)}),oP=Vg(({depthTexture:e,shadowCoord:t,shadow:n})=>{const r=(t,n)=>Wx(e,t).compare(n),i=aS("mapSize","vec2",n).setGroup(xv),s=Qg(1).div(i),a=s.x,o=s.y,l=t.xy,u=qy(l.mul(i).add(.5));return l.subAssign(u.mul(s)),ay(r(l,t.z),r(l.add(Qg(a,0)),t.z),r(l.add(Qg(0,o)),t.z),r(l.add(s),t.z),R_(r(l.add(Qg(a.negate(),0)),t.z),r(l.add(Qg(a.mul(2),0)),t.z),u.x),R_(r(l.add(Qg(a.negate(),o)),t.z),r(l.add(Qg(a.mul(2),o)),t.z),u.x),R_(r(l.add(Qg(0,o.negate())),t.z),r(l.add(Qg(0,o.mul(2))),t.z),u.y),R_(r(l.add(Qg(a,o.negate())),t.z),r(l.add(Qg(a,o.mul(2))),t.z),u.y),R_(R_(r(l.add(Qg(a.negate(),o.negate())),t.z),r(l.add(Qg(a.mul(2),o.negate())),t.z),u.x),R_(r(l.add(Qg(a.negate(),o.mul(2))),t.z),r(l.add(Qg(a.mul(2),o.mul(2))),t.z),u.x),u.y)).mul(1/9)}),lP=Vg(({depthTexture:e,shadowCoord:t})=>{const n=Xg(1).toVar(),r=Wx(e).sample(t.xy).rg,i=g_(t.z,r.x);return Wg(i.notEqual(Xg(1)),()=>{const e=t.z.sub(r.x),s=f_(0,r.y.mul(r.y));let a=s.div(s.add(e.mul(e)));a=N_(oy(a,.3).div(.95-.3)),n.assign(N_(f_(i,a)))}),n}),uP=Vg(({samples:e,radius:t,size:n,shadowPass:r})=>{const i=Xg(0).toVar(),s=Xg(0).toVar(),a=e.lessThanEqual(Xg(1)).select(Xg(0),Xg(2).div(e.sub(1))),o=e.lessThanEqual(Xg(1)).select(Xg(0),Xg(-1));BT({start:$g(0),end:$g(e),type:"int",condition:"<"},({i:e})=>{const l=o.add(Xg(e).mul(a)),u=r.sample(ay(ew.xy,Qg(0,l).mul(t)).div(n)).x;i.addAssign(u),s.addAssign(u.mul(u))}),i.divAssign(e),s.divAssign(e);const l=Vy(s.sub(i.mul(i)));return Qg(i,l)}),cP=Vg(({samples:e,radius:t,size:n,shadowPass:r})=>{const i=Xg(0).toVar(),s=Xg(0).toVar(),a=e.lessThanEqual(Xg(1)).select(Xg(0),Xg(2).div(e.sub(1))),o=e.lessThanEqual(Xg(1)).select(Xg(0),Xg(-1));BT({start:$g(0),end:$g(e),type:"int",condition:"<"},({i:e})=>{const l=o.add(Xg(e).mul(a)),u=r.sample(ay(ew.xy,Qg(l,0).mul(t)).div(n));i.addAssign(u.x),s.addAssign(ay(u.y.mul(u.y),u.x.mul(u.x)))}),i.divAssign(e),s.divAssign(e);const l=Vy(s.sub(i.mul(i)));return Qg(i,l)}),dP=[sP,aP,oP,lP];let hP;const pP=new YC;class fP extends jN{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:r,shadow:i}){const s=r.x.greaterThanEqual(0).and(r.x.lessThanEqual(1)).and(r.y.greaterThanEqual(0)).and(r.y.lessThanEqual(1)).and(r.z.lessThanEqual(1)),a=t({depthTexture:n,shadowCoord:r,shadow:i});return s.select(a,Xg(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:r}=e,i=aS("bias","float",n).setGroup(xv);let s,a=t;if(n.camera.isOrthographicCamera||!0!==r.logarithmicDepthBuffer)a=a.xyz.div(a.w),s=a.z,r.coordinateSystem===Ut&&(s=s.mul(2).sub(1));else{const e=a.w;a=a.xy.div(e);const t=aS("near","float",n.camera).setGroup(xv),r=aS("far","float",n.camera).setGroup(xv);s=_w(e.negate(),t,r)}return a=tv(a.x,a.y.oneMinus(),s.add(i)),a}getShadowFilterFn(e){return dP[e]}setupShadow(e){const{renderer:t}=e,{light:n,shadow:r}=this,i=t.shadowMap.type,s=new Oa(r.mapSize.width,r.mapSize.height);s.compareFunction=Tt;const a=e.createRenderTarget(r.mapSize.width,r.mapSize.height);if(a.depthTexture=s,r.camera.updateProjectionMatrix(),3===i){s.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Ee,type:he}),this.vsmShadowMapHorizontal=e.createRenderTarget(r.mapSize.width,r.mapSize.height,{format:Ee,type:he});const t=Wx(s),n=Wx(this.vsmShadowMapVertical.texture),i=aS("blurSamples","float",r).setGroup(xv),a=aS("radius","float",r).setGroup(xv),o=aS("mapSize","vec2",r).setGroup(xv);let l=this.vsmMaterialVertical||(this.vsmMaterialVertical=new Rw);l.fragmentNode=uP({samples:i,radius:a,size:o,shadowPass:t}).context(e.getSharedContext()),l.name="VSMVertical",l=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new Rw),l.fragmentNode=cP({samples:i,radius:a,size:o,shadowPass:n}).context(e.getSharedContext()),l.name="VSMHorizontal"}const o=aS("intensity","float",r).setGroup(xv),l=aS("normalBias","float",r).setGroup(xv),u=FN(n).mul(qN.add(Hb.mul(l))),c=this.setupShadowCoord(e,u),d=r.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(null===d)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const h=3===i?this.vsmShadowMapHorizontal.texture:s,p=this.setupShadowFilter(e,{filterFn:d,shadowTexture:a.texture,depthTexture:h,shadowCoord:c,shadow:r}),f=Wx(a.texture,c),m=R_(1,p.rgb.mix(f,1),o.mul(f.a)).toVar();return this.shadowMap=a,this.shadow.map=a,m}setup(e){if(!1!==e.renderer.shadowMap.enabled)return Vg(()=>{let t=this._node;return this.setupShadowPosition(e),null===t&&(this._node=t=this.setupShadow(e)),e.material.shadowNode,e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t})()}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:i,scene:s}=e;t.updateMatrices(r),n.setSize(t.mapSize.width,t.mapSize.height),i.render(s,t.camera)}updateShadow(e){const{shadowMap:t,light:n,shadow:r}=this,{renderer:i,scene:s,camera:a}=e,o=i.shadowMap.type,l=t.depthTexture.version;this._depthVersionCached=l,r.camera.layers.mask=a.layers.mask;const u=i.getRenderObjectFunction(),c=i.getMRT(),d=!!c&&c.has("velocity");hP=JN(i,s,hP),s.overrideMaterial=iP(n),i.setRenderObjectFunction((e,t,n,s,l,u,...c)=>{(!0===e.castShadow||e.receiveShadow&&3===o)&&(d&&(Bm(e).useVelocity=!0),e.onBeforeShadow(i,e,a,r.camera,s,t.overrideMaterial,u),i.renderObject(e,t,n,s,l,u,...c),e.onAfterShadow(i,e,a,r.camera,s,t.overrideMaterial,u))}),i.setRenderTarget(t),this.renderShadow(e),i.setRenderObjectFunction(u),!0!==n.isPointLight&&3===o&&this.vsmPass(i),eP(i,s,hP)}vsmPass(e){const{shadow:t}=this;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height),e.setRenderTarget(this.vsmShadowMapVertical),pP.material=this.vsmMaterialVertical,pP.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),pP.material=this.vsmMaterialHorizontal,pP.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,null!==this.vsmShadowMapVertical&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),null!==this.vsmShadowMapHorizontal&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const mP=(e,t)=>Fg(new fP(e,t)),gP=new jr,vP=Vg(([e,t])=>{const n=e.toVar(),r=Jy(n),i=uy(1,f_(r.x,f_(r.y,r.z)));r.mulAssign(i),n.mulAssign(i.mul(t.mul(2).oneMinus()));const s=Qg(n.xy).toVar(),a=t.mul(1.5).oneMinus();return Wg(r.z.greaterThanEqual(a),()=>{Wg(n.z.greaterThan(0),()=>{s.x.assign(oy(4,n.x))})}).ElseIf(r.x.greaterThanEqual(a),()=>{const e=e_(n.x);s.x.assign(n.z.mul(e).add(e.mul(2)))}).ElseIf(r.y.greaterThanEqual(a),()=>{const e=e_(n.y);s.x.assign(n.x.add(e.mul(2)).add(2)),s.y.assign(n.z.mul(e).sub(2))}),Qg(.125,.25).mul(s).add(Qg(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),yP=Vg(({depthTexture:e,bd3D:t,dp:n,texelSize:r})=>Wx(e,vP(t,r.y)).compare(n)),_P=Vg(({depthTexture:e,bd3D:t,dp:n,texelSize:r,shadow:i})=>{const s=aS("radius","float",i).setGroup(xv),a=Qg(-1,1).mul(s).mul(r.y);return Wx(e,vP(t.add(a.xyy),r.y)).compare(n).add(Wx(e,vP(t.add(a.yyy),r.y)).compare(n)).add(Wx(e,vP(t.add(a.xyx),r.y)).compare(n)).add(Wx(e,vP(t.add(a.yyx),r.y)).compare(n)).add(Wx(e,vP(t,r.y)).compare(n)).add(Wx(e,vP(t.add(a.xxy),r.y)).compare(n)).add(Wx(e,vP(t.add(a.yxy),r.y)).compare(n)).add(Wx(e,vP(t.add(a.xxx),r.y)).compare(n)).add(Wx(e,vP(t.add(a.yxx),r.y)).compare(n)).mul(1/9)}),xP=Vg(({filterFn:e,depthTexture:t,shadowCoord:n,shadow:r})=>{const i=n.xyz.toVar(),s=i.length(),a=Tv("float").setGroup(xv).onRenderUpdate(()=>r.camera.near),o=Tv("float").setGroup(xv).onRenderUpdate(()=>r.camera.far),l=aS("bias","float",r).setGroup(xv),u=Tv(r.mapSize).setGroup(xv),c=Xg(1).toVar();return Wg(s.sub(o).lessThanEqual(0).and(s.sub(a).greaterThanEqual(0)),()=>{const n=s.sub(a).div(o.sub(a)).toVar();n.addAssign(l);const d=i.normalize(),h=Qg(1).div(u.mul(Qg(4,2)));c.assign(e({depthTexture:t,bd3D:d,dp:n,texelSize:h,shadow:r}))}),c}),bP=new vn,SP=new Xt,TP=new Xt;class wP extends fP{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return 0===e?yP:_P}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:n,depthTexture:r,shadowCoord:i,shadow:s}){return xP({filterFn:t,shadowTexture:n,depthTexture:r,shadowCoord:i,shadow:s})}renderShadow(e){const{shadow:t,shadowMap:n,light:r}=this,{renderer:i,scene:s}=e,a=t.getFrameExtents();TP.copy(t.mapSize),TP.multiply(a),n.setSize(TP.width,TP.height),SP.copy(t.mapSize);const o=i.autoClear,l=i.getClearColor(gP),u=i.getClearAlpha();i.autoClear=!1,i.setClearColor(t.clearColor,t.clearAlpha),i.clear();const c=t.getViewportCount();for(let e=0;e<c;e++){const a=t.getViewport(e),o=SP.x*a.x,l=TP.y-SP.y-SP.y*a.y;bP.set(o,l,SP.x*a.z,SP.y*a.w),n.viewport.copy(bP),t.updateMatrices(r,e),i.render(s,t.camera)}i.autoClear=o,i.setClearColor(l,u)}}const MP=(e,t)=>Fg(new wP(e,t));class EP extends WT{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new jr,this.colorNode=e&&e.colorNode||Tv(this.color).setGroup(xv),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=Vm.FRAME}customCacheKey(){return Am(this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}getLightVector(e){return zN(this.light).sub(e.context.positionView||Ib)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return mP(this.light)}setupShadow(e){const{renderer:t}=e;if(!1===t.shadowMap.enabled)return;let n=this.shadowColorNode;if(null===n){const t=this.light.shadow.shadowNode;let r;r=void 0!==t?Fg(t):this.setupShadowNode(e),this.shadowNode=r,this.shadowColorNode=n=this.colorNode.mul(r),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):null!==this.shadowNode&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const AP=Vg(({lightDistance:e,cutoffDistance:t,decayExponent:n})=>{const r=e.pow(n).max(.01).reciprocal();return t.greaterThan(0).select(r.mul(e.div(t).pow4().oneMinus().clamp().pow2()),r)}),CP=({color:e,lightVector:t,cutoffDistance:n,decayExponent:r})=>{const i=t.normalize(),s=t.length(),a=AP({lightDistance:s,cutoffDistance:n,decayExponent:r});return{lightDirection:i,lightColor:e.mul(a)}};class RP extends EP{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Tv(0).setGroup(xv),this.decayExponentNode=Tv(2).setGroup(xv)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return MP(this.light)}setupDirect(e){return CP({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const NP=Vg(([e=Ox()])=>{const t=e.mul(2),n=t.x.floor(),r=t.y.floor();return n.add(r).mod(2).sign()}),PP=Vg(([e=Ox()],{renderer:t,material:n})=>{const r=Xg(1).toVar(),i=C_(e.mul(2).sub(1));if(n.alphaToCoverage&&t.samples>1){const e=Xg(i.fwidth()).toVar();r.assign(L_(e.oneMinus(),e.add(1),i).oneMinus())}else i.greaterThan(1).discard();return r}),IP=Vg(([e,t,n])=>{const r=Xg(n).toVar(),i=Xg(t).toVar(),s=Kg(e).toVar();return G_(s,i,r)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),LP=Vg(([e,t])=>{const n=Kg(t).toVar(),r=Xg(e).toVar();return G_(n,r.negate(),r)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),UP=Vg(([e])=>{const t=Xg(e).toVar();return $g(Hy(t))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),DP=Vg(([e,t])=>{const n=Xg(e).toVar();return t.assign(UP(n)),n.sub(Xg(t))}),FP=yC([Vg(([e,t,n,r,i,s])=>{const a=Xg(s).toVar(),o=Xg(i).toVar(),l=Xg(r).toVar(),u=Xg(n).toVar(),c=Xg(t).toVar(),d=Xg(e).toVar(),h=Xg(oy(1,o)).toVar();return oy(1,a).mul(d.mul(h).add(c.mul(o))).add(a.mul(u.mul(h).add(l.mul(o))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),Vg(([e,t,n,r,i,s])=>{const a=Xg(s).toVar(),o=Xg(i).toVar(),l=tv(r).toVar(),u=tv(n).toVar(),c=tv(t).toVar(),d=tv(e).toVar(),h=Xg(oy(1,o)).toVar();return oy(1,a).mul(d.mul(h).add(c.mul(o))).add(a.mul(u.mul(h).add(l.mul(o))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]})]),BP=yC([Vg(([e,t,n,r,i,s,a,o,l,u,c])=>{const d=Xg(c).toVar(),h=Xg(u).toVar(),p=Xg(l).toVar(),f=Xg(o).toVar(),m=Xg(a).toVar(),g=Xg(s).toVar(),v=Xg(i).toVar(),y=Xg(r).toVar(),_=Xg(n).toVar(),x=Xg(t).toVar(),b=Xg(e).toVar(),S=Xg(oy(1,p)).toVar(),T=Xg(oy(1,h)).toVar();return Xg(oy(1,d)).toVar().mul(T.mul(b.mul(S).add(x.mul(p))).add(h.mul(_.mul(S).add(y.mul(p))))).add(d.mul(T.mul(v.mul(S).add(g.mul(p))).add(h.mul(m.mul(S).add(f.mul(p))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),Vg(([e,t,n,r,i,s,a,o,l,u,c])=>{const d=Xg(c).toVar(),h=Xg(u).toVar(),p=Xg(l).toVar(),f=tv(o).toVar(),m=tv(a).toVar(),g=tv(s).toVar(),v=tv(i).toVar(),y=tv(r).toVar(),_=tv(n).toVar(),x=tv(t).toVar(),b=tv(e).toVar(),S=Xg(oy(1,p)).toVar(),T=Xg(oy(1,h)).toVar();return Xg(oy(1,d)).toVar().mul(T.mul(b.mul(S).add(x.mul(p))).add(h.mul(_.mul(S).add(y.mul(p))))).add(d.mul(T.mul(v.mul(S).add(g.mul(p))).add(h.mul(m.mul(S).add(f.mul(p))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]})]),OP=Vg(([e,t,n])=>{const r=Xg(n).toVar(),i=Xg(t).toVar(),s=Yg(e).toVar(),a=Yg(s.bitAnd(Yg(7))).toVar(),o=Xg(IP(a.lessThan(Yg(4)),i,r)).toVar(),l=Xg(ly(2,IP(a.lessThan(Yg(4)),r,i))).toVar();return LP(o,Kg(a.bitAnd(Yg(1)))).add(LP(l,Kg(a.bitAnd(Yg(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),kP=Vg(([e,t,n,r])=>{const i=Xg(r).toVar(),s=Xg(n).toVar(),a=Xg(t).toVar(),o=Yg(e).toVar(),l=Yg(o.bitAnd(Yg(15))).toVar(),u=Xg(IP(l.lessThan(Yg(8)),a,s)).toVar(),c=Xg(IP(l.lessThan(Yg(4)),s,IP(l.equal(Yg(12)).or(l.equal(Yg(14))),a,i))).toVar();return LP(u,Kg(l.bitAnd(Yg(1)))).add(LP(c,Kg(l.bitAnd(Yg(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),zP=yC([OP,kP]),VP=Vg(([e,t,n])=>{const r=Xg(n).toVar(),i=Xg(t).toVar(),s=rv(e).toVar();return tv(zP(s.x,i,r),zP(s.y,i,r),zP(s.z,i,r))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),GP=Vg(([e,t,n,r])=>{const i=Xg(r).toVar(),s=Xg(n).toVar(),a=Xg(t).toVar(),o=rv(e).toVar();return tv(zP(o.x,a,s,i),zP(o.y,a,s,i),zP(o.z,a,s,i))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),HP=yC([VP,GP]),WP=Vg(([e])=>{const t=Xg(e).toVar();return ly(.6616,t)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),jP=Vg(([e])=>{const t=Xg(e).toVar();return ly(.982,t)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),qP=yC([WP,Vg(([e])=>{const t=tv(e).toVar();return ly(.6616,t)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]})]),XP=yC([jP,Vg(([e])=>{const t=tv(e).toVar();return ly(.982,t)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]})]),$P=Vg(([e,t])=>{const n=$g(t).toVar(),r=Yg(e).toVar();return r.shiftLeft(n).bitOr(r.shiftRight($g(32).sub(n)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),YP=Vg(([e,t,n])=>{e.subAssign(n),e.bitXorAssign($P(n,$g(4))),n.addAssign(t),t.subAssign(e),t.bitXorAssign($P(e,$g(6))),e.addAssign(n),n.subAssign(t),n.bitXorAssign($P(t,$g(8))),t.addAssign(e),e.subAssign(n),e.bitXorAssign($P(n,$g(16))),n.addAssign(t),t.subAssign(e),t.bitXorAssign($P(e,$g(19))),e.addAssign(n),n.subAssign(t),n.bitXorAssign($P(t,$g(4))),t.addAssign(e)}),KP=Vg(([e,t,n])=>{const r=Yg(n).toVar(),i=Yg(t).toVar(),s=Yg(e).toVar();return r.bitXorAssign(i),r.subAssign($P(i,$g(14))),s.bitXorAssign(r),s.subAssign($P(r,$g(11))),i.bitXorAssign(s),i.subAssign($P(s,$g(25))),r.bitXorAssign(i),r.subAssign($P(i,$g(16))),s.bitXorAssign(r),s.subAssign($P(r,$g(4))),i.bitXorAssign(s),i.subAssign($P(s,$g(14))),r.bitXorAssign(i),r.subAssign($P(i,$g(24))),r}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),QP=Vg(([e])=>{const t=Yg(e).toVar();return Xg(t).div(Xg(Yg($g(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),ZP=Vg(([e])=>{const t=Xg(e).toVar();return t.mul(t).mul(t).mul(t.mul(t.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),JP=yC([Vg(([e])=>{const t=$g(e).toVar(),n=Yg(Yg(1)).toVar(),r=Yg(Yg($g(3735928559)).add(n.shiftLeft(Yg(2))).add(Yg(13))).toVar();return KP(r.add(Yg(t)),r,r)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),Vg(([e,t])=>{const n=$g(t).toVar(),r=$g(e).toVar(),i=Yg(Yg(2)).toVar(),s=Yg().toVar(),a=Yg().toVar(),o=Yg().toVar();return s.assign(a.assign(o.assign(Yg($g(3735928559)).add(i.shiftLeft(Yg(2))).add(Yg(13))))),s.addAssign(Yg(r)),a.addAssign(Yg(n)),KP(s,a,o)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),Vg(([e,t,n])=>{const r=$g(n).toVar(),i=$g(t).toVar(),s=$g(e).toVar(),a=Yg(Yg(3)).toVar(),o=Yg().toVar(),l=Yg().toVar(),u=Yg().toVar();return o.assign(l.assign(u.assign(Yg($g(3735928559)).add(a.shiftLeft(Yg(2))).add(Yg(13))))),o.addAssign(Yg(s)),l.addAssign(Yg(i)),u.addAssign(Yg(r)),KP(o,l,u)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),Vg(([e,t,n,r])=>{const i=$g(r).toVar(),s=$g(n).toVar(),a=$g(t).toVar(),o=$g(e).toVar(),l=Yg(Yg(4)).toVar(),u=Yg().toVar(),c=Yg().toVar(),d=Yg().toVar();return u.assign(c.assign(d.assign(Yg($g(3735928559)).add(l.shiftLeft(Yg(2))).add(Yg(13))))),u.addAssign(Yg(o)),c.addAssign(Yg(a)),d.addAssign(Yg(s)),YP(u,c,d),u.addAssign(Yg(i)),KP(u,c,d)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),Vg(([e,t,n,r,i])=>{const s=$g(i).toVar(),a=$g(r).toVar(),o=$g(n).toVar(),l=$g(t).toVar(),u=$g(e).toVar(),c=Yg(Yg(5)).toVar(),d=Yg().toVar(),h=Yg().toVar(),p=Yg().toVar();return d.assign(h.assign(p.assign(Yg($g(3735928559)).add(c.shiftLeft(Yg(2))).add(Yg(13))))),d.addAssign(Yg(u)),h.addAssign(Yg(l)),p.addAssign(Yg(o)),YP(d,h,p),d.addAssign(Yg(a)),h.addAssign(Yg(s)),KP(d,h,p)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]})]),eI=yC([Vg(([e,t])=>{const n=$g(t).toVar(),r=$g(e).toVar(),i=Yg(JP(r,n)).toVar(),s=rv().toVar();return s.x.assign(i.bitAnd($g(255))),s.y.assign(i.shiftRight($g(8)).bitAnd($g(255))),s.z.assign(i.shiftRight($g(16)).bitAnd($g(255))),s}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),Vg(([e,t,n])=>{const r=$g(n).toVar(),i=$g(t).toVar(),s=$g(e).toVar(),a=Yg(JP(s,i,r)).toVar(),o=rv().toVar();return o.x.assign(a.bitAnd($g(255))),o.y.assign(a.shiftRight($g(8)).bitAnd($g(255))),o.z.assign(a.shiftRight($g(16)).bitAnd($g(255))),o}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]})]),tI=Vg(([e])=>{const t=Qg(e).toVar(),n=$g().toVar(),r=$g().toVar(),i=Xg(DP(t.x,n)).toVar(),s=Xg(DP(t.y,r)).toVar(),a=Xg(ZP(i)).toVar(),o=Xg(ZP(s)).toVar(),l=Xg(FP(zP(JP(n,r),i,s),zP(JP(n.add($g(1)),r),i.sub(1),s),zP(JP(n,r.add($g(1))),i,s.sub(1)),zP(JP(n.add($g(1)),r.add($g(1))),i.sub(1),s.sub(1)),a,o)).toVar();return qP(l)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),nI=Vg(([e])=>{const t=tv(e).toVar(),n=$g().toVar(),r=$g().toVar(),i=$g().toVar(),s=Xg(DP(t.x,n)).toVar(),a=Xg(DP(t.y,r)).toVar(),o=Xg(DP(t.z,i)).toVar(),l=Xg(ZP(s)).toVar(),u=Xg(ZP(a)).toVar(),c=Xg(ZP(o)).toVar(),d=Xg(BP(zP(JP(n,r,i),s,a,o),zP(JP(n.add($g(1)),r,i),s.sub(1),a,o),zP(JP(n,r.add($g(1)),i),s,a.sub(1),o),zP(JP(n.add($g(1)),r.add($g(1)),i),s.sub(1),a.sub(1),o),zP(JP(n,r,i.add($g(1))),s,a,o.sub(1)),zP(JP(n.add($g(1)),r,i.add($g(1))),s.sub(1),a,o.sub(1)),zP(JP(n,r.add($g(1)),i.add($g(1))),s,a.sub(1),o.sub(1)),zP(JP(n.add($g(1)),r.add($g(1)),i.add($g(1))),s.sub(1),a.sub(1),o.sub(1)),l,u,c)).toVar();return XP(d)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),rI=yC([tI,nI]),iI=Vg(([e])=>{const t=Qg(e).toVar(),n=$g().toVar(),r=$g().toVar(),i=Xg(DP(t.x,n)).toVar(),s=Xg(DP(t.y,r)).toVar(),a=Xg(ZP(i)).toVar(),o=Xg(ZP(s)).toVar(),l=tv(FP(HP(eI(n,r),i,s),HP(eI(n.add($g(1)),r),i.sub(1),s),HP(eI(n,r.add($g(1))),i,s.sub(1)),HP(eI(n.add($g(1)),r.add($g(1))),i.sub(1),s.sub(1)),a,o)).toVar();return qP(l)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),sI=Vg(([e])=>{const t=tv(e).toVar(),n=$g().toVar(),r=$g().toVar(),i=$g().toVar(),s=Xg(DP(t.x,n)).toVar(),a=Xg(DP(t.y,r)).toVar(),o=Xg(DP(t.z,i)).toVar(),l=Xg(ZP(s)).toVar(),u=Xg(ZP(a)).toVar(),c=Xg(ZP(o)).toVar(),d=tv(BP(HP(eI(n,r,i),s,a,o),HP(eI(n.add($g(1)),r,i),s.sub(1),a,o),HP(eI(n,r.add($g(1)),i),s,a.sub(1),o),HP(eI(n.add($g(1)),r.add($g(1)),i),s.sub(1),a.sub(1),o),HP(eI(n,r,i.add($g(1))),s,a,o.sub(1)),HP(eI(n.add($g(1)),r,i.add($g(1))),s.sub(1),a,o.sub(1)),HP(eI(n,r.add($g(1)),i.add($g(1))),s,a.sub(1),o.sub(1)),HP(eI(n.add($g(1)),r.add($g(1)),i.add($g(1))),s.sub(1),a.sub(1),o.sub(1)),l,u,c)).toVar();return XP(d)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),aI=yC([iI,sI]),oI=yC([Vg(([e])=>{const t=Xg(e).toVar(),n=$g(UP(t)).toVar();return QP(JP(n))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),Vg(([e])=>{const t=Qg(e).toVar(),n=$g(UP(t.x)).toVar(),r=$g(UP(t.y)).toVar();return QP(JP(n,r))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),Vg(([e])=>{const t=tv(e).toVar(),n=$g(UP(t.x)).toVar(),r=$g(UP(t.y)).toVar(),i=$g(UP(t.z)).toVar();return QP(JP(n,r,i))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),Vg(([e])=>{const t=sv(e).toVar(),n=$g(UP(t.x)).toVar(),r=$g(UP(t.y)).toVar(),i=$g(UP(t.z)).toVar(),s=$g(UP(t.w)).toVar();return QP(JP(n,r,i,s))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]})]),lI=yC([Vg(([e])=>{const t=Xg(e).toVar(),n=$g(UP(t)).toVar();return tv(QP(JP(n,$g(0))),QP(JP(n,$g(1))),QP(JP(n,$g(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),Vg(([e])=>{const t=Qg(e).toVar(),n=$g(UP(t.x)).toVar(),r=$g(UP(t.y)).toVar();return tv(QP(JP(n,r,$g(0))),QP(JP(n,r,$g(1))),QP(JP(n,r,$g(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),Vg(([e])=>{const t=tv(e).toVar(),n=$g(UP(t.x)).toVar(),r=$g(UP(t.y)).toVar(),i=$g(UP(t.z)).toVar();return tv(QP(JP(n,r,i,$g(0))),QP(JP(n,r,i,$g(1))),QP(JP(n,r,i,$g(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Vg(([e])=>{const t=sv(e).toVar(),n=$g(UP(t.x)).toVar(),r=$g(UP(t.y)).toVar(),i=$g(UP(t.z)).toVar(),s=$g(UP(t.w)).toVar();return tv(QP(JP(n,r,i,s,$g(0))),QP(JP(n,r,i,s,$g(1))),QP(JP(n,r,i,s,$g(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]})]),uI=Vg(([e,t,n,r])=>{const i=Xg(r).toVar(),s=Xg(n).toVar(),a=$g(t).toVar(),o=tv(e).toVar(),l=Xg(0).toVar(),u=Xg(1).toVar();return BT(a,()=>{l.addAssign(u.mul(rI(o))),u.mulAssign(i),o.mulAssign(s)}),l}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),cI=Vg(([e,t,n,r])=>{const i=Xg(r).toVar(),s=Xg(n).toVar(),a=$g(t).toVar(),o=tv(e).toVar(),l=tv(0).toVar(),u=Xg(1).toVar();return BT(a,()=>{l.addAssign(u.mul(aI(o))),u.mulAssign(i),o.mulAssign(s)}),l}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),dI=Vg(([e,t,n,r])=>{const i=Xg(r).toVar(),s=Xg(n).toVar(),a=$g(t).toVar(),o=tv(e).toVar();return Qg(uI(o,a,s,i),uI(o.add(tv($g(19),$g(193),$g(17))),a,s,i))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),hI=Vg(([e,t,n,r])=>{const i=Xg(r).toVar(),s=Xg(n).toVar(),a=$g(t).toVar(),o=tv(e).toVar(),l=tv(cI(o,a,s,i)).toVar(),u=Xg(uI(o.add(tv($g(19),$g(193),$g(17))),a,s,i)).toVar();return sv(l,u)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),pI=Vg(([e,t,n,r,i,s,a])=>{const o=$g(a).toVar(),l=Xg(s).toVar(),u=$g(i).toVar(),c=$g(r).toVar(),d=$g(n).toVar(),h=$g(t).toVar(),p=Qg(e).toVar(),f=tv(lI(Qg(h.add(c),d.add(u)))).toVar(),m=Qg(f.x,f.y).toVar();m.subAssign(.5),m.mulAssign(l),m.addAssign(.5);const g=Qg(Qg(Xg(h),Xg(d)).add(m)).toVar(),v=Qg(g.sub(p)).toVar();return Wg(o.equal($g(2)),()=>Jy(v.x).add(Jy(v.y))),Wg(o.equal($g(3)),()=>f_(Jy(v.x),Jy(v.y))),x_(v,v)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),fI=yC([pI,Vg(([e,t,n,r,i,s,a,o,l])=>{const u=$g(l).toVar(),c=Xg(o).toVar(),d=$g(a).toVar(),h=$g(s).toVar(),p=$g(i).toVar(),f=$g(r).toVar(),m=$g(n).toVar(),g=$g(t).toVar(),v=tv(e).toVar(),y=tv(lI(tv(g.add(p),m.add(h),f.add(d)))).toVar();y.subAssign(.5),y.mulAssign(c),y.addAssign(.5);const _=tv(tv(Xg(g),Xg(m),Xg(f)).add(y)).toVar(),x=tv(_.sub(v)).toVar();return Wg(u.equal($g(2)),()=>Jy(x.x).add(Jy(x.y)).add(Jy(x.z))),Wg(u.equal($g(3)),()=>f_(f_(Jy(x.x),Jy(x.y)),Jy(x.z))),x_(x,x)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),mI=Vg(([e,t,n])=>{const r=$g(n).toVar(),i=Xg(t).toVar(),s=Qg(e).toVar(),a=$g().toVar(),o=$g().toVar(),l=Qg(DP(s.x,a),DP(s.y,o)).toVar(),u=Xg(1e6).toVar();return BT({start:-1,end:$g(1),name:"x",condition:"<="},({x:e})=>{BT({start:-1,end:$g(1),name:"y",condition:"<="},({y:t})=>{const n=Xg(fI(l,e,t,a,o,i,r)).toVar();u.assign(p_(u,n))})}),Wg(r.equal($g(0)),()=>{u.assign(Vy(u))}),u}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),gI=Vg(([e,t,n])=>{const r=$g(n).toVar(),i=Xg(t).toVar(),s=Qg(e).toVar(),a=$g().toVar(),o=$g().toVar(),l=Qg(DP(s.x,a),DP(s.y,o)).toVar(),u=Qg(1e6,1e6).toVar();return BT({start:-1,end:$g(1),name:"x",condition:"<="},({x:e})=>{BT({start:-1,end:$g(1),name:"y",condition:"<="},({y:t})=>{const n=Xg(fI(l,e,t,a,o,i,r)).toVar();Wg(n.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(n)}).ElseIf(n.lessThan(u.y),()=>{u.y.assign(n)})})}),Wg(r.equal($g(0)),()=>{u.assign(Vy(u))}),u}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),vI=Vg(([e,t,n])=>{const r=$g(n).toVar(),i=Xg(t).toVar(),s=Qg(e).toVar(),a=$g().toVar(),o=$g().toVar(),l=Qg(DP(s.x,a),DP(s.y,o)).toVar(),u=tv(1e6,1e6,1e6).toVar();return BT({start:-1,end:$g(1),name:"x",condition:"<="},({x:e})=>{BT({start:-1,end:$g(1),name:"y",condition:"<="},({y:t})=>{const n=Xg(fI(l,e,t,a,o,i,r)).toVar();Wg(n.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(n)}).ElseIf(n.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(n)}).ElseIf(n.lessThan(u.z),()=>{u.z.assign(n)})})}),Wg(r.equal($g(0)),()=>{u.assign(Vy(u))}),u}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),yI=Vg(([e,t,n])=>{const r=$g(n).toVar(),i=Xg(t).toVar(),s=tv(e).toVar(),a=$g().toVar(),o=$g().toVar(),l=$g().toVar(),u=tv(DP(s.x,a),DP(s.y,o),DP(s.z,l)).toVar(),c=Xg(1e6).toVar();return BT({start:-1,end:$g(1),name:"x",condition:"<="},({x:e})=>{BT({start:-1,end:$g(1),name:"y",condition:"<="},({y:t})=>{BT({start:-1,end:$g(1),name:"z",condition:"<="},({z:n})=>{const s=Xg(fI(u,e,t,n,a,o,l,i,r)).toVar();c.assign(p_(c,s))})})}),Wg(r.equal($g(0)),()=>{c.assign(Vy(c))}),c}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),_I=yC([mI,yI]),xI=Vg(([e,t,n])=>{const r=$g(n).toVar(),i=Xg(t).toVar(),s=tv(e).toVar(),a=$g().toVar(),o=$g().toVar(),l=$g().toVar(),u=tv(DP(s.x,a),DP(s.y,o),DP(s.z,l)).toVar(),c=Qg(1e6,1e6).toVar();return BT({start:-1,end:$g(1),name:"x",condition:"<="},({x:e})=>{BT({start:-1,end:$g(1),name:"y",condition:"<="},({y:t})=>{BT({start:-1,end:$g(1),name:"z",condition:"<="},({z:n})=>{const s=Xg(fI(u,e,t,n,a,o,l,i,r)).toVar();Wg(s.lessThan(c.x),()=>{c.y.assign(c.x),c.x.assign(s)}).ElseIf(s.lessThan(c.y),()=>{c.y.assign(s)})})})}),Wg(r.equal($g(0)),()=>{c.assign(Vy(c))}),c}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),bI=yC([gI,xI]),SI=Vg(([e,t,n])=>{const r=$g(n).toVar(),i=Xg(t).toVar(),s=tv(e).toVar(),a=$g().toVar(),o=$g().toVar(),l=$g().toVar(),u=tv(DP(s.x,a),DP(s.y,o),DP(s.z,l)).toVar(),c=tv(1e6,1e6,1e6).toVar();return BT({start:-1,end:$g(1),name:"x",condition:"<="},({x:e})=>{BT({start:-1,end:$g(1),name:"y",condition:"<="},({y:t})=>{BT({start:-1,end:$g(1),name:"z",condition:"<="},({z:n})=>{const s=Xg(fI(u,e,t,n,a,o,l,i,r)).toVar();Wg(s.lessThan(c.x),()=>{c.z.assign(c.y),c.y.assign(c.x),c.x.assign(s)}).ElseIf(s.lessThan(c.y),()=>{c.z.assign(c.y),c.y.assign(s)}).ElseIf(s.lessThan(c.z),()=>{c.z.assign(s)})})})}),Wg(r.equal($g(0)),()=>{c.assign(Vy(c))}),c}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),TI=yC([vI,SI]),wI=Vg(([e])=>{const t=e.y,n=e.z,r=tv().toVar();return Wg(t.lessThan(1e-4),()=>{r.assign(tv(n,n,n))}).Else(()=>{let i=e.x;i=i.sub(Hy(i)).mul(6).toVar();const s=$g(l_(i)),a=i.sub(Xg(s)),o=n.mul(t.oneMinus()),l=n.mul(t.mul(a).oneMinus()),u=n.mul(t.mul(a.oneMinus()).oneMinus());Wg(s.equal($g(0)),()=>{r.assign(tv(n,u,o))}).ElseIf(s.equal($g(1)),()=>{r.assign(tv(l,n,o))}).ElseIf(s.equal($g(2)),()=>{r.assign(tv(o,n,u))}).ElseIf(s.equal($g(3)),()=>{r.assign(tv(o,l,n))}).ElseIf(s.equal($g(4)),()=>{r.assign(tv(u,o,n))}).Else(()=>{r.assign(tv(n,o,l))})}),r}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),MI=Vg(([e])=>{const t=tv(e).toVar(),n=Xg(t.x).toVar(),r=Xg(t.y).toVar(),i=Xg(t.z).toVar(),s=Xg(p_(n,p_(r,i))).toVar(),a=Xg(f_(n,f_(r,i))).toVar(),o=Xg(a.sub(s)).toVar(),l=Xg().toVar(),u=Xg().toVar(),c=Xg().toVar();return c.assign(a),Wg(a.greaterThan(0),()=>{u.assign(o.div(a))}).Else(()=>{u.assign(0)}),Wg(u.lessThanEqual(0),()=>{l.assign(0)}).Else(()=>{Wg(n.greaterThanEqual(a),()=>{l.assign(r.sub(i).div(o))}).ElseIf(r.greaterThanEqual(a),()=>{l.assign(ay(2,i.sub(n).div(o)))}).Else(()=>{l.assign(ay(4,n.sub(r).div(o)))}),l.mulAssign(1/6),Wg(l.lessThan(0),()=>{l.addAssign(1)})}),tv(l,u,c)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),EI=Vg(([e])=>{const t=tv(e).toVar(),n=iv(fy(t,tv(.04045))).toVar(),r=tv(t.div(12.92)).toVar(),i=tv(S_(f_(t.add(tv(.055)),tv(0)).div(1.055),tv(2.4))).toVar();return R_(r,i,n)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),AI=(e,t)=>{e=Xg(e),t=Xg(t);const n=Qg(t.dFdx(),t.dFdy()).length().mul(.7071067811865476);return L_(e.sub(n),e.add(n),t)},CI=(e,t,n,r)=>R_(e,t,n[r].clamp()),RI=(e,t,n,r,i)=>R_(e,t,AI(n,r[i])),NI=Vg(([e,t,n])=>{const r=jy(e).toVar("nDir"),i=oy(Xg(.5).mul(t.sub(n)),Nb).div(r).toVar("rbmax"),s=oy(Xg(-.5).mul(t.sub(n)),Nb).div(r).toVar("rbmin"),a=tv().toVar("rbminmax");a.x=r.x.greaterThan(Xg(0)).select(i.x,s.x),a.y=r.y.greaterThan(Xg(0)).select(i.y,s.y),a.z=r.z.greaterThan(Xg(0)).select(i.z,s.z);const o=p_(p_(a.x,a.y),a.z).toVar("correction");return Nb.add(r.mul(o)).toVar("boxIntersection").sub(n)}),PI=Vg(([e,t])=>{const n=e.x,r=e.y,i=e.z;let s=t.element(0).mul(.886227);return s=s.add(t.element(1).mul(1.023328).mul(r)),s=s.add(t.element(2).mul(1.023328).mul(i)),s=s.add(t.element(3).mul(1.023328).mul(n)),s=s.add(t.element(4).mul(.858086).mul(n).mul(r)),s=s.add(t.element(5).mul(.858086).mul(r).mul(i)),s=s.add(t.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),s=s.add(t.element(7).mul(.858086).mul(n).mul(i)),s=s.add(t.element(8).mul(.429043).mul(ly(n,n).sub(ly(r,r)))),s});var II=Object.freeze({__proto__:null,BRDF_GGX:gM,BRDF_Lambert:tM,BasicPointShadowFilter:yP,BasicShadowFilter:sP,Break:OT,Const:K_,Continue:()=>Ix("continue").append(),DFGApprox:vM,D_GGX:pM,Discard:Lx,EPSILON:Ry,F_Schlick:eM,Fn:Vg,INFINITY:Ny,If:Wg,Loop:BT,NodeAccess:Gm,NodeShaderStage:zm,NodeType:{BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},NodeUpdateType:Vm,PCFShadowFilter:aP,PCFSoftShadowFilter:oP,PI:Py,PI2:Iy,PointShadowFilter:_P,Return:()=>Ix("return").append(),Schlick_to_F0:_M,ScriptableNodeResources:cN,ShaderNode:Dg,TBNViewMatrix:TS,VSMShadowFilter:lP,V_GGX_SmithCorrelated:dM,Var:Y_,abs:Jy,acesFilmicToneMapping:KR,acos:Qy,add:ay,addMethodChaining:ug,addNodeElement:function(e){},agxToneMapping:eN,all:Ly,alphaT:Ov,and:vy,anisotropy:kv,anisotropyB:Vv,anisotropyT:zv,any:Uy,append:jg,array:mv,arrayBuffer:e=>Fg(new sg(e,"ArrayBuffer")),asin:Ky,assign:ny,atan:Zy,atan2:O_,atomicAdd:(e,t,n=null)=>LN(PN.ATOMIC_ADD,e,t,n),atomicAnd:(e,t,n=null)=>LN(PN.ATOMIC_AND,e,t,n),atomicFunc:LN,atomicLoad:(e,t=null)=>LN(PN.ATOMIC_LOAD,e,null,t),atomicMax:(e,t,n=null)=>LN(PN.ATOMIC_MAX,e,t,n),atomicMin:(e,t,n=null)=>LN(PN.ATOMIC_MIN,e,t,n),atomicOr:(e,t,n=null)=>LN(PN.ATOMIC_OR,e,t,n),atomicStore:(e,t,n=null)=>LN(PN.ATOMIC_STORE,e,t,n),atomicSub:(e,t,n=null)=>LN(PN.ATOMIC_SUB,e,t,n),atomicXor:(e,t,n=null)=>LN(PN.ATOMIC_XOR,e,t,n),attenuationColor:Jv,attenuationDistance:Zv,attribute:Bx,attributeArray:(e,t="float")=>{let n,r;!0===t.isStruct?(n=t.layout.getLength(),r=Lm("float")):(n=Um(t),r=Lm(t));const i=new rR(e,n,r);return oR(i,t,e)},backgroundBlurriness:fR,backgroundIntensity:mR,backgroundRotation:gR,batch:IT,billboarding:wC,bitAnd:by,bitNot:Sy,bitOr:Ty,bitXor:wy,bitangentGeometry:vS,bitangentLocal:yS,bitangentView:_S,bitangentWorld:xS,bitcast:d_,blendBurn:CR,blendColor:IR,blendDodge:RR,blendOverlay:PR,blendScreen:NR,blur:vE,bool:Kg,buffer:Xx,bufferAttribute:yx,bumpMap:IS,burn:(...e)=>CR(e),bvec2:ev,bvec3:iv,bvec4:lv,bypass:Ax,cache:Mx,call:iy,cameraFar:Jx,cameraIndex:Qx,cameraNear:Zx,cameraNormalMatrix:ib,cameraPosition:sb,cameraProjectionMatrix:eb,cameraProjectionMatrixInverse:tb,cameraViewMatrix:nb,cameraWorldMatrix:rb,cbrt:A_,cdl:OR,ceil:Wy,checker:NP,cineonToneMapping:$R,clamp:N_,clearcoat:Pv,clearcoatRoughness:Iv,code:rN,color:qg,colorSpaceToWorking:ux,colorToDirection:e=>Fg(e).mul(2).sub(1),compute:Tx,cond:H_,context:j_,convert:pv,convertColorSpace:(e,t,n)=>Fg(new sx(Fg(e),t,n)),convertToTexture:(e,...t)=>e.isTextureNode?e:e.isPassNode?e.getTextureNode():ZC(e,...t),cos:$y,cross:b_,cubeTexture:rS,cubeToUV:vP,dFdx:i_,dFdy:s_,dashSize:qv,defaultBuildStages:Wm,defaultShaderStages:Hm,defined:Lg,degrees:Fy,deltaTime:xC,densityFog:function(e,t){return gN(e,mN(t))},densityFogFactor:mN,depth:bw,depthPass:(e,t,n)=>Fg(new WR(WR.DEPTH,e,t,n)),difference:__,diffuseColor:Av,directPointLight:CP,directionToColor:Bw,dispersion:ey,distance:y_,div:uy,dodge:(...e)=>RR(e),dot:x_,drawIndex:ET,dynamicBufferAttribute:_x,element:hv,emissive:Cv,equal:dy,equals:h_,equirectUV:Vw,exp:By,exp2:Oy,expression:Ix,faceDirection:Fb,faceForward:U_,faceforward:k_,float:Xg,floor:Hy,fog:gN,fract:qy,frameGroup:_v,frameId:bC,frontFacing:Db,fwidth:u_,gain:(e,t)=>e.lessThan(.5)?hC(e.mul(2),t).div(2):oy(1,hC(ly(oy(1,e),2),t).div(2)),gapSize:Xv,getConstNodeType:Ug,getCurrentStack:Hg,getDirection:pE,getDistanceAttenuation:AP,getGeometryRoughness:uM,getNormalFromDepth:tR,getParallaxCorrectNormal:NI,getRoughness:cM,getScreenPosition:eR,getShIrradianceAt:PI,getTextureIndex:lC,getViewPosition:JC,globalId:MN,glsl:(e,t)=>rN(e,t,"glsl"),glslFn:(e,t)=>sN(e,t,"glsl"),grayscale:LR,greaterThan:fy,greaterThanEqual:gy,hash:dC,highpModelNormalViewMatrix:Eb,highpModelViewMatrix:Mb,hue:FR,instance:CT,instanceIndex:ST,instancedArray:(e,t="float")=>{let n,r;!0===t.isStruct?(n=t.layout.getLength(),r=Lm("float")):(n=Um(t),r=Lm(t));const i=new nR(e,n,r);return oR(i,t,e)},instancedBufferAttribute:xx,instancedDynamicBufferAttribute:bx,instancedMesh:NT,int:$g,inverseSqrt:Gy,inversesqrt:z_,invocationLocalIndex:MT,invocationSubgroupIndex:wT,ior:Yv,iridescence:Dv,iridescenceIOR:Fv,iridescenceThickness:Bv,ivec2:Zg,ivec3:nv,ivec4:av,js:(e,t)=>rN(e,t,"js"),label:q_,length:t_,lengthSq:C_,lessThan:py,lessThanEqual:my,lightPosition:ON,lightProjectionUV:BN,lightShadowMatrix:FN,lightTargetDirection:VN,lightTargetPosition:kN,lightViewPosition:zN,lightingContext:XT,lights:(e=[])=>Fg(new WN).setLights(e),linearDepth:Sw,linearToneMapping:qR,localId:EN,log:ky,log2:zy,logarithmicDepthToViewZ:(e,t,n)=>{const r=e.mul(ky(n.div(t)));return Xg(Math.E).pow(r).mul(t).negate()},loop:(...e)=>BT(...e),luminance:BR,mat2:uv,mat3:cv,mat4:dv,matcapUV:rA,materialAO:vT,materialAlphaTest:DS,materialAnisotropy:eT,materialAnisotropyVector:yT,materialAttenuationColor:lT,materialAttenuationDistance:oT,materialClearcoat:$S,materialClearcoatNormal:KS,materialClearcoatRoughness:YS,materialColor:FS,materialDispersion:mT,materialEmissive:OS,materialEnvIntensity:Kb,materialEnvRotation:Qb,materialIOR:aT,materialIridescence:tT,materialIridescenceIOR:nT,materialIridescenceThickness:rT,materialLightMap:gT,materialLineDashOffset:pT,materialLineDashSize:cT,materialLineGapSize:dT,materialLineScale:uT,materialLineWidth:hT,materialMetalness:qS,materialNormal:XS,materialOpacity:kS,materialPointSize:fT,materialReference:uS,materialReflectivity:WS,materialRefractionRatio:Yb,materialRotation:QS,materialRoughness:jS,materialSheen:ZS,materialSheenRoughness:JS,materialShininess:BS,materialSpecular:zS,materialSpecularColor:GS,materialSpecularIntensity:VS,materialSpecularStrength:HS,materialThickness:sT,materialTransmission:iT,max:f_,maxMipLevel:Gx,mediumpModelViewMatrix:wb,metalness:Nv,min:p_,mix:R_,mixElement:F_,mod:m_,modInt:cy,modelDirection:mb,modelNormalMatrix:bb,modelPosition:vb,modelRadius:xb,modelScale:yb,modelViewMatrix:Tb,modelViewPosition:_b,modelViewProjection:_T,modelWorldMatrix:gb,modelWorldMatrixInverse:Sb,morphReference:HT,mrt:cC,mul:ly,mx_aastep:AI,mx_cell_noise_float:(e=Ox())=>oI(e.convert("vec2|vec3")),mx_contrast:(e,t=1,n=.5)=>Xg(e).sub(n).mul(t).add(n),mx_fractal_noise_float:(e=Ox(),t=3,n=2,r=.5,i=1)=>uI(e,$g(t),n,r).mul(i),mx_fractal_noise_vec2:(e=Ox(),t=3,n=2,r=.5,i=1)=>dI(e,$g(t),n,r).mul(i),mx_fractal_noise_vec3:(e=Ox(),t=3,n=2,r=.5,i=1)=>cI(e,$g(t),n,r).mul(i),mx_fractal_noise_vec4:(e=Ox(),t=3,n=2,r=.5,i=1)=>hI(e,$g(t),n,r).mul(i),mx_hsvtorgb:wI,mx_noise_float:(e=Ox(),t=1,n=0)=>rI(e.convert("vec2|vec3")).mul(t).add(n),mx_noise_vec3:(e=Ox(),t=1,n=0)=>aI(e.convert("vec2|vec3")).mul(t).add(n),mx_noise_vec4:(e=Ox(),t=1,n=0)=>{e=e.convert("vec2|vec3");return sv(aI(e),rI(e.add(Qg(19,73)))).mul(t).add(n)},mx_ramplr:(e,t,n=Ox())=>CI(e,t,n,"x"),mx_ramptb:(e,t,n=Ox())=>CI(e,t,n,"y"),mx_rgbtohsv:MI,mx_safepower:(e,t=1)=>(e=Xg(e)).abs().pow(t).mul(e.sign()),mx_splitlr:(e,t,n,r=Ox())=>RI(e,t,n,r,"x"),mx_splittb:(e,t,n,r=Ox())=>RI(e,t,n,r,"y"),mx_srgb_texture_to_lin_rec709:EI,mx_transform_uv:(e=1,t=0,n=Ox())=>n.mul(e).add(t),mx_worley_noise_float:(e=Ox(),t=1)=>_I(e.convert("vec2|vec3"),t,$g(1)),mx_worley_noise_vec2:(e=Ox(),t=1)=>bI(e.convert("vec2|vec3"),t,$g(1)),mx_worley_noise_vec3:(e=Ox(),t=1)=>TI(e.convert("vec2|vec3"),t,$g(1)),negate:n_,neutralToneMapping:tN,nodeArray:Og,nodeImmutable:zg,nodeObject:Fg,nodeObjects:Bg,nodeProxy:kg,normalFlat:kb,normalGeometry:Bb,normalLocal:Ob,normalMap:CS,normalView:zb,normalWorld:Vb,normalize:jy,not:_y,notEqual:hy,numWorkgroups:TN,objectDirection:lb,objectGroup:bv,objectPosition:cb,objectRadius:pb,objectScale:db,objectViewPosition:hb,objectWorldMatrix:ub,oneMinus:r_,or:yy,orthographicDepthToViewZ:(e,t,n)=>t.sub(n).mul(e).sub(t),oscSawtooth:(e=_C)=>e.fract(),oscSine:(e=_C)=>e.add(.75).mul(2*Math.PI).sin().mul(.5).add(.5),oscSquare:(e=_C)=>e.fract().round(),oscTriangle:(e=_C)=>e.add(.5).fract().mul(2).sub(1).abs(),output:jv,outputStruct:oC,overlay:(...e)=>PR(e),overloadingFn:yC,parabola:hC,parallaxDirection:wS,parallaxUV:(e,t)=>e.sub(wS.mul(t)),parameter:(e,t)=>Fg(new tC(e,t)),pass:(e,t,n)=>Fg(new WR(WR.COLOR,e,t,n)),passTexture:(e,t)=>Fg(new GR(e,t)),pcurve:(e,t,n)=>S_(uy(S_(e,t),ay(S_(e,t),S_(oy(1,e),n))),1/t),perspectiveDepthToViewZ:yw,pmremTexture:HE,pointShadow:MP,pointUV:cR,pointWidth:$v,positionGeometry:Ab,positionLocal:Cb,positionPrevious:Rb,positionView:Ib,positionViewDirection:Lb,positionWorld:Nb,positionWorldDirection:Pb,posterize:zR,pow:S_,pow2:T_,pow3:w_,pow4:M_,property:Mv,radians:Dy,rand:D_,range:xN,rangeFog:function(e,t,n){return gN(e,fN(t,n))},rangeFogFactor:fN,reciprocal:o_,reference:aS,referenceBuffer:oS,reflect:v_,reflectVector:eS,reflectView:Zb,reflector:e=>Fg(new WC(e)),refract:I_,refractVector:tS,refractView:Jb,reinhardToneMapping:XR,remainder:Ay,remap:Rx,remapClamp:Nx,renderGroup:xv,renderOutput:Dx,rendererReference:px,rotate:oA,rotateUV:SC,roughness:Rv,round:a_,rtt:ZC,sRGBTransferEOTF:tx,sRGBTransferOETF:nx,sampler:e=>(!0===e.isNode?e:Wx(e)).convert("sampler"),saturate:P_,saturation:UR,screen:(...e)=>NR(e),screenCoordinate:ew,screenSize:JT,screenUV:ZT,scriptable:hN,scriptableValue:oN,select:G_,setCurrentStack:Gg,shaderStages:jm,shadow:mP,shadowPositionWorld:qN,shapeCircle:PP,sharedUniformGroup:yv,sheen:Lv,sheenRoughness:Uv,shiftLeft:My,shiftRight:Ey,shininess:Wv,sign:e_,sin:Xy,sinc:(e,t)=>Xy(Py.mul(t.mul(e).sub(1))).div(Py.mul(t.mul(e).sub(1))),skinning:e=>Fg(new UT(e)),skinningReference:DT,smoothstep:L_,smoothstepElement:B_,specularColor:Gv,specularF90:Hv,spherizeUV:TC,split:(e,t)=>Fg(new eg(Fg(e),t)),spritesheetUV:AC,sqrt:Vy,stack:rC,step:g_,storage:oR,storageBarrier:()=>CN("storage").append(),storageObject:(e,t,n)=>oR(e,t,n).setPBO(!0),storageTexture:yR,string:(e="")=>Fg(new sg(e,"string")),struct:(e,t=null)=>{const n=new iC(e,t),r=(...t)=>{let r=null;if(t.length>0)if(t[0].isNode){r={};const n=Object.keys(e);for(let e=0;e<t.length;e++)r[n[e]]=t[e]}else r=t[0];return Fg(new sC(n,r))};return r.layout=n,r.isStruct=!0,r},sub:oy,subgroupIndex:TT,subgroupSize:AN,tan:Yy,tangentGeometry:cS,tangentLocal:dS,tangentView:hS,tangentWorld:pS,temp:Q_,texture:Wx,texture3D:bR,textureBarrier:()=>CN("texture").append(),textureBicubic:BM,textureCubeUV:fE,textureLoad:jx,textureSize:zx,textureStore:(e,t,n)=>{const r=yR(e,t,n);return null!==n&&r.append(),r},thickness:Qv,time:_C,timerDelta:(e=1)=>xC.mul(e),timerGlobal:(e=1)=>_C.mul(e),timerLocal:(e=1)=>_C.mul(e),toOutputColorSpace:ax,toWorkingColorSpace:ox,toneMapping:mx,toneMappingExposure:gx,toonOutlinePass:(e,t,n=new jr(0,0,0),r=.003,i=1)=>Fg(new jR(e,t,Fg(n),Fg(r),Fg(i))),transformDirection:E_,transformNormal:jb,transformNormalToView:qb,transformedBentNormalView:MS,transformedBitangentView:bS,transformedBitangentWorld:SS,transformedClearcoatNormalView:Wb,transformedNormalView:Gb,transformedNormalWorld:Hb,transformedTangentView:fS,transformedTangentWorld:mS,transmission:Kv,transpose:c_,triNoise3D:mC,triplanarTexture:(...e)=>RC(...e),triplanarTextures:RC,trunc:l_,tslFn:(...e)=>Vg(...e),uint:Yg,uniform:Tv,uniformArray:Kx,uniformGroup:vv,uniforms:(e,t)=>Fg(new Yx(e,t)),userData:(e,t,n)=>Fg(new SR(e,t,n)),uv:Ox,uvec2:Jg,uvec3:rv,uvec4:ov,varying:J_,varyingProperty:Ev,vec2:Qg,vec3:tv,vec4:sv,vectorComponents:qm,velocity:AR,vertexColor:e=>Fg(new lR(e)),vertexIndex:bT,vertexStage:ex,vibrance:DR,viewZToLogarithmicDepth:_w,viewZToOrthographicDepth:gw,viewZToPerspectiveDepth:vw,viewport:tw,viewportBottomLeft:ow,viewportCoordinate:rw,viewportDepthTexture:fw,viewportLinearDepth:Tw,viewportMipTexture:dw,viewportResolution:sw,viewportSafeUV:MC,viewportSharedTexture:Fw,viewportSize:nw,viewportTexture:cw,viewportTopLeft:aw,viewportUV:iw,wgsl:(e,t)=>rN(e,t,"wgsl"),wgslFn:(e,t)=>sN(e,t,"wgsl"),workgroupArray:(e,t)=>Fg(new NN("Workgroup",e,t)),workgroupBarrier:()=>CN("workgroup").append(),workgroupId:wN,workingToColorSpace:lx,xor:xy});const LI=new eC;class UI extends bA{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const r=this.renderer,i=this.nodes.getBackgroundNode(e)||e.background;let s=!1;if(null===i)r._clearColor.getRGB(LI),LI.a=r._clearColor.a;else if(!0===i.isColor)i.getRGB(LI),LI.a=1,s=!0;else if(!0===i.isNode){const n=this.get(e),s=i;LI.copy(r._clearColor);let a=n.backgroundMesh;if(void 0===a){const e=j_(sv(s).mul(mR),{getUV:()=>gR.mul(Vb),getTextureLevel:()=>fR});let t=_T;t=t.setZ(t.w);const r=new Rw;r.name="Background.material",r.side=1,r.depthTest=!1,r.depthWrite=!1,r.fog=!1,r.lights=!1,r.vertexNode=t,r.colorNode=e,n.backgroundMeshNode=e,n.backgroundMesh=a=new Ai(new nl(1,32,32),r),a.frustumCulled=!1,a.name="Background.mesh",a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)}}const o=s.getCacheKey();n.backgroundCacheKey!==o&&(n.backgroundMeshNode.node=sv(s).mul(mR),n.backgroundMeshNode.needsUpdate=!0,a.material.needsUpdate=!0,n.backgroundCacheKey=o),t.unshift(a,a.geometry,a.material,0,0,null,null)}const a=r.xr.getEnvironmentBlendMode();if("additive"===a?LI.set(0,0,0,1):"alpha-blend"===a&&LI.set(0,0,0,0),!0===r.autoClear||!0===s){const e=n.clearColorValue;e.r=LI.r,e.g=LI.g,e.b=LI.b,e.a=LI.a,!0!==r.backend.isWebGLBackend&&!0!==r.alpha||(e.r*=e.a,e.g*=e.a,e.b*=e.a),n.depthClearValue=r._clearDepth,n.stencilClearValue=r._clearStencil,n.clearColor=!0===r.autoClearColor,n.clearDepth=!0===r.autoClearDepth,n.clearStencil=!0===r.autoClearStencil}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let DI=0;class FI{constructor(e="",t=[],n=0,r=[]){this.name=e,this.bindings=t,this.index=n,this.bindingsReference=r,this.id=DI++}}class BI{constructor(e,t,n,r,i,s,a,o,l,u=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=u,this.nodeAttributes=r,this.bindings=i,this.updateNodes=s,this.updateBeforeNodes=a,this.updateAfterNodes=o,this.observer=l,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings){if(!0!==t.bindings[0].groupNode.shared){const n=new FI(t.name,[],t.index,t);e.push(n);for(const e of t.bindings)n.bindings.push(e.clone())}else e.push(t)}return e}}class OI{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class kI{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class zI{constructor(e,t,n=!1,r=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=r}}class VI extends zI{constructor(e,t){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0}}class GI{constructor(e,t,n=""){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let HI=0;class WI{constructor(e=null){this.id=HI++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return void 0===t&&null!==this.parent&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class jI{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class qI{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class XI extends qI{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class $I extends qI{constructor(e,t=new Xt){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class YI extends qI{constructor(e,t=new Tn){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class KI extends qI{constructor(e,t=new vn){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class QI extends qI{constructor(e,t=new jr){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class ZI extends qI{constructor(e,t=new ic){super(e,t),this.isMatrix2Uniform=!0,this.boundary=16,this.itemSize=4}}class JI extends qI{constructor(e,t=new $t){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class eL extends qI{constructor(e,t=new Jn){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class tL extends XI{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class nL extends $I{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class rL extends YI{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class iL extends KI{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class sL extends QI{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class aL extends ZI{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class oL extends JI{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class lL extends eL{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const uL=new WeakMap,cL=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),dL=e=>/e/g.test(e)?String(e).replace(/\+/g,""):(e=Number(e))+(e%1?"":".0");class hL{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=rC(),this.stacks=[],this.tab="\t",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new WI,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let e=uL.get(this.renderer);return void 0===e&&(e=new gA,uL.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new yn(e,t,n)}createCubeRenderTarget(e,t){return new Gw(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),r=[];let i,s=!0;for(const e of t)r.push(e),s=s&&!0!==e.groupNode.shared;return s?(i=n.get(r),void 0===i&&(i=new FI(e,r,this.bindingsIndexes[e].group,r),n.set(r,i))):i=new FI(e,r,this.bindingsIndexes[e].group,r),i}getBindGroupArray(e,t){const n=this.bindings[t];let r=n[e];return void 0===r&&(void 0===this.bindingsIndexes[e]&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=r=[]),r}getBindings(){let e=this.bindGroups;if(null===e){const t={},n=this.bindings;for(const e of jm)for(const r in n[e]){const i=n[e][r];(t[r]||(t[r]=[])).push(...i)}e=[];for(const n in t){const r=t[n],i=this._getBindGroup(n,r);e.push(i)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((e,t)=>e.bindings[0].groupNode.order-t.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){!1===this.nodes.includes(e)&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){!1===this.sequentialNodes.includes(e)&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes){e.getUpdateType()!==Vm.NONE&&this.updateNodes.push(e.getSelf())}for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==Vm.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==Vm.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===ne||e.magFilter===re||e.magFilter===te||e.magFilter===ie||e.minFilter===ne||e.minFilter===re||e.minFilter===te||e.minFilter===ie}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return this.context,this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const n=this.getDataFromNode(e);return void 0===n.cache&&(n.cache=new WI(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){}getInstanceIndex(){}getDrawIndex(){}getFrontFacing(){}getFragCoord(){}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=void 0===t.usageCount?1:t.usageCount+1,t.usageCount}generateTexture(){}generateTextureLod(){}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,n=null){let r=this.generateArrayDeclaration(e,t)+"( ";for(let i=0;i<t;i++){const s=n?n[i]:null;r+=null!==s?s.build(this,e):this.generateConst(e),i<t-1&&(r+=", ")}return r+=" )",r}generateStruct(e,t,n=null){const r=[];for(const e of t){const{name:t,type:i}=e;n&&n[t]&&n[t].isNode?r.push(n[t].build(this,i)):r.push(this.generateConst(i))}return e+"( "+r.join(", ")+" )"}generateConst(e,t=null){if(null===t&&("float"===e||"int"===e||"uint"===e?t=0:"bool"===e?t=!1:"color"===e?t=new jr:"vec2"===e?t=new Xt:"vec3"===e?t=new Tn:"vec4"===e&&(t=new vn)),"float"===e)return dL(t);if("int"===e)return`${Math.round(t)}`;if("uint"===e)return t>=0?`${Math.round(t)}u`:"0u";if("bool"===e)return t?"true":"false";if("color"===e)return`${this.getType("vec3")}( ${dL(t.r)}, ${dL(t.g)}, ${dL(t.b)} )`;const n=this.getTypeLength(e),r=this.getComponentType(e),i=e=>this.generateConst(r,e);if(2===n)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)} )`;if(3===n)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)}, ${i(t.z)} )`;if(4===n&&"mat2"!==e)return`${this.getType(e)}( ${i(t.x)}, ${i(t.y)}, ${i(t.z)}, ${i(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(i).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return"color"===e?"vec3":e}hasGeometryAttribute(e){return this.geometry&&void 0!==this.geometry.getAttribute(e)}getAttribute(e,t){const n=this.attributes;for(const t of n)if(t.name===e)return t;const r=new OI(e,t);return n.push(r),r}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return"void"===e||"property"===e||"sampler"===e||"texture"===e||"cubeTexture"===e||"storageTexture"===e||"depthTexture"===e||"texture3D"===e}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===ue)return"int";if(t===ce)return"uint"}return"float"}getElementType(e){return"mat2"===e?"vec2":"mat3"===e?"vec3":"mat4"===e?"vec4":this.getComponentType(e)}getComponentType(e){if("float"===(e=this.getVectorType(e))||"bool"===e||"int"===e||"uint"===e)return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return null===t?null:"b"===t[1]?"bool":"i"===t[1]?"int":"u"===t[1]?"uint":"float"}getVectorType(e){return"color"===e?"vec3":"texture"===e||"cubeTexture"===e||"storageTexture"===e||"texture3D"===e?"vec4":e}getTypeFromLength(e,t="float"){if(1===e)return t;let n=Im(e);const r="float"===t?"":t[0];return!0===/mat2/.test(t)&&(n=n.replace("vec","mat")),r+n}getTypeFromArray(e){return cL.get(e.constructor)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,r=e.itemSize,i=e.normalized;let s;return e instanceof ai||!0===i||(s=this.getTypeFromArray(n)),this.getTypeFromLength(r,s)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return null!==n?Number(n[1]):"float"===t||"bool"===t||"int"===t||"uint"===t?1:!0===/mat2/.test(e)?4:!0===/mat3/.test(e)?9:!0===/mat4/.test(e)?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return"int"===t||"uint"===t?e:this.changeComponentType(e,"int")}addStack(){return this.stack=rC(this.stack),this.stacks.push(Hg()||this.stack),Gg(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,Gg(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){let r=(n=null===n?e.isGlobal(this)?this.globalCache:this.cache:n).getData(e);return void 0===r&&(r={},n.setData(e,r)),void 0===r[t]&&(r[t]={}),r[t]}getNodeProperties(e,t="any"){const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e);let r=n.bufferAttribute;if(void 0===r){const i=this.uniforms.index++;r=new OI("nodeAttribute"+i,t,e),this.bufferAttributes.push(r),n.bufferAttribute=r}return r}getStructTypeFromNode(e,t,n=null,r=this.shaderStage){const i=this.getDataFromNode(e,r,this.globalCache);let s=i.structType;if(void 0===s){const e=this.structs.index++;null===n&&(n="StructType"+e),s=new jI(n,t),this.structs[r].push(s),i.structType=s}return s}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,r=null){const i=this.getDataFromNode(e,n,this.globalCache);let s=i.uniform;if(void 0===s){const a=this.uniforms.index++;s=new kI(r||"nodeUniform"+a,t,e),this.uniforms[n].push(s),i.uniform=s}return s}getArrayCount(e){let t=null;return e.isArrayNode?t=e.count:e.isVarNode&&e.node.isArrayNode&&(t=e.node.count),t}getVarFromNode(e,t=null,n=e.getNodeType(this),r=this.shaderStage,i=!1){const s=this.getDataFromNode(e,r);let a=s.variable;if(void 0===a){const o=i?"_const":"_var",l=this.vars[r]||(this.vars[r]=[]),u=this.vars[o]||(this.vars[o]=0);null===t&&(t=(i?"nodeConst":"nodeVar")+u,this.vars[o]++);const c=this.getArrayCount(e);a=new zI(t,n,i,c),i||l.push(a),s.variable=a}return a}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(!e.bNode||this.isDeterministic(e.bNode))&&(!e.cNode||this.isDeterministic(e.cNode));if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(!e.bNode||this.isDeterministic(e.bNode));if(e.isArrayNode){if(null!==e.values)for(const t of e.values)if(!this.isDeterministic(t))return!1;return!0}return!!e.isConstNode}getVaryingFromNode(e,t=null,n=e.getNodeType(this)){const r=this.getDataFromNode(e,"any");let i=r.varying;if(void 0===i){const e=this.varyings,s=e.length;null===t&&(t="nodeVarying"+s),i=new VI(t,n),e.push(i),r.varying=i}return i}getCodeFromNode(e,t,n=this.shaderStage){const r=this.getDataFromNode(e);let i=r.code;if(void 0===i){const e=this.codes[n]||(this.codes[n]=[]),s=e.length;i=new GI("nodeCode"+s,t),e.push(i),r.code=i}return i}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:r}=this.getDataFromNode(e);let i=!0,s=t;for(;s;){if(!0===r.get(s)){i=!1;break}s=this.getDataFromNode(s).parentNodeBlock}if(i)for(const e of n)this.addLineFlowCode(e)}addLineFlowCodeBlock(e,t,n){const r=this.getDataFromNode(e),i=r.flowCodes||(r.flowCodes=[]),s=r.flowCodeBlock||(r.flowCodeBlock=new WeakMap);i.push(t),s.set(n,!0)}addLineFlowCode(e,t=null){return""===e||(null!==t&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e+=";\n"),this.flow.code+=e),this}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="\t",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new iN,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let e=0;const t=Object.values(this);return{next:()=>({value:t[e],done:e++>=t.length})}}};for(const e of t.inputs)n[e.name]=new tC(e.type,e.name);e.layout=null;const r=e.call(n),i=this.flowStagesNode(r,t.type);return e.layout=t,i}flowStagesNode(e,t=null){const n=this.flow,r=this.vars,i=this.cache,s=this.buildStage,a=this.stack,o={code:""};this.flow=o,this.vars={},this.cache=new WI,this.stack=rC();for(const n of Wm)this.setBuildStage(n),o.result=e.build(this,t);return o.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=r,this.cache=i,this.stack=a,this.setBuildStage(s),o}getFunctionOperator(){return null}flowChildNode(e,t=null){const n=this.flow,r={code:""};return this.flow=r,r.result=e.build(this,t),this.flow=n,r}flowNodeFromShaderStage(e,t,n=null,r=null){const i=this.shaderStage;this.setShaderStage(e);const s=this.flowChildNode(t,n);return null!==r&&(s.code+=`${this.tab+r} = ${s.result};\n`),this.flowCode[e]=this.flowCode[e]+s.code,this.setShaderStage(i),s}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){}getVaryings(){}getVar(e,t,n=null){return`${null!==n?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(void 0!==n)for(const e of n)t+=`${this.getVar(e.type,e.name)}; `;return t}getUniforms(){}getCodes(e){const t=this.codes[e];let n="";if(void 0!==t)for(const e of t)n+=e.code+"\n";return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){}build(){const{object:e,material:t,renderer:n}=this;if(null!==t){let e=n.library.fromMaterial(t);null===e&&(e=new Rw),e.build(this)}else this.addFlow("compute",e);for(const e of Wm){this.setBuildStage(e),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const t of jm){this.setShaderStage(t);const n=this.flowNodes[t];for(const t of n)"generate"===e?this.flowNode(t):t.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if("float"===t||"int"===t||"uint"===t)return new tL(e);if("vec2"===t||"ivec2"===t||"uvec2"===t)return new nL(e);if("vec3"===t||"ivec3"===t||"uvec3"===t)return new rL(e);if("vec4"===t||"ivec4"===t||"uvec4"===t)return new iL(e);if("color"===t)return new sL(e);if("mat2"===t)return new aL(e);if("mat3"===t)return new oL(e);if("mat4"===t)return new lL(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,n){if((t=this.getVectorType(t))===(n=this.getVectorType(n))||null===n||this.isReference(n))return e;const r=this.getTypeLength(t),i=this.getTypeLength(n);return 16===r&&9===i?`${this.getType(n)}(${e}[0].xyz, ${e}[1].xyz, ${e}[2].xyz)`:9===r&&4===i?`${this.getType(n)}(${e}[0].xy, ${e}[1].xy)`:r>4||i>4||0===i?e:r===i?`${this.getType(n)}( ${e} )`:r>i?this.format(`${e}.${"xyz".slice(0,i)}`,this.getTypeFromLength(i,this.getComponentType(t)),n):4===i&&r>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:2===r?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(1===r&&i>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${d} - Node System\n`}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}}class pL{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return void 0===n&&(n={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===Vm.FRAME){const{frameMap:t}=this._getMaps(this.updateBeforeMap,n);t.get(n)!==this.frameId&&!1!==e.updateBefore(this)&&t.set(n,this.frameId)}else if(t===Vm.RENDER){const{renderMap:t}=this._getMaps(this.updateBeforeMap,n);t.get(n)!==this.renderId&&!1!==e.updateBefore(this)&&t.set(n,this.renderId)}else t===Vm.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===Vm.FRAME){const{frameMap:t}=this._getMaps(this.updateAfterMap,n);t.get(n)!==this.frameId&&!1!==e.updateAfter(this)&&t.set(n,this.frameId)}else if(t===Vm.RENDER){const{renderMap:t}=this._getMaps(this.updateAfterMap,n);t.get(n)!==this.renderId&&!1!==e.updateAfter(this)&&t.set(n,this.renderId)}else t===Vm.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===Vm.FRAME){const{frameMap:t}=this._getMaps(this.updateMap,n);t.get(n)!==this.frameId&&!1!==e.update(this)&&t.set(n,this.frameId)}else if(t===Vm.RENDER){const{renderMap:t}=this._getMaps(this.updateMap,n);t.get(n)!==this.renderId&&!1!==e.update(this)&&t.set(n,this.renderId)}else t===Vm.OBJECT&&e.update(this)}update(){this.frameId++,void 0===this.lastTime&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class fL{constructor(e,t,n=null,r="",i=!1){this.type=e,this.name=t,this.count=n,this.qualifier=r,this.isConst=i}}fL.isNodeFunctionInput=!0;class mL extends EP{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:VN(this.light),lightColor:e}}}const gL=new Jn,vL=new Jn;let yL=null;class _L extends EP{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Tv(new Tn).setGroup(xv),this.halfWidth=Tv(new Tn).setGroup(xv),this.updateType=Vm.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;vL.identity(),gL.copy(t.matrixWorld),gL.premultiply(n),vL.extractRotation(gL),this.halfWidth.value.set(.5*t.width,0,0),this.halfHeight.value.set(0,.5*t.height,0),this.halfWidth.value.applyMatrix4(vL),this.halfHeight.value.applyMatrix4(vL)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=Wx(yL.LTC_FLOAT_1),n=Wx(yL.LTC_FLOAT_2)):(t=Wx(yL.LTC_HALF_1),n=Wx(yL.LTC_HALF_2));const{colorNode:r,light:i}=this;return{lightColor:r,lightPosition:zN(i),halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){yL=e}}class xL extends EP{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Tv(0).setGroup(xv),this.penumbraCosNode=Tv(0).setGroup(xv),this.cutoffDistanceNode=Tv(0).setGroup(xv),this.decayExponentNode=Tv(0).setGroup(xv)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:n}=this;return L_(t,n,e)}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:r,light:i}=this,s=this.getLightVector(e),a=s.normalize(),o=a.dot(VN(i)),l=this.getSpotAttenuation(o),u=s.length(),c=AP({lightDistance:u,cutoffDistance:n,decayExponent:r});let d=t.mul(l).mul(c);if(i.map){const t=BN(i,e.context.positionWorld),n=Wx(i.map,t.xy).onRenderUpdate(()=>i.map);d=t.mul(2).sub(1).abs().lessThan(1).all().select(d.mul(n),d)}return{lightColor:d,lightDirection:a}}}class bL extends xL{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e){const t=this.light.iesMap;let n=null;if(t&&!0===t.isTexture){const r=e.acos().mul(1/Math.PI);n=Wx(t,Qg(r,0),0).r}else n=super.getSpotAttenuation(e);return n}}class SL extends EP{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class TL extends EP{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=ON(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Tv(new jr).setGroup(xv)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:r}=this,i=zb.dot(r).mul(.5).add(.5),s=R_(n,t,i);e.context.irradiance.addAssign(s)}}class wL extends EP{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let e=0;e<9;e++)t.push(new Tn);this.lightProbe=Kx(t)}update(e){const{light:t}=this;super.update(e);for(let e=0;e<9;e++)this.lightProbe.array[e].copy(t.sh.coefficients[e]).multiplyScalar(t.intensity)}setup(e){const t=PI(Vb,this.lightProbe);e.context.irradiance.addAssign(t)}}class ML{parseFunction(){}}class EL{constructor(e,t,n="",r=""){this.type=e,this.inputs=t,this.name=n,this.precision=r}getCode(){}}EL.isNodeFunction=!0;const AL=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,CL=/[a-z_0-9]+/gi,RL="#pragma main";class NL extends EL{constructor(e){const{type:t,inputs:n,name:r,precision:i,inputsCode:s,blockCode:a,headerCode:o}=(e=>{const t=(e=e.trim()).indexOf(RL),n=-1!==t?e.slice(t+12):e,r=n.match(AL);if(null!==r&&5===r.length){const i=r[4],s=[];let a=null;for(;null!==(a=CL.exec(i));)s.push(a);const o=[];let l=0;for(;l<s.length;){const e="const"===s[l][0];!0===e&&l++;let t=s[l][0];"in"===t||"out"===t||"inout"===t?l++:t="";const n=s[l++][0];let r=Number.parseInt(s[l][0]);!1===Number.isNaN(r)?l++:r=null;const i=s[l++][0];o.push(new fL(n,i,r,t,e))}const u=n.substring(r[0].length),c=void 0!==r[3]?r[3]:"";return{type:r[2],inputs:o,name:c,precision:void 0!==r[1]?r[1]:"",inputsCode:i,blockCode:u,headerCode:-1!==t?e.slice(0,t):""}}throw new Error("FunctionNode: Function is not a GLSL code.")})(e);super(t,n,r,i),this.inputsCode=s,this.blockCode=a,this.headerCode=o}getCode(e=this.name){let t;const n=this.blockCode;if(""!==n){const{type:r,inputsCode:i,headerCode:s,precision:a}=this;let o=`${r} ${e} ( ${i.trim()} )`;""!==a&&(o=`${a} ${o}`),t=s+o+n}else t="";return t}}class PL extends ML{parseFunction(e){return new NL(e)}}const IL=new WeakMap,LL=[],UL=[];class DL extends bA{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new pL,this.nodeBuilderCache=new Map,this.callHashCache=new gA,this.groupsData=new gA,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===bv.name)return!0;if(n===xv.name){const t=this.get(e),n=this.nodeFrame.renderId;return t.renderId!==n&&(t.renderId=n,!0)}if(n===_v.name){const t=this.get(e),n=this.nodeFrame.frameId;return t.frameId!==n&&(t.frameId=n,!0)}LL[0]=t,LL[1]=e;let r=this.groupsData.get(LL);return void 0===r&&this.groupsData.set(LL,r={}),LL.length=0,r.version!==t.version&&(r.version=t.version,!0)}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(void 0===n){const{nodeBuilderCache:r}=this,i=this.getForRenderCacheKey(e);if(n=r.get(i),void 0===n){const t=this.backend.createNodeBuilder(e.object,this.renderer);t.scene=e.scene,t.material=e.material,t.camera=e.camera,t.context.material=e.material,t.lightsNode=e.lightsNode,t.environmentNode=this.getEnvironmentNode(e.scene),t.fogNode=this.getFogNode(e.scene),t.clippingContext=e.clippingContext,t.build(),n=this._createNodeBuilderState(t),r.set(i,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,0===t.usedTimes&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(void 0===n){const r=this.backend.createNodeBuilder(e,this.renderer);r.build(),n=this._createNodeBuilderState(r),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new BI(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){LL[0]=e,LL[1]=t;const n=this.renderer.info.calls,r=this.callHashCache.get(LL)||{};if(r.callId!==n){const i=this.getEnvironmentNode(e),s=this.getFogNode(e);t&&UL.push(t.getCacheKey(!0)),i&&UL.push(i.getCacheKey()),s&&UL.push(s.getCacheKey()),UL.push(this.renderer.shadowMap.enabled?1:0),r.callId=n,r.cacheKey=Em(UL),this.callHashCache.set(LL,r),UL.length=0}return LL.length=0,r.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const r=0===e.backgroundBlurriness&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&0===t.backgroundBlurriness;if(t.background!==n||r){const i=this.getCacheNode("background",n,()=>{if(!0===n.isCubeTexture||n.mapping===X||n.mapping===$||n.mapping===Y){if(e.backgroundBlurriness>0||n.mapping===Y)return HE(n);{let e;return e=!0===n.isCubeTexture?rS(n):Wx(n),Xw(e)}}if(!0===n.isTexture)return Wx(n,ZT.flipY()).setUpdateMatrix(!0);n.isColor},r);t.backgroundNode=i,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,r=!1){const i=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let s=i.get(t);return(void 0===s||r)&&(s=n(),i.set(t,s)),s}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const e=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const e=aS("color","color",n).setGroup(xv),t=aS("density","float",n).setGroup(xv);return gN(e,mN(t))}if(n.isFog){const e=aS("color","color",n).setGroup(xv),t=aS("near","float",n).setGroup(xv),r=aS("far","float",n).setGroup(xv);return gN(e,fN(t,r))}});t.fogNode=e,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const e=this.getCacheNode("environment",n,()=>!0===n.isCubeTexture?rS(n):!0===n.isTexture?Wx(n):void 0);t.environmentNode=e,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,r=null,i=null){const s=this.nodeFrame;return s.renderer=e,s.scene=t,s.object=n,s.camera=r,s.material=i,s}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace}hasOutputChange(e){return IL.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),r=Wx(e,ZT).renderOutput(t.toneMapping,t.currentColorSpace);return IL.set(e,n),r}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const e of n.updateNodes)t.updateNode(e)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const e of n.updateNodes)t.updateNode(e)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new pL,this.nodeBuilderCache=new Map,this.cacheLib={}}}const FL=new js;class BL{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new $t,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,null!==e&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const r=e.length;for(let i=0;i<r;i++){FL.copy(e[i]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const r=t[n+i],s=FL.normal;r.x=-s.x,r.y=-s.y,r.z=-s.z,r.w=FL.constant}}updateGlobal(e,t){this.shadowPass=null!==e.overrideMaterial&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const r=t.clippingPlanes,i=r.length;let s,a;if(this.clipIntersection?(s=this.intersectionPlanes,a=e.intersectionPlanes.length):(s=this.unionPlanes,a=e.unionPlanes.length),s.length!==a+i){s.length=a+i;for(let e=0;e<i;e++)s[a+e]=new vn;n=!0}this.projectPlanes(r,s,a),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return void 0===t&&(t=new BL(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class OL{constructor(e,t){this.bundleGroup=e,this.camera=t}}const kL=[];class zL{constructor(){this.bundles=new gA}get(e,t){const n=this.bundles;kL[0]=e,kL[1]=t;let r=n.get(kL);return void 0===r&&(r=new OL(e,t),n.set(kL,r)),kL.length=0,r}dispose(){this.bundles=new gA}}class VL{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(null!==n){t=new n;for(const n in e)t[n]=e[n]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(!n.has(t)){if("function"!=typeof e)throw new Error(`Node class ${e.name} is not a class.`);if("function"==typeof t||"object"==typeof t)throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}}addClass(e,t,n){if(!n.has(t)){if("function"!=typeof e)throw new Error(`Node class ${e.name} is not a class.`);if("function"!=typeof t)throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}}}const GL=new WN,HL=[];class WL extends gA{constructor(){super()}createNode(e=[]){return(new WN).setLights(e)}getNode(e,t){if(e.isQuadMesh)return GL;HL[0]=e,HL[1]=t;let n=this.get(HL);return void 0===n&&(n=this.createNode(),this.set(HL,n)),HL.length=0,n}}class jL extends yn{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this.hasExternalTextures=!1,this.autoAllocateDepthBuffer=!0}copy(e){return super.copy(e),this.hasExternalTextures=e.hasExternalTextures,this.autoAllocateDepthBuffer=e.autoAllocateDepthBuffer,this}}const qL=new Tn,XL=new Tn;class $L extends Dt{constructor(e){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new ki,this._cameraL.viewport=new vn,this._cameraR=new ki,this._cameraR.viewport=new vn,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new Ru,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Xt,this._onSessionEvent=KL.bind(this),this._onSessionEnd=QL.bind(this),this._onInputSourcesChange=ZL.bind(this),this._onAnimationFrame=JL.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._useLayers="undefined"!=typeof XRWebGLBinding&&"createProjectionLayer"in XRWebGLBinding.prototype}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(null!==this._glProjLayer||null!==this._glBaseLayer)return this._foveation}setFoveation(e){this._foveation=e,null!==this._glProjLayer&&(this._glProjLayer.fixedFoveation=e),null!==this._glBaseLayer&&void 0!==this._glBaseLayer.fixedFoveation&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(null!==this._session)return this._session.environmentBlendMode}getFrame(){return this._xrFrame}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend,r=t.getContext();if(this._session=e,null!==e){if(!0===n.isWebGPUBackend)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),!0===this._useLayers){let n=null,i=null,s=null;t.depth&&(s=t.stencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24,n=t.stencil?Te:Se,i=t.stencil?me:ce);const a={colorFormat:r.RGBA8,depthFormat:s,scaleFactor:this._framebufferScaleFactor},o=new XRWebGLBinding(e,r),l=o.createProjectionLayer(a);this._glBinding=o,this._glProjLayer=l,e.updateRenderState({layers:[l]}),t.setPixelRatio(1),t.setSize(l.textureWidth,l.textureHeight,!1),this._xrRenderTarget=new jL(l.textureWidth,l.textureHeight,{format:_e,type:se,colorSpace:t.outputColorSpace,depthTexture:new Oa(l.textureWidth,l.textureHeight,i,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:t.stencil,resolveDepthBuffer:!1===l.ignoreDepthValues,resolveStencilBuffer:!1===l.ignoreDepthValues}),this._xrRenderTarget.hasExternalTextures=!0}else{const n={antialias:t.samples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},i=new XRWebGLLayer(e,r,n);this._glBaseLayer=i,e.updateRenderState({baseLayer:i}),t.setPixelRatio(1),t.setSize(i.framebufferWidth,i.framebufferHeight,!1),this._xrRenderTarget=new jL(i.framebufferWidth,i.framebufferHeight,{format:_e,type:se,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:!1===i.ignoreDepthValues,resolveStencilBuffer:!1===i.ignoreDepthValues})}this.setFoveation(this.getFoveation()),this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(null===t)return;const n=e.near,r=e.far,i=this._cameraXR,s=this._cameraL,a=this._cameraR;i.near=a.near=s.near=n,i.far=a.far=s.far=r,this._currentDepthNear===i.near&&this._currentDepthFar===i.far||(t.updateRenderState({depthNear:i.near,depthFar:i.far}),this._currentDepthNear=i.near,this._currentDepthFar=i.far),s.layers.mask=2|e.layers.mask,a.layers.mask=4|e.layers.mask,i.layers.mask=s.layers.mask|a.layers.mask;const o=e.parent,l=i.cameras;YL(i,o);for(let e=0;e<l.length;e++)YL(l[e],o);2===l.length?function(e,t,n){qL.setFromMatrixPosition(t.matrixWorld),XL.setFromMatrixPosition(n.matrixWorld);const r=qL.distanceTo(XL),i=t.projectionMatrix.elements,s=n.projectionMatrix.elements,a=i[14]/(i[10]-1),o=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],c=(i[8]-1)/i[0],d=(s[8]+1)/s[0],h=a*c,p=a*d,f=r/(-c+d),m=f*-c;if(t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert(),-1===i[10])e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const t=a+f,n=o+f,i=h-m,s=p+(r-m),c=l*o/n*t,d=u*o/n*t;e.projectionMatrix.makePerspective(i,s,c,d,t,n),e.projectionMatrixInverse.copy(e.projectionMatrix).invert()}}(i,s,a):i.projectionMatrix.copy(s.projectionMatrix),function(e,t,n){null===n?e.matrix.copy(t.matrixWorld):(e.matrix.copy(n.matrixWorld),e.matrix.invert(),e.matrix.multiply(t.matrixWorld));e.matrix.decompose(e.position,e.quaternion,e.scale),e.updateMatrixWorld(!0),e.projectionMatrix.copy(t.projectionMatrix),e.projectionMatrixInverse.copy(t.projectionMatrixInverse),e.isPerspectiveCamera&&(e.fov=2*kt*Math.atan(1/e.projectionMatrix.elements[5]),e.zoom=1)}(e,i,o)}_getController(e){let t=this._controllers[e];return void 0===t&&(t=new qi,this._controllers[e]=t),t}}function YL(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}function KL(e){const t=this._controllerInputSources.indexOf(e.inputSource);if(-1===t)return;const n=this._controllers[t];if(void 0!==n){const t=this.getReferenceSpace();n.update(e.inputSource,e.frame,t),n.dispatchEvent({type:e.type,data:e.inputSource})}}function QL(){const e=this._session,t=this._renderer;e.removeEventListener("select",this._onSessionEvent),e.removeEventListener("selectstart",this._onSessionEvent),e.removeEventListener("selectend",this._onSessionEvent),e.removeEventListener("squeeze",this._onSessionEvent),e.removeEventListener("squeezestart",this._onSessionEvent),e.removeEventListener("squeezeend",this._onSessionEvent),e.removeEventListener("end",this._onSessionEnd),e.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let e=0;e<this._controllers.length;e++){const t=this._controllerInputSources[e];null!==t&&(this._controllerInputSources[e]=null,this._controllers[e].disconnect(t))}this._currentDepthNear=null,this._currentDepthFar=null,t.backend.setXRTarget(null),t.setOutputRenderTarget(null),this._session=null,this._xrRenderTarget=null,this.isPresenting=!1,t._animation.stop(),t._animation.setAnimationLoop(this._currentAnimationLoop),t._animation.setContext(this._currentAnimationContext),t._animation.start(),t.setPixelRatio(this._currentPixelRatio),t.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function ZL(e){const t=this._controllers,n=this._controllerInputSources;for(let r=0;r<e.removed.length;r++){const i=e.removed[r],s=n.indexOf(i);s>=0&&(n[s]=null,t[s].disconnect(i))}for(let r=0;r<e.added.length;r++){const i=e.added[r];let s=n.indexOf(i);if(-1===s){for(let e=0;e<t.length;e++){if(e>=n.length){n.push(i),s=e;break}if(null===n[e]){n[e]=i,s=e;break}}if(-1===s)break}const a=t[s];a&&a.connect(i)}}function JL(e,t){if(void 0===t)return;const n=this._cameraXR,r=this._renderer,i=r.backend,s=this._glBaseLayer,a=this.getReferenceSpace(),o=t.getViewerPose(a);if(this._xrFrame=t,null!==o){const e=o.views;null!==this._glBaseLayer&&i.setXRTarget(s.framebuffer);let t=!1;e.length!==n.cameras.length&&(n.cameras.length=0,t=!0);for(let r=0;r<e.length;r++){const a=e[r];let o;if(!0===this._useLayers){const e=this._glBinding.getViewSubImage(this._glProjLayer,a);o=e.viewport,0===r&&i.setXRRenderTargetTextures(this._xrRenderTarget,e.colorTexture,this._glProjLayer.ignoreDepthValues?void 0:e.depthStencilTexture)}else o=s.getViewport(a);let l=this._cameras[r];void 0===l&&(l=new ki,l.layers.enable(r),l.viewport=new vn,this._cameras[r]=l),l.matrix.fromArray(a.transform.matrix),l.matrix.decompose(l.position,l.quaternion,l.scale),l.projectionMatrix.fromArray(a.projectionMatrix),l.projectionMatrixInverse.copy(l.projectionMatrix).invert(),l.viewport.set(o.x,o.y,o.width,o.height),0===r&&(n.matrix.copy(l.matrix),n.matrix.decompose(n.position,n.quaternion,n.scale)),!0===t&&n.cameras.push(l)}r.setOutputRenderTarget(this._xrRenderTarget)}for(let e=0;e<this._controllers.length;e++){const n=this._controllerInputSources[e],r=this._controllers[e];null!==n&&void 0!==r&&r.update(n,t,a)}this._currentAnimationLoop&&this._currentAnimationLoop(e,t),t.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:t}),this._xrFrame=null}const eU=new Yi,tU=new Xt,nU=new vn,rU=new $s,iU=new Jn,sU=new vn;class aU{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:r=!0,depth:i=!0,stencil:s=!1,antialias:a=!1,samples:o=0,getFallback:l=null,colorBufferType:u=he}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=o||!0===a?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=r,this.logarithmicDepthBuffer=n,this.outputColorSpace=gt,this.toneMapping=0,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=i,this.stencil=s,this.info=new PA,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new VL,this.lighting=new WL,this._getFallback=l,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new vn(0,0,this._width,this._height),this._scissor=new vn(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new YC(new Rw),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const c=!0===this.alpha?0:1;this._clearColor=new eC(0,0,0,c),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=u,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:1},this.xr=new $L(this),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(e,t,n)=>{await this.compileAsync(e,t);const r=this._renderLists.get(e,t),i=this._renderContexts.get(e,t,this._renderTarget),s=e.overrideMaterial||n.material,a=this._objects.get(n,s,e,t,r.lightsNode,i,i.clippingContext),{fragmentShader:o,vertexShader:l}=a.getNodeBuilderState();return{fragmentShader:o,vertexShader:l}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return null!==this._initPromise||(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(e){if(null===this._getFallback)return void t(e);try{this.backend=n=this._getFallback(e),await n.init(this)}catch(e){return void t(e)}}this._nodes=new DL(this,n),this._animation=new mA(this._nodes,this.info),this._attributes=new AA(n),this._background=new UI(this,this._nodes),this._geometries=new NA(this._attributes,this.info),this._textures=new JA(this,n,this.info),this._pipelines=new BA(n,this._nodes),this._bindings=new OA(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new xA(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new WA(this.lighting),this._bundles=new zL,this._renderContexts=new QA,this._animation.start(),this._initialized=!0,e(this)})),this._initPromise}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(!0===this._isDeviceLost)return;!1===this._initialized&&await this.init();const r=this._nodes.nodeFrame,i=r.renderId,s=this._currentRenderContext,a=this._currentRenderObjectFunction,o=this._compilationPromises,l=!0===e.isScene?e:eU;null===n&&(n=e);const u=this._renderTarget,c=this._renderContexts.get(n,t,u),d=this._activeMipmapLevel,h=[];this._currentRenderContext=c,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=h,r.renderId++,r.update(),c.depth=this.depth,c.stencil=this.stencil,c.clippingContext||(c.clippingContext=new BL),c.clippingContext.updateGlobal(l,t),l.onBeforeRender(this,e,t,u);const p=this._renderLists.get(e,t);if(p.begin(),this._projectObject(e,t,0,p,c.clippingContext),n!==e&&n.traverseVisible(function(e){e.isLight&&e.layers.test(t.layers)&&p.pushLight(e)}),p.finish(),null!==u){this._textures.updateRenderTarget(u,d);const e=this._textures.get(u);c.textures=e.textures,c.depthTexture=e.depthTexture}else c.textures=null,c.depthTexture=null;this._background.update(l,p,c);const f=p.opaque,m=p.transparent,g=p.transparentDoublePass,v=p.lightsNode;!0===this.opaque&&f.length>0&&this._renderObjects(f,t,l,v),!0===this.transparent&&m.length>0&&this._renderTransparents(m,g,t,l,v),r.renderId=i,this._currentRenderContext=s,this._currentRenderObjectFunction=a,this._compilationPromises=o,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(h)}async renderAsync(e,t){!1===this._initialized&&await this.init(),this._renderScene(e,t)}async waitForGPU(){await this.backend.waitForGPU()}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:\n\nMessage: ${e.message}`;e.reason&&(t+=`\nReason: ${e.reason}`),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:r,camera:i,renderList:s}=e,a=this._currentRenderContext,o=this._bundles.get(r,i),l=this.backend.get(o);void 0===l.renderContexts&&(l.renderContexts=new Set);const u=r.version!==l.version,c=!1===l.renderContexts.has(a)||u;if(l.renderContexts.add(a),c){this.backend.beginBundle(a),(void 0===l.renderObjects||u)&&(l.renderObjects=[]),this._currentRenderBundle=o;const e=s.opaque;!0===this.opaque&&e.length>0&&this._renderObjects(e,i,t,n),this._currentRenderBundle=null,this.backend.finishBundle(a,o),l.version=r.version}else{const{renderObjects:e}=l;for(let t=0,n=e.length;t<n;t++){const n=e[t];this._nodes.needsRefresh(n)&&(this._nodes.updateBefore(n),this._nodes.updateForRender(n),this._bindings.updateForRender(n),this._nodes.updateAfter(n))}}this.backend.addBundle(a,o)}render(e,t){if(!1===this._initialized)return this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this;if(!1===(0!==e)&&!1===(t!==vt))return null;const{width:n,height:r}=this.getDrawingBufferSize(tU),{depth:i,stencil:s}=this;let a=this._frameBufferTarget;return null===a&&(a=new yn(n,r,{depthBuffer:i,stencilBuffer:s,type:this._colorBufferType,format:_e,colorSpace:vt,generateMipmaps:!1,minFilter:ne,magFilter:ne,samples:this.samples}),a.isPostProcessingRenderTarget=!0,this._frameBufferTarget=a),a.depthBuffer=i,a.stencilBuffer=s,a.setSize(n,r),a.viewport.copy(this._viewport),a.scissor.copy(this._scissor),a.viewport.multiplyScalar(this._pixelRatio),a.scissor.multiplyScalar(this._pixelRatio),a.scissorTest=this._scissorTest,a}_renderScene(e,t,n=!0){if(!0===this._isDeviceLost)return;const r=n?this._getFrameBufferTarget():null,i=this._nodes.nodeFrame,s=i.renderId,a=this._currentRenderContext,o=this._currentRenderObjectFunction,l=!0===e.isScene?e:eU,u=this._renderTarget||this._outputRenderTarget,c=this._activeCubeFace,d=this._activeMipmapLevel;let h;null!==r?(h=r,this.setRenderTarget(h)):h=u;const p=this._renderContexts.get(e,t,h);this._currentRenderContext=p,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,i.renderId=this.info.calls;const f=this.coordinateSystem,m=this.xr;if(t.coordinateSystem!==f&&!1===m.isPresenting&&(t.coordinateSystem=f,t.updateProjectionMatrix(),t.isArrayCamera))for(const e of t.cameras)e.coordinateSystem=f,e.updateProjectionMatrix();!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===m.enabled&&!0===m.isPresenting&&(!0===m.cameraAutoUpdate&&m.updateCamera(t),t=m.getCamera());let g=this._viewport,v=this._scissor,y=this._pixelRatio;null!==h&&(g=h.viewport,v=h.scissor,y=1),this.getDrawingBufferSize(tU),nU.set(0,0,tU.width,tU.height);const _=void 0===g.minDepth?0:g.minDepth,x=void 0===g.maxDepth?1:g.maxDepth;p.viewportValue.copy(g).multiplyScalar(y).floor(),p.viewportValue.width>>=d,p.viewportValue.height>>=d,p.viewportValue.minDepth=_,p.viewportValue.maxDepth=x,p.viewport=!1===p.viewportValue.equals(nU),p.scissorValue.copy(v).multiplyScalar(y).floor(),p.scissor=this._scissorTest&&!1===p.scissorValue.equals(nU),p.scissorValue.width>>=d,p.scissorValue.height>>=d,p.clippingContext||(p.clippingContext=new BL),p.clippingContext.updateGlobal(l,t),l.onBeforeRender(this,e,t,h),iU.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),rU.setFromProjectionMatrix(iU,f);const b=this._renderLists.get(e,t);if(b.begin(),this._projectObject(e,t,0,b,p.clippingContext),b.finish(),!0===this.sortObjects&&b.sort(this._opaqueSort,this._transparentSort),null!==h){this._textures.updateRenderTarget(h,d);const e=this._textures.get(h);p.textures=e.textures,p.depthTexture=e.depthTexture,p.width=e.width,p.height=e.height,p.renderTarget=h,p.depth=h.depthBuffer,p.stencil=h.stencilBuffer}else p.textures=null,p.depthTexture=null,p.width=this.domElement.width,p.height=this.domElement.height,p.depth=this.depth,p.stencil=this.stencil;p.width>>=d,p.height>>=d,p.activeCubeFace=c,p.activeMipmapLevel=d,p.occlusionQueryCount=b.occlusionQueryCount,this._background.update(l,b,p),this.backend.beginRender(p);const{bundles:S,lightsNode:T,transparentDoublePass:w,transparent:M,opaque:E}=b;return S.length>0&&this._renderBundles(S,l,T),!0===this.opaque&&E.length>0&&this._renderObjects(E,t,l,T),!0===this.transparent&&M.length>0&&this._renderTransparents(M,w,t,l,T),this.backend.finishRender(p),i.renderId=s,this._currentRenderContext=a,this._currentRenderObjectFunction=o,null!==r&&(this.setRenderTarget(u,c,d),this._renderOutput(h)),l.onAfterRender(this,e,t,h),p}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,r=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=r}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){!1===this._initialized&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize()}setSize(e,t,n=!0){this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),!0===n&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize()}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,r){const i=this._scissor;e.isVector4?i.copy(e):i.set(e,t,n,r)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,r,i=0,s=1){const a=this._viewport;e.isVector4?a.copy(e):a.set(e,t,n,r),a.minDepth=i,a.maxDepth=s}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(!1===this._initialized)return this.clearAsync(e,t,n);const r=this._renderTarget||this._getFrameBufferTarget();let i=null;if(null!==r){this._textures.updateRenderTarget(r);const e=this._textures.get(r);i=this._renderContexts.getForClear(r),i.textures=e.textures,i.depthTexture=e.depthTexture,i.width=e.width,i.height=e.height,i.renderTarget=r,i.depth=r.depthBuffer,i.stencil=r.stencilBuffer,i.clearColorValue=this.backend.getClearColor()}this.backend.clear(e,t,n,i),null!==r&&null===this._renderTarget&&this._renderOutput(r)}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){!1===this._initialized&&await this.init(),this.clear(e,t,n)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:0}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:vt}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||null===this._renderTarget}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),null!==this._frameBufferTarget&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{null!==e&&e.dispose()}),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(!0===this._isDeviceLost)return;if(!1===this._initialized)return this.computeAsync(e);const t=this._nodes.nodeFrame,n=t.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,t.renderId=this.info.calls;const r=this.backend,i=this._pipelines,s=this._bindings,a=this._nodes,o=Array.isArray(e)?e:[e];if(void 0===o[0]||!0!==o[0].isComputeNode)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");r.beginCompute(e);for(const t of o){if(!1===i.has(t)){const e=()=>{t.removeEventListener("dispose",e),i.delete(t),s.delete(t),a.delete(t)};t.addEventListener("dispose",e);const n=t.onInitFunction;null!==n&&n.call(t,{renderer:this})}a.updateForCompute(t),s.updateForCompute(t);const n=s.getForCompute(t),o=i.getForCompute(t,n);r.compute(e,t,n,o)}r.finishCompute(e),t.renderId=n}async computeAsync(e){!1===this._initialized&&await this.init(),this.compute(e)}async hasFeatureAsync(e){return!1===this._initialized&&await this.init(),this.backend.hasFeature(e)}async resolveTimestampsAsync(e="render"){return!1===this._initialized&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){return!1!==this._initialized&&this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){!1===this._initialized&&await this.init(),this._textures.updateTexture(e)}initTexture(e){this._initialized,this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(null!==t)if(t.isVector2)t=sU.set(t.x,t.y,e.image.width,e.image.height).floor();else{if(!t.isVector4)return;t=sU.copy(t).floor()}else t=sU.set(0,0,e.image.width,e.image.height);let n,r=this._currentRenderContext;null!==r?n=r.renderTarget:(n=this._renderTarget||this._getFrameBufferTarget(),null!==n&&(this._textures.updateRenderTarget(n),r=this._textures.get(n))),this._textures.updateTexture(e,{renderTarget:n}),this.backend.copyFramebufferToTexture(e,r,t)}copyTextureToTexture(e,t,n=null,r=null,i=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,r,i)}async readRenderTargetPixelsAsync(e,t,n,r,i,s=0,a=0){return this.backend.copyTextureToBuffer(e.textures[s],t,n,r,i,a)}_projectObject(e,t,n,r,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(i=i.getGroupContext(e));else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)r.pushLight(e);else if(e.isSprite){if(!e.frustumCulled||rU.intersectsSprite(e)){!0===this.sortObjects&&sU.setFromMatrixPosition(e.matrixWorld).applyMatrix4(iU);const{geometry:t,material:s}=e;s.visible&&r.push(e,t,s,n,sU.z,null,i)}}else if(e.isLineLoop);else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||rU.intersectsObject(e))){const{geometry:t,material:s}=e;if(!0===this.sortObjects&&(null===t.boundingSphere&&t.computeBoundingSphere(),sU.copy(t.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(iU)),Array.isArray(s)){const a=t.groups;for(let o=0,l=a.length;o<l;o++){const l=a[o],u=s[l.materialIndex];u&&u.visible&&r.push(e,t,u,n,sU.z,l,i)}}else s.visible&&r.push(e,t,s,n,sU.z,null,i)}if(!0===e.isBundleGroup&&void 0!==this.backend.beginBundle){const n=r;(r=this._renderLists.get(e,t)).begin(),n.pushBundle({bundleGroup:e,camera:t,renderList:r}),r.finish()}const s=e.children;for(let e=0,a=s.length;e<a;e++)this._projectObject(s[e],t,n,r,i)}_renderBundles(e,t,n){for(const r of e)this._renderBundle(r,t,n)}_renderTransparents(e,t,n,r,i){if(t.length>0){for(const{material:e}of t)e.side=1;this._renderObjects(t,n,r,i,"backSide");for(const{material:e}of t)e.side=0;this._renderObjects(e,n,r,i);for(const{material:e}of t)e.side=2}else this._renderObjects(e,n,r,i)}_renderObjects(e,t,n,r,i=null){for(let s=0,a=e.length;s<a;s++){const{object:a,geometry:o,material:l,group:u,clippingContext:c}=e[s];this._currentRenderObjectFunction(a,n,t,o,l,u,r,c,i)}}renderObject(e,t,n,r,i,s,a,o=null,l=null){let u,c,d;if(e.onBeforeRender(this,t,n,r,i,s),null!==t.overrideMaterial){const e=t.overrideMaterial;i.positionNode&&i.positionNode.isNode&&(u=e.positionNode,e.positionNode=i.positionNode),e.alphaTest=i.alphaTest,e.alphaMap=i.alphaMap,e.transparent=i.transparent||i.transmission>0,e.isShadowPassMaterial&&(e.side=null===i.shadowSide?i.side:i.shadowSide,i.depthNode&&i.depthNode.isNode&&(d=e.depthNode,e.depthNode=i.depthNode),i.castShadowNode&&i.castShadowNode.isNode&&(c=e.colorNode,e.colorNode=i.castShadowNode)),i=e}!0===i.transparent&&2===i.side&&!1===i.forceSinglePass?(i.side=1,this._handleObjectFunction(e,i,t,n,a,s,o,"backSide"),i.side=0,this._handleObjectFunction(e,i,t,n,a,s,o,l),i.side=2):this._handleObjectFunction(e,i,t,n,a,s,o,l),void 0!==u&&(t.overrideMaterial.positionNode=u),void 0!==d&&(t.overrideMaterial.depthNode=d),void 0!==c&&(t.overrideMaterial.colorNode=c),e.onAfterRender(this,t,n,r,i,s)}_renderObjectDirect(e,t,n,r,i,s,a,o){const l=this._objects.get(e,t,n,r,i,this._currentRenderContext,a,o);l.drawRange=e.geometry.drawRange,l.group=s;const u=this._nodes.needsRefresh(l);if(u&&(this._nodes.updateBefore(l),this._geometries.updateForRender(l),this._nodes.updateForRender(l),this._bindings.updateForRender(l)),this._pipelines.updateForRender(l),null!==this._currentRenderBundle){this.backend.get(this._currentRenderBundle).renderObjects.push(l),l.bundle=this._currentRenderBundle.bundleGroup}this.backend.draw(l,this.info),u&&this._nodes.updateAfter(l)}_createObjectPipeline(e,t,n,r,i,s,a,o){const l=this._objects.get(e,t,n,r,i,this._currentRenderContext,a,o);l.drawRange=e.geometry.drawRange,l.group=s,this._nodes.updateBefore(l),this._geometries.updateForRender(l),this._nodes.updateForRender(l),this._bindings.updateForRender(l),this._pipelines.getForRender(l,this._compilationPromises),this._nodes.updateAfter(l)}get compile(){return this.compileAsync}}class oU{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}class lU extends oU{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return(e=this._buffer.byteLength)+(EA-e%EA)%EA;var e}get buffer(){return this._buffer}update(){return!0}}class uU extends lU{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let cU=0;class dU extends uU{constructor(e,t){super("UniformBuffer_"+cU++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class hU extends uU{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return-1!==t&&this.uniforms.splice(t,1),this}get values(){return null===this._values&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(null===e){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){let e=0;for(let t=0,n=this.uniforms.length;t<n;t++){const n=this.uniforms[t],{boundary:r,itemSize:i}=n,s=e%EA;0!==s&&EA-s-r<0?e+=EA-s:s%r!==0&&(e+=s%r),n.offset=e/this.bytesPerElement,e+=i*this.bytesPerElement}return Math.ceil(e/EA)*EA}update(){let e=!1;for(const t of this.uniforms)!0===this.updateByType(t)&&(e=!0);return e}updateByType(e){return e.isNumberUniform?this.updateNumber(e):e.isVector2Uniform?this.updateVector2(e):e.isVector3Uniform?this.updateVector3(e):e.isVector4Uniform?this.updateVector4(e):e.isColorUniform?this.updateColor(e):e.isMatrix3Uniform?this.updateMatrix3(e):e.isMatrix4Uniform?this.updateMatrix4(e):void 0}updateNumber(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,s=e.getType();if(n[i]!==r){this._getBufferForType(s)[i]=n[i]=r,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,s=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y){const e=this._getBufferForType(s);e[i+0]=n[i+0]=r.x,e[i+1]=n[i+1]=r.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,s=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z){const e=this._getBufferForType(s);e[i+0]=n[i+0]=r.x,e[i+1]=n[i+1]=r.y,e[i+2]=n[i+2]=r.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset,s=e.getType();if(n[i+0]!==r.x||n[i+1]!==r.y||n[i+2]!==r.z||n[i+4]!==r.w){const e=this._getBufferForType(s);e[i+0]=n[i+0]=r.x,e[i+1]=n[i+1]=r.y,e[i+2]=n[i+2]=r.z,e[i+3]=n[i+3]=r.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,r=e.getValue(),i=e.offset;if(n[i+0]!==r.r||n[i+1]!==r.g||n[i+2]!==r.b){const e=this.buffer;e[i+0]=n[i+0]=r.r,e[i+1]=n[i+1]=r.g,e[i+2]=n[i+2]=r.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,r=e.getValue().elements,i=e.offset;if(n[i+0]!==r[0]||n[i+1]!==r[1]||n[i+2]!==r[2]||n[i+4]!==r[3]||n[i+5]!==r[4]||n[i+6]!==r[5]||n[i+8]!==r[6]||n[i+9]!==r[7]||n[i+10]!==r[8]){const e=this.buffer;e[i+0]=n[i+0]=r[0],e[i+1]=n[i+1]=r[1],e[i+2]=n[i+2]=r[2],e[i+4]=n[i+4]=r[3],e[i+5]=n[i+5]=r[4],e[i+6]=n[i+6]=r[5],e[i+8]=n[i+8]=r[6],e[i+9]=n[i+9]=r[7],e[i+10]=n[i+10]=r[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,r=e.getValue().elements,i=e.offset;if(!1===function(e,t,n){for(let r=0,i=t.length;r<i;r++)if(e[n+r]!==t[r])return!1;return!0}(n,r,i)){this.buffer.set(r,i),function(e,t,n){for(let r=0,i=t.length;r<i;r++)e[n+r]=t[r]}(n,r,i),t=!0}return t}_getBufferForType(e){return"int"===e||"ivec2"===e||"ivec3"===e||"ivec4"===e?new Int32Array(this.buffer.buffer):"uint"===e||"uvec2"===e||"uvec3"===e||"uvec4"===e?new Uint32Array(this.buffer.buffer):this.buffer}}let pU=0;class fU extends hU{constructor(e,t){super(e),this.id=pU++,this.groupNode=t,this.isNodeUniformsGroup=!0}}let mU=0;class gU extends oU{constructor(e,t){super(e),this.id=mU++,this.texture=t,this.version=t?t.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:t}=this;return e!==this.generation?(this.generation=e,!0):t.isVideoTexture}update(){const{texture:e,version:t}=this;return t!==e.version&&(this.version=e.version,!0)}}class vU extends gU{constructor(e,t,n,r=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=r}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class yU extends vU{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledCubeTexture=!0}}class _U extends vU{constructor(e,t,n,r=null){super(e,t,n,r),this.isSampledTexture3D=!0}}const xU={textureDimensions:"textureSize",equals:"equal"},bU={low:"lowp",medium:"mediump",high:"highp"},SU={swizzleAssign:!0,storageBuffer:!1},TU="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\nprecision highp sampler3D;\nprecision highp samplerCube;\nprecision highp sampler2DArray;\n\nprecision highp usampler2D;\nprecision highp usampler3D;\nprecision highp usamplerCube;\nprecision highp usampler2DArray;\n\nprecision highp isampler2D;\nprecision highp isampler3D;\nprecision highp isamplerCube;\nprecision highp isampler2DArray;\n\nprecision lowp sampler2DShadow;\n";class wU extends hL{constructor(e,t){super(e,t,new PL),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]},this.useComparisonMethod=!0}needsToWorkingColorSpace(e){return!0===e.isVideoTexture&&e.colorSpace!==mt}getMethod(e){return xU[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const e of t.inputs)r.push(this.getType(e.type)+" "+e.name);return`${this.getType(t.type)} ${t.name}( ${r.join(", ")} ) {\n\n\t${n.vars}\n\n${n.code}\n\treturn ${n.result};\n\n}`}setupPBO(e){const t=e.value;if(void 0===t.pbo){const e=t.array,n=t.count*t.itemSize,{itemSize:r}=t,i=t.array.constructor.name.toLowerCase().includes("int");let s=i?Me:we;2===r?s=i?Ae:Ee:3===r?s=i?1032:ye:4===r&&(s=i?Ce:_e);const a={Float32Array:de,Uint8Array:se,Uint16Array:le,Uint32Array:ce,Int8Array:ae,Int16Array:oe,Int32Array:ue,Uint8ClampedArray:se},o=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(n/r))));let l=Math.ceil(n/r/o);o*l*r<n&&l++;const u=o*l*r,c=new e.constructor(u);c.set(e,0),t.array=c;const d=new Rs(t.array,o,l,s,a[t.array.constructor.name]||de);d.needsUpdate=!0,d.isPBOTexture=!0;const h=new Hx(d,null,null);h.setPrecision("high"),t.pboNode=h,t.pbo=h.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&!0!==e.node.isTextureNode&&!0!==e.node.isBufferNode?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,r=t.value;if(this.renderer.backend.has(r)){this.renderer.backend.get(r).pbo=r.pbo}const i=this.getUniformFromNode(r.pboNode,"texture",this.shaderStage,this.context.label),s=this.getPropertyName(i);this.increaseUsage(n);const a=n.build(this,"uint"),o=this.getDataFromNode(e);let l=o.propertyName;if(void 0===l){const n=this.getVarFromNode(e);l=this.getPropertyName(n);const i=this.getDataFromNode(t);let u=i.propertySizeName;void 0===u&&(u=l+"Size",this.getVarFromNode(t,u,"uint"),this.addLineFlowCode(`${u} = uint( textureSize( ${s}, 0 ).x )`,e),i.propertySizeName=u);const{itemSize:c}=r,d="."+qm.join("").slice(0,c),h=`ivec2(${a} % ${u}, ${a} / ${u})`,p=this.generateTextureLoad(null,s,h,null,"0");let f="vec4";r.pbo.type===ce?f="uvec4":r.pbo.type===ue&&(f="ivec4"),this.addLineFlowCode(`${l} = ${f}(${p})${d}`,e),o.propertyName=l}return l}generateTextureLoad(e,t,n,r,i="0"){return r?`texelFetch( ${t}, ivec3( ${n}, ${r} ), ${i} )`:`texelFetch( ${t}, ${n}, ${i} )`}generateTexture(e,t,n,r){return e.isDepthTexture?`texture( ${t}, ${n} ).x`:(r&&(n=`vec3( ${n}, ${r} )`),`texture( ${t}, ${n} )`)}generateTextureLevel(e,t,n,r){return`textureLod( ${t}, ${n}, ${r} )`}generateTextureBias(e,t,n,r){return`texture( ${t}, ${n}, ${r} )`}generateTextureGrad(e,t,n,r){return`textureGrad( ${t}, ${n}, ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,n,r,i,s=this.shaderStage){if("fragment"===s)return`texture( ${t}, vec3( ${n}, ${r} ) )`}getVars(e){const t=[],n=this.vars[e];if(void 0!==n)for(const e of n)t.push(`${this.getVar(e.type,e.name,e.count)};`);return t.join("\n\t")}getUniforms(e){const t=this.uniforms[e],n=[],r={};for(const i of t){let t=null,s=!1;if("texture"===i.type||"texture3D"===i.type){const e=i.node.value;let n="";!0!==e.isDataTexture&&!0!==e.isData3DTexture||(e.type===ce?n="u":e.type===ue&&(n="i")),t="texture3D"===i.type?`${n}sampler3D ${i.name};`:e.compareFunction?`sampler2DShadow ${i.name};`:!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture?`${n}sampler2DArray ${i.name};`:`${n}sampler2D ${i.name};`}else if("cubeTexture"===i.type)t=`samplerCube ${i.name};`;else if("buffer"===i.type){const e=i.node,n=this.getType(e.bufferType),r=e.bufferCount,s=r>0?r:"";t=`${e.name} {\n\t${n} ${i.name}[${s}];\n};\n`}else{t=`${this.getVectorType(i.type)} ${this.getPropertyName(i,e)};`,s=!0}const a=i.node.precision;if(null!==a&&(t=bU[a]+" "+t),s){t="\t"+t;const e=i.groupNode.name;(r[e]||(r[e]=[])).push(t)}else t="uniform "+t,n.push(t)}let i="";for(const t in r){const n=r[t];i+=this._getGLSLUniformStruct(e+"_"+t,n.join("\n"))+"\n"}return i+=n.join("\n"),i}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==ue){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const r=n.array;!1==(r instanceof Uint32Array||r instanceof Int32Array)&&(t=t.slice(1))}return t}getAttributes(e){let t="";if("vertex"===e||"compute"===e){const e=this.getAttributesArray();let n=0;for(const r of e)t+=`layout( location = ${n++} ) in ${r.type} ${r.name};\n`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`\t${n.type} ${n.name};`);return t.join("\n")}getStructs(e){const t=[],n=this.structs[e],r=[];for(const e of n)if(e.output)for(const t of e.members)r.push(`layout( location = ${t.index} ) out ${t.type} ${t.name};`);else{let n="struct "+e.name+" {\n";n+=this.getStructMembers(e),n+="\n};\n",t.push(n)}return 0===r.length&&r.push("layout( location = 0 ) out vec4 fragColor;"),"\n"+r.join("\n")+"\n\n"+t.join("\n")}getVaryings(e){let t="";const n=this.varyings;if("vertex"===e||"compute"===e)for(const r of n){"compute"===e&&(r.needsInterpolation=!0);const n=this.getType(r.type);if(r.needsInterpolation){t+=`${n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":""} out ${n} ${r.name};\n`}else t+=`${n} ${r.name};\n`}else if("fragment"===e)for(const e of n)if(e.needsInterpolation){const n=this.getType(e.type);t+=`${n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":""}in ${n} ${e.name};\n`}for(const n of this.builtins[e])t+=`${n};\n`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((e,t)=>e*t,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,n=this.shaderStage){const r=this.extensions[n]||(this.extensions[n]=new Map);!1===r.has(e)&&r.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if("vertex"===e){const t=this.renderer.backend.extensions;this.object.isBatchedMesh&&t.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(void 0!==n)for(const{name:e,behavior:r}of n.values())t.push(`#extension ${e} : ${r}`);return t.join("\n")}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=SU[e];if(void 0===t){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance"}if(void 0!==n){const e=this.renderer.backend.extensions;e.has(n)&&(e.get(n),t=!0)}SU[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const r=e[n],i=this.getPropertyName(r.attributeNode);t+=`${r.varyingName} = ${i};\n\t`}return t}_getGLSLUniformStruct(e,t){return`\nlayout( std140 ) uniform ${e} {\n${t}\n};`}_getGLSLVertexCode(e){return`#version 300 es\n\n${this.getSignature()}\n\n// extensions\n${e.extensions}\n\n// precision\n${TU}\n\n// uniforms\n${e.uniforms}\n\n// varyings\n${e.varyings}\n\n// attributes\n${e.attributes}\n\n// codes\n${e.codes}\n\nvoid main() {\n\n\t// vars\n\t${e.vars}\n\n\t// transforms\n\t${e.transforms}\n\n\t// flow\n\t${e.flow}\n\n\tgl_PointSize = 1.0;\n\n}\n`}_getGLSLFragmentCode(e){return`#version 300 es\n\n${this.getSignature()}\n\n// precision\n${TU}\n\n// uniforms\n${e.uniforms}\n\n// varyings\n${e.varyings}\n\n// codes\n${e.codes}\n\n// structs\n${e.structs}\n\nvoid main() {\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n}\n`}buildCode(){const e=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n="// code\n\n";n+=this.flowCode[t];const r=this.flowNodes[t],i=r[r.length-1];for(const e of r){const r=this.getFlowData(e),s=e.name;s&&(n.length>0&&(n+="\n"),n+=`\t// flow -> ${s}\n\t`),n+=`${r.code}\n\t`,e===i&&"compute"!==t&&(n+="// result\n\t","vertex"===t?(n+="gl_Position = ",n+=`${r.result};`):"fragment"===t&&(e.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${r.result};`)))}const s=e[t];s.extensions=this.getExtensions(t),s.uniforms=this.getUniforms(t),s.attributes=this.getAttributes(t),s.varyings=this.getVaryings(t),s.vars=this.getVars(t),s.structs=this.getStructs(t),s.codes=this.getCodes(t),s.transforms=this.getTransforms(t),s.flow=n}null!==this.material?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n,r=null){const i=super.getUniformFromNode(e,t,n,r),s=this.getDataFromNode(e,n,this.globalCache);let a=s.uniformGPU;if(void 0===a){const r=e.groupNode,o=r.name,l=this.getBindGroupArray(o,n);if("texture"===t)a=new vU(i.name,i.node,r),l.push(a);else if("cubeTexture"===t)a=new yU(i.name,i.node,r),l.push(a);else if("texture3D"===t)a=new _U(i.name,i.node,r),l.push(a);else if("buffer"===t){e.name=`NodeBuffer_${e.id}`,i.name=`buffer${e.id}`;const t=new dU(e,r);t.name=e.name,l.push(t),a=t}else{const e=this.uniformGroups[n]||(this.uniformGroups[n]={});let s=e[o];void 0===s&&(s=new fU(n+"_"+o,r),e[o]=s,l.push(s)),a=this.getNodeUniform(i,t),s.addUniform(a)}s.uniformGPU=a}return i}}let MU=null,EU=null;class AU{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={render:null,compute:null}}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp)return void nn("WebGPURenderer: Timestamp tracking is disabled.");const t=this.timestampQueryPool[e];if(!t)return void nn(`WebGPURenderer: No timestamp query pool for type '${e}' found.`);const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async waitForGPU(){}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return MU=MU||new Xt,this.renderer.getDrawingBufferSize(MU)}setScissorTest(){}getClearColor(){const e=this.renderer;return EU=EU||new eC,e.getClearColor(EU),EU.getRGB(EU),EU}getDomElement(){let e=this.domElement;return null===e&&(e=void 0!==this.parameters.canvas?this.parameters.canvas:en(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${d} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return void 0===t&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let CU,RU,NU=0;class PU{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[1^this.activeBufferIndex]}switchBuffers(){this.activeBufferIndex^=1}}class IU{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:r}=n,i=e.array,s=e.usage||r.STATIC_DRAW,a=e.isInterleavedBufferAttribute?e.data:e,o=n.get(a);let l,u=o.bufferGPU;if(void 0===u&&(u=this._createBuffer(r,t,i,s),o.bufferGPU=u,o.bufferType=t,o.version=a.version),i instanceof Float32Array)l=r.FLOAT;else if(i instanceof Uint16Array)l=e.isFloat16BufferAttribute?r.HALF_FLOAT:r.UNSIGNED_SHORT;else if(i instanceof Int16Array)l=r.SHORT;else if(i instanceof Uint32Array)l=r.UNSIGNED_INT;else if(i instanceof Int32Array)l=r.INT;else if(i instanceof Int8Array)l=r.BYTE;else if(i instanceof Uint8Array)l=r.UNSIGNED_BYTE;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+i);l=r.UNSIGNED_BYTE}let c={bufferGPU:u,bufferType:t,type:l,byteLength:i.byteLength,bytesPerElement:i.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:l===r.INT||l===r.UNSIGNED_INT||e.gpuType===ue,id:NU++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const e=this._createBuffer(r,t,i,s);c=new PU(c,e)}n.set(e,c)}updateAttribute(e){const t=this.backend,{gl:n}=t,r=e.array,i=e.isInterleavedBufferAttribute?e.data:e,s=t.get(i),a=s.bufferType,o=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(a,s.bufferGPU),0===o.length)n.bufferSubData(a,0,r);else{for(let e=0,t=o.length;e<t;e++){const t=o[e];n.bufferSubData(a,t.start*r.BYTES_PER_ELEMENT,r,t.start,t.count)}i.clearUpdateRanges()}n.bindBuffer(a,null),s.version=i.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const r=t.get(e);n.deleteBuffer(r.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,r=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:i}=t.get(r),s=e.array,a=s.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,i);const o=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,o),n.bufferData(n.COPY_WRITE_BUFFER,a,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,a),await t.utils._clientWaitAsync();const l=new e.array.constructor(s.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,o),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,l),n.deleteBuffer(o),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),l.buffer}_createBuffer(e,t,n,r){const i=e.createBuffer();return e.bindBuffer(t,i),e.bufferData(t,n,r),e.bindBuffer(t,null),i}}class LU{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;CU={[g]:e.FUNC_ADD,[v]:e.FUNC_SUBTRACT,[y]:e.FUNC_REVERSE_SUBTRACT},RU={[_]:e.ZERO,[x]:e.ONE,[b]:e.SRC_COLOR,[T]:e.SRC_ALPHA,[R]:e.SRC_ALPHA_SATURATE,[A]:e.DST_COLOR,[M]:e.DST_ALPHA,[S]:e.ONE_MINUS_SRC_COLOR,[w]:e.ONE_MINUS_SRC_ALPHA,[C]:e.ONE_MINUS_DST_COLOR,[E]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=(new vn).fromArray(t),this.currentViewport=(new vn).fromArray(n),this._tempVec4=new vn}enable(e){const{enabled:t}=this;!0!==t[e]&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;!1!==t[e]&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;0!==e?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,n,r,i,s,a,o){const{gl:l}=this;if(0!==e){if(!1===this.currentBlendingEnabled&&(this.enable(l.BLEND),this.currentBlendingEnabled=!0),5===e)i=i||t,s=s||n,a=a||r,t===this.currentBlendEquation&&i===this.currentBlendEquationAlpha||(l.blendEquationSeparate(CU[t],CU[i]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=i),n===this.currentBlendSrc&&r===this.currentBlendDst&&s===this.currentBlendSrcAlpha&&a===this.currentBlendDstAlpha||(l.blendFuncSeparate(RU[n],RU[r],RU[s],RU[a]),this.currentBlendSrc=n,this.currentBlendDst=r,this.currentBlendSrcAlpha=s,this.currentBlendDstAlpha=a),this.currentBlending=e,this.currentPremultipledAlpha=!1;else if(e!==this.currentBlending||o!==this.currentPremultipledAlpha){if(this.currentBlendEquation===g&&this.currentBlendEquationAlpha===g||(l.blendEquation(l.FUNC_ADD),this.currentBlendEquation=g,this.currentBlendEquationAlpha=g),o)switch(e){case 1:l.blendFuncSeparate(l.ONE,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case 2:l.blendFunc(l.ONE,l.ONE);break;case 3:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case 4:l.blendFuncSeparate(l.ZERO,l.SRC_COLOR,l.ZERO,l.SRC_ALPHA)}else switch(e){case 1:l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case 2:l.blendFunc(l.SRC_ALPHA,l.ONE);break;case 3:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case 4:l.blendFunc(l.ZERO,l.SRC_COLOR)}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=o}}else!0===this.currentBlendingEnabled&&(this.disable(l.BLEND),this.currentBlendingEnabled=!1)}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,r){const i=this._tempVec4.set(e,t,n,r);if(!1===this.currentScissor.equals(i)){const{gl:e}=this;e.scissor(i.x,i.y,i.z,i.w),this.currentScissor.copy(i)}}viewport(e,t,n,r){const i=this._tempVec4.set(e,t,n,r);if(!1===this.currentViewport.equals(i)){const{gl:e}=this;e.viewport(i.x,i.y,i.z,i.w),this.currentViewport.copy(i)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){this.currentStencilFunc===e&&this.currentStencilRef===t&&this.currentStencilFuncMask===n||(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){this.currentStencilFail===e&&this.currentStencilZFail===t&&this.currentStencilZPass===n||(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:r}=this;2===e.side?this.disable(r.CULL_FACE):this.enable(r.CULL_FACE);let i=1===e.side;t&&(i=!i),this.setFlipSided(i),1===e.blending&&!1===e.transparent?this.setBlending(0):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const s=e.stencilWrite;if(this.setStencilTest(s),s&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage&&this.backend.renderer.samples>1?this.enable(r.SAMPLE_ALPHA_TO_COVERAGE):this.disable(r.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n){const e=12288;for(let t=0;t<8;t++)t<n?this.enable(e+t):this.disable(e+t)}}setPolygonOffset(e,t,n){const{gl:r}=this;e?(this.enable(r.POLYGON_OFFSET_FILL),this.currentPolygonOffsetFactor===t&&this.currentPolygonOffsetUnits===n||(r.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(r.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e&&(this.gl.useProgram(e),this.currentProgram=e,!0)}setVertexState(e,t=null){const n=this.gl;return(this.currentVAO!==e||this.currentIndex!==t)&&(n.bindVertexArray(e),null!==t&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0)}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:r}=this;return r[e]!==t&&(n.bindFramebuffer(e,t),r[e]=t,e===n.DRAW_FRAMEBUFFER&&(r[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(r[n.DRAW_FRAMEBUFFER]=t),!0)}drawBuffers(e,t){const{gl:n}=this;let r=[],i=!1;if(null!==e.textures){r=this.currentDrawbuffers.get(t),void 0===r&&(r=[],this.currentDrawbuffers.set(t,r));const s=e.textures;if(r.length!==s.length||r[0]!==n.COLOR_ATTACHMENT0){for(let e=0,t=s.length;e<t;e++)r[e]=n.COLOR_ATTACHMENT0+e;r.length=s.length,i=!0}}else r[0]!==n.BACK&&(r[0]=n.BACK,i=!0);i&&n.drawBuffers(r)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:r}=this;void 0===e&&(e=t.TEXTURE0+r-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:r,currentTextureSlot:i,currentBoundTextures:s,maxTextures:a}=this;void 0===n&&(n=null===i?r.TEXTURE0+a-1:i);let o=s[n];void 0===o&&(o={type:void 0,texture:void 0},s[n]=o),o.type===e&&o.texture===t||(i!==n&&(r.activeTexture(n),this.currentTextureSlot=n),r.bindTexture(e,t),o.type=e,o.texture=t)}bindBufferBase(e,t,n){const{gl:r}=this,i=`${e}-${t}`;return this.currentBoundBufferBases[i]!==n&&(r.bindBufferBase(e,t,n),this.currentBoundBufferBases[i]=n,!0)}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,r=n[t];void 0!==r&&void 0!==r.type&&(e.bindTexture(r.type,null),r.type=void 0,r.texture=void 0)}}class UU{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=""){const{gl:n,extensions:r}=this;let i;if(e===se)return n.UNSIGNED_BYTE;if(e===pe)return n.UNSIGNED_SHORT_4_4_4_4;if(e===fe)return n.UNSIGNED_SHORT_5_5_5_1;if(e===ge)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===ae)return n.BYTE;if(e===oe)return n.SHORT;if(e===le)return n.UNSIGNED_SHORT;if(e===ue)return n.INT;if(e===ce)return n.UNSIGNED_INT;if(e===de)return n.FLOAT;if(e===he)return n.HALF_FLOAT;if(e===ve)return n.ALPHA;if(e===ye)return n.RGB;if(e===_e)return n.RGBA;if(e===xe)return n.LUMINANCE;if(e===be)return n.LUMINANCE_ALPHA;if(e===Se)return n.DEPTH_COMPONENT;if(e===Te)return n.DEPTH_STENCIL;if(e===we)return n.RED;if(e===Me)return n.RED_INTEGER;if(e===Ee)return n.RG;if(e===Ae)return n.RG_INTEGER;if(e===Ce)return n.RGBA_INTEGER;if(e===Re||e===Ne||e===Pe||e===Ie)if(t===gt){if(i=r.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(e===Re)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===Ne)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===Pe)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===Ie)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=r.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(e===Re)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Ne)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Pe)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Ie)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===Le||e===Ue||e===De||e===Fe){if(i=r.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(e===Le)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Ue)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===De)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Fe)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===Be||e===Oe||e===ke){if(i=r.get("WEBGL_compressed_texture_etc"),null===i)return null;if(e===Be||e===Oe)return t===gt?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(e===ke)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(e===ze||e===Ve||e===Ge||e===He||e===We||e===je||e===qe||e===Xe||e===$e||e===Ye||e===Ke||e===Qe||e===Ze||e===Je){if(i=r.get("WEBGL_compressed_texture_astc"),null===i)return null;if(e===ze)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===Ve)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===Ge)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===He)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===We)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===je)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===qe)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===Xe)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===$e)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===Ye)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===Ke)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Qe)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===Ze)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===Je)return t===gt?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(e===et){if(i=r.get("EXT_texture_compression_bptc"),null===i)return null;if(e===et)return t===gt?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}if(e===rt||e===it||e===st||e===at){if(i=r.get("EXT_texture_compression_rgtc"),null===i)return null;if(e===et)return i.COMPRESSED_RED_RGTC1_EXT;if(e===it)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===st)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===at)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return e===me?n.UNSIGNED_INT_24_8:void 0!==n[e]?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,r)=>{!function i(){const s=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(s===e.WAIT_FAILED)return e.deleteSync(t),void r();s!==e.TIMEOUT_EXPIRED?(e.deleteSync(t),n()):requestAnimationFrame(i)}()})}}let DU,FU,BU,OU=!1;class kU{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},!1===OU&&(this._init(),OU=!0)}_init(){const e=this.gl;DU={[K]:e.REPEAT,[Q]:e.CLAMP_TO_EDGE,[Z]:e.MIRRORED_REPEAT},FU={[J]:e.NEAREST,[ee]:e.NEAREST_MIPMAP_NEAREST,[te]:e.NEAREST_MIPMAP_LINEAR,[ne]:e.LINEAR,[re]:e.LINEAR_MIPMAP_NEAREST,[ie]:e.LINEAR_MIPMAP_LINEAR},BU={[St]:e.NEVER,[Rt]:e.ALWAYS,[Tt]:e.LESS,[Mt]:e.LEQUAL,[wt]:e.EQUAL,[Ct]:e.GEQUAL,[Et]:e.GREATER,[At]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return n=!0===e.isCubeTexture?t.TEXTURE_CUBE_MAP:!0===e.isDataArrayTexture||!0===e.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:!0===e.isData3DTexture?t.TEXTURE_3D:t.TEXTURE_2D,n}getInternalFormat(e,t,n,r,i=!1){const{gl:s,extensions:a}=this;if(null!==e&&void 0!==s[e])return s[e];let o=t;return t===s.RED&&(n===s.FLOAT&&(o=s.R32F),n===s.HALF_FLOAT&&(o=s.R16F),n===s.UNSIGNED_BYTE&&(o=s.R8),n===s.UNSIGNED_SHORT&&(o=s.R16),n===s.UNSIGNED_INT&&(o=s.R32UI),n===s.BYTE&&(o=s.R8I),n===s.SHORT&&(o=s.R16I),n===s.INT&&(o=s.R32I)),t===s.RED_INTEGER&&(n===s.UNSIGNED_BYTE&&(o=s.R8UI),n===s.UNSIGNED_SHORT&&(o=s.R16UI),n===s.UNSIGNED_INT&&(o=s.R32UI),n===s.BYTE&&(o=s.R8I),n===s.SHORT&&(o=s.R16I),n===s.INT&&(o=s.R32I)),t===s.RG&&(n===s.FLOAT&&(o=s.RG32F),n===s.HALF_FLOAT&&(o=s.RG16F),n===s.UNSIGNED_BYTE&&(o=s.RG8),n===s.UNSIGNED_SHORT&&(o=s.RG16),n===s.UNSIGNED_INT&&(o=s.RG32UI),n===s.BYTE&&(o=s.RG8I),n===s.SHORT&&(o=s.RG16I),n===s.INT&&(o=s.RG32I)),t===s.RG_INTEGER&&(n===s.UNSIGNED_BYTE&&(o=s.RG8UI),n===s.UNSIGNED_SHORT&&(o=s.RG16UI),n===s.UNSIGNED_INT&&(o=s.RG32UI),n===s.BYTE&&(o=s.RG8I),n===s.SHORT&&(o=s.RG16I),n===s.INT&&(o=s.RG32I)),t===s.RGB&&(n===s.FLOAT&&(o=s.RGB32F),n===s.HALF_FLOAT&&(o=s.RGB16F),n===s.UNSIGNED_BYTE&&(o=s.RGB8),n===s.UNSIGNED_SHORT&&(o=s.RGB16),n===s.UNSIGNED_INT&&(o=s.RGB32UI),n===s.BYTE&&(o=s.RGB8I),n===s.SHORT&&(o=s.RGB16I),n===s.INT&&(o=s.RGB32I),n===s.UNSIGNED_BYTE&&(o=r===gt&&!1===i?s.SRGB8:s.RGB8),n===s.UNSIGNED_SHORT_5_6_5&&(o=s.RGB565),n===s.UNSIGNED_SHORT_5_5_5_1&&(o=s.RGB5_A1),n===s.UNSIGNED_SHORT_4_4_4_4&&(o=s.RGB4),n===s.UNSIGNED_INT_5_9_9_9_REV&&(o=s.RGB9_E5)),t===s.RGB_INTEGER&&(n===s.UNSIGNED_BYTE&&(o=s.RGB8UI),n===s.UNSIGNED_SHORT&&(o=s.RGB16UI),n===s.UNSIGNED_INT&&(o=s.RGB32UI),n===s.BYTE&&(o=s.RGB8I),n===s.SHORT&&(o=s.RGB16I),n===s.INT&&(o=s.RGB32I)),t===s.RGBA&&(n===s.FLOAT&&(o=s.RGBA32F),n===s.HALF_FLOAT&&(o=s.RGBA16F),n===s.UNSIGNED_BYTE&&(o=s.RGBA8),n===s.UNSIGNED_SHORT&&(o=s.RGBA16),n===s.UNSIGNED_INT&&(o=s.RGBA32UI),n===s.BYTE&&(o=s.RGBA8I),n===s.SHORT&&(o=s.RGBA16I),n===s.INT&&(o=s.RGBA32I),n===s.UNSIGNED_BYTE&&(o=r===gt&&!1===i?s.SRGB8_ALPHA8:s.RGBA8),n===s.UNSIGNED_SHORT_4_4_4_4&&(o=s.RGBA4),n===s.UNSIGNED_SHORT_5_5_5_1&&(o=s.RGB5_A1)),t===s.RGBA_INTEGER&&(n===s.UNSIGNED_BYTE&&(o=s.RGBA8UI),n===s.UNSIGNED_SHORT&&(o=s.RGBA16UI),n===s.UNSIGNED_INT&&(o=s.RGBA32UI),n===s.BYTE&&(o=s.RGBA8I),n===s.SHORT&&(o=s.RGBA16I),n===s.INT&&(o=s.RGBA32I)),t===s.DEPTH_COMPONENT&&(n===s.UNSIGNED_SHORT&&(o=s.DEPTH_COMPONENT16),n===s.UNSIGNED_INT&&(o=s.DEPTH_COMPONENT24),n===s.FLOAT&&(o=s.DEPTH_COMPONENT32F)),t===s.DEPTH_STENCIL&&n===s.UNSIGNED_INT_24_8&&(o=s.DEPTH24_STENCIL8),o!==s.R16F&&o!==s.R32F&&o!==s.RG16F&&o!==s.RG32F&&o!==s.RGBA16F&&o!==s.RGBA32F||a.get("EXT_color_buffer_float"),o}setTextureParameters(e,t){const{gl:n,extensions:r,backend:i}=this;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE),n.texParameteri(e,n.TEXTURE_WRAP_S,DU[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,DU[t.wrapT]),e!==n.TEXTURE_3D&&e!==n.TEXTURE_2D_ARRAY||n.texParameteri(e,n.TEXTURE_WRAP_R,DU[t.wrapR]),n.texParameteri(e,n.TEXTURE_MAG_FILTER,FU[t.magFilter]);const s=void 0!==t.mipmaps&&t.mipmaps.length>0,a=t.minFilter===ne&&s?ie:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,FU[a]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,BU[t.compareFunction])),!0===r.has("EXT_texture_filter_anisotropic")){if(t.magFilter===J)return;if(t.minFilter!==te&&t.minFilter!==ie)return;if(t.type===de&&!1===r.has("OES_texture_float_linear"))return;if(t.anisotropy>1){const s=r.get("EXT_texture_filter_anisotropic");n.texParameterf(e,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,i.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:r}=this,i=this.getGLTextureType(e);let s=r[i];void 0===s&&(s=t.createTexture(),n.state.bindTexture(i,s),t.texParameteri(i,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(i,t.TEXTURE_MAG_FILTER,t.NEAREST),r[i]=s),n.set(e,{textureGPU:s,glTextureType:i,isDefault:!0})}createTexture(e,t){const{gl:n,backend:r}=this,{levels:i,width:s,height:a,depth:o}=t,l=r.utils.convert(e.format,e.colorSpace),u=r.utils.convert(e.type),c=this.getInternalFormat(e.internalFormat,l,u,e.colorSpace,e.isVideoTexture),d=n.createTexture(),h=this.getGLTextureType(e);r.state.bindTexture(h,d),this.setTextureParameters(h,e),e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,i,c,s,a,o):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,i,c,s,a,o):e.isVideoTexture||n.texStorage2D(h,i,c,s,a),r.set(e,{textureGPU:d,glTextureType:h,glFormat:l,glType:u,glInternalFormat:c})}copyBufferToTexture(e,t){const{gl:n,backend:r}=this,{textureGPU:i,glTextureType:s,glFormat:a,glType:o}=r.get(t),{width:l,height:u}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),r.state.bindTexture(s,i),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(s,0,0,0,l,u,a,o,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),r.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:r,height:i}=t,{textureGPU:s,glTextureType:a,glFormat:o,glType:l,glInternalFormat:u}=this.backend.get(e);if(e.isRenderTargetTexture||void 0===s)return;const c=e=>e.isDataTexture?e.image.data:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||e instanceof OffscreenCanvas?e:e.data;if(this.backend.state.bindTexture(a,s),this.setTextureParameters(a,e),e.isCompressedTexture){const r=e.mipmaps,i=t.image;for(let t=0;t<r.length;t++){const s=r[t];e.isCompressedArrayTexture?e.format!==n.RGBA?null!==o&&n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,t,0,0,0,s.width,s.height,i.depth,o,s.data):n.texSubImage3D(n.TEXTURE_2D_ARRAY,t,0,0,0,s.width,s.height,i.depth,o,l,s.data):null!==o&&n.compressedTexSubImage2D(n.TEXTURE_2D,t,0,0,s.width,s.height,o,s.data)}}else if(e.isCubeTexture){const e=t.images;for(let t=0;t<6;t++){const s=c(e[t]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,r,i,o,l,s)}}else if(e.isDataArrayTexture){const e=t.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,e.width,e.height,e.depth,o,l,e.data)}else if(e.isData3DTexture){const e=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,e.width,e.height,e.depth,o,l,e.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(a,0,u,o,l,t.image);else{const e=c(t.image);n.texSubImage2D(a,0,0,0,r,i,o,l,e)}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:r,glTextureType:i}=n.get(e);n.state.bindTexture(i,r),t.generateMipmap(i)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const r=n.get(e);if(r.renderBufferStorageSetup=void 0,r.framebuffers){for(const e in r.framebuffers)t.deleteFramebuffer(r.framebuffers[e]);delete r.framebuffers}if(r.depthRenderbuffer&&(t.deleteRenderbuffer(r.depthRenderbuffer),delete r.depthRenderbuffer),r.stencilRenderbuffer&&(t.deleteRenderbuffer(r.stencilRenderbuffer),delete r.stencilRenderbuffer),r.msaaFrameBuffer&&(t.deleteFramebuffer(r.msaaFrameBuffer),delete r.msaaFrameBuffer),r.msaaRenderbuffers){for(let e=0;e<r.msaaRenderbuffers.length;e++)t.deleteRenderbuffer(r.msaaRenderbuffers[e]);delete r.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:n}=this,{textureGPU:r,renderTarget:i}=n.get(e);this.deallocateRenderBuffers(i),t.deleteTexture(r),n.delete(e)}copyTextureToTexture(e,t,n=null,r=null,i=0){const{gl:s,backend:a}=this,{state:o}=this.backend,{textureGPU:l,glTextureType:u,glType:c,glFormat:d}=a.get(t);let h,p,f,m,g,v;null!==n?(h=n.max.x-n.min.x,p=n.max.y-n.min.y,f=n.min.x,m=n.min.y):(h=e.image.width,p=e.image.height,f=0,m=0),null!==r?(g=r.x,v=r.y):(g=0,v=0),o.bindTexture(u,l),s.pixelStorei(s.UNPACK_ALIGNMENT,t.unpackAlignment),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,t.unpackAlignment);const y=s.getParameter(s.UNPACK_ROW_LENGTH),_=s.getParameter(s.UNPACK_IMAGE_HEIGHT),x=s.getParameter(s.UNPACK_SKIP_PIXELS),b=s.getParameter(s.UNPACK_SKIP_ROWS),S=s.getParameter(s.UNPACK_SKIP_IMAGES),T=e.isCompressedTexture?e.mipmaps[i]:e.image;if(s.pixelStorei(s.UNPACK_ROW_LENGTH,T.width),s.pixelStorei(s.UNPACK_IMAGE_HEIGHT,T.height),s.pixelStorei(s.UNPACK_SKIP_PIXELS,f),s.pixelStorei(s.UNPACK_SKIP_ROWS,m),e.isRenderTargetTexture||e.isDepthTexture){const n=a.get(e),r=a.get(t),i=a.get(n.renderTarget),l=a.get(r.renderTarget),u=i.framebuffers[n.cacheKey],c=l.framebuffers[r.cacheKey];o.bindFramebuffer(s.READ_FRAMEBUFFER,u),o.bindFramebuffer(s.DRAW_FRAMEBUFFER,c);let d=s.COLOR_BUFFER_BIT;e.isDepthTexture&&(d=s.DEPTH_BUFFER_BIT),s.blitFramebuffer(f,m,h,p,g,v,h,p,d,s.NEAREST),o.bindFramebuffer(s.READ_FRAMEBUFFER,null),o.bindFramebuffer(s.DRAW_FRAMEBUFFER,null)}else e.isDataTexture?s.texSubImage2D(s.TEXTURE_2D,i,g,v,h,p,d,c,T.data):e.isCompressedTexture?s.compressedTexSubImage2D(s.TEXTURE_2D,i,g,v,T.width,T.height,d,T.data):s.texSubImage2D(s.TEXTURE_2D,i,g,v,h,p,d,c,T);s.pixelStorei(s.UNPACK_ROW_LENGTH,y),s.pixelStorei(s.UNPACK_IMAGE_HEIGHT,_),s.pixelStorei(s.UNPACK_SKIP_PIXELS,x),s.pixelStorei(s.UNPACK_SKIP_ROWS,b),s.pixelStorei(s.UNPACK_SKIP_IMAGES,S),0===i&&t.generateMipmaps&&s.generateMipmap(s.TEXTURE_2D),o.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:r}=this,{state:i}=this.backend,{textureGPU:s}=this.backend.get(e),{x:a,y:o,z:l,w:u}=n,c=!0===e.isDepthTexture||t.renderTarget&&t.renderTarget.samples>0,d=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(c){const n=0!==a||0!==o;let c,h;if(!0===e.isDepthTexture?(c=r.DEPTH_BUFFER_BIT,h=r.DEPTH_ATTACHMENT,t.stencil&&(c|=r.STENCIL_BUFFER_BIT)):(c=r.COLOR_BUFFER_BIT,h=r.COLOR_ATTACHMENT0),n){const e=this.backend.get(t.renderTarget),n=e.framebuffers[t.getCacheKey()],h=e.msaaFrameBuffer;i.bindFramebuffer(r.DRAW_FRAMEBUFFER,n),i.bindFramebuffer(r.READ_FRAMEBUFFER,h);const p=d-o-u;r.blitFramebuffer(a,p,a+l,p+u,a,p,a+l,p+u,c,r.NEAREST),i.bindFramebuffer(r.READ_FRAMEBUFFER,n),i.bindTexture(r.TEXTURE_2D,s),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a,p,l,u),i.unbindTexture()}else{const e=r.createFramebuffer();i.bindFramebuffer(r.DRAW_FRAMEBUFFER,e),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,h,r.TEXTURE_2D,s,0),r.blitFramebuffer(0,0,l,u,0,0,l,u,c,r.NEAREST),r.deleteFramebuffer(e)}}else i.bindTexture(r.TEXTURE_2D,s),r.copyTexSubImage2D(r.TEXTURE_2D,0,0,0,a,d-u-o,l,u),i.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,r=!1){const{gl:i}=this,s=t.renderTarget,{depthTexture:a,depthBuffer:o,stencilBuffer:l,width:u,height:c}=s;if(i.bindRenderbuffer(i.RENDERBUFFER,e),o&&!l){let t=i.DEPTH_COMPONENT24;if(!0===r){this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(i.RENDERBUFFER,s.samples,t,u,c)}else n>0?(a&&a.isDepthTexture&&a.type===i.FLOAT&&(t=i.DEPTH_COMPONENT32F),i.renderbufferStorageMultisample(i.RENDERBUFFER,n,t,u,c)):i.renderbufferStorage(i.RENDERBUFFER,t,u,c);i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,e)}else o&&l&&(n>0?i.renderbufferStorageMultisample(i.RENDERBUFFER,n,i.DEPTH24_STENCIL8,u,c):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,u,c),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,e))}async copyTextureToBuffer(e,t,n,r,i,s){const{backend:a,gl:o}=this,{textureGPU:l,glFormat:u,glType:c}=this.backend.get(e),d=o.createFramebuffer();o.bindFramebuffer(o.READ_FRAMEBUFFER,d);const h=e.isCubeTexture?o.TEXTURE_CUBE_MAP_POSITIVE_X+s:o.TEXTURE_2D;o.framebufferTexture2D(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,h,l,0);const p=this._getTypedArrayType(c),f=r*i*this._getBytesPerTexel(c,u),m=o.createBuffer();o.bindBuffer(o.PIXEL_PACK_BUFFER,m),o.bufferData(o.PIXEL_PACK_BUFFER,f,o.STREAM_READ),o.readPixels(t,n,r,i,u,c,0),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),await a.utils._clientWaitAsync();const g=new p(f/p.BYTES_PER_ELEMENT);return o.bindBuffer(o.PIXEL_PACK_BUFFER,m),o.getBufferSubData(o.PIXEL_PACK_BUFFER,0,g),o.bindBuffer(o.PIXEL_PACK_BUFFER,null),o.deleteFramebuffer(d),g}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4)return Uint16Array;if(e===t.UNSIGNED_SHORT_5_5_5_1)return Uint16Array;if(e===t.UNSIGNED_SHORT_5_6_5)return Uint16Array;if(e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let r=0;return e===n.UNSIGNED_BYTE&&(r=1),e!==n.UNSIGNED_SHORT_4_4_4_4&&e!==n.UNSIGNED_SHORT_5_5_5_1&&e!==n.UNSIGNED_SHORT_5_6_5&&e!==n.UNSIGNED_SHORT&&e!==n.HALF_FLOAT||(r=2),e!==n.UNSIGNED_INT&&e!==n.FLOAT||(r=4),t===n.RGBA?4*r:t===n.RGB?3*r:t===n.ALPHA?r:void 0}}class zU{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return void 0===t&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}}class VU{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(null!==this.maxAnisotropy)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const GU={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class HU{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:r,object:i,type:s,info:a,index:o}=this;0!==o?n.drawElements(r,t,s,e):n.drawArrays(r,e,t),a.update(i,t,1)}renderInstances(e,t,n){const{gl:r,mode:i,type:s,index:a,object:o,info:l}=this;0!==n&&(0!==a?r.drawElementsInstanced(i,t,s,e,n):r.drawArraysInstanced(i,e,t,n),l.update(o,t,n))}renderMultiDraw(e,t,n){const{extensions:r,mode:i,object:s,info:a}=this;if(0===n)return;const o=r.get("WEBGL_multi_draw");if(null===o)for(let r=0;r<n;r++)this.render(e[r],t[r]);else{0!==this.index?o.multiDrawElementsWEBGL(i,t,0,this.type,e,0,n):o.multiDrawArraysWEBGL(i,e,0,t,0,n);let r=0;for(let e=0;e<n;e++)r+=t[e];a.update(s,r,1)}}renderMultiDrawInstances(e,t,n,r){const{extensions:i,mode:s,object:a,info:o}=this;if(0===n)return;const l=i.get("WEBGL_multi_draw");if(null===l)for(let i=0;i<n;i++)this.renderInstances(e[i],t[i],r[i]);else{0!==this.index?l.multiDrawElementsInstancedWEBGL(s,t,0,this.type,e,0,r,0,n):l.multiDrawArraysInstancedWEBGL(s,e,0,t,0,r,0,n);let i=0;for(let e=0;e<n;e++)i+=t[e]*r[e];o.update(a,i,1)}}}class WU{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.pendingResolve=!1}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class jU extends WU{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),this.ext){this.queries=[];for(let t=0;t<this.maxQueries;t++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}else this.trackTimestamp=!1}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return nn(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e.id,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(null==t)return;if(null!==this.activeQuery)return;const n=this.queries[t];if(n)try{"inactive"===this.queryStates.get(t)&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(e){this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(null!=t&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(e){this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=[];for(const[t,n]of this.queryStates)if("ended"===n){const n=this.queries[t];e.push(this.resolveQuery(n))}if(0===e.length)return this.lastValue;const t=(await Promise.all(e)).reduce((e,t)=>e+t,0);return this.lastValue=t,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,t}catch(e){return this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed)return void t(this.lastValue);let n,r=!1;const i=e=>{r||(r=!0,n&&(clearTimeout(n),n=null),t(e))},s=()=>{if(this.isDisposed)i(this.lastValue);else try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT))return void i(this.lastValue);if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE))return void(n=setTimeout(s,1));const r=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(r)/1e6)}catch(e){t(this.lastValue)}};s()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class qU extends AU{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this.trackTimestamp=!0===e.trackTimestamp,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.samples>0,alpha:!0,depth:e.depth,stencil:e.stencil},r=void 0!==t.context?t.context:e.domElement.getContext("webgl2",n);function i(t){t.preventDefault();const n={api:"WebGL",message:t.statusMessage||"Unknown reason",reason:null,originalEvent:t};e.onDeviceLost(n)}this._onContextLost=i,e.domElement.addEventListener("webglcontextlost",i,!1),this.gl=r,this.extensions=new zU(this),this.capabilities=new VU(this),this.attributeUtils=new IU(this),this.textureUtils=new kU(this),this.bufferRenderer=new HU(this),this.state=new LU(this),this.utils=new UU(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return Lt}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}async makeXRCompatible(){!0!==this.gl.getContextAttributes().xrCompatible&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){const r=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:r.RGBA8}),null!==n){const t=e.stencilBuffer?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:t}),e.autoAllocateDepthBuffer=!1,this.extensions.has("WEBGL_multisampled_render_to_texture")}}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new jU(this.gl,t,2048));const n=this.timestampQueryPool[t];null!==n.allocateQueriesForContext(e)&&n.beginQuery(e)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t].endQuery(e)}getContext(){return this.gl}beginRender(e){const{state:t,gl:n}=this,r=this.get(e);if(e.viewport?this.updateViewport(e):t.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),e.scissor){const{x:n,y:r,width:i,height:s}=e.scissorValue;t.scissor(n,e.height-s-r,i,s)}this.initTimestampQuery(e),r.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const i=e.occlusionQueryCount;i>0&&(r.currentOcclusionQueries=r.occlusionQueries,r.currentOcclusionQueryObjects=r.occlusionQueryObjects,r.lastOcclusionObject=null,r.occlusionQueries=new Array(i),r.occlusionQueryObjects=new Array(i),r.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,r=this.get(e),i=r.previousContext;n.resetVertexState();const s=e.occlusionQueryCount;s>0&&(s>r.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const a=e.textures;if(null!==a)for(let e=0;e<a.length;e++){const t=a[e];t.generateMipmaps&&this.generateMipmaps(t)}if(this._currentContext=i,null!==e.textures&&e.renderTarget){const r=this.get(e.renderTarget),{samples:i}=e.renderTarget;if(i>0&&!1===this._useMultisampledRTT(e.renderTarget)){const i=r.framebuffers[e.getCacheKey()],s=t.COLOR_BUFFER_BIT,a=r.msaaFrameBuffer,o=e.textures;n.bindFramebuffer(t.READ_FRAMEBUFFER,a),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,i);for(let n=0;n<o.length;n++)if(e.scissor){const{x:n,y:i,width:a,height:o}=e.scissorValue,l=e.height-o-i;t.blitFramebuffer(n,l,n+a,l+o,n,l,n+a,l+o,s,t.NEAREST),!0===this._supportsInvalidateFramebuffer&&t.invalidateSubFramebuffer(t.READ_FRAMEBUFFER,r.invalidationArray,n,l,a,o)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,s,t.NEAREST),!0===this._supportsInvalidateFramebuffer&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,r.invalidationArray)}}null!==i&&(this._setFramebuffer(i),i.viewport?this.updateViewport(i):n.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)),this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const e=new WeakSet,{gl:i}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const s=()=>{let a=0;for(let t=0;t<n.length;t++){const s=n[t];null!==s&&(i.getQueryParameter(s,i.QUERY_RESULT_AVAILABLE)&&(0===i.getQueryParameter(s,i.QUERY_RESULT)&&e.add(r[t]),n[t]=null,i.deleteQuery(s),a++))}a<n.length?requestAnimationFrame(s):t.occluded=e};s()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:r,width:i,height:s}=e.viewportValue;t.viewport(n,e.height-s-r,i,s)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,r=null,i=!0){const{gl:s,renderer:a}=this;if(null===r){r={textures:null,clearColorValue:this.getClearColor()}}let o=0;if(e&&(o|=s.COLOR_BUFFER_BIT),t&&(o|=s.DEPTH_BUFFER_BIT),n&&(o|=s.STENCIL_BUFFER_BIT),0!==o){let l;l=r.clearColorValue?r.clearColorValue:this.getClearColor();const u=a.getClearDepth(),c=a.getClearStencil();if(t&&this.state.setDepthMask(!0),null===r.textures)s.clearColor(l.r,l.g,l.b,l.a),s.clear(o);else{if(i&&this._setFramebuffer(r),e)for(let e=0;e<r.textures.length;e++)0===e?s.clearBufferfv(s.COLOR,e,[l.r,l.g,l.b,l.a]):s.clearBufferfv(s.COLOR,e,[0,0,0,1]);t&&n?s.clearBufferfi(s.DEPTH_STENCIL,0,u,c):t?s.clearBufferfv(s.DEPTH,0,[u]):n&&s.clearBufferiv(s.STENCIL,0,[c])}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,t,n,r){const{state:i,gl:s}=this;!1===this.discard&&(s.enable(s.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:a,transformBuffers:o,attributes:l}=this.get(r),u=this._getVaoKey(l),c=this.vaoCache[u];void 0===c?this._createVao(l):i.setVertexState(c),i.useProgram(a),this._bindUniforms(n);const d=this._getTransformFeedback(o);s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,d),s.beginTransformFeedback(s.POINTS),l[0].isStorageInstancedBufferAttribute?s.drawArraysInstanced(s.POINTS,0,1,t.count):s.drawArrays(s.POINTS,0,t.count),s.endTransformFeedback(),s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null);for(let e=0;e<o.length;e++){const t=o[e];t.pbo&&this.textureUtils.copyBufferToTexture(t.transformBuffer,t.pbo),t.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(e){const{object:t,pipeline:n,material:r,context:i,hardwareClippingPlanes:s}=e,{programGPU:a}=this.get(n),{gl:o,state:l}=this,u=this.get(i),c=e.getDrawParameters();if(null===c)return;this._bindUniforms(e.getBindings());const d=t.isMesh&&t.matrixWorld.determinant()<0;l.setMaterial(r,d,s),l.useProgram(a);const h=this.get(e);let p=h.staticVao;if(void 0===p||h.geometryId!==e.geometry.id){const t=this._getVaoKey(e.getAttributes());if(p=this.vaoCache[t],void 0===p){let t;({vaoGPU:p,staticVao:t}=this._createVao(e.getAttributes())),t&&(h.staticVao=p,h.geometryId=e.geometry.id)}}const f=e.getIndex(),m=null!==f?this.get(f).bufferGPU:null;l.setVertexState(p,m);const g=u.lastOcclusionObject;if(g!==t&&void 0!==g){if(null!==g&&!0===g.occlusionTest&&(o.endQuery(o.ANY_SAMPLES_PASSED),u.occlusionQueryIndex++),!0===t.occlusionTest){const e=o.createQuery();o.beginQuery(o.ANY_SAMPLES_PASSED,e),u.occlusionQueries[u.occlusionQueryIndex]=e,u.occlusionQueryObjects[u.occlusionQueryIndex]=t}u.lastOcclusionObject=t}const v=this.bufferRenderer;t.isPoints?v.mode=o.POINTS:t.isLineSegments?v.mode=o.LINES:t.isLine?v.mode=o.LINE_STRIP:t.isLineLoop?v.mode=o.LINE_LOOP:!0===r.wireframe?(l.setLineWidth(r.wireframeLinewidth*this.renderer.getPixelRatio()),v.mode=o.LINES):v.mode=o.TRIANGLES;const{vertexCount:y,instanceCount:_}=c;let{firstVertex:x}=c;if(v.object=t,null!==f){x*=f.array.BYTES_PER_ELEMENT;const e=this.get(f);v.index=f.count,v.type=e.type}else v.index=0;const b=()=>{t.isBatchedMesh?null!==t._multiDrawInstances?(nn("THREE.WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?v.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):nn("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):_>1?v.renderInstances(x,y,_):v.render(x,y)};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const n=this.get(e.camera),r=e.camera.cameras,i=e.getBindingGroup("cameraIndex").bindings[0];if(void 0===n.indexesGPU||n.indexesGPU.length!==r.length){const e=new Uint32Array([0,0,0,0]),t=[];for(let n=0,i=r.length;n<i;n++){const r=o.createBuffer();e[0]=n,o.bindBuffer(o.UNIFORM_BUFFER,r),o.bufferData(o.UNIFORM_BUFFER,e,o.STATIC_DRAW),t.push(r)}n.indexesGPU=t}const s=this.get(i),a=this.renderer.getPixelRatio();for(let i=0,u=r.length;i<u;i++){const u=r[i];if(t.layers.test(u.layers)){const t=u.viewport,r=t.x*a,c=t.y*a,d=t.width*a,h=t.height*a;l.viewport(Math.floor(r),Math.floor(e.context.height-h-c),Math.floor(d),Math.floor(h)),l.bindBufferBase(o.UNIFORM_BUFFER,s.index,n.indexesGPU[i]),b()}}}else b()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,r,i,s){return this.textureUtils.copyTextureToBuffer(e,t,n,r,i,s)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new wU(e,t)}createProgram(e){const t=this.gl,{stage:n,code:r}=e,i="fragment"===n?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(i,r),t.compileShader(i),this.set(e,{shaderGPU:i})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,r=e.pipeline,{fragmentProgram:i,vertexProgram:s}=r,a=n.createProgram(),o=this.get(i).shaderGPU,l=this.get(s).shaderGPU;if(n.attachShader(a,o),n.attachShader(a,l),n.linkProgram(a),this.set(r,{programGPU:a,fragmentShader:o,vertexShader:l}),null!==t&&this.parallel){const i=new Promise(t=>{const i=this.parallel,s=()=>{n.getProgramParameter(a,i.COMPLETION_STATUS_KHR)?(this._completeCompile(e,r),t()):requestAnimationFrame(s)};s()});return void t.push(i)}this._completeCompile(e,r)}_handleSource(e,t){const n=e.split("\n"),r=[],i=Math.max(t-6,0),s=Math.min(t+6,n.length);for(let e=i;e<s;e++){const i=e+1;r.push(`${i===t?">":" "} ${i}: ${n[e]}`)}return r.join("\n")}_getShaderErrors(e,t,n){const r=e.getShaderParameter(t,e.COMPILE_STATUS),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const r=parseInt(s[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+this._handleSource(e.getShaderSource(t),r)}return i}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const r=this.gl;r.getProgramInfoLog(e).trim();if(!1===r.getProgramParameter(e,r.LINK_STATUS))if("function"==typeof this.renderer.debug.onShaderError)this.renderer.debug.onShaderError(r,e,n,t);else{this._getShaderErrors(r,n,"vertex"),this._getShaderErrors(r,t,"fragment")}}}_completeCompile(e,t){const{state:n,gl:r}=this,i=this.get(t),{programGPU:s,fragmentShader:a,vertexShader:o}=i;!1===r.getProgramParameter(s,r.LINK_STATUS)&&this._logProgramError(s,a,o),n.useProgram(s);const l=e.getBindings();this._setupBindings(l,s),this.set(t,{programGPU:s})}createComputePipeline(e,t){const{state:n,gl:r}=this,i={stage:"fragment",code:"#version 300 es\nprecision highp float;\nvoid main() {}"};this.createProgram(i);const{computeProgram:s}=e,a=r.createProgram(),o=this.get(i).shaderGPU,l=this.get(s).shaderGPU,u=s.transforms,c=[],d=[];for(let e=0;e<u.length;e++){const t=u[e];c.push(t.varyingName),d.push(t.attributeNode)}r.attachShader(a,o),r.attachShader(a,l),r.transformFeedbackVaryings(a,c,r.SEPARATE_ATTRIBS),r.linkProgram(a),!1===r.getProgramParameter(a,r.LINK_STATUS)&&this._logProgramError(a,o,l),n.useProgram(a),this._setupBindings(t,a);const h=s.attributes,p=[],f=[];for(let e=0;e<h.length;e++){const t=h[e].node.attribute;p.push(t),this.has(t)||this.attributeUtils.createAttribute(t,r.ARRAY_BUFFER)}for(let e=0;e<d.length;e++){const t=d[e].attribute;this.has(t)||this.attributeUtils.createAttribute(t,r.ARRAY_BUFFER);const n=this.get(t);f.push(n)}this.set(e,{programGPU:a,transformBuffers:f,attributes:p})}createBindings(e,t){if(!1===this._knownBindings.has(t)){this._knownBindings.add(t);let e=0,n=0;for(const r of t){this.set(r,{textures:n,uniformBuffers:e});for(const t of r.bindings)t.isUniformBuffer&&e++,t.isSampledTexture&&n++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let r=n.uniformBuffers,i=n.textures;for(const n of e.bindings)if(n.isUniformsGroup||n.isUniformBuffer){const e=n.buffer,i=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,e,t.DYNAMIC_DRAW),this.set(n,{index:r++,bufferGPU:i})}else if(n.isSampledTexture){const{textureGPU:e,glTextureType:t}=this.get(n.texture);this.set(n,{index:i++,textureGPU:e,glTextureType:t})}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const n=this.get(e).bufferGPU,r=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,r,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(GU).filter(t=>GU[t]===e),n=this.extensions;for(let e=0;e<t.length;e++)if(n.has(t[e]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,r=null,i=0){this.textureUtils.copyTextureToTexture(e,t,n,r,i)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let r=null;if(null!==e.textures){const i=e.renderTarget,s=this.get(i),{samples:a,depthBuffer:o,stencilBuffer:l}=i,u=!0===i.isWebGLCubeRenderTarget,c=!0===i.isRenderTarget3D,d=!0===i.isRenderTargetArray,h=!0===i.isXRRenderTarget,p=!0===h&&!0===i.hasExternalTextures;let f=s.msaaFrameBuffer,m=s.depthRenderbuffer;const g=this.extensions.get("WEBGL_multisampled_render_to_texture"),v=this._useMultisampledRTT(i),y=XA(e);let _;if(u?(s.cubeFramebuffers||(s.cubeFramebuffers={}),_=s.cubeFramebuffers[y]):h&&!1===p?_=this._xrFramebuffer:(s.framebuffers||(s.framebuffers={}),_=s.framebuffers[y]),void 0===_){_=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,_);const r=e.textures;if(u){s.cubeFramebuffers[y]=_;const{textureGPU:e}=this.get(r[0]),n=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+n,e,0)}else{s.framebuffers[y]=_;for(let n=0;n<r.length;n++){const i=r[n],s=this.get(i);s.renderTarget=e.renderTarget,s.cacheKey=y;const o=t.COLOR_ATTACHMENT0+n;if(c||d){const e=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,o,s.textureGPU,0,e)}else v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,o,t.TEXTURE_2D,s.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,o,t.TEXTURE_2D,s.textureGPU,0)}n.drawBuffers(e,_)}if(i.isXRRenderTarget&&!0===i.autoAllocateDepthBuffer){const n=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(n,e,0,v),s.xrDepthRenderbuffer=n}else if(null!==e.depthTexture){const n=this.get(e.depthTexture),r=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;n.renderTarget=e.renderTarget,n.cacheKey=y,v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,r,t.TEXTURE_2D,n.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,r,t.TEXTURE_2D,n.textureGPU,0)}}else if(h&&p){n.bindFramebuffer(t.FRAMEBUFFER,_);const r=this.get(e.textures[0]);v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r.textureGPU,0);const o=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(!0===i.autoAllocateDepthBuffer){const e=s.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,o,t.RENDERBUFFER,e)}else{const n=this.get(e.depthTexture);v?g.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,o,t.TEXTURE_2D,n.textureGPU,0,a):t.framebufferTexture2D(t.FRAMEBUFFER,o,t.TEXTURE_2D,n.textureGPU,0)}}if(a>0&&!1===v){if(void 0===f){const r=[];f=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,f);const i=[],u=e.textures;for(let n=0;n<u.length;n++){if(i[n]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,i[n]),r.push(t.COLOR_ATTACHMENT0+n),o){const e=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;r.push(e)}const s=e.textures[n],u=this.get(s);t.renderbufferStorageMultisample(t.RENDERBUFFER,a,u.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+n,t.RENDERBUFFER,i[n])}if(s.msaaFrameBuffer=f,s.msaaRenderbuffers=i,void 0===m){m=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(m,e,a),s.depthRenderbuffer=m;const n=l?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;r.push(n)}s.invalidationArray=r}r=s.msaaFrameBuffer}else r=_}n.bindFramebuffer(t.FRAMEBUFFER,r)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){t+=":"+this.get(e[n]).id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();let r="",i=!0;t.bindVertexArray(n);for(let n=0;n<e.length;n++){const s=e[n],a=this.get(s);let o,l;r+=":"+a.id,t.bindBuffer(t.ARRAY_BUFFER,a.bufferGPU),t.enableVertexAttribArray(n),(s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute)&&(i=!1),!0===s.isInterleavedBufferAttribute?(o=s.data.stride*a.bytesPerElement,l=s.offset*a.bytesPerElement):(o=0,l=0),a.isInteger?t.vertexAttribIPointer(n,s.itemSize,a.type,o,l):t.vertexAttribPointer(n,s.itemSize,a.type,s.normalized,o,l),s.isInstancedBufferAttribute&&!s.isInterleavedBufferAttribute?t.vertexAttribDivisor(n,s.meshPerAttribute):s.isInterleavedBufferAttribute&&s.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(n,s.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),this.vaoCache[r]=n,{vaoGPU:n,staticVao:i}}_getTransformFeedback(e){let t="";for(let n=0;n<e.length;n++)t+=":"+e[n].id;let n=this.transformFeedbackCache[t];if(void 0!==n)return n;const{gl:r}=this;n=r.createTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,n);for(let t=0;t<e.length;t++){const n=e[t];r.bindBufferBase(r.TRANSFORM_FEEDBACK_BUFFER,t,n.transformBuffer)}return r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const r of e)for(const e of r.bindings){const r=this.get(e).index;if(e.isUniformsGroup||e.isUniformBuffer){const i=n.getUniformBlockIndex(t,e.name);n.uniformBlockBinding(t,i,r)}else if(e.isSampledTexture){const i=n.getUniformLocation(t,e.name);n.uniform1i(i,r)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const r of e)for(const e of r.bindings){const r=this.get(e),i=r.index;e.isUniformsGroup||e.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,i,r.bufferGPU):e.isSampledTexture&&n.bindTexture(r.glTextureType,r.textureGPU,t.TEXTURE0+i)}}_useMultisampledRTT(e){return e.samples>0&&!0===this.extensions.has("WEBGL_multisampled_render_to_texture")&&!1!==e.autoAllocateDepthBuffer}dispose(){const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const XU="point-list",$U="line-list",YU="line-strip",KU="triangle-list",QU="triangle-strip",ZU="never",JU="less",eD="equal",tD="less-equal",nD="greater",rD="not-equal",iD="greater-equal",sD="always",aD="store",oD="load",lD="clear",uD="ccw",cD="none",dD="front",hD="back",pD="uint16",fD="uint32",mD={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10uFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Stencil8:"stencil8",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},gD="clamp-to-edge",vD="repeat",yD="mirror-repeat",_D="linear",xD="nearest",bD="zero",SD="one",TD="src",wD="one-minus-src",MD="src-alpha",ED="one-minus-src-alpha",AD="dst",CD="one-minus-dst",RD="dst-alpha",ND="one-minus-dst-alpha",PD="src-alpha-saturated",ID="constant",LD="one-minus-constant",UD="add",DD="subtract",FD="reverse-subtract",BD="min",OD="max",kD=0,zD=15,VD="keep",GD="zero",HD="replace",WD="invert",jD="increment-clamp",qD="decrement-clamp",XD="increment-wrap",$D="decrement-wrap",YD="storage",KD="read-only-storage",QD="write-only",ZD="read-only",JD="read-write",eF="float",tF="unfilterable-float",nF="depth",rF="sint",iF="uint",sF="2d",aF="3d",oF="2d",lF="2d-array",uF="cube",cF="3d",dF="all",hF="vertex",pF="instance",fF={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class mF extends oU{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.isSampler=!0}}class gF extends mF{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){this.texture=this.textureNode.value}}class vF extends lU{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let yF=0;class _F extends vF{constructor(e,t){super("StorageBuffer_"+yF++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:Gm.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class xF extends bA{constructor(e){super(),this.device=e;this.mipmapSampler=e.createSampler({minFilter:_D}),this.flipYSampler=e.createSampler({minFilter:xD}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:"\nstruct VarysStruct {\n\t@builtin( position ) Position: vec4<f32>,\n\t@location( 0 ) vTex : vec2<f32>\n};\n\n@vertex\nfn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {\n\n\tvar Varys : VarysStruct;\n\n\tvar pos = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( -1.0,  1.0 ),\n\t\tvec2<f32>(  1.0,  1.0 ),\n\t\tvec2<f32>( -1.0, -1.0 ),\n\t\tvec2<f32>(  1.0, -1.0 )\n\t);\n\n\tvar tex = array< vec2<f32>, 4 >(\n\t\tvec2<f32>( 0.0, 0.0 ),\n\t\tvec2<f32>( 1.0, 0.0 ),\n\t\tvec2<f32>( 0.0, 1.0 ),\n\t\tvec2<f32>( 1.0, 1.0 )\n\t);\n\n\tVarys.vTex = tex[ vertexIndex ];\n\tVarys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );\n\n\treturn Varys;\n\n}\n"}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vTex );\n\n}\n"}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:"\n@group( 0 ) @binding( 0 )\nvar imgSampler : sampler;\n\n@group( 0 ) @binding( 1 )\nvar img : texture_2d<f32>;\n\n@fragment\nfn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {\n\n\treturn textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );\n\n}\n"})}getTransferPipeline(e){let t=this.transferPipelines[e];return void 0===t&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:QU,stripIndexFormat:fD},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return void 0===t&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:QU,stripIndexFormat:fD},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,n=0){const r=t.format,{width:i,height:s}=t.size,a=this.getTransferPipeline(r),o=this.getFlipYPipeline(r),l=this.device.createTexture({size:{width:i,height:s,depthOrArrayLayers:1},format:r,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),u=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:oF,baseArrayLayer:n}),c=l.createView({baseMipLevel:0,mipLevelCount:1,dimension:oF,baseArrayLayer:0}),d=this.device.createCommandEncoder({}),h=(e,t,n)=>{const r=e.getBindGroupLayout(0),i=this.device.createBindGroup({layout:r,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:t}]}),s=d.beginRenderPass({colorAttachments:[{view:n,loadOp:lD,storeOp:aD,clearValue:[0,0,0,0]}]});s.setPipeline(e),s.setBindGroup(0,i),s.draw(4,1,0,0),s.end()};h(a,u,c),h(o,c,u),this.device.queue.submit([d.finish()]),l.destroy()}generateMipmaps(e,t,n=0){const r=this.get(e);void 0===r.useCount&&(r.useCount=0,r.layers=[]);const i=r.layers[n]||this._mipmapCreateBundles(e,t,n),s=this.device.createCommandEncoder({});this._mipmapRunBundles(s,i),this.device.queue.submit([s.finish()]),0!==r.useCount&&(r.layers[n]=i),r.useCount++}_mipmapCreateBundles(e,t,n){const r=this.getTransferPipeline(t.format),i=r.getBindGroupLayout(0);let s=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:oF,baseArrayLayer:n});const a=[];for(let o=1;o<t.mipLevelCount;o++){const l=this.device.createBindGroup({layout:i,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:s}]}),u=e.createView({baseMipLevel:o,mipLevelCount:1,dimension:oF,baseArrayLayer:n}),c={colorAttachments:[{view:u,loadOp:lD,storeOp:aD,clearValue:[0,0,0,0]}]},d=this.device.createRenderBundleEncoder({colorFormats:[t.format]});d.setPipeline(r),d.setBindGroup(0,l),d.draw(4,1,0,0),a.push({renderBundles:[d.finish()],passDescriptor:c}),s=u}return a}_mipmapRunBundles(e,t){const n=t.length;for(let r=0;r<n;r++){const n=t[r],i=e.beginRenderPass(n.passDescriptor);i.executeBundles(n.renderBundles),i.end()}}}const bF={[St]:"never",[Tt]:"less",[wt]:"equal",[Mt]:"less-equal",[Et]:"greater",[Ct]:"greater-equal",[Rt]:"always",[At]:"not-equal"},SF=[0,1,3,2,4,5];class TF{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new Oa,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,n=t.device,r=t.get(e),i={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};i.magFilter===_D&&i.minFilter===_D&&i.mipmapFilter===_D&&(i.maxAnisotropy=e.anisotropy),e.isDepthTexture&&null!==e.compareFunction&&(i.compare=bF[e.compareFunction]),r.sampler=n.createSampler(i)}createDefaultTexture(e){let t;const n=wF(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){const n=this.backend,r=n.get(e);if(r.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");void 0===t.needsMipmaps&&(t.needsMipmaps=!1),void 0===t.levels&&(t.levels=1),void 0===t.depth&&(t.depth=1);const{width:i,height:s,depth:a,levels:o}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const l=this._getDimension(e),u=e.internalFormat||t.format||wF(e,n.device);r.format=u;const{samples:c,primarySamples:d,isMSAA:h}=n.utils.getTextureSampleData(e);let p=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;!0===e.isStorageTexture&&(p|=GPUTextureUsage.STORAGE_BINDING),!0!==e.isCompressedTexture&&!0!==e.isCompressedArrayTexture&&(p|=GPUTextureUsage.RENDER_ATTACHMENT);const f={label:e.name,size:{width:i,height:s,depthOrArrayLayers:a},mipLevelCount:o,sampleCount:d,dimension:l,format:u,usage:p};if(e.isVideoTexture){const t=e.source.data,n=new VideoFrame(t);f.size.width=n.displayWidth,f.size.height=n.displayHeight,n.close(),r.externalTexture=t}else{if(void 0===u)return void this.createDefaultTexture(e);r.texture=n.device.createTexture(f)}if(h){const e=Object.assign({},f);e.label=e.label+"-msaa",e.sampleCount=c,r.msaaTexture=n.device.createTexture(e)}r.initialized=!0,r.textureDescriptorGPU=f}destroyTexture(e){const t=this.backend,n=t.get(e);void 0!==n.texture&&n.texture.destroy(),void 0!==n.msaaTexture&&n.msaaTexture.destroy(),t.delete(e)}destroySampler(e){delete this.backend.get(e).sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let e=0;e<6;e++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,e);else{const n=e.image.depth||1;for(let e=0;e<n;e++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,e)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:n}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,t=!1){const n=this.backend,{width:r,height:i}=n.getDrawingBufferSize(),s=this.depthTexture,a=n.get(s).texture;let o,l;if(t?(o=Te,l=me):e&&(o=Se,l=ce),void 0!==a){if(s.image.width===r&&s.image.height===i&&s.format===o&&s.type===l)return a;this.destroyTexture(s)}return s.name="depthBuffer",s.format=o,s.type=l,s.image.width=r,s.image.height=i,this.createTexture(s,{width:r,height:i}),n.get(s).texture}updateTexture(e,t){const n=this.backend.get(e),{textureDescriptorGPU:r}=n;if(!e.isRenderTargetTexture&&void 0!==r){if(e.isDataTexture)this._copyBufferToTexture(t.image,n.texture,r,0,e.flipY);else if(e.isDataArrayTexture||e.isData3DTexture)for(let i=0;i<t.image.depth;i++)this._copyBufferToTexture(t.image,n.texture,r,i,e.flipY,i);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,r);else if(e.isCubeTexture)this._copyCubeMapToTexture(t.images,n.texture,r,e.flipY);else if(e.isVideoTexture){const t=e.source.data;n.externalTexture=t}else this._copyImageToTexture(t.image,n.texture,r,0,e.flipY);n.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,n,r,i,s){const a=this.backend.device,o=this.backend.get(e),l=o.texture,u=o.textureDescriptorGPU.format,c=this._getBytesPerTexel(u);let d=r*c;d=256*Math.ceil(d/256);const h=a.createBuffer({size:r*i*c,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),p=a.createCommandEncoder();p.copyTextureToBuffer({texture:l,origin:{x:t,y:n,z:s}},{buffer:h,bytesPerRow:d},{width:r,height:i});const f=this._getTypedArrayType(u);a.queue.submit([p.finish()]),await h.mapAsync(GPUMapMode.READ);return new f(h.getMappedRange())}_isEnvironmentTexture(e){const t=e.mapping;return t===X||t===$||t===j||t===q}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(void 0===t){const n=new gn;n.minFilter=J,n.magFilter=J,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(void 0===t){const n=new Gi;n.minFilter=J,n.magFilter=J,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(null===e){const t={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),t)}return e}_copyCubeMapToTexture(e,t,n,r){for(let i=0;i<6;i++){const s=e[i],a=!0===r?SF[i]:i;s.isDataTexture?this._copyBufferToTexture(s.image,t,n,a,r):this._copyImageToTexture(s,t,n,a,r)}}_copyImageToTexture(e,t,n,r,i){this.backend.device.queue.copyExternalImageToTexture({source:e,flipY:i},{texture:t,mipLevel:0,origin:{x:0,y:0,z:r}},{width:e.width,height:e.height,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return null===e&&(this._passUtils=e=new xF(this.backend.device)),e}_generateMipmaps(e,t,n=0){this._getPassUtils().generateMipmaps(e,t,n)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,r,i,s=0){const a=this.backend.device,o=e.data,l=this._getBytesPerTexel(n.format),u=e.width*l;a.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:r}},o,{offset:e.width*e.height*l*s,bytesPerRow:u},{width:e.width,height:e.height,depthOrArrayLayers:1}),!0===i&&this._flipY(t,n,r)}_copyCompressedBufferToTexture(e,t,n){const r=this.backend.device,i=this._getBlockData(n.format),s=n.size.depthOrArrayLayers>1;for(let a=0;a<e.length;a++){const o=e[a],l=o.width,u=o.height,c=s?n.size.depthOrArrayLayers:1,d=Math.ceil(l/i.width)*i.byteLength,h=d*Math.ceil(u/i.height);for(let e=0;e<c;e++)r.queue.writeTexture({texture:t,mipLevel:a,origin:{x:0,y:0,z:e}},o.data,{offset:e*h,bytesPerRow:d,rowsPerImage:Math.ceil(u/i.height)},{width:Math.ceil(l/i.width)*i.width,height:Math.ceil(u/i.height)*i.height,depthOrArrayLayers:1})}}_getBlockData(e){return e===mD.BC1RGBAUnorm||e===mD.BC1RGBAUnormSRGB?{byteLength:8,width:4,height:4}:e===mD.BC2RGBAUnorm||e===mD.BC2RGBAUnormSRGB||e===mD.BC3RGBAUnorm||e===mD.BC3RGBAUnormSRGB?{byteLength:16,width:4,height:4}:e===mD.BC4RUnorm||e===mD.BC4RSNorm?{byteLength:8,width:4,height:4}:e===mD.BC5RGUnorm||e===mD.BC5RGSnorm||e===mD.BC6HRGBUFloat||e===mD.BC6HRGBFloat||e===mD.BC7RGBAUnorm||e===mD.BC7RGBAUnormSRGB?{byteLength:16,width:4,height:4}:e===mD.ETC2RGB8Unorm||e===mD.ETC2RGB8UnormSRGB||e===mD.ETC2RGB8A1Unorm||e===mD.ETC2RGB8A1UnormSRGB?{byteLength:8,width:4,height:4}:e===mD.ETC2RGBA8Unorm||e===mD.ETC2RGBA8UnormSRGB?{byteLength:16,width:4,height:4}:e===mD.EACR11Unorm||e===mD.EACR11Snorm?{byteLength:8,width:4,height:4}:e===mD.EACRG11Unorm||e===mD.EACRG11Snorm||e===mD.ASTC4x4Unorm||e===mD.ASTC4x4UnormSRGB?{byteLength:16,width:4,height:4}:e===mD.ASTC5x4Unorm||e===mD.ASTC5x4UnormSRGB?{byteLength:16,width:5,height:4}:e===mD.ASTC5x5Unorm||e===mD.ASTC5x5UnormSRGB?{byteLength:16,width:5,height:5}:e===mD.ASTC6x5Unorm||e===mD.ASTC6x5UnormSRGB?{byteLength:16,width:6,height:5}:e===mD.ASTC6x6Unorm||e===mD.ASTC6x6UnormSRGB?{byteLength:16,width:6,height:6}:e===mD.ASTC8x5Unorm||e===mD.ASTC8x5UnormSRGB?{byteLength:16,width:8,height:5}:e===mD.ASTC8x6Unorm||e===mD.ASTC8x6UnormSRGB?{byteLength:16,width:8,height:6}:e===mD.ASTC8x8Unorm||e===mD.ASTC8x8UnormSRGB?{byteLength:16,width:8,height:8}:e===mD.ASTC10x5Unorm||e===mD.ASTC10x5UnormSRGB?{byteLength:16,width:10,height:5}:e===mD.ASTC10x6Unorm||e===mD.ASTC10x6UnormSRGB?{byteLength:16,width:10,height:6}:e===mD.ASTC10x8Unorm||e===mD.ASTC10x8UnormSRGB?{byteLength:16,width:10,height:8}:e===mD.ASTC10x10Unorm||e===mD.ASTC10x10UnormSRGB?{byteLength:16,width:10,height:10}:e===mD.ASTC12x10Unorm||e===mD.ASTC12x10UnormSRGB?{byteLength:16,width:12,height:10}:e===mD.ASTC12x12Unorm||e===mD.ASTC12x12UnormSRGB?{byteLength:16,width:12,height:12}:void 0}_convertAddressMode(e){let t=gD;return e===K?t=vD:e===Z&&(t=yD),t}_convertFilterMode(e){let t=_D;return e!==J&&e!==ee&&e!==te||(t=xD),t}_getBytesPerTexel(e){return e===mD.R8Unorm||e===mD.R8Snorm||e===mD.R8Uint||e===mD.R8Sint?1:e===mD.R16Uint||e===mD.R16Sint||e===mD.R16Float||e===mD.RG8Unorm||e===mD.RG8Snorm||e===mD.RG8Uint||e===mD.RG8Sint?2:e===mD.R32Uint||e===mD.R32Sint||e===mD.R32Float||e===mD.RG16Uint||e===mD.RG16Sint||e===mD.RG16Float||e===mD.RGBA8Unorm||e===mD.RGBA8UnormSRGB||e===mD.RGBA8Snorm||e===mD.RGBA8Uint||e===mD.RGBA8Sint||e===mD.BGRA8Unorm||e===mD.BGRA8UnormSRGB||e===mD.RGB9E5UFloat||e===mD.RGB10A2Unorm||e===mD.RG11B10UFloat||e===mD.Depth32Float||e===mD.Depth24Plus||e===mD.Depth24PlusStencil8||e===mD.Depth32FloatStencil8?4:e===mD.RG32Uint||e===mD.RG32Sint||e===mD.RG32Float||e===mD.RGBA16Uint||e===mD.RGBA16Sint||e===mD.RGBA16Float?8:e===mD.RGBA32Uint||e===mD.RGBA32Sint||e===mD.RGBA32Float?16:void 0}_getTypedArrayType(e){return e===mD.R8Uint?Uint8Array:e===mD.R8Sint?Int8Array:e===mD.R8Unorm?Uint8Array:e===mD.R8Snorm?Int8Array:e===mD.RG8Uint?Uint8Array:e===mD.RG8Sint?Int8Array:e===mD.RG8Unorm?Uint8Array:e===mD.RG8Snorm?Int8Array:e===mD.RGBA8Uint?Uint8Array:e===mD.RGBA8Sint?Int8Array:e===mD.RGBA8Unorm?Uint8Array:e===mD.RGBA8Snorm?Int8Array:e===mD.R16Uint?Uint16Array:e===mD.R16Sint?Int16Array:e===mD.RG16Uint?Uint16Array:e===mD.RG16Sint?Int16Array:e===mD.RGBA16Uint?Uint16Array:e===mD.RGBA16Sint?Int16Array:e===mD.R16Float||e===mD.RG16Float||e===mD.RGBA16Float?Uint16Array:e===mD.R32Uint?Uint32Array:e===mD.R32Sint?Int32Array:e===mD.R32Float?Float32Array:e===mD.RG32Uint?Uint32Array:e===mD.RG32Sint?Int32Array:e===mD.RG32Float?Float32Array:e===mD.RGBA32Uint?Uint32Array:e===mD.RGBA32Sint?Int32Array:e===mD.RGBA32Float?Float32Array:e===mD.BGRA8Unorm||e===mD.BGRA8UnormSRGB?Uint8Array:e===mD.RGB10A2Unorm||e===mD.RGB9E5UFloat||e===mD.RG11B10UFloat?Uint32Array:e===mD.Depth32Float?Float32Array:e===mD.Depth24Plus||e===mD.Depth24PlusStencil8?Uint32Array:e===mD.Depth32FloatStencil8?Float32Array:void 0}_getDimension(e){let t;return t=e.isData3DTexture?aF:sF,t}}function wF(e,t=null){const n=e.format,r=e.type,i=e.colorSpace;let s;if(!0===e.isCompressedTexture||!0===e.isCompressedArrayTexture)switch(n){case Ne:s=i===gt?mD.BC1RGBAUnormSRGB:mD.BC1RGBAUnorm;break;case Pe:s=i===gt?mD.BC2RGBAUnormSRGB:mD.BC2RGBAUnorm;break;case Ie:s=i===gt?mD.BC3RGBAUnormSRGB:mD.BC3RGBAUnorm;break;case Oe:s=i===gt?mD.ETC2RGB8UnormSRGB:mD.ETC2RGB8Unorm;break;case ke:s=i===gt?mD.ETC2RGBA8UnormSRGB:mD.ETC2RGBA8Unorm;break;case ze:s=i===gt?mD.ASTC4x4UnormSRGB:mD.ASTC4x4Unorm;break;case Ve:s=i===gt?mD.ASTC5x4UnormSRGB:mD.ASTC5x4Unorm;break;case Ge:s=i===gt?mD.ASTC5x5UnormSRGB:mD.ASTC5x5Unorm;break;case He:s=i===gt?mD.ASTC6x5UnormSRGB:mD.ASTC6x5Unorm;break;case We:s=i===gt?mD.ASTC6x6UnormSRGB:mD.ASTC6x6Unorm;break;case je:s=i===gt?mD.ASTC8x5UnormSRGB:mD.ASTC8x5Unorm;break;case qe:s=i===gt?mD.ASTC8x6UnormSRGB:mD.ASTC8x6Unorm;break;case Xe:s=i===gt?mD.ASTC8x8UnormSRGB:mD.ASTC8x8Unorm;break;case $e:s=i===gt?mD.ASTC10x5UnormSRGB:mD.ASTC10x5Unorm;break;case Ye:s=i===gt?mD.ASTC10x6UnormSRGB:mD.ASTC10x6Unorm;break;case Ke:s=i===gt?mD.ASTC10x8UnormSRGB:mD.ASTC10x8Unorm;break;case Qe:s=i===gt?mD.ASTC10x10UnormSRGB:mD.ASTC10x10Unorm;break;case Ze:s=i===gt?mD.ASTC12x10UnormSRGB:mD.ASTC12x10Unorm;break;case Je:s=i===gt?mD.ASTC12x12UnormSRGB:mD.ASTC12x12Unorm;break;case _e:s=i===gt?mD.RGBA8UnormSRGB:mD.RGBA8Unorm}else switch(n){case _e:switch(r){case ae:s=mD.RGBA8Snorm;break;case oe:s=mD.RGBA16Sint;break;case le:s=mD.RGBA16Uint;break;case ce:s=mD.RGBA32Uint;break;case ue:s=mD.RGBA32Sint;break;case se:s=i===gt?mD.RGBA8UnormSRGB:mD.RGBA8Unorm;break;case he:s=mD.RGBA16Float;break;case de:s=mD.RGBA32Float}break;case ye:if(r===ge)s=mD.RGB9E5UFloat;break;case we:switch(r){case ae:s=mD.R8Snorm;break;case oe:s=mD.R16Sint;break;case le:s=mD.R16Uint;break;case ce:s=mD.R32Uint;break;case ue:s=mD.R32Sint;break;case se:s=mD.R8Unorm;break;case he:s=mD.R16Float;break;case de:s=mD.R32Float}break;case Ee:switch(r){case ae:s=mD.RG8Snorm;break;case oe:s=mD.RG16Sint;break;case le:s=mD.RG16Uint;break;case ce:s=mD.RG32Uint;break;case ue:s=mD.RG32Sint;break;case se:s=mD.RG8Unorm;break;case he:s=mD.RG16Float;break;case de:s=mD.RG32Float}break;case Se:switch(r){case le:s=mD.Depth16Unorm;break;case ce:s=mD.Depth24Plus;break;case de:s=mD.Depth32Float}break;case Te:switch(r){case me:s=mD.Depth24PlusStencil8;break;case de:t&&t.features.has(fF.Depth32FloatStencil8),s=mD.Depth32FloatStencil8}break;case Me:switch(r){case ue:s=mD.R32Sint;break;case ce:s=mD.R32Uint}break;case Ae:switch(r){case ue:s=mD.RG32Sint;break;case ce:s=mD.RG32Uint}break;case Ce:switch(r){case ue:s=mD.RGBA32Sint;break;case ce:s=mD.RGBA32Uint}}return s}const MF=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,EF=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/gi,AF={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"};class CF extends EL{constructor(e){const{type:t,inputs:n,name:r,inputsCode:i,blockCode:s,outputType:a}=(e=>{const t=(e=e.trim()).match(MF);if(null!==t&&4===t.length){const n=t[2],r=[];let i=null;for(;null!==(i=EF.exec(n));)r.push({name:i[1],type:i[2]});const s=[];for(let e=0;e<r.length;e++){const{name:t,type:n}=r[e];let i=n;i.startsWith("ptr")?i="pointer":(i.startsWith("texture")&&(i=n.split("<")[0]),i=AF[i]),s.push(new fL(i,t))}const a=e.substring(t[0].length),o=t[3]||"void",l=void 0!==t[1]?t[1]:"";return{type:AF[o]||o,inputs:s,name:l,inputsCode:n,blockCode:a,outputType:o}}throw new Error("FunctionNode: Function is not a WGSL code.")})(e);super(t,n,r),this.inputsCode=i,this.blockCode=s,this.outputType=a}getCode(e=this.name){const t="void"!==this.outputType?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class RF extends ML{parseFunction(e){return new CF(e)}}const NF="undefined"!=typeof self?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},PF={[Gm.READ_ONLY]:"read",[Gm.WRITE_ONLY]:"write",[Gm.READ_WRITE]:"read_write"},IF={[K]:"repeat",[Q]:"clamp",[Z]:"mirror"},LF={vertex:NF?NF.VERTEX:1,fragment:NF?NF.FRAGMENT:2,compute:NF?NF.COMPUTE:4},UF={instance:!0,swizzleAssign:!1,storageBuffer:!0},DF={"^^":"tsl_xor"},FF={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},BF={},OF={tsl_xor:new nN("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new nN("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new nN("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new nN("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new nN("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new nN("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new nN("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new nN("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new nN("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new nN("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new nN("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new nN("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new nN("\nfn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {\n\n\tlet res = vec2f( iRes );\n\n\tlet uvScaled = coord * res;\n\tlet uvWrapping = ( ( uvScaled % res ) + res ) % res;\n\n\t// https://www.shadertoy.com/view/WtyXRy\n\n\tlet uv = uvWrapping - 0.5;\n\tlet iuv = floor( uv );\n\tlet f = fract( uv );\n\n\tlet rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );\n\tlet rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );\n\tlet rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );\n\tlet rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );\n\n\treturn mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );\n\n}\n")},kF={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};"undefined"!=typeof navigator&&/Windows/g.test(navigator.userAgent)&&(OF.pow_float=new nN("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),OF.pow_vec2=new nN("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[OF.pow_float]),OF.pow_vec3=new nN("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[OF.pow_float]),OF.pow_vec4=new nN("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[OF.pow_float]),kF.pow_float="tsl_pow_float",kF.pow_vec2="tsl_pow_vec2",kF.pow_vec3="tsl_pow_vec3",kF.pow_vec4="tsl_pow_vec4");let zF="";!0!==("undefined"!=typeof navigator&&/Firefox|Deno/g.test(navigator.userAgent))&&(zF+="diagnostic( off, derivative_uniformity );\n");class VF extends hL{constructor(e,t){super(e,t,new RF),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return!0===e.isVideoTexture&&e.colorSpace!==mt}_generateTextureSample(e,t,n,r,i=this.shaderStage){return"fragment"===i?r?`textureSample( ${t}, ${t}_sampler, ${n}, ${r} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n):this.generateTextureLod(e,t,n,r,"0")}_generateVideoSample(e,t,n=this.shaderStage){if("fragment"===n)return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${t}.x, 1.0 - ${t}.y ) )`}_generateTextureSampleLevel(e,t,n,r,i,s=this.shaderStage){return"fragment"!==s&&"compute"!==s||!1!==this.isUnfilterable(e)?this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,r):this.generateTextureLod(e,t,n,i,r):`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${r} )`}generateWrapFunction(e){const t=`tsl_coord_${IF[e.wrapS]}S_${IF[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let n=BF[t];if(void 0===n){const r=[],i=e.isData3DTexture?"vec3f":"vec2f";let s=`fn ${t}( coord : ${i} ) -> ${i} {\n\n\treturn ${i}(\n`;const a=(e,t)=>{e===K?(r.push(OF.repeatWrapping_float),s+=`\t\ttsl_repeatWrapping_float( coord.${t} )`):e===Q?(r.push(OF.clampWrapping_float),s+=`\t\ttsl_clampWrapping_float( coord.${t} )`):e===Z?(r.push(OF.mirrorWrapping_float),s+=`\t\ttsl_mirrorWrapping_float( coord.${t} )`):s+=`\t\tcoord.${t}`};a(e.wrapS,"x"),s+=",\n",a(e.wrapT,"y"),e.isData3DTexture&&(s+=",\n",a(e.wrapR,"z")),s+="\n\t);\n\n}\n",BF[t]=n=new nN(s,r)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const r=this.getDataFromNode(e,this.shaderStage,this.globalCache);void 0===r.dimensionsSnippet&&(r.dimensionsSnippet={});let i=r.dimensionsSnippet[n];if(void 0===r.dimensionsSnippet[n]){let s,a;const{primarySamples:o}=this.renderer.backend.utils.getTextureSampleData(e),l=o>1;a=e.isData3DTexture?"vec3<u32>":"vec2<u32>",s=l||e.isVideoTexture||e.isStorageTexture?t:`${t}${n?`, u32( ${n} )`:""}`,i=new X_(new Px(`textureDimensions( ${s} )`,a)),r.dimensionsSnippet[n]=i,(e.isDataArrayTexture||e.isData3DTexture)&&(r.arrayLayerCount=new X_(new Px(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(r.cubeFaceCount=new X_(new Px("6u","u32")))}return i.build(this)}generateFilteredTexture(e,t,n,r="0u"){this._include("biquadraticTexture");return`tsl_biquadraticTexture( ${t}, ${this.generateWrapFunction(e)}( ${n} ), ${this.generateTextureDimension(e,t,r)}, u32( ${r} ) )`}generateTextureLod(e,t,n,r,i="0u"){const s=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,i),o=e.isData3DTexture?"vec3":"vec2",l=`${o}<u32>(${s}(${n}) * ${o}<f32>(${a}))`;return this.generateTextureLoad(e,t,l,r,i)}generateTextureLoad(e,t,n,r,i="0u"){return!0===e.isVideoTexture||!0===e.isStorageTexture?`textureLoad( ${t}, ${n} )`:r?`textureLoad( ${t}, ${n}, ${r}, u32( ${i} ) )`:`textureLoad( ${t}, ${n}, u32( ${i} ) )`}generateTextureStore(e,t,n,r){return`textureStore( ${t}, ${n}, ${r} )`}isSampleCompare(e){return!0===e.isDepthTexture&&null!==e.compareFunction}isUnfilterable(e){return"float"!==this.getComponentTypeFromTexture(e)||!this.isAvailable("float32Filterable")&&!0===e.isDataTexture&&e.type===de||!1===this.isSampleCompare(e)&&e.minFilter===J&&e.magFilter===J||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,r,i=this.shaderStage){let s=null;return s=!0===e.isVideoTexture?this._generateVideoSample(t,n,i):this.isUnfilterable(e)?this.generateTextureLod(e,t,n,r,"0",i):this._generateTextureSample(e,t,n,r,i),s}generateTextureGrad(e,t,n,r,i,s=this.shaderStage){if("fragment"===s)return`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${r[0]}, ${r[1]} )`}generateTextureCompare(e,t,n,r,i,s=this.shaderStage){if("fragment"===s)return`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${r} )`}generateTextureLevel(e,t,n,r,i,s=this.shaderStage){let a=null;return a=!0===e.isVideoTexture?this._generateVideoSample(t,n,s):this._generateTextureSampleLevel(e,t,n,r,i,s),a}generateTextureBias(e,t,n,r,i,s=this.shaderStage){if("fragment"===s)return`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${r} )`}getPropertyName(e,t=this.shaderStage){if(!0===e.isNodeVarying&&!0===e.needsInterpolation){if("vertex"===t)return`varyings.${e.name}`}else if(!0===e.isNodeUniform){const t=e.name,n=e.type;return"texture"===n||"cubeTexture"===n||"storageTexture"===n||"texture3D"===n?t:"buffer"===n||"storageBuffer"===n||"indirectStorageBuffer"===n?this.isCustomStruct(e)?t:t+".value":e.groupNode.name+"."+t}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=DF[e];return void 0!==t?(this._include(t),t):null}getNodeAccess(e,t){return"compute"!==t?Gm.READ_ONLY:e.access}getStorageAccess(e,t){return PF[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,r=null){const i=super.getUniformFromNode(e,t,n,r),s=this.getDataFromNode(e,n,this.globalCache);if(void 0===s.uniformGPU){let a;const o=e.groupNode,l=o.name,u=this.getBindGroupArray(l,n);if("texture"===t||"cubeTexture"===t||"storageTexture"===t||"texture3D"===t){let r=null;const s=this.getNodeAccess(e,n);if("texture"===t||"storageTexture"===t?r=new vU(i.name,i.node,o,s):"cubeTexture"===t?r=new yU(i.name,i.node,o,s):"texture3D"===t&&(r=new _U(i.name,i.node,o,s)),r.store=!0===e.isStorageTextureNode,r.setVisibility(LF[n]),"fragment"!==n&&"compute"!==n||!1!==this.isUnfilterable(e.value)||!1!==r.store)u.push(r),a=[r];else{const e=new gF(`${i.name}_sampler`,i.node,o);e.setVisibility(LF[n]),u.push(e,r),a=[e,r]}}else if("buffer"===t||"storageBuffer"===t||"indirectStorageBuffer"===t){const s=new("buffer"===t?dU:_F)(e,o);s.setVisibility(LF[n]),u.push(s),a=s,i.name=r||"NodeBuffer_"+i.id}else{const e=this.uniformGroups[n]||(this.uniformGroups[n]={});let r=e[l];void 0===r&&(r=new fU(l,o),r.setVisibility(LF[n]),e[l]=r,u.push(r)),a=this.getNodeUniform(i,t),r.addUniform(a)}s.uniformGPU=a}return i}getBuiltin(e,t,n,r=this.shaderStage){const i=this.builtins[r]||(this.builtins[r]=new Map);return!1===i.has(e)&&i.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return void 0!==this.builtins[t]&&this.builtins[t].has(e)}getVertexIndex(){return"vertex"===this.shaderStage?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),r=[];for(const e of t.inputs)r.push(e.name+" : "+this.getType(e.type));let i=`fn ${t.name}( ${r.join(", ")} ) -> ${this.getType(t.type)} {\n${n.vars}\n${n.code}\n`;return n.result&&(i+=`\treturn ${n.result};\n`),i+="\n}\n",i}getInstanceIndex(){return"vertex"===this.shaderStage?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(void 0!==n)for(const e of n)t.push(`enable ${e};`);return t.join("\n")}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(void 0!==n)for(const{name:e,property:r,type:i}of n.values())t.push(`@builtin( ${e} ) ${r} : ${i}`);return t.join(",\n\t")}getScopedArray(e,t,n,r){return!1===this.scopedArrays.has(e)&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:r}),e}getScopedArrays(e){if("compute"!==e)return;const t=[];for(const{name:e,scope:n,bufferType:r,bufferCount:i}of this.scopedArrays.values()){const s=this.getType(r);t.push(`var<${n}> ${e}: array< ${s}, ${i} >;`)}return t.join("\n")}getAttributes(e){const t=[];if("compute"===e&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),"vertex"===e||"compute"===e){const e=this.getBuiltins("attribute");e&&t.push(e);const n=this.getAttributesArray();for(let e=0,r=n.length;e<r;e++){const r=n[e],i=r.name,s=this.getType(r.type);t.push(`@location( ${e} ) ${i} : ${s}`)}}return t.join(",\n\t")}getStructMembers(e){const t=[];for(const n of e.members){const r=e.output?"@location( "+n.index+" ) ":"";let i=this.getType(n.type);n.atomic&&(i="atomic< "+i+" >"),t.push(`\t${r+n.name} : ${i}`)}return e.output&&t.push(`\t${this.getBuiltins("output")}`),t.join(",\n")}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const e=[];for(const t of n){let n=`struct ${t.name} {\n`;n+=this.getStructMembers(t),n+="\n};",e.push(n)}t="\n"+e.join("\n\n")+"\n"}return t}getVar(e,t,n=null){let r=`var ${t} : `;return r+=null!==n?this.generateArrayDeclaration(e,n):this.getType(e),r}getVars(e){const t=[],n=this.vars[e];if(void 0!==n)for(const e of n)t.push(`\t${this.getVar(e.type,e.name,e.count)};`);return`\n${t.join("\n")}\n`}getVaryings(e){const t=[];if("vertex"===e&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),"vertex"===e||"fragment"===e){const n=this.varyings,r=this.vars[e];for(let i=0;i<n.length;i++){const s=n[i];if(s.needsInterpolation){let e=`@location( ${i} )`;/^(int|uint|ivec|uvec)/.test(s.type)&&(e+=" @interpolate( flat )"),t.push(`${e} ${s.name} : ${this.getType(s.type)}`)}else"vertex"===e&&!1===r.includes(s)&&r.push(s)}}const n=this.getBuiltins(e);n&&t.push(n);const r=t.join(",\n\t");return"vertex"===e?this._getWGSLStruct("VaryingsStruct","\t"+r):r}isCustomStruct(e){return e.value.isStorageBufferAttribute&&null!==e.node.structTypeNode}getUniforms(e){const t=this.uniforms[e],n=[],r=[],i=[],s={};for(const i of t){const t=i.groupNode.name,a=this.bindingsIndexes[t];if("texture"===i.type||"cubeTexture"===i.type||"storageTexture"===i.type||"texture3D"===i.type){const t=i.node.value;let r;"fragment"!==e&&"compute"!==e||!1!==this.isUnfilterable(t)||!0===i.node.isStorageTextureNode||(this.isSampleCompare(t)?n.push(`@binding( ${a.binding++} ) @group( ${a.group} ) var ${i.name}_sampler : sampler_comparison;`):n.push(`@binding( ${a.binding++} ) @group( ${a.group} ) var ${i.name}_sampler : sampler;`));let s="";const{primarySamples:o}=this.renderer.backend.utils.getTextureSampleData(t);if(o>1&&(s="_multisampled"),!0===t.isCubeTexture)r="texture_cube<f32>";else if(!0===t.isDataArrayTexture||!0===t.isCompressedArrayTexture)r="texture_2d_array<f32>";else if(!0===t.isDepthTexture)r=`texture_depth${s}_2d`;else if(!0===t.isVideoTexture)r="texture_external";else if(!0===t.isData3DTexture)r="texture_3d<f32>";else if(!0===i.node.isStorageTextureNode){r=`texture_storage_2d<${wF(t)}, ${this.getStorageAccess(i.node,e)}>`}else{r=`texture${s}_2d<${this.getComponentTypeFromTexture(t).charAt(0)}32>`}n.push(`@binding( ${a.binding++} ) @group( ${a.group} ) var ${i.name} : ${r};`)}else if("buffer"===i.type||"storageBuffer"===i.type||"indirectStorageBuffer"===i.type){const t=i.node,n=this.getType(t.getNodeType(this)),s=t.bufferCount,o=s>0&&"buffer"===i.type?", "+s:"",l=t.isStorageBufferNode?`storage, ${this.getStorageAccess(t,e)}`:"uniform";if(this.isCustomStruct(i))r.push(`@binding( ${a.binding++} ) @group( ${a.group} ) var<${l}> ${i.name} : ${n};`);else{const e=`\tvalue : array< ${t.isAtomic?`atomic<${n}>`:`${n}`}${o} >`;r.push(this._getWGSLStructBinding(i.name,e,l,a.binding++,a.group))}}else{const e=this.getType(this.getVectorType(i.type)),t=i.groupNode.name;(s[t]||(s[t]={index:a.binding++,id:a.group,snippets:[]})).snippets.push(`\t${i.name} : ${e}`)}}for(const e in s){const t=s[e];i.push(this._getWGSLStructBinding(e,t.snippets.join(",\n"),"uniform",t.index,t.id))}let a=n.join("\n");return a+=r.join("\n"),a+=i.join("\n"),a}buildCode(){const e=null!==this.material?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let r="// code\n\n";r+=this.flowCode[t];const i=this.flowNodes[t],s=i[i.length-1],a=s.outputNode,o=void 0!==a&&!0===a.isOutputStructNode;for(const e of i){const i=this.getFlowData(e),l=e.name;if(l&&(r.length>0&&(r+="\n"),r+=`\t// flow -> ${l}\n`),r+=`${i.code}\n\t`,e===s&&"compute"!==t)if(r+="// result\n\n\t","vertex"===t)r+=`varyings.Vertex = ${i.result};`;else if("fragment"===t)if(o)n.returnType=a.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",r+=`return ${i.result};`;else{let e="\t@location(0) color: vec4<f32>";const t=this.getBuiltins("output");t&&(e+=",\n\t"+t),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",e),n.structs+="\nvar<private> output : OutputStruct;",r+=`output.color = ${i.result};\n\n\treturn output;`}}n.flow=r}this.shaderStage=null,null!==this.material?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,t=null){let n;return null!==t&&(n=this._getWGSLMethod(e+"_"+t)),void 0===n&&(n=this._getWGSLMethod(e)),n||e}getType(e){return FF[e]||e}isAvailable(e){let t=UF[e];return void 0===t&&("float32Filterable"===e?t=this.renderer.hasFeature("float32-filterable"):"clipDistance"===e&&(t=this.renderer.hasFeature("clip-distances")),UF[e]=t),t}_getWGSLMethod(e){return void 0!==OF[e]&&this._include(e),kF[e]}_include(e){const t=OF[e];return t.build(this),null!==this.currentFunctionNode&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}\n// directives\n${e.directives}\n\n// structs\n${e.structs}\n\n// uniforms\n${e.uniforms}\n\n// varyings\n${e.varyings}\nvar<private> varyings : VaryingsStruct;\n\n// codes\n${e.codes}\n\n@vertex\nfn main( ${e.attributes} ) -> VaryingsStruct {\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n\treturn varyings;\n\n}\n`}_getWGSLFragmentCode(e){return`${this.getSignature()}\n// global\n${zF}\n\n// structs\n${e.structs}\n\n// uniforms\n${e.uniforms}\n\n// codes\n${e.codes}\n\n@fragment\nfn main( ${e.varyings} ) -> ${e.returnType} {\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n}\n`}_getWGSLComputeCode(e,t){return`${this.getSignature()}\n// directives\n${e.directives}\n\n// system\nvar<private> instanceIndex : u32;\n\n// locals\n${e.scopedArrays}\n\n// structs\n${e.structs}\n\n// uniforms\n${e.uniforms}\n\n// codes\n${e.codes}\n\n@compute @workgroup_size( ${t} )\nfn main( ${e.attributes} ) {\n\n\t// system\n\tinstanceIndex = globalId.x + globalId.y * numWorkgroups.x * u32(${t}) + globalId.z * numWorkgroups.x * numWorkgroups.y * u32(${t});\n\n\t// vars\n\t${e.vars}\n\n\t// flow\n\t${e.flow}\n\n}\n`}_getWGSLStruct(e,t){return`\nstruct ${e} {\n${t}\n};`}_getWGSLStructBinding(e,t,n,r=0,i=0){const s=e+"Struct";return`${this._getWGSLStruct(s,t)}\n@binding( ${r} ) @group( ${i} )\nvar<${n}> ${e} : ${s};`}}class GF{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return null!==e.depthTexture?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=mD.Depth24PlusStencil8:e.depth&&(t=mD.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const e=this.backend.renderer,n=e.getRenderTarget();t=n?n.samples:e.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&null!==e.renderTarget&&!0!==e.isDepthTexture&&!0!==e.isFramebufferTexture;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return t=null!==e.textures?this.getTextureFormatGPU(e.textures[0]):this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return null!==e.textures?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){return e.isPoints?XU:e.isLineSegments||e.isMesh&&!0===t.wireframe?$U:e.isLine?YU:e.isMesh?KU:void 0}getSampleCount(e){let t=1;return e>1&&(t=Math.pow(2,Math.floor(Math.log2(e))),2===t&&(t=4)),t}getSampleCountRenderContext(e){return null!==e.textures?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(void 0===e)return navigator.gpu.getPreferredCanvasFormat();if(e===se)return mD.BGRA8Unorm;if(e===he)return mD.RGBA16Float;throw new Error("Unsupported outputType")}}const HF=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),WF=new Map([[ai,["float16"]]]),jF=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class qF{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),r=this.backend,i=r.get(n);let s=i.buffer;if(void 0===s){const a=r.device;let o=n.array;if(!1===e.normalized)if(o.constructor===Int16Array)o=new Int32Array(o);else if(o.constructor===Uint16Array&&(o=new Uint32Array(o),t&GPUBufferUsage.INDEX))for(let e=0;e<o.length;e++)65535===o[e]&&(o[e]=4294967295);if(n.array=o,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&3===n.itemSize){o=new o.constructor(4*n.count);for(let e=0;e<n.count;e++)o.set(n.array.subarray(3*e,3*e+3),4*e);n.itemSize=4,n.array=o,i._force3to4BytesAlignment=!0}const l=o.byteLength+(4-o.byteLength%4)%4;s=a.createBuffer({label:n.name,size:l,usage:t,mappedAtCreation:!0}),new o.constructor(s.getMappedRange()).set(o),s.unmap(),i.buffer=s}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,r=n.device,i=n.get(t),s=n.get(t).buffer;let a=t.array;if(!0===i._force3to4BytesAlignment){a=new a.constructor(4*t.count);for(let e=0;e<t.count;e++)a.set(t.array.subarray(3*e,3*e+3),4*e);t.array=a}const o=this._isTypedArray(a),l=t.updateRanges;if(0===l.length)r.queue.writeBuffer(s,0,a,0);else{const e=o?1:a.BYTES_PER_ELEMENT;for(let t=0,n=l.length;t<n;t++){const n=l[t];let o,u;if(!0===i._force3to4BytesAlignment){o=4*Math.floor(n.start/3)*e,u=4*Math.ceil(n.count/3)*e}else o=n.start*e,u=n.count*e;r.queue.writeBuffer(s,0,a,o,u)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let e=0;e<t.length;e++){const r=t[e],i=r.array.BYTES_PER_ELEMENT,s=this._getBufferAttribute(r);let a=n.get(s);if(void 0===a){let e,t;!0===r.isInterleavedBufferAttribute?(e=r.data.stride*i,t=r.data.isInstancedInterleavedBuffer?pF:hF):(e=r.itemSize*i,t=r.isInstancedBufferAttribute?pF:hF),!1!==r.normalized||r.array.constructor!==Int16Array&&r.array.constructor!==Uint16Array||(e=4),a={arrayStride:e,attributes:[],stepMode:t},n.set(s,a)}const o=this._getVertexFormat(r),l=!0===r.isInterleavedBufferAttribute?r.offset*i:0;a.attributes.push({shaderLocation:e,offset:l,format:o})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,r=t.get(this._getBufferAttribute(e)).buffer,i=r.size,s=n.createBuffer({label:`${e.name}_readback`,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),a=n.createCommandEncoder({label:`readback_encoder_${e.name}`});a.copyBufferToBuffer(r,0,s,0,i);const o=a.finish();n.queue.submit([o]),await s.mapAsync(GPUMapMode.READ);const l=s.getMappedRange(),u=new e.array.constructor(l.slice(0));return s.unmap(),u.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,r=e.array.constructor,i=e.constructor;let s;if(1===t)s=jF.get(r);else{const e=(WF.get(i)||HF.get(r))[n?1:0];if(e){const n=r.BYTES_PER_ELEMENT*t,i=4*Math.floor((n+3)/4)/r.BYTES_PER_ELEMENT;if(i%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");s=`${e}x${i}`}}return s}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class XF{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,n=t.device,r=[];let i=0;for(const n of e.bindings){const e={binding:i++,visibility:n.visibility};if(n.isUniformBuffer||n.isStorageBuffer){const t={};n.isStorageBuffer&&(4&n.visibility&&(n.access===Gm.READ_WRITE||n.access===Gm.WRITE_ONLY)?t.type=YD:t.type=KD),e.buffer=t}else if(n.isSampler){const t={};n.texture.isDepthTexture&&null!==n.texture.compareFunction&&(t.type="comparison"),e.sampler=t}else if(n.isSampledTexture&&n.texture.isVideoTexture)e.externalTexture={};else if(n.isSampledTexture&&n.store){const t={};t.format=this.backend.get(n.texture).texture.format;const r=n.access;t.access=r===Gm.READ_WRITE?JD:r===Gm.WRITE_ONLY?QD:ZD,e.storageTexture=t}else if(n.isSampledTexture){const r={},{primarySamples:i}=t.utils.getTextureSampleData(n.texture);if(i>1&&(r.multisampled=!0,n.texture.isDepthTexture||(r.sampleType=tF)),n.texture.isDepthTexture)r.sampleType=nF;else if(n.texture.isDataTexture||n.texture.isDataArrayTexture||n.texture.isData3DTexture){const e=n.texture.type;e===ue?r.sampleType=rF:e===ce?r.sampleType=iF:e===de&&(this.backend.hasFeature("float32-filterable")?r.sampleType=eF:r.sampleType=tF)}n.isSampledCubeTexture?r.viewDimension=uF:n.texture.isDataArrayTexture||n.texture.isCompressedArrayTexture?r.viewDimension=lF:n.isSampledTexture3D&&(r.viewDimension=cF),e.texture=r}r.push(e)}return n.createBindGroupLayout({entries:r})}createBindings(e,t,n,r=0){const{backend:i,bindGroupLayoutCache:s}=this,a=i.get(e);let o,l=s.get(e.bindingsReference);void 0===l&&(l=this.createBindingsLayout(e),s.set(e.bindingsReference,l)),n>0&&(void 0===a.groups&&(a.groups=[],a.versions=[]),a.versions[n]===r&&(o=a.groups[n])),void 0===o&&(o=this.createBindGroup(e,l),n>0&&(a.groups[n]=o,a.versions[n]=r)),a.group=o,a.layout=l}updateBinding(e){const t=this.backend,n=t.device,r=e.buffer,i=t.get(e).buffer;n.queue.writeBuffer(i,0,r,0)}createBindGroupIndex(e,t){const n=this.backend.device,r=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,i=e[0],s=n.createBuffer({label:"bindingCameraIndex_"+i,size:16,usage:r});n.queue.writeBuffer(s,0,e,0);const a=[{binding:0,resource:{buffer:s}}];return n.createBindGroup({label:"bindGroupCameraIndex_"+i,layout:t,entries:a})}createBindGroup(e,t){const n=this.backend,r=n.device;let i=0;const s=[];for(const t of e.bindings){if(t.isUniformBuffer){const e=n.get(t);if(void 0===e.buffer){const n=t.byteLength,i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,s=r.createBuffer({label:"bindingBuffer_"+t.name,size:n,usage:i});e.buffer=s}s.push({binding:i,resource:{buffer:e.buffer}})}else if(t.isStorageBuffer){const e=n.get(t);if(void 0===e.buffer){const r=t.attribute;e.buffer=n.get(r).buffer}s.push({binding:i,resource:{buffer:e.buffer}})}else if(t.isSampler){const e=n.get(t.texture);s.push({binding:i,resource:e.sampler})}else if(t.isSampledTexture){const e=n.get(t.texture);let a;if(void 0!==e.externalTexture)a=r.importExternalTexture({source:e.externalTexture});else{const n=t.store?1:e.texture.mipLevelCount,r=`view-${e.texture.width}-${e.texture.height}-${n}`;if(a=e[r],void 0===a){const i=dF;let s;s=t.isSampledCubeTexture?uF:t.isSampledTexture3D?cF:t.texture.isDataArrayTexture||t.texture.isCompressedArrayTexture?lF:oF,a=e[r]=e.texture.createView({aspect:i,dimension:s,mipLevelCount:n})}}s.push({binding:i,resource:a})}i++}return r.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:s})}}class $F{constructor(e){this.backend=e}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:r,geometry:i,pipeline:s}=e,{vertexProgram:a,fragmentProgram:o}=s,l=this.backend,u=l.device,c=l.utils,d=l.get(s),h=[];for(const t of e.getBindings()){const e=l.get(t);h.push(e.layout)}const p=l.attributeUtils.createShaderVertexBuffers(e);let f;!0===r.transparent&&0!==r.blending&&(f=this._getBlending(r));let m={};!0===r.stencilWrite&&(m={compare:this._getStencilCompare(r),failOp:this._getStencilOperation(r.stencilFail),depthFailOp:this._getStencilOperation(r.stencilZFail),passOp:this._getStencilOperation(r.stencilZPass)});const g=this._getColorWriteMask(r),v=[];if(null!==e.context.textures){const t=e.context.textures;for(let e=0;e<t.length;e++){const n=c.getTextureFormatGPU(t[e]);v.push({format:n,blend:f,writeMask:g})}}else{const t=c.getCurrentColorFormat(e.context);v.push({format:t,blend:f,writeMask:g})}const y=l.get(a).module,_=l.get(o).module,x=this._getPrimitiveState(n,i,r),b=this._getDepthCompare(r),S=c.getCurrentDepthStencilFormat(e.context),T=this._getSampleCount(e.context),w={label:`renderPipeline_${r.name||r.type}_${r.id}`,vertex:Object.assign({},y,{buffers:p}),fragment:Object.assign({},_,{targets:v}),primitive:x,multisample:{count:T,alphaToCoverageEnabled:r.alphaToCoverage&&T>1},layout:u.createPipelineLayout({bindGroupLayouts:h})},M={},E=e.context.depth,A=e.context.stencil;if(!0!==E&&!0!==A||(!0===E&&(M.format=S,M.depthWriteEnabled=r.depthWrite,M.depthCompare=b),!0===A&&(M.stencilFront=m,M.stencilBack={},M.stencilReadMask=r.stencilFuncMask,M.stencilWriteMask=r.stencilWriteMask),!0===r.polygonOffset&&(M.depthBias=r.polygonOffsetUnits,M.depthBiasSlopeScale=r.polygonOffsetFactor,M.depthBiasClamp=0),w.depthStencil=M),null===t)d.pipeline=u.createRenderPipeline(w);else{const e=new Promise(e=>{u.createRenderPipelineAsync(w).then(t=>{d.pipeline=t,e()})});t.push(e)}}createBundleEncoder(e){const t=this.backend,{utils:n,device:r}=t,i=n.getCurrentDepthStencilFormat(e),s={label:"renderBundleEncoder",colorFormats:[n.getCurrentColorFormat(e)],depthStencilFormat:i,sampleCount:this._getSampleCount(e)};return r.createRenderBundleEncoder(s)}createComputePipeline(e,t){const n=this.backend,r=n.device,i=n.get(e.computeProgram).module,s=n.get(e),a=[];for(const e of t){const t=n.get(e);a.push(t.layout)}s.pipeline=r.createComputePipeline({compute:i,layout:r.createPipelineLayout({bindGroupLayouts:a})})}_getBlending(e){let t,n;const r=e.blending,i=e.blendSrc,s=e.blendDst,a=e.blendEquation;if(5===r){const r=null!==e.blendSrcAlpha?e.blendSrcAlpha:i,o=null!==e.blendDstAlpha?e.blendDstAlpha:s,l=null!==e.blendEquationAlpha?e.blendEquationAlpha:a;t={srcFactor:this._getBlendFactor(i),dstFactor:this._getBlendFactor(s),operation:this._getBlendOperation(a)},n={srcFactor:this._getBlendFactor(r),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(l)}}else{const i=(e,r,i,s)=>{t={srcFactor:e,dstFactor:r,operation:UD},n={srcFactor:i,dstFactor:s,operation:UD}};if(e.premultipliedAlpha)switch(r){case 1:i(SD,ED,SD,ED);break;case 2:i(SD,SD,SD,SD);break;case 3:i(bD,wD,bD,SD);break;case 4:i(bD,TD,bD,MD)}else switch(r){case 1:i(MD,ED,SD,ED);break;case 2:i(MD,SD,MD,SD);break;case 3:i(bD,wD,bD,SD);break;case 4:i(bD,TD,bD,TD)}}if(void 0!==t&&void 0!==n)return{color:t,alpha:n}}_getBlendFactor(e){let t;switch(e){case _:t=bD;break;case x:t=SD;break;case b:t=TD;break;case S:t=wD;break;case T:t=MD;break;case w:t=ED;break;case A:t=AD;break;case C:t=CD;break;case M:t=RD;break;case E:t=ND;break;case R:t=PD;break;case 211:t=ID;break;case 212:t=LD}return t}_getStencilCompare(e){let t;switch(e.stencilFunc){case 512:t=ZU;break;case bt:t=sD;break;case 513:t=JU;break;case 515:t=tD;break;case 514:t=eD;break;case 518:t=iD;break;case 516:t=nD;break;case 517:t=rD}return t}_getStencilOperation(e){let t;switch(e){case xt:t=VD;break;case 0:t=GD;break;case 7681:t=HD;break;case 5386:t=WD;break;case 7682:t=jD;break;case 7683:t=qD;break;case 34055:t=XD;break;case 34056:t=$D}return t}_getBlendOperation(e){let t;switch(e){case g:t=UD;break;case v:t=DD;break;case y:t=FD;break;case 103:t=BD;break;case 104:t=OD}return t}_getPrimitiveState(e,t,n){const r={},i=this.backend.utils;switch(r.topology=i.getPrimitiveTopology(e,n),null!==t.index&&!0===e.isLine&&!0!==e.isLineSegments&&(r.stripIndexFormat=t.index.array instanceof Uint16Array?pD:fD),n.side){case 0:r.frontFace=uD,r.cullMode=hD;break;case 1:r.frontFace=uD,r.cullMode=dD;break;case 2:r.frontFace=uD,r.cullMode=cD}return r}_getColorWriteMask(e){return!0===e.colorWrite?zD:kD}_getDepthCompare(e){let t;if(!1===e.depthTest)t=sD;else{switch(e.depthFunc){case 0:t=ZU;break;case 1:t=sD;break;case 2:t=JU;break;case 3:t=tD;break;case 4:t=eD;break;case 5:t=iD;break;case 6:t=nD;break;case 7:t=rD}}return t}}class YF extends WU{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const r=8*this.maxQueries;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return nn(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e.id,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||0===this.currentQueryIndex||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if("unmapped"!==this.resultBuffer.mapState)return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=8*t;this.currentQueryIndex=0,this.queryOffsets.clear();const r=this.device.createCommandEncoder();r.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),r.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const i=r.finish();if(this.device.queue.submit([i]),"unmapped"!==this.resultBuffer.mapState)return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue;const s=new BigUint64Array(this.resultBuffer.getMappedRange(0,n));let a=0;for(const[,t]of e){const e=s[t],n=s[t+1];a+=Number(n-e)/1e6}return this.resultBuffer.unmap(),this.lastValue=a,a}catch(e){return"mapped"===this.resultBuffer.mapState&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){}if(this.resultBuffer&&"mapped"===this.resultBuffer.mapState)try{this.resultBuffer.unmap()}catch(e){}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class KF extends AU{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=void 0===e.alpha||e.alpha,this.parameters.requiredLimits=void 0===e.requiredLimits?{}:e.requiredLimits,this.trackTimestamp=!0===e.trackTimestamp,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new GF(this),this.attributeUtils=new qF(this),this.bindingUtils=new XF(this),this.pipelineUtils=new $F(this),this.textureUtils=new TF(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(void 0===t.device){const e={powerPreference:t.powerPreference},r="undefined"!=typeof navigator?await navigator.gpu.requestAdapter(e):null;if(null===r)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const i=Object.values(fF),s=[];for(const e of i)r.features.has(e)&&s.push(e);const a={requiredFeatures:s,requiredLimits:t.requiredLimits};n=await r.requestDevice(a)}else n=t.device;n.lost.then(t=>{const n={api:"WebGPU",message:t.message||"Unknown reason",reason:t.reason||null,originalEvent:t};e.onDeviceLost(n)});const r=void 0!==t.context?t.context:e.domElement.getContext("webgpu");this.device=n,this.context=r;const i=t.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(fF.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:i}),this.updateSize()}get coordinateSystem(){return Ut}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(null===e){const t=this.renderer;e={colorAttachments:[{view:null}]},!0!==this.renderer.depth&&!0!==this.renderer.stencil||(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(t.depth,t.stencil).createView()});const n=e.colorAttachments[0];this.renderer.samples>0?n.view=this.colorBuffer.createView():n.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_getRenderPassDescriptor(e,t={}){const n=e.renderTarget,r=this.get(n);let i=r.descriptors;if(void 0===i||r.width!==n.width||r.height!==n.height||r.dimensions!==n.dimensions||r.activeMipmapLevel!==n.activeMipmapLevel||r.activeCubeFace!==e.activeCubeFace||r.samples!==n.samples||r.loadOp!==t.loadOp){i={},r.descriptors=i;const e=()=>{n.removeEventListener("dispose",e),this.delete(n)};n.addEventListener("dispose",e)}const s=e.getCacheKey();let a=i[s];if(void 0===a){const o=e.textures,l=[];let u;for(let r=0;r<o.length;r++){const i=this.get(o[r]),s={label:`colorAttachment_${r}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:oF};n.isRenderTarget3D?(u=e.activeCubeFace,s.baseArrayLayer=0,s.dimension=cF,s.depthOrArrayLayers=o[r].image.depth):n.isRenderTargetArray&&(s.dimension=lF,s.depthOrArrayLayers=o[r].image.depth);const a=i.texture.createView(s);let c,d;void 0!==i.msaaTexture?(c=i.msaaTexture.createView(),d=a):(c=a,d=void 0);let h={r:0,g:0,b:0,a:1};0===r&&t.clearValue&&(h=t.clearValue),l.push({view:c,depthSlice:u,resolveTarget:d,loadOp:t.loadOP||oD,storeOp:t.storeOP||aD,clearValue:h})}if(a={colorAttachments:l},e.depth){const t={view:this.get(e.depthTexture).texture.createView()};a.depthStencilAttachment=t}i[s]=a,r.width=n.width,r.height=n.height,r.samples=n.samples,r.activeMipmapLevel=e.activeMipmapLevel,r.activeCubeFace=e.activeCubeFace,r.dimensions=n.dimensions,r.depthSlice=u,r.loadOp=l[0].loadOp}return a}beginRender(e){const t=this.get(e),n=this.device,r=e.occlusionQueryCount;let i,s;r>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,i=n.createQuerySet({type:"occlusion",count:r,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=i,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(r),t.lastOcclusionObject=null),s=null===e.textures?this._getDefaultRenderPassDescriptor():this._getRenderPassDescriptor(e,{loadOp:oD}),this.initTimestampQuery(e,s),s.occlusionQuerySet=i;const a=s.depthStencilAttachment;if(null!==e.textures){const t=s.colorAttachments;for(let n=0;n<t.length;n++){const r=t[n];e.clearColor?(r.clearValue=0===n?e.clearColorValue:{r:0,g:0,b:0,a:1},r.loadOp=lD,r.storeOp=aD):(r.loadOp=oD,r.storeOp=aD)}}else{const t=s.colorAttachments[0];e.clearColor?(t.clearValue=e.clearColorValue,t.loadOp=lD,t.storeOp=aD):(t.loadOp=oD,t.storeOp=aD)}e.depth&&(e.clearDepth?(a.depthClearValue=e.clearDepthValue,a.depthLoadOp=lD,a.depthStoreOp=aD):(a.depthLoadOp=oD,a.depthStoreOp=aD)),e.stencil&&(e.clearStencil?(a.stencilClearValue=e.clearStencilValue,a.stencilLoadOp=lD,a.stencilStoreOp=aD):(a.stencilLoadOp=oD,a.stencilStoreOp=aD));const o=n.createCommandEncoder({label:"renderContext_"+e.id}),l=o.beginRenderPass(s);if(t.descriptor=s,t.encoder=o,t.currentPass=l,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[],e.viewport&&this.updateViewport(e),e.scissor){const{x:t,y:n,width:r,height:i}=e.scissorValue;l.setScissorRect(t,n,r,i)}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;if(t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery(),t.currentPass.end(),n>0){const r=8*n;let i=this.occludedResolveCache.get(r);void 0===i&&(i=this.device.createBuffer({size:r,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(r,i));const s=this.device.createBuffer({size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,i,0),t.encoder.copyBufferToBuffer(i,0,s,0,r),t.occlusionQueryBuffer=s,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),null!==e.textures){const t=e.textures;for(let e=0;e<t.length;e++){const n=t[e];!0===n.generateMipmaps&&this.textureUtils.generateMipmaps(n)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:r}=t;if(n&&r){const e=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const i=n.getMappedRange(),s=new BigUint64Array(i);for(let t=0;t<r.length;t++)s[t]===BigInt(0)&&e.add(r[t]);n.destroy(),t.occluded=e}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:r,width:i,height:s,minDepth:a,maxDepth:o}=e.viewportValue;t.setViewport(n,r,i,s,a,o)}getClearColor(){const e=super.getClearColor();return!0===this.renderer.alpha&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,r=null){const i=this.device,s=this.renderer;let a,o,l,u,c=[];if(e){const e=this.getClearColor();o={r:e.r,g:e.g,b:e.b,a:e.a}}if(null===r){l=s.depth,u=s.stencil;const t=this._getDefaultRenderPassDescriptor();if(e){c=t.colorAttachments;const e=c[0];e.clearValue=o,e.loadOp=lD,e.storeOp=aD}(l||u)&&(a=t.depthStencilAttachment)}else{if(l=r.depth,u=r.stencil,e){c=this._getRenderPassDescriptor(r,{loadOp:lD,clearValue:o}).colorAttachments}if(l||u){a={view:this.get(r.depthTexture).texture.createView()}}}l&&(t?(a.depthLoadOp=lD,a.depthClearValue=s.getClearDepth(),a.depthStoreOp=aD):(a.depthLoadOp=oD,a.depthStoreOp=aD)),u&&(n?(a.stencilLoadOp=lD,a.stencilClearValue=s.getClearStencil(),a.stencilStoreOp=aD):(a.stencilLoadOp=oD,a.stencilStoreOp=aD));const d=i.createCommandEncoder({label:"clear"});d.beginRenderPass({colorAttachments:c,depthStencilAttachment:a}).end(),i.queue.submit([d.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(e,n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,r){const{passEncoderGPU:i}=this.get(e),s=this.get(r).pipeline;i.setPipeline(s);for(let e=0,t=n.length;e<t;e++){const t=n[e],r=this.get(t);i.setBindGroup(e,r.group)}const a=this.device.limits.maxComputeWorkgroupsPerDimension,o=this.get(t);void 0===o.dispatchSize&&(o.dispatchSize={x:0,y:1,z:1});const{dispatchSize:l}=o;t.dispatchCount>a?(l.x=Math.min(t.dispatchCount,a),l.y=Math.ceil(t.dispatchCount/a)):l.x=t.dispatchCount,i.dispatchWorkgroups(l.x,l.y,l.z)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:n,material:r,context:i,pipeline:s}=e,a=e.getBindings(),o=this.get(i),l=this.get(s).pipeline,u=o.currentSets,c=o.currentPass,d=e.getDrawParameters();if(null===d)return;u.pipeline!==l&&(c.setPipeline(l),u.pipeline=l);const h=u.bindingGroups;for(let e=0,t=a.length;e<t;e++){const t=a[e],n=this.get(t);h[t.index]!==t.id&&(c.setBindGroup(t.index,n.group),h[t.index]=t.id)}const p=e.getIndex(),f=null!==p;if(!0===f&&u.index!==p){const e=this.get(p).buffer,t=p.array instanceof Uint16Array?pD:fD;c.setIndexBuffer(e,t),u.index=p}const m=e.getVertexBuffers();for(let e=0,t=m.length;e<t;e++){const t=m[e];if(u.attributes[e]!==t){const n=this.get(t).buffer;c.setVertexBuffer(e,n),u.attributes[e]=t}}if(void 0!==o.occlusionQuerySet){const e=o.lastOcclusionObject;e!==n&&(null!==e&&!0===e.occlusionTest&&(c.endOcclusionQuery(),o.occlusionQueryIndex++),!0===n.occlusionTest&&(c.beginOcclusionQuery(o.occlusionQueryIndex),o.occlusionQueryObjects[o.occlusionQueryIndex]=n),o.lastOcclusionObject=n)}!0===i.stencil&&!0===r.stencilWrite&&o.currentStencilRef!==r.stencilRef&&(c.setStencilReference(r.stencilRef),o.currentStencilRef=r.stencilRef);const g=()=>{if(!0===n.isBatchedMesh){const e=n._multiDrawStarts,r=n._multiDrawCounts,i=n._multiDrawCount,s=n._multiDrawInstances;null!==s&&nn("THREE.WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let a=0;a<i;a++){const i=s?s[a]:1,o=i>1?0:a;!0===f?c.drawIndexed(r[a],i,e[a]/p.array.BYTES_PER_ELEMENT,0,o):c.draw(r[a],i,e[a],o),t.update(n,r[a],i)}}else if(!0===f){const{vertexCount:r,instanceCount:i,firstVertex:s}=d,a=e.getIndirect();if(null!==a){const e=this.get(a).buffer;c.drawIndexedIndirect(e,0)}else c.drawIndexed(r,i,s,0,0);t.update(n,r,i)}else{const{vertexCount:r,instanceCount:i,firstVertex:s}=d,a=e.getIndirect();if(null!==a){const e=this.get(a).buffer;c.drawIndirect(e,0)}else c.draw(r,i,s,0);t.update(n,r,i)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const t=this.get(e.camera),r=e.camera.cameras,s=e.getBindingGroup("cameraIndex");if(void 0===t.indexesGPU||t.indexesGPU.length!==r.length){const e=this.get(s),n=[],i=new Uint32Array([0,0,0,0]);for(let t=0,s=r.length;t<s;t++){i[0]=t;const r=this.bindingUtils.createBindGroupIndex(i,e.layout);n.push(r)}t.indexesGPU=n}const a=this.renderer.getPixelRatio();for(let e=0,o=r.length;e<o;e++){const o=r[e];if(n.layers.test(o.layers)){const n=o.viewport;c.setViewport(Math.floor(n.x*a),Math.floor(n.y*a),Math.floor(n.width*a),Math.floor(n.height*a),i.viewportValue.minDepth,i.viewportValue.maxDepth),c.setBindGroup(s.index,t.indexesGPU[e]),g()}}}else g()}needsRenderUpdate(e){const t=this.get(e),{object:n,material:r}=e,i=this.utils,s=i.getSampleCountRenderContext(e.context),a=i.getCurrentColorSpace(e.context),o=i.getCurrentColorFormat(e.context),l=i.getCurrentDepthStencilFormat(e.context),u=i.getPrimitiveTopology(n,r);let c=!1;return t.material===r&&t.materialVersion===r.version&&t.transparent===r.transparent&&t.blending===r.blending&&t.premultipliedAlpha===r.premultipliedAlpha&&t.blendSrc===r.blendSrc&&t.blendDst===r.blendDst&&t.blendEquation===r.blendEquation&&t.blendSrcAlpha===r.blendSrcAlpha&&t.blendDstAlpha===r.blendDstAlpha&&t.blendEquationAlpha===r.blendEquationAlpha&&t.colorWrite===r.colorWrite&&t.depthWrite===r.depthWrite&&t.depthTest===r.depthTest&&t.depthFunc===r.depthFunc&&t.stencilWrite===r.stencilWrite&&t.stencilFunc===r.stencilFunc&&t.stencilFail===r.stencilFail&&t.stencilZFail===r.stencilZFail&&t.stencilZPass===r.stencilZPass&&t.stencilFuncMask===r.stencilFuncMask&&t.stencilWriteMask===r.stencilWriteMask&&t.side===r.side&&t.alphaToCoverage===r.alphaToCoverage&&t.sampleCount===s&&t.colorSpace===a&&t.colorFormat===o&&t.depthStencilFormat===l&&t.primitiveTopology===u&&t.clippingContextCacheKey===e.clippingContextCacheKey||(t.material=r,t.materialVersion=r.version,t.transparent=r.transparent,t.blending=r.blending,t.premultipliedAlpha=r.premultipliedAlpha,t.blendSrc=r.blendSrc,t.blendDst=r.blendDst,t.blendEquation=r.blendEquation,t.blendSrcAlpha=r.blendSrcAlpha,t.blendDstAlpha=r.blendDstAlpha,t.blendEquationAlpha=r.blendEquationAlpha,t.colorWrite=r.colorWrite,t.depthWrite=r.depthWrite,t.depthTest=r.depthTest,t.depthFunc=r.depthFunc,t.stencilWrite=r.stencilWrite,t.stencilFunc=r.stencilFunc,t.stencilFail=r.stencilFail,t.stencilZFail=r.stencilZFail,t.stencilZPass=r.stencilZPass,t.stencilFuncMask=r.stencilFuncMask,t.stencilWriteMask=r.stencilWriteMask,t.side=r.side,t.alphaToCoverage=r.alphaToCoverage,t.sampleCount=s,t.colorSpace=a,t.colorFormat=o,t.depthStencilFormat=l,t.primitiveTopology=u,t.clippingContextCacheKey=e.clippingContextCacheKey,c=!0),c}getRenderCacheKey(e){const{object:t,material:n}=e,r=this.utils,i=e.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,r.getSampleCountRenderContext(i),r.getCurrentColorSpace(i),r.getCurrentColorFormat(i),r.getCurrentDepthStencilFormat(i),r.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,r,i,s){return this.textureUtils.copyTextureToBuffer(e,t,n,r,i,s)}initTimestampQuery(e,t){if(!this.trackTimestamp)return;const n=e.isComputeNode?"compute":"render";this.timestampQueryPool[n]||(this.timestampQueryPool[n]=new YF(this.device,n,2048));const r=this.timestampQueryPool[n],i=r.allocateQueriesForContext(e);t.timestampWrites={querySet:r.querySet,beginningOfPassWriteIndex:i,endOfPassWriteIndex:i+1}}createNodeBuilder(e,t){return new VF(e,t)}createProgram(e){this.get(e).module={module:this.device.createShaderModule({code:e.code,label:e.stage+(""!==e.name?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),r=n.currentPass.finish();this.get(t).bundleGPU=r,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBindings(e,t,n,r){this.bindingUtils.createBindings(e,t,n,r)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t,n=null,r=null,i=0){let s=0,a=0,o=0,l=0,u=0,c=0,d=e.image.width,h=e.image.height;null!==n&&(l=n.x,u=n.y,c=n.z||0,d=n.width,h=n.height),null!==r&&(s=r.x,a=r.y,o=r.z||0);const p=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),f=this.get(e).texture,m=this.get(t).texture;p.copyTextureToTexture({texture:f,mipLevel:i,origin:{x:l,y:u,z:c}},{texture:m,mipLevel:i,origin:{x:s,y:a,z:o}},[d,h,1]),this.device.queue.submit([p.finish()])}copyFramebufferToTexture(e,t,n){const r=this.get(t);let i=null;i=t.renderTarget?e.isDepthTexture?this.get(t.depthTexture).texture:this.get(t.textures[0]).texture:e.isDepthTexture?this.textureUtils.getDepthBuffer(t.depth,t.stencil):this.context.getCurrentTexture();const s=this.get(e).texture;if(i.format!==s.format)return;let a;if(r.currentPass?(r.currentPass.end(),a=r.encoder):a=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),a.copyTextureToTexture({texture:i,origin:[n.x,n.y,0]},{texture:s},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e),r.currentPass){const{descriptor:e}=r;for(let t=0;t<e.colorAttachments.length;t++)e.colorAttachments[t].loadOp=oD;if(t.depth&&(e.depthStencilAttachment.depthLoadOp=oD),t.stencil&&(e.depthStencilAttachment.stencilLoadOp=oD),r.currentPass=a.beginRenderPass(e),r.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:e,y:n,width:i,height:s}=t.scissorValue;r.currentPass.setScissorRect(e,n,i,s)}}else this.device.queue.submit([a.finish()])}}class QF extends iu{constructor(e,t,n,r,i,s){super(e,t,n,r,i,s),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class ZF extends VL{constructor(){super(),this.addMaterial(lM,"MeshPhongMaterial"),this.addMaterial(YE,"MeshStandardMaterial"),this.addMaterial(QE,"MeshPhysicalMaterial"),this.addMaterial(tA,"MeshToonMaterial"),this.addMaterial(Jw,"MeshBasicMaterial"),this.addMaterial(aM,"MeshLambertMaterial"),this.addMaterial(kw,"MeshNormalMaterial"),this.addMaterial(sA,"MeshMatcapMaterial"),this.addMaterial(Pw,"LineBasicMaterial"),this.addMaterial(Lw,"LineDashedMaterial"),this.addMaterial(dA,"PointsMaterial"),this.addMaterial(uA,"SpriteMaterial"),this.addMaterial(fA,"ShadowMaterial"),this.addLight(RP,uu),this.addLight(mL,hu),this.addLight(_L,fu),this.addLight(xL,iu),this.addLight(SL,pu),this.addLight(TL,Zl),this.addLight(wL,gu),this.addLight(bL,QF),this.addToneMapping(qR,1),this.addToneMapping(XR,2),this.addToneMapping($R,3),this.addToneMapping(KR,4),this.addToneMapping(eN,6),this.addToneMapping(tN,7)}}class JF extends aU{constructor(e={}){let t;e.forceWebGL?t=qU:(t=KF,e.getFallback=()=>new qU(e));super(new t(e),e),this.library=new ZF,this.isWebGPURenderer=!0}}class eB{constructor(e,t=sv(0,0,1,1)){this.renderer=e,this.outputNode=t,this.outputColorTransform=!0,this.needsUpdate=!0;const n=new Rw;n.name="PostProcessing",this._quadMesh=new YC(n)}render(){this._update();const e=this.renderer,t=e.toneMapping,n=e.outputColorSpace;e.toneMapping=0,e.outputColorSpace=vt;const r=e.xr.enabled;e.xr.enabled=!1,this._quadMesh.render(e),e.xr.enabled=r,e.toneMapping=t,e.outputColorSpace=n}dispose(){this._quadMesh.material.dispose()}_update(){if(!0===this.needsUpdate){const e=this.renderer,t=e.toneMapping,n=e.outputColorSpace;this._quadMesh.material.fragmentNode=!0===this.outputColorTransform?Dx(this.outputNode,t,n):this.outputNode.context({toneMapping:t,outputColorSpace:n}),this._quadMesh.material.needsUpdate=!0,this.needsUpdate=!1}}async renderAsync(){this._update();const e=this.renderer,t=e.toneMapping,n=e.outputColorSpace;e.toneMapping=0,e.outputColorSpace=vt;const r=e.xr.enabled;e.xr.enabled=!1,await this._quadMesh.renderAsync(e),e.xr.enabled=r,e.toneMapping=t,e.outputColorSpace=n}}II.BRDF_GGX,II.BRDF_Lambert,II.BasicShadowFilter,II.Break,II.Continue,II.DFGApprox,II.D_GGX,II.Discard,II.EPSILON,II.F_Schlick;const tB=II.Fn;II.INFINITY,II.If;const nB=II.Loop;II.NodeShaderStage,II.NodeType,II.NodeUpdateType,II.NodeAccess,II.PCFShadowFilter,II.PCFSoftShadowFilter,II.PI,II.PI2,II.Return,II.Schlick_to_F0,II.ScriptableNodeResources;const rB=II.ShaderNode;II.TBNViewMatrix,II.VSMShadowFilter,II.V_GGX_SmithCorrelated;const iB=II.abs;II.acesFilmicToneMapping,II.acos;const sB=II.add;II.addNodeElement,II.agxToneMapping,II.all,II.alphaT,II.and,II.anisotropy,II.anisotropyB,II.anisotropyT,II.any,II.append,II.array,II.arrayBuffer,II.asin,II.assign,II.atan,II.atan2,II.atomicAdd,II.atomicAnd,II.atomicFunc,II.atomicMax,II.atomicMin,II.atomicOr,II.atomicStore,II.atomicSub,II.atomicXor,II.atomicLoad,II.attenuationColor,II.attenuationDistance,II.attribute,II.attributeArray,II.backgroundBlurriness,II.backgroundIntensity,II.backgroundRotation,II.batch,II.billboarding,II.bitAnd,II.bitNot,II.bitOr,II.bitXor,II.bitangentGeometry,II.bitangentLocal,II.bitangentView,II.bitangentWorld,II.bitcast,II.blendBurn,II.blendColor,II.blendDodge,II.blendOverlay;const aB=II.blendScreen;II.blur,II.bool,II.buffer,II.bufferAttribute,II.bumpMap,II.burn,II.bvec2,II.bvec3,II.bvec4,II.bypass,II.cache,II.call,II.cameraFar,II.cameraIndex,II.cameraNear,II.cameraNormalMatrix,II.cameraPosition,II.cameraProjectionMatrix,II.cameraProjectionMatrixInverse,II.cameraViewMatrix,II.cameraWorldMatrix,II.cbrt,II.cdl,II.ceil,II.checker,II.cineonToneMapping,II.clamp,II.clearcoat,II.clearcoatRoughness,II.code,II.color,II.colorSpaceToWorking,II.colorToDirection,II.compute,II.cond,II.Const,II.context,II.convert,II.convertColorSpace,II.convertToTexture,II.cos,II.cross,II.cubeTexture,II.dFdx,II.dFdy,II.dashSize,II.defaultBuildStages,II.defaultShaderStages,II.defined,II.degrees,II.deltaTime,II.densityFog,II.densityFogFactor,II.depth,II.depthPass,II.difference,II.diffuseColor,II.directPointLight,II.directionToColor,II.dispersion,II.distance,II.div,II.dodge,II.dot,II.drawIndex,II.dynamicBufferAttribute,II.element,II.emissive,II.equal,II.equals,II.equirectUV,II.exp,II.exp2,II.expression,II.faceDirection,II.faceForward,II.faceforward;const oB=II.float;II.floor,II.fog,II.fract,II.frameGroup,II.frameId,II.frontFacing,II.fwidth,II.gain,II.gapSize,II.getConstNodeType,II.getCurrentStack,II.getDirection,II.getDistanceAttenuation,II.getGeometryRoughness,II.getNormalFromDepth,II.getParallaxCorrectNormal,II.getRoughness,II.getScreenPosition,II.getShIrradianceAt,II.getTextureIndex,II.getViewPosition,II.glsl,II.glslFn,II.grayscale,II.greaterThan,II.greaterThanEqual,II.hash,II.highpModelNormalViewMatrix,II.highpModelViewMatrix,II.hue,II.instance,II.instanceIndex,II.instancedArray,II.instancedBufferAttribute,II.instancedDynamicBufferAttribute,II.instancedMesh;const lB=II.int;II.inverseSqrt,II.inversesqrt,II.invocationLocalIndex,II.invocationSubgroupIndex,II.ior,II.iridescence,II.iridescenceIOR,II.iridescenceThickness,II.ivec2,II.ivec3,II.ivec4,II.js,II.label,II.length,II.lengthSq,II.lessThan,II.lessThanEqual,II.lightPosition,II.lightTargetDirection,II.lightTargetPosition,II.lightViewPosition,II.lightingContext,II.lights,II.linearDepth,II.linearToneMapping,II.localId,II.globalId,II.log,II.log2,II.logarithmicDepthToViewZ,II.loop;const uB=II.luminance;II.mediumpModelViewMatrix,II.mat2,II.mat3,II.mat4,II.matcapUV,II.materialAO,II.materialAlphaTest,II.materialAnisotropy,II.materialAnisotropyVector,II.materialAttenuationColor,II.materialAttenuationDistance,II.materialClearcoat,II.materialClearcoatNormal,II.materialClearcoatRoughness,II.materialColor,II.materialDispersion,II.materialEmissive,II.materialIOR,II.materialIridescence,II.materialIridescenceIOR,II.materialIridescenceThickness,II.materialLightMap,II.materialLineDashOffset,II.materialLineDashSize,II.materialLineGapSize,II.materialLineScale,II.materialLineWidth,II.materialMetalness,II.materialNormal,II.materialOpacity,II.materialPointSize,II.materialReference,II.materialReflectivity,II.materialRefractionRatio,II.materialRotation,II.materialRoughness,II.materialSheen,II.materialSheenRoughness,II.materialShininess,II.materialSpecular,II.materialSpecularColor,II.materialSpecularIntensity,II.materialSpecularStrength,II.materialThickness,II.materialTransmission;const cB=II.max;II.maxMipLevel,II.metalness,II.min;const dB=II.mix;II.mixElement;const hB=II.mod;II.modInt,II.modelDirection,II.modelNormalMatrix,II.modelPosition,II.modelRadius,II.modelScale,II.modelViewMatrix,II.modelViewPosition,II.modelViewProjection,II.modelWorldMatrix,II.modelWorldMatrixInverse,II.morphReference,II.mrt,II.mul,II.mx_aastep;const pB=II.mx_cell_noise_float;II.mx_contrast,II.mx_fractal_noise_float,II.mx_fractal_noise_vec2,II.mx_fractal_noise_vec3,II.mx_fractal_noise_vec4,II.mx_hsvtorgb,II.mx_noise_float,II.mx_noise_vec3,II.mx_noise_vec4,II.mx_ramplr,II.mx_ramptb,II.mx_rgbtohsv,II.mx_safepower,II.mx_splitlr,II.mx_splittb,II.mx_srgb_texture_to_lin_rec709,II.mx_transform_uv,II.mx_worley_noise_float,II.mx_worley_noise_vec2,II.mx_worley_noise_vec3,II.negate,II.neutralToneMapping,II.nodeArray,II.nodeImmutable;const fB=II.nodeObject;II.nodeObjects,II.nodeProxy,II.normalFlat,II.normalGeometry,II.normalLocal,II.normalMap,II.normalView,II.normalWorld,II.normalize,II.not,II.notEqual,II.numWorkgroups,II.objectDirection,II.objectGroup,II.objectPosition,II.objectRadius,II.objectScale,II.objectViewPosition,II.objectWorldMatrix;const mB=II.oneMinus;II.or,II.orthographicDepthToViewZ,II.oscSawtooth,II.oscSine,II.oscSquare,II.oscTriangle,II.output,II.outputStruct,II.overlay,II.overloadingFn,II.parabola,II.parallaxDirection,II.parallaxUV,II.parameter;const gB=II.pass,vB=II.passTexture;II.pcurve,II.perspectiveDepthToViewZ,II.pmremTexture,II.pointUV,II.pointWidth,II.positionGeometry,II.positionLocal,II.positionPrevious,II.positionView,II.positionViewDirection,II.positionWorld,II.positionWorldDirection,II.posterize,II.pow,II.pow2,II.pow3,II.pow4,II.property,II.radians,II.rand,II.range,II.rangeFog,II.rangeFogFactor,II.reciprocal,II.lightProjectionUV,II.reference,II.referenceBuffer,II.reflect,II.reflectVector,II.reflectView,II.reflector,II.refract,II.refractVector,II.refractView,II.reinhardToneMapping,II.remainder,II.remap,II.remapClamp,II.renderGroup,II.renderOutput,II.rendererReference,II.rotate,II.rotateUV,II.roughness,II.round,II.rtt,II.sRGBTransferEOTF,II.sRGBTransferOETF,II.sampler,II.saturate,II.saturation,II.screen,II.screenCoordinate,II.screenSize,II.screenUV,II.scriptable,II.scriptableValue;const yB=II.select;II.setCurrentStack,II.shaderStages,II.shadow,II.pointShadow,II.shadowPositionWorld,II.sharedUniformGroup,II.shapeCircle,II.sheen,II.sheenRoughness,II.shiftLeft,II.shiftRight,II.shininess,II.sign,II.sin,II.sinc,II.skinning,II.skinningReference;const _B=II.smoothstep;II.smoothstepElement,II.specularColor,II.specularF90,II.spherizeUV,II.split,II.spritesheetUV,II.sqrt,II.stack,II.step,II.storage,II.storageBarrier,II.storageObject,II.storageTexture,II.string,II.struct;const xB=II.sub;II.subgroupIndex,II.subgroupSize,II.tan,II.tangentGeometry,II.tangentLocal,II.tangentView,II.tangentWorld,II.temp;const bB=II.texture;II.texture3D,II.textureBarrier,II.textureBicubic,II.textureCubeUV,II.textureLoad,II.textureSize,II.textureStore,II.thickness,II.threshold,II.time,II.timerDelta,II.timerGlobal,II.timerLocal,II.toOutputColorSpace,II.toWorkingColorSpace,II.toneMapping,II.toneMappingExposure,II.toonOutlinePass,II.transformDirection,II.transformNormal,II.transformNormalToView,II.transformedBentNormalView,II.transformedBitangentView,II.transformedBitangentWorld,II.transformedClearcoatNormalView,II.transformedNormalView,II.transformedNormalWorld,II.transformedTangentView,II.transformedTangentWorld,II.transmission,II.transpose,II.tri,II.tri3,II.triNoise3D,II.triplanarTexture,II.triplanarTextures,II.trunc,II.tslFn,II.uint;const SB=II.uniform,TB=II.uniformArray;II.uniformGroup,II.uniforms,II.userData;const wB=II.uv;II.uvec2,II.uvec3,II.uvec4,II.Var,II.varying,II.varyingProperty;const MB=II.vec2,EB=II.vec3,AB=II.vec4;II.vectorComponents,II.velocity,II.vertexColor,II.vertexIndex,II.vibrance,II.viewZToLogarithmicDepth,II.viewZToOrthographicDepth,II.viewZToPerspectiveDepth,II.viewport,II.viewportBottomLeft,II.viewportCoordinate,II.viewportDepthTexture,II.viewportLinearDepth,II.viewportMipTexture,II.viewportResolution,II.viewportSafeUV,II.viewportSharedTexture,II.viewportSize,II.viewportTexture,II.viewportTopLeft,II.viewportUV,II.wgsl,II.wgslFn,II.workgroupArray,II.workgroupBarrier,II.workgroupId,II.workingToColorSpace,II.xor;const CB=new YC,RB=new Xt,NB=new Xt(1,0),PB=new Xt(0,1);let IB;class LB extends Qm{static get type(){return"BloomNode"}constructor(e,t=1,n=0,r=0){super("vec4"),this.inputNode=e,this.strength=SB(t),this.radius=SB(n),this.threshold=SB(r),this.smoothWidth=SB(.01),this._renderTargetsHorizontal=[],this._renderTargetsVertical=[],this._nMips=5,this._renderTargetBright=new yn(1,1,{depthBuffer:!1,type:he}),this._renderTargetBright.texture.name="UnrealBloomPass.bright",this._renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this._nMips;e++){const t=new yn(1,1,{depthBuffer:!1,type:he});t.texture.name="UnrealBloomPass.h"+e,t.texture.generateMipmaps=!1,this._renderTargetsHorizontal.push(t);const n=new yn(1,1,{depthBuffer:!1,type:he});n.texture.name="UnrealBloomPass.v"+e,n.texture.generateMipmaps=!1,this._renderTargetsVertical.push(n)}this._compositeMaterial=null,this._highPassFilterMaterial=null,this._separableBlurMaterials=[],this._textureNodeBright=bB(this._renderTargetBright.texture),this._textureNodeBlur0=bB(this._renderTargetsVertical[0].texture),this._textureNodeBlur1=bB(this._renderTargetsVertical[1].texture),this._textureNodeBlur2=bB(this._renderTargetsVertical[2].texture),this._textureNodeBlur3=bB(this._renderTargetsVertical[3].texture),this._textureNodeBlur4=bB(this._renderTargetsVertical[4].texture),this._textureOutput=vB(this,this._renderTargetsHorizontal[0].texture),this.updateBeforeType=Vm.FRAME}getTextureNode(){return this._textureOutput}setSize(e,t){let n=Math.round(e/2),r=Math.round(t/2);this._renderTargetBright.setSize(n,r);for(let e=0;e<this._nMips;e++)this._renderTargetsHorizontal[e].setSize(n,r),this._renderTargetsVertical[e].setSize(n,r),this._separableBlurMaterials[e].invSize.value.set(1/n,1/r),n=Math.round(n/2),r=Math.round(r/2)}updateBefore(e){const{renderer:t}=e;IB=tP.resetRendererState(t,IB);const n=t.getDrawingBufferSize(RB);this.setSize(n.width,n.height),t.setRenderTarget(this._renderTargetBright),CB.material=this._highPassFilterMaterial,CB.render(t);let r=this._renderTargetBright;for(let e=0;e<this._nMips;e++)CB.material=this._separableBlurMaterials[e],this._separableBlurMaterials[e].colorTexture.value=r.texture,this._separableBlurMaterials[e].direction.value=NB,t.setRenderTarget(this._renderTargetsHorizontal[e]),CB.render(t),this._separableBlurMaterials[e].colorTexture.value=this._renderTargetsHorizontal[e].texture,this._separableBlurMaterials[e].direction.value=PB,t.setRenderTarget(this._renderTargetsVertical[e]),CB.render(t),r=this._renderTargetsVertical[e];t.setRenderTarget(this._renderTargetsHorizontal[0]),CB.material=this._compositeMaterial,CB.render(t),tP.restoreRendererState(t,IB)}setup(e){const t=tB(()=>{const e=this.inputNode,t=uB(e.rgb),n=_B(this.threshold,this.threshold.add(this.smoothWidth),t);return dB(AB(0),e,n)});this._highPassFilterMaterial=this._highPassFilterMaterial||new Rw,this._highPassFilterMaterial.fragmentNode=t().context(e.getSharedContext()),this._highPassFilterMaterial.name="Bloom_highPass",this._highPassFilterMaterial.needsUpdate=!0;const n=[3,5,7,9,11];for(let t=0;t<this._nMips;t++)this._separableBlurMaterials.push(this._getSeparableBlurMaterial(e,n[t]));const r=TB([1,.8,.6,.4,.2]),i=TB([new Tn(1,1,1),new Tn(1,1,1),new Tn(1,1,1),new Tn(1,1,1),new Tn(1,1,1)]),s=tB(([e,t])=>{const n=oB(1.2).sub(e);return dB(e,n,t)}).setLayout({name:"lerpBloomFactor",type:"float",inputs:[{name:"factor",type:"float"},{name:"radius",type:"float"}]}),a=tB(()=>{const e=s(r.element(0),this.radius).mul(AB(i.element(0),1)).mul(this._textureNodeBlur0),t=s(r.element(1),this.radius).mul(AB(i.element(1),1)).mul(this._textureNodeBlur1),n=s(r.element(2),this.radius).mul(AB(i.element(2),1)).mul(this._textureNodeBlur2),a=s(r.element(3),this.radius).mul(AB(i.element(3),1)).mul(this._textureNodeBlur3),o=s(r.element(4),this.radius).mul(AB(i.element(4),1)).mul(this._textureNodeBlur4);return e.add(t).add(n).add(a).add(o).mul(this.strength)});return this._compositeMaterial=this._compositeMaterial||new Rw,this._compositeMaterial.fragmentNode=a().context(e.getSharedContext()),this._compositeMaterial.name="Bloom_comp",this._compositeMaterial.needsUpdate=!0,this._textureOutput}dispose(){for(let e=0;e<this._renderTargetsHorizontal.length;e++)this._renderTargetsHorizontal[e].dispose();for(let e=0;e<this._renderTargetsVertical.length;e++)this._renderTargetsVertical[e].dispose();this._renderTargetBright.dispose()}_getSeparableBlurMaterial(e,t){const n=[];for(let e=0;e<t;e++)n.push(.39894*Math.exp(-.5*e*e/(t*t))/t);const r=bB(),i=TB(n),s=SB(new Xt),a=SB(new Xt(.5,.5)),o=wB(),l=e=>r.sample(e),u=tB(()=>{const e=i.element(0).toVar(),n=l(o).rgb.mul(e).toVar();return nB({start:lB(1),end:lB(t),type:"int",condition:"<"},({i:t})=>{const r=oB(t),u=i.element(t),c=a.mul(s).mul(r),d=l(o.add(c)).rgb,h=l(o.sub(c)).rgb;n.addAssign(sB(d,h).mul(u)),e.addAssign(oB(2).mul(u))}),AB(n.div(e),1)}),c=new Rw;return c.fragmentNode=u().context(e.getSharedContext()),c.name="Bloom_separable",c.needsUpdate=!0,c.colorTexture=r,c.direction=a,c.invSize=s,c}}const UB=(e,t,n,r)=>fB(new LB(fB(e),t,n,r));export{m as AdditiveBlending,ym as Canvas,Ba as CanvasTexture,tB as Fn,Yr as MeshBasicMaterial,Jw as MeshBasicNodeMaterial,gt as SRGBColorSpace,rB as ShaderNode,gn as Texture,Kl as TextureLoader,eB as ThreePostProcessing,Xt as Vector2,JF as WebGPURenderer,iB as abs,aB as blendScreen,UB as bloom,Gp as extend,oB as float,cB as max,hB as mod,pB as mx_cell_noise_float,mB as oneMinus,gB as pass,yB as select,_B as smoothstep,xB as sub,bB as texture,SB as uniform,bm as useAspect,Lf as useFrame,xm as useTexture,If as useThree,wB as uv,MB as vec2,EB as vec3};
